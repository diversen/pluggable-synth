(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
const noteParser = require('note-parser')
const octave1 = require('./keyboard-tones.js').octave1;
const jsCssPiano = require('js-css-piano');
const webmidi = require('webmidi')

var keys = {};

jsCssPiano.prototype = {

    getFrequency: function (note) {
        note = note.replace('s', '#');
        let res = noteParser.parse(note)
        let freq = res.freq;
        return freq;
    },

    synth: function () {
        console.log('set a synth')
    },

    toggleKey: function (note) {
        let selector = '#' + this.elemID + " > .piano li[data-note='" + note + "']"
        let elem = document.querySelector(selector)
        if (!elem) {
            return
        }
        elem.classList.toggle('active');
    },

    synthStart: function (note, options) {
        note = note.toLowerCase()
        this.toggleKey(note)
        let freq = this.getFrequency(note);
        let synth = new this.synth();

        synth.start(freq, options);
        keys[note] = synth;
    },

    synthStop: function (note) {
        note = note.toLowerCase()
        this.toggleKey(note)
        let synth = keys[note]
        synth.stop()
        delete keys[note]
    },

    // Enable one or two octaves on keyboard
    enableKeyboardEvents: function () {
        document.addEventListener("keydown", (e) => {

            var k = e.key;
            let note = octave1[k] + this.options.octaveBegin

            if (k in octave1 && !(note in keys)) {
                this.synthStart(note);
            }
        });

        document.addEventListener("keyup", (e) => {

            let octave = this.options.octaveBegin
            var k = e.key;
            let note = octave1[k] + octave;
            if (k in octave1 && (note in keys)) {
                this.synthStop(note)
            }
        });
    },

    // Enable midi keyboard
    enableMidiEvents: function () {
        webmidi.enable((err) => {

            if (err) {
                console.log("WebMidi could not be enabled.", err);
                return;
            } else {
                console.log("WebMidi enabled!");
            }

            console.log(webmidi.inputs)
            var midiInput = webmidi.inputs[1];

            midiInput.addListener('noteon', "all", (e) => {

                let octave = parseInt(e.note.octave)
                let note = e.note.name + octave
                note = note.replace('#', 's')

                if (!(note in keys)) {
                    this.synthStart(note, e);
                }
            });

            midiInput.addListener('noteoff', "all", (e) => {
                let octave = parseInt(e.note.octave);
                let note = e.note.name + octave;

                note = note.replace('#', 's')

                this.synthStop(note)

            }
            );
        });
    }
}

module.exports = jsCssPiano;

},{"./keyboard-tones.js":2,"js-css-piano":3,"note-parser":4,"webmidi":5}],2:[function(require,module,exports){
var keyboardTones = {}

keyboardTones.octave1 = {
    a: 'c',
    w: 'cs',
    s: 'd',
    e: 'ds',
    d: 'e',
    f: 'f',
    t: 'fs',
    g: 'g',
    y: 'gs',
    h: 'a',
    u: 'as',
    j: 'b'
};


keyboardTones.octave2 = {
    q: 'c',
    2: 'cs',
    w: 'd',
    3: 'ds',
    e: 'e',
    r: 'f',
    5: 'fs',
    t: 'g',
    6: 'gs',
    y: 'a',
    7: 'as',
    u: 'b'
};

module.exports = keyboardTones;
},{}],3:[function(require,module,exports){
function piano(elemID, opts) {

    this.elemID = elemID
    this.elem = document.getElementById(elemID)
    
    this.defaults = {
        octaves: 2,
        octaveBegin: 3
    }

    this.options = {}
    Object.assign(this.options, this.defaults, opts)
    
    this.createPiano = function () {
        let html = this.getPianoHTML()
        this.elem.innerHTML = html
    }

    this.getPianoHTML = function () {
        
        let octaveBegin = this.options.octaveBegin
        let html = `<ul class="piano">`
        for (i = 1; i <= this.options.octaves; i++) {  
            html += this.getTones(octaveBegin)
            octaveBegin++ 
        }
        html += `</ul>`
        return html
    }

    this.getNoteAndOctave = function (note, octave) {
        return note + octave
    }

    this.getTones = function (octave) {
        let octaveHTML = 
        `
            <li class="white c" data-note="${this.getNoteAndOctave('c', octave)}"></li>
            <li class="black cs" data-note="${this.getNoteAndOctave('cs', octave)}"></li>
            <li class="white d" data-note="${this.getNoteAndOctave('d', octave)}"></li>
            <li class="black ds" data-note="${this.getNoteAndOctave('ds', octave)}"></li>
            <li class="white e" data-note="${this.getNoteAndOctave('e', octave)}"></li>
            <li class="white f" data-note="${this.getNoteAndOctave('f', octave)}"></li>
            <li class="black fs" data-note="${this.getNoteAndOctave('fs', octave)}"></li>
            <li class="white g" data-note="${this.getNoteAndOctave('g', octave)}"></li>
            <li class="black gs" data-note="${this.getNoteAndOctave('gs', octave)}"></li>
            <li class="white a" data-note="${this.getNoteAndOctave('a', octave)}"></li>
            <li class="black as" data-note="${this.getNoteAndOctave('as', octave)}"></li>
            <li class="white b" data-note="${this.getNoteAndOctave('b', octave)}"></li>`
            
        return octaveHTML
    }
}

module.exports = piano;

},{}],4:[function(require,module,exports){
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n(t.NoteParser=t.NoteParser||{})}(this,function(t){"use strict";function n(t,n){return Array(n+1).join(t)}function r(t){return"number"==typeof t}function e(t){return"string"==typeof t}function u(t){return void 0!==t}function c(t,n){return Math.pow(2,(t-69)/12)*(n||440)}function o(){return b}function i(t,n,r){if("string"!=typeof t)return null;var e=b.exec(t);if(!e||!n&&e[4])return null;var u={letter:e[1].toUpperCase(),acc:e[2].replace(/x/g,"##")};u.pc=u.letter+u.acc,u.step=(u.letter.charCodeAt(0)+3)%7,u.alt="b"===u.acc[0]?-u.acc.length:u.acc.length;var o=A[u.step]+u.alt;return u.chroma=o<0?12+o:o%12,e[3]&&(u.oct=+e[3],u.midi=o+12*(u.oct+1),u.freq=c(u.midi,r)),n&&(u.tonicOf=e[4]),u}function f(t){return r(t)?t<0?n("b",-t):n("#",t):""}function a(t){return r(t)?""+t:""}function l(t,n,r){return null===t||void 0===t?null:t.step?l(t.step,t.alt,t.oct):t<0||t>6?null:C.charAt(t)+f(n)+a(r)}function p(t){if((r(t)||e(t))&&t>=0&&t<128)return+t;var n=i(t);return n&&u(n.midi)?n.midi:null}function s(t,n){var r=p(t);return null===r?null:c(r,n)}function d(t){return(i(t)||{}).letter}function m(t){return(i(t)||{}).acc}function h(t){return(i(t)||{}).pc}function v(t){return(i(t)||{}).step}function g(t){return(i(t)||{}).alt}function x(t){return(i(t)||{}).chroma}function y(t){return(i(t)||{}).oct}var b=/^([a-gA-G])(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)\s*$/,A=[0,2,4,5,7,9,11],C="CDEFGAB";t.regex=o,t.parse=i,t.build=l,t.midi=p,t.freq=s,t.letter=d,t.acc=m,t.pc=h,t.step=v,t.alt=g,t.chroma=x,t.oct=y});


},{}],5:[function(require,module,exports){
/*

WebMidi v2.0.0-rc.9

WebMidi.js helps you tame the Web MIDI API. Send and receive MIDI messages with ease. Control instruments with user-friendly functions (playNote, sendPitchBend, etc.). React to MIDI input with simple event listeners (noteon, pitchbend, controlchange, etc.).
https://github.com/cotejp/webmidi


The MIT License (MIT)

Copyright (c) 2015-2016, Jean-Philippe Côté

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and
associated documentation files (the "Software"), to deal in the Software without restriction,
including without limitation the rights to use, copy, modify, merge, publish, distribute,
sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial
portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT
NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES
OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

*/

!function(scope){"use strict";function WebMidi(){if(WebMidi.prototype._singleton)throw new Error("WebMidi is a singleton, it cannot be instantiated directly.");WebMidi.prototype._singleton=this,this._inputs=[],this._outputs=[],this._userHandlers={},this._stateChangeQueue=[],this._processingStateChange=!1,this._midiInterfaceEvents=["connected","disconnected"],this._notes=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],this._semitones={C:0,D:2,E:4,F:5,G:7,A:9,B:11},Object.defineProperties(this,{MIDI_SYSTEM_MESSAGES:{value:{sysex:240,timecode:241,songposition:242,songselect:243,tuningrequest:246,sysexend:247,clock:248,start:250,"continue":251,stop:252,activesensing:254,reset:255,unknownsystemmessage:-1},writable:!1,enumerable:!0,configurable:!1},MIDI_CHANNEL_MESSAGES:{value:{noteoff:8,noteon:9,keyaftertouch:10,controlchange:11,channelmode:11,programchange:12,channelaftertouch:13,pitchbend:14},writable:!1,enumerable:!0,configurable:!1},MIDI_REGISTERED_PARAMETER:{value:{pitchbendrange:[0,0],channelfinetuning:[0,1],channelcoarsetuning:[0,2],tuningprogram:[0,3],tuningbank:[0,4],modulationrange:[0,5],azimuthangle:[61,0],elevationangle:[61,1],gain:[61,2],distanceratio:[61,3],maximumdistance:[61,4],maximumdistancegain:[61,5],referencedistanceratio:[61,6],panspreadangle:[61,7],rollangle:[61,8]},writable:!1,enumerable:!0,configurable:!1},MIDI_CONTROL_CHANGE_MESSAGES:{value:{bankselectcoarse:0,modulationwheelcoarse:1,breathcontrollercoarse:2,footcontrollercoarse:4,portamentotimecoarse:5,dataentrycoarse:6,volumecoarse:7,balancecoarse:8,pancoarse:10,expressioncoarse:11,effectcontrol1coarse:12,effectcontrol2coarse:13,generalpurposeslider1:16,generalpurposeslider2:17,generalpurposeslider3:18,generalpurposeslider4:19,bankselectfine:32,modulationwheelfine:33,breathcontrollerfine:34,footcontrollerfine:36,portamentotimefine:37,dataentryfine:38,volumefine:39,balancefine:40,panfine:42,expressionfine:43,effectcontrol1fine:44,effectcontrol2fine:45,holdpedal:64,portamento:65,sustenutopedal:66,softpedal:67,legatopedal:68,hold2pedal:69,soundvariation:70,resonance:71,soundreleasetime:72,soundattacktime:73,brightness:74,soundcontrol6:75,soundcontrol7:76,soundcontrol8:77,soundcontrol9:78,soundcontrol10:79,generalpurposebutton1:80,generalpurposebutton2:81,generalpurposebutton3:82,generalpurposebutton4:83,reverblevel:91,tremololevel:92,choruslevel:93,celestelevel:94,phaserlevel:95,databuttonincrement:96,databuttondecrement:97,nonregisteredparametercoarse:98,nonregisteredparameterfine:99,registeredparametercoarse:100,registeredparameterfine:101},writable:!1,enumerable:!0,configurable:!1},MIDI_CHANNEL_MODE_MESSAGES:{value:{allsoundoff:120,resetallcontrollers:121,localcontrol:122,allnotesoff:123,omnimodeoff:124,omnimodeon:125,monomodeon:126,polymodeon:127},writable:!1,enumerable:!0,configurable:!1}}),Object.defineProperties(this,{supported:{enumerable:!0,get:function(){return"requestMIDIAccess"in navigator}},enabled:{enumerable:!0,get:function(){return void 0!==this["interface"]}.bind(this)},inputs:{enumerable:!0,get:function(){return this._inputs}.bind(this)},outputs:{enumerable:!0,get:function(){return this._outputs}.bind(this)},sysexEnabled:{enumerable:!0,get:function(){return!(!this["interface"]||!this["interface"].sysexEnabled)}.bind(this)},time:{enumerable:!0,get:function(){return performance.now()}}})}function Input(midiInput){var that=this;this._userHandlers={channel:{},system:{}},this._midiInput=midiInput,Object.defineProperties(this,{connection:{enumerable:!0,get:function(){return that._midiInput.connection}},id:{enumerable:!0,get:function(){return that._midiInput.id}},manufacturer:{enumerable:!0,get:function(){return that._midiInput.manufacturer}},name:{enumerable:!0,get:function(){return that._midiInput.name}},state:{enumerable:!0,get:function(){return that._midiInput.state}}}),this._initializeUserHandlers()}function Output(midiOutput){var that=this;this._midiOutput=midiOutput,Object.defineProperties(this,{connection:{enumerable:!0,get:function(){return that._midiOutput.connection}},id:{enumerable:!0,get:function(){return that._midiOutput.id}},manufacturer:{enumerable:!0,get:function(){return that._midiOutput.manufacturer}},name:{enumerable:!0,get:function(){return that._midiOutput.name}},state:{enumerable:!0,get:function(){return that._midiOutput.state}}})}var wm=new WebMidi;WebMidi.prototype.enable=function(callback,sysex){return this.enabled?void 0:this.supported?void navigator.requestMIDIAccess({sysex:sysex}).then(function(midiAccess){this["interface"]=midiAccess,this._resetInterfaceUserHandlers(),this["interface"].onstatechange=this._onInterfaceStateChange.bind(this),this._onInterfaceStateChange(null),"function"==typeof callback&&callback.call(this)}.bind(this),function(err){"function"==typeof callback&&callback.call(this,err)}.bind(this)):void("function"==typeof callback&&callback(new Error("The Web MIDI API is not supported by your browser.")))},WebMidi.prototype.disable=function(){if(!this.supported)throw new Error("The Web MIDI API is not supported by your browser.");this["interface"].onstatechange=void 0,this["interface"]=void 0,this._inputs=[],this._outputs=[],this._resetInterfaceUserHandlers()},WebMidi.prototype.addListener=function(type,listener){if(!this.enabled)throw new Error("WebMidi must be enabled before adding event listeners.");if("function"!=typeof listener)throw new TypeError("The 'listener' parameter must be a function.");if(!(this._midiInterfaceEvents.indexOf(type)>=0))throw new TypeError("The specified event type is not supported.");return this._userHandlers[type].push(listener),this},WebMidi.prototype.hasListener=function(type,listener){if(!this.enabled)throw new Error("WebMidi must be enabled before checking event listeners.");if("function"!=typeof listener)throw new TypeError("The 'listener' parameter must be a function.");if(!(this._midiInterfaceEvents.indexOf(type)>=0))throw new TypeError("The specified event type is not supported.");for(var o=0;o<this._userHandlers[type].length;o++)if(this._userHandlers[type][o]===listener)return!0;return!1},WebMidi.prototype.removeListener=function(type,listener){if(!this.enabled)throw new Error("WebMidi must be enabled before removing event listeners.");if(void 0!==listener&&"function"!=typeof listener)throw new TypeError("The 'listener' parameter must be a function.");if(this._midiInterfaceEvents.indexOf(type)>=0)if(listener)for(var o=0;o<this._userHandlers[type].length;o++)this._userHandlers[type][o]===listener&&this._userHandlers[type].splice(o,1);else this._userHandlers[type]=[];else{if(void 0!==type)throw new TypeError("The specified event type is not supported.");this._resetInterfaceUserHandlers()}return this},WebMidi.prototype.getInputById=function(id){if(!this.enabled)throw new Error("WebMidi is not enabled.");for(var i=0;i<this.inputs.length;i++)if(this.inputs[i].id===id)return this.inputs[i];return!1},WebMidi.prototype.getOutputById=function(id){if(!this.enabled)throw new Error("WebMidi is not enabled.");for(var i=0;i<this.outputs.length;i++)if(this.outputs[i].id===id)return this.outputs[i];return!1},WebMidi.prototype.getInputByName=function(name){if(!this.enabled)throw new Error("WebMidi is not enabled.");for(var i=0;i<this.inputs.length;i++)if(~this.inputs[i].name.indexOf(name))return this.inputs[i];return!1},WebMidi.prototype.getOctave=function(number){return number>=0&&127>=number?Math.floor(parseInt(number)/12-1)-1:void 0},WebMidi.prototype.getOutputByName=function(name){if(!this.enabled)throw new Error("WebMidi is not enabled.");for(var i=0;i<this.outputs.length;i++)if(~this.outputs[i].name.indexOf(name))return this.outputs[i];return!1},WebMidi.prototype.guessNoteNumber=function(input){var output=!1;if(input&&input.toFixed&&input>=0&&127>=input?output=Math.round(input):parseInt(input)>=0&&parseInt(input)<=127?output=parseInt(input):("string"==typeof input||input instanceof String)&&(output=this.noteNameToNumber(input)),output===!1)throw new Error("Invalid note number ("+input+").");return output},WebMidi.prototype.noteNameToNumber=function(name){"string"!=typeof name&&(name="");var matches=name.match(/([CDEFGAB])(#{0,2}|b{0,2})(-?\d+)/i);if(!matches)throw new RangeError("Invalid note name.");var semitones=wm._semitones[matches[1].toUpperCase()],octave=parseInt(matches[3]),result=12*(octave+2)+semitones;if(matches[2].toLowerCase().indexOf("b")>-1?result-=matches[2].length:matches[2].toLowerCase().indexOf("#")>-1&&(result+=matches[2].length),0>semitones||-2>octave||octave>8||0>result||result>127)throw new RangeError("Invalid note name or note outside valid range.");return result},WebMidi.prototype._updateInputsAndOutputs=function(){this._updateInputs(),this._updateOutputs()},WebMidi.prototype._updateInputs=function(){for(var i=0;i<this._inputs.length;i++){for(var remove=!0,updated=this["interface"].inputs.values(),input=updated.next();input&&!input.done;input=updated.next())if(this._inputs[i]._midiInput===input.value){remove=!1;break}remove&&this._inputs.splice(i,1)}this["interface"].inputs.forEach(function(nInput){for(var add=!0,j=0;j<this._inputs.length;j++)this._inputs[j]._midiInput===nInput&&(add=!1);add&&this._inputs.push(this._createInput(nInput))}.bind(this))},WebMidi.prototype._updateOutputs=function(){for(var i=0;i<this._outputs.length;i++){for(var remove=!0,updated=this["interface"].outputs.values(),output=updated.next();output&&!output.done;output=updated.next())if(this._outputs[i]._midiOutput===output.value){remove=!1;break}remove&&this._outputs.splice(i,1)}this["interface"].outputs.forEach(function(nOutput){for(var add=!0,j=0;j<this._outputs.length;j++)this._outputs[j]._midiOutput===nOutput&&(add=!1);add&&this._outputs.push(this._createOutput(nOutput))}.bind(this))},WebMidi.prototype._createInput=function(midiInput){var input=new Input(midiInput);return input._midiInput.onmidimessage=input._onMidiMessage.bind(input),input},WebMidi.prototype._createOutput=function(midiOutput){var output=new Output(midiOutput);return output._midiOutput.onmidimessage=output._onMidiMessage.bind(output),output},WebMidi.prototype._onInterfaceStateChange=function(e){if(this._stateChangeQueue.push(e),!this._processingStateChange){for(this._processingStateChange=!0;this._stateChangeQueue.length>0;)this._processStateChange(this._stateChangeQueue.shift());this._processingStateChange=!1}},WebMidi.prototype._processStateChange=function(e){if(this._updateInputsAndOutputs(),null!==e){var event={timestamp:e.timeStamp,type:e.port.state,id:e.port.id,manufacturer:e.port.manufacturer,name:e.port.name};"connected"===e.port.state&&("output"===e.port.type?event.output=this.getOutputById(e.port.id):"input"===e.port.type&&(event.input=this.getInputById(e.port.id))),this._userHandlers[e.port.state].forEach(function(handler){handler(event)})}},WebMidi.prototype._resetInterfaceUserHandlers=function(){for(var i=0;i<this._midiInterfaceEvents.length;i++)this._userHandlers[this._midiInterfaceEvents[i]]=[]},Input.prototype.addListener=function(type,channel,listener){var that=this;if(void 0===channel&&(channel="all"),Array.isArray(channel)||(channel=[channel]),channel.forEach(function(item){if("all"!==item&&!(item>=1&&16>=item))throw new RangeError("The 'channel' parameter is invalid.")}),"function"!=typeof listener)throw new TypeError("The 'listener' parameter must be a function.");if(wm.MIDI_SYSTEM_MESSAGES[type])this._userHandlers.system[type]||(this._userHandlers.system[type]=[]),this._userHandlers.system[type].push(listener);else{if(!wm.MIDI_CHANNEL_MESSAGES[type])throw new TypeError("The specified event type is not supported.");if(channel.indexOf("all")>-1){channel=[];for(var j=1;16>=j;j++)channel.push(j)}this._userHandlers.channel[type]||(this._userHandlers.channel[type]=[]),channel.forEach(function(ch){that._userHandlers.channel[type][ch]||(that._userHandlers.channel[type][ch]=[]),that._userHandlers.channel[type][ch].push(listener)})}return this},Input.prototype.on=Input.prototype.addListener,Input.prototype.hasListener=function(type,channel,listener){var that=this;if("function"!=typeof listener)throw new TypeError("The 'listener' parameter must be a function.");if(void 0===channel&&(channel="all"),channel.constructor!==Array&&(channel=[channel]),wm.MIDI_SYSTEM_MESSAGES[type]){for(var o=0;o<this._userHandlers.system[type].length;o++)if(this._userHandlers.system[type][o]===listener)return!0}else if(wm.MIDI_CHANNEL_MESSAGES[type]){if(channel.indexOf("all")>-1){channel=[];for(var j=1;16>=j;j++)channel.push(j)}return this._userHandlers.channel[type]?channel.every(function(chNum){var listeners=that._userHandlers.channel[type][chNum];return listeners&&listeners.indexOf(listener)>-1}):!1}return!1},Input.prototype.removeListener=function(type,channel,listener){var that=this;if(void 0!==listener&&"function"!=typeof listener)throw new TypeError("The 'listener' parameter must be a function.");if(void 0===channel&&(channel="all"),channel.constructor!==Array&&(channel=[channel]),wm.MIDI_SYSTEM_MESSAGES[type])if(void 0===listener)this._userHandlers.system[type]=[];else for(var o=0;o<this._userHandlers.system[type].length;o++)this._userHandlers.system[type][o]===listener&&this._userHandlers.system[type].splice(o,1);else if(wm.MIDI_CHANNEL_MESSAGES[type]){if(channel.indexOf("all")>-1){channel=[];for(var j=1;16>=j;j++)channel.push(j)}if(!this._userHandlers.channel[type])return this;channel.forEach(function(chNum){var listeners=that._userHandlers.channel[type][chNum];if(listeners)if(void 0===listener)that._userHandlers.channel[type][chNum]=[];else for(var l=0;l<listeners.length;l++)listeners[l]===listener&&listeners.splice(l,1)})}else{if(void 0!==type)throw new TypeError("The specified event type is not supported.");this._initializeUserHandlers()}return this},Input.prototype._initializeUserHandlers=function(){for(var prop1 in wm.MIDI_CHANNEL_MESSAGES)wm.MIDI_CHANNEL_MESSAGES.hasOwnProperty(prop1)&&(this._userHandlers.channel[prop1]={});for(var prop2 in wm.MIDI_SYSTEM_MESSAGES)wm.MIDI_SYSTEM_MESSAGES.hasOwnProperty(prop2)&&(this._userHandlers.system[prop2]=[])},Input.prototype._onMidiMessage=function(e){e.data[0]<240?this._parseChannelEvent(e):e.data[0]<=255&&this._parseSystemEvent(e)},Input.prototype._parseChannelEvent=function(e){var data1,data2,command=e.data[0]>>4,channel=(15&e.data[0])+1;e.data.length>1&&(data1=e.data[1],data2=e.data.length>2?e.data[2]:void 0);var event={target:this,data:e.data,timestamp:e.timeStamp,channel:channel};command===wm.MIDI_CHANNEL_MESSAGES.noteoff||command===wm.MIDI_CHANNEL_MESSAGES.noteon&&0===data2?(event.type="noteoff",event.note={number:data1,name:wm._notes[data1%12],octave:wm.getOctave(data1)},event.velocity=data2/127,event.rawVelocity=data2):command===wm.MIDI_CHANNEL_MESSAGES.noteon?(event.type="noteon",event.note={number:data1,name:wm._notes[data1%12],octave:wm.getOctave(data1)},event.velocity=data2/127,event.rawVelocity=data2):command===wm.MIDI_CHANNEL_MESSAGES.keyaftertouch?(event.type="keyaftertouch",event.note={number:data1,name:wm._notes[data1%12],octave:wm.getOctave(data1)},event.value=data2/127):command===wm.MIDI_CHANNEL_MESSAGES.controlchange&&data1>=0&&119>=data1?(event.type="controlchange",event.controller={number:data1,name:this.getCcNameByNumber(data1)},event.value=data2):command===wm.MIDI_CHANNEL_MESSAGES.channelmode&&data1>=120&&127>=data1?(event.type="channelmode",event.controller={number:data1,name:this.getChannelModeByNumber(data1)},event.value=data2):command===wm.MIDI_CHANNEL_MESSAGES.programchange?(event.type="programchange",event.value=data1):command===wm.MIDI_CHANNEL_MESSAGES.channelaftertouch?(event.type="channelaftertouch",event.value=data1/127):command===wm.MIDI_CHANNEL_MESSAGES.pitchbend?(event.type="pitchbend",event.value=((data2<<7)+data1-8192)/8192):event.type="unknownchannelmessage",this._userHandlers.channel[event.type]&&this._userHandlers.channel[event.type][channel]&&this._userHandlers.channel[event.type][channel].forEach(function(callback){callback(event)})},Input.prototype.getCcNameByNumber=function(number){if(number=parseInt(number),!(number>=0&&119>=number))throw new RangeError("The control change number must be between 0 and 119.");for(var cc in wm.MIDI_CONTROL_CHANGE_MESSAGES)if(number===wm.MIDI_CONTROL_CHANGE_MESSAGES[cc])return cc;return void 0},Input.prototype.getChannelModeByNumber=function(number){if(number=parseInt(number),!(number>=120&&status<=127))throw new RangeError("The control change number must be between 120 and 127.");for(var cm in wm.MIDI_CHANNEL_MODE_MESSAGES)if(number===wm.MIDI_CHANNEL_MODE_MESSAGES[cm])return cm},Input.prototype._parseSystemEvent=function(e){var command=e.data[0],event={target:this,data:e.data,timestamp:e.timeStamp};command===wm.MIDI_SYSTEM_MESSAGES.sysex?event.type="sysex":command===wm.MIDI_SYSTEM_MESSAGES.timecode?event.type="timecode":command===wm.MIDI_SYSTEM_MESSAGES.songposition?event.type="songposition":command===wm.MIDI_SYSTEM_MESSAGES.songselect?(event.type="songselect",event.song=e.data[1]):command===wm.MIDI_SYSTEM_MESSAGES.tuningrequest?event.type="tuningrequest":command===wm.MIDI_SYSTEM_MESSAGES.clock?event.type="clock":command===wm.MIDI_SYSTEM_MESSAGES.start?event.type="start":command===wm.MIDI_SYSTEM_MESSAGES["continue"]?event.type="continue":command===wm.MIDI_SYSTEM_MESSAGES.stop?event.type="stop":command===wm.MIDI_SYSTEM_MESSAGES.activesensing?event.type="activesensing":command===wm.MIDI_SYSTEM_MESSAGES.reset?event.type="reset":event.type="unknownsystemmessage",this._userHandlers.system[event.type]&&this._userHandlers.system[event.type].forEach(function(callback){callback(event)})},Output.prototype.send=function(status,data,timestamp){if(!(status>=128&&255>=status))throw new RangeError("The status byte must be an integer between 128 (0x80) and 255 (0xFF).");Array.isArray(data)||(data=parseInt(data)>=0&&parseInt(data)<=127?[parseInt(data)]:[]);var message=[status];return data.forEach(function(item){if(!(item>=0&&255>=item))throw new RangeError("The data bytes must be integers between 0 (0x00) and 255 (0xFF).");message.push(item)}),this._midiOutput.send(message,parseFloat(timestamp)||0),this},Output.prototype.sendSysex=function(manufacturer,data,options){if(!wm.sysexEnabled)throw new Error("SysEx message support must first be activated.");return options=options||{},manufacturer=[].concat(manufacturer),data.forEach(function(item){if(0>item||item>127)throw new RangeError("The data bytes of a SysEx message must be integers between 0 (0x00) and 127 (0x7F).")}),data=manufacturer.concat(data,wm.MIDI_SYSTEM_MESSAGES.sysexend),this.send(wm.MIDI_SYSTEM_MESSAGES.sysex,data,this._parseTimeParameter(options.time)),this},Output.prototype.sendTimecodeQuarterFrame=function(value,options){return options=options||{},this.send(wm.MIDI_SYSTEM_MESSAGES.timecode,value,this._parseTimeParameter(options.time)),this},Output.prototype.sendSongPosition=function(value,options){value=parseInt(value)||0,options=options||{};var msb=value>>7&127,lsb=127&value;return this.send(wm.MIDI_SYSTEM_MESSAGES.songposition,[msb,lsb],this._parseTimeParameter(options.time)),this},Output.prototype.sendSongSelect=function(value,options){if(value=parseInt(value),options=options||{},!(value>=0&&127>=value))throw new RangeError("The song number must be between 0 and 127.");return this.send(wm.MIDI_SYSTEM_MESSAGES.songselect,[value],this._parseTimeParameter(options.time)),this},Output.prototype.sendTuningRequest=function(options){return options=options||{},this.send(wm.MIDI_SYSTEM_MESSAGES.tuningrequest,void 0,this._parseTimeParameter(options.time)),this},Output.prototype.sendClock=function(options){return options=options||{},this.send(wm.MIDI_SYSTEM_MESSAGES.clock,void 0,this._parseTimeParameter(options.time)),this},Output.prototype.sendStart=function(options){return options=options||{},this.send(wm.MIDI_SYSTEM_MESSAGES.start,void 0,this._parseTimeParameter(options.time)),this},Output.prototype.sendContinue=function(options){return options=options||{},this.send(wm.MIDI_SYSTEM_MESSAGES["continue"],void 0,this._parseTimeParameter(options.time)),this},Output.prototype.sendStop=function(options){return options=options||{},this.send(wm.MIDI_SYSTEM_MESSAGES.stop,void 0,this._parseTimeParameter(options.time)),this},Output.prototype.sendActiveSensing=function(options){return options=options||{},this.send(wm.MIDI_SYSTEM_MESSAGES.activesensing,void 0,this._parseTimeParameter(options.time)),this},Output.prototype.sendReset=function(options){return options=options||{},this.send(wm.MIDI_SYSTEM_MESSAGES.reset,void 0,this._parseTimeParameter(options.time)),this},Output.prototype.stopNote=function(note,channel,options){if("all"===note)return this.sendChannelMode("allnotesoff",0,channel,options);var nVelocity=64;return options=options||{},options.velocity=parseFloat(options.velocity),options.rawVelocity?!isNaN(options.velocity)&&options.velocity>=0&&options.velocity<=127&&(nVelocity=options.velocity):!isNaN(options.velocity)&&options.velocity>=0&&options.velocity<=1&&(nVelocity=127*options.velocity),this._convertNoteToArray(note).forEach(function(item){this._convertChannelToArray(channel).forEach(function(ch){this.send((wm.MIDI_CHANNEL_MESSAGES.noteoff<<4)+(ch-1),[item,Math.round(nVelocity)],this._parseTimeParameter(options.time))}.bind(this))}.bind(this)),this},Output.prototype.playNote=function(note,channel,options){var nVelocity=64;if(options=options||{},options.velocity=parseFloat(options.velocity),options.rawVelocity?!isNaN(options.velocity)&&options.velocity>=0&&options.velocity<=127&&(nVelocity=options.velocity):!isNaN(options.velocity)&&options.velocity>=0&&options.velocity<=1&&(nVelocity=127*options.velocity),options.time=this._parseTimeParameter(options.time),this._convertNoteToArray(note).forEach(function(item){this._convertChannelToArray(channel).forEach(function(ch){this.send((wm.MIDI_CHANNEL_MESSAGES.noteon<<4)+(ch-1),[item,Math.round(nVelocity)],options.time)}.bind(this))}.bind(this)),options.duration=parseFloat(options.duration),options.duration){options.duration<=0&&(options.duration=0);var nRelease=64;options.release=parseFloat(options.release),options.rawVelocity?!isNaN(options.release)&&options.release>=0&&options.release<=127&&(nRelease=options.release):!isNaN(options.release)&&options.release>=0&&options.release<=1&&(nRelease=127*options.release),this._convertNoteToArray(note).forEach(function(item){this._convertChannelToArray(channel).forEach(function(ch){this.send((wm.MIDI_CHANNEL_MESSAGES.noteoff<<4)+(ch-1),[item,Math.round(nRelease)],(options.time||wm.time)+options.duration)}.bind(this))}.bind(this))}return this},Output.prototype.sendKeyAftertouch=function(note,channel,pressure,options){var that=this;if(options=options||{},1>channel||channel>16)throw new RangeError("The channel must be between 1 and 16.");pressure=parseFloat(pressure),(isNaN(pressure)||0>pressure||pressure>1)&&(pressure=.5);var nPressure=Math.round(127*pressure);return this._convertNoteToArray(note).forEach(function(item){that._convertChannelToArray(channel).forEach(function(ch){that.send((wm.MIDI_CHANNEL_MESSAGES.keyaftertouch<<4)+(ch-1),[item,nPressure],that._parseTimeParameter(options.time))})}),this},Output.prototype.sendControlChange=function(controller,value,channel,options){if(options=options||{},"string"==typeof controller){if(controller=wm.MIDI_CONTROL_CHANGE_MESSAGES[controller],!controller)throw new TypeError("Invalid controller name.")}else if(controller=parseInt(controller),!(controller>=0&&119>=controller))throw new RangeError("Controller numbers must be between 0 and 119.");if(value=parseInt(value)||0,!(value>=0&&127>=value))throw new RangeError("Controller value must be between 0 and 127.");return this._convertChannelToArray(channel).forEach(function(ch){this.send((wm.MIDI_CHANNEL_MESSAGES.controlchange<<4)+(ch-1),[controller,value],this._parseTimeParameter(options.time))}.bind(this)),this},Output.prototype._selectRegisteredParameter=function(parameter,channel,time){var that=this;if(parameter[0]=parseInt(parameter[0]),!(parameter[0]>=0&&parameter[0]<=127))throw new RangeError("The control65 value must be between 0 and 127");if(parameter[1]=parseInt(parameter[1]),!(parameter[1]>=0&&parameter[1]<=127))throw new RangeError("The control64 value must be between 0 and 127");return this._convertChannelToArray(channel).forEach(function(ch){that.sendControlChange(101,parameter[0],channel,{time:time}),that.sendControlChange(100,parameter[1],channel,{time:time})}),this},Output.prototype._selectNonRegisteredParameter=function(parameter,channel,time){var that=this;if(parameter[0]=parseInt(parameter[0]),!(parameter[0]>=0&&parameter[0]<=127))throw new RangeError("The control63 value must be between 0 and 127");if(parameter[1]=parseInt(parameter[1]),!(parameter[1]>=0&&parameter[1]<=127))throw new RangeError("The control62 value must be between 0 and 127");return this._convertChannelToArray(channel).forEach(function(ch){that.sendControlChange(99,parameter[0],channel,{time:time}),that.sendControlChange(98,parameter[1],channel,{time:time})}),this},Output.prototype._setCurrentRegisteredParameter=function(data,channel,time){var that=this;if(data=[].concat(data),data[0]=parseInt(data[0]),!(data[0]>=0&&data[0]<=127))throw new RangeError("The msb value must be between 0 and 127");return this._convertChannelToArray(channel).forEach(function(ch){that.sendControlChange(6,data[0],channel,{time:time})}),data[1]=parseInt(data[1]),data[1]>=0&&data[1]<=127&&this._convertChannelToArray(channel).forEach(function(ch){that.sendControlChange(38,data[1],channel,{time:time})}),this},Output.prototype._deselectRegisteredParameter=function(channel,time){var that=this;return this._convertChannelToArray(channel).forEach(function(ch){that.sendControlChange(101,127,channel,{time:time}),that.sendControlChange(100,127,channel,{time:time})}),this},Output.prototype.setRegisteredParameter=function(parameter,data,channel,options){var that=this;if(options=options||{},!Array.isArray(parameter)){if(!wm.MIDI_REGISTERED_PARAMETER[parameter])throw new Error("The specified parameter is not available.");parameter=wm.MIDI_REGISTERED_PARAMETER[parameter]}return this._convertChannelToArray(channel).forEach(function(ch){that._selectRegisteredParameter(parameter,channel,options.time),that._setCurrentRegisteredParameter(data,channel,options.time),that._deselectRegisteredParameter(channel,options.time)}),this},Output.prototype.setNonRegisteredParameter=function(parameter,data,channel,options){var that=this;if(options=options||{},!(parameter[0]>=0&&parameter[0]<=127&&parameter[1]>=0&&parameter[1]<=127))throw new Error("Position 0 and 1 of the 2-position parameter array must both be between 0 and 127.");return data=[].concat(data),this._convertChannelToArray(channel).forEach(function(ch){that._selectNonRegisteredParameter(parameter,channel,options.time),that._setCurrentRegisteredParameter(data,channel,options.time),that._deselectRegisteredParameter(channel,options.time)}),this},Output.prototype.incrementRegisteredParameter=function(parameter,channel,options){var that=this;if(options=options||{},!Array.isArray(parameter)){if(!wm.MIDI_REGISTERED_PARAMETER[parameter])throw new Error("The specified parameter is not available.");parameter=wm.MIDI_REGISTERED_PARAMETER[parameter]}return this._convertChannelToArray(channel).forEach(function(ch){that._selectRegisteredParameter(parameter,channel,options.time),that.sendControlChange(96,0,channel,{time:options.time}),that._deselectRegisteredParameter(channel,options.time)}),this},Output.prototype.decrementRegisteredParameter=function(parameter,channel,options){if(options=options||{},!Array.isArray(parameter)){if(!wm.MIDI_REGISTERED_PARAMETER[parameter])throw new TypeError("The specified parameter is not available.");parameter=wm.MIDI_REGISTERED_PARAMETER[parameter]}return this._convertChannelToArray(channel).forEach(function(ch){this._selectRegisteredParameter(parameter,channel,options.time),this.sendControlChange(97,0,channel,{time:options.time}),this._deselectRegisteredParameter(channel,options.time)}.bind(this)),this},Output.prototype.setPitchBendRange=function(semitones,cents,channel,options){var that=this;if(options=options||{},semitones=parseInt(semitones)||0,!(semitones>=0&&127>=semitones))throw new RangeError("The semitones value must be between 0 and 127");if(cents=parseInt(cents)||0,!(cents>=0&&127>=cents))throw new RangeError("The cents value must be between 0 and 127");return this._convertChannelToArray(channel).forEach(function(ch){that.setRegisteredParameter("pitchbendrange",[semitones,cents],channel,{time:options.time})}),this},Output.prototype.setModulationRange=function(semitones,cents,channel,options){var that=this;if(options=options||{},semitones=parseInt(semitones)||0,!(semitones>=0&&127>=semitones))throw new RangeError("The semitones value must be between 0 and 127");if(cents=parseInt(cents)||0,!(cents>=0&&127>=cents))throw new RangeError("The cents value must be between 0 and 127");return this._convertChannelToArray(channel).forEach(function(ch){that.setRegisteredParameter("modulationrange",[semitones,cents],channel,{time:options.time})}),this},Output.prototype.setMasterTuning=function(value,channel,options){var that=this;if(options=options||{},value=parseFloat(value)||0,-65>=value||value>=64)throw new RangeError("The value must be a decimal number larger than -65 and smaller than 64.");var coarse=parseInt(value)+64,fine=value-parseInt(value);fine=Math.round((fine+1)/2*16383);var msb=fine>>7&127,lsb=127&fine;return this._convertChannelToArray(channel).forEach(function(ch){that.setRegisteredParameter("channelcoarsetuning",coarse,channel,{time:options.time}),that.setRegisteredParameter("channelfinetuning",[msb,lsb],channel,{time:options.time})}),this},Output.prototype.setTuningProgram=function(value,channel,options){var that=this;if(options=options||{},value=parseInt(value)||0,!(value>=0&&127>=value))throw new RangeError("The program value must be between 0 and 127");return this._convertChannelToArray(channel).forEach(function(ch){that.setRegisteredParameter("tuningprogram",value,channel,{time:options.time})}),this},Output.prototype.setTuningBank=function(value,channel,options){var that=this;if(options=options||{},value=parseInt(value)||0,!(value>=0&&127>=value))throw new RangeError("The bank value must be between 0 and 127");return this._convertChannelToArray(channel).forEach(function(ch){that.setRegisteredParameter("tuningbank",value,channel,{time:options.time})}),this},Output.prototype.sendChannelMode=function(command,value,channel,options){if(options=options||{},"string"==typeof command){if(command=wm.MIDI_CHANNEL_MODE_MESSAGES[command],!command)throw new TypeError("Invalid channel mode message name.")}else if(command=parseInt(command),!(command>=120&&127>=command))throw new RangeError("Channel mode numerical identifiers must be between 120 and 127.");if(value=parseInt(value)||0,0>value||value>127)throw new RangeError("Value must be an integer between 0 and 127.");return this._convertChannelToArray(channel).forEach(function(ch){this.send((wm.MIDI_CHANNEL_MESSAGES.channelmode<<4)+(ch-1),[command,value],this._parseTimeParameter(options.time))}.bind(this)),this},Output.prototype.sendProgramChange=function(program,channel,options){var that=this;if(options=options||{},program=parseInt(program),isNaN(program)||0>program||program>127)throw new RangeError("Program numbers must be between 0 and 127.");return this._convertChannelToArray(channel).forEach(function(ch){that.send((wm.MIDI_CHANNEL_MESSAGES.programchange<<4)+(ch-1),[program],that._parseTimeParameter(options.time))}),this},Output.prototype.sendChannelAftertouch=function(pressure,channel,options){var that=this;options=options||{},pressure=parseFloat(pressure),(isNaN(pressure)||0>pressure||pressure>1)&&(pressure=.5);var nPressure=Math.round(127*pressure);return this._convertChannelToArray(channel).forEach(function(ch){that.send((wm.MIDI_CHANNEL_MESSAGES.channelaftertouch<<4)+(ch-1),[nPressure],that._parseTimeParameter(options.time))}),this},Output.prototype.sendPitchBend=function(bend,channel,options){
var that=this;if(options=options||{},bend=parseFloat(bend),isNaN(bend)||-1>bend||bend>1)throw new RangeError("Pitch bend value must be between -1 and 1.");var nLevel=Math.round((bend+1)/2*16383),msb=nLevel>>7&127,lsb=127&nLevel;return this._convertChannelToArray(channel).forEach(function(ch){that.send((wm.MIDI_CHANNEL_MESSAGES.pitchbend<<4)+(ch-1),[lsb,msb],that._parseTimeParameter(options.time))}),this},Output.prototype._parseTimeParameter=function(time){var parsed,value;return"string"==typeof time&&"+"===time.substring(0,1)?(parsed=parseFloat(time),parsed&&parsed>0&&(value=wm.time+parsed)):(parsed=parseFloat(time),parsed>wm.time&&(value=parsed)),value},Output.prototype._convertNoteToArray=function(note){var notes=[];return Array.isArray(note)||(note=[note]),note.forEach(function(item){notes.push(wm.guessNoteNumber(item))}),notes},Output.prototype._convertChannelToArray=function(channel){if(("all"===channel||void 0===channel)&&(channel=["all"]),Array.isArray(channel)||(channel=[channel]),channel.indexOf("all")>-1){channel=[];for(var i=1;16>=i;i++)channel.push(i)}return channel.forEach(function(ch){if(!(ch>=1&&16>=ch))throw new RangeError("MIDI channels must be between 1 and 16.")}),channel},Output.prototype._onMidiMessage=function(e){},"function"==typeof define&&"object"==typeof define.amd?define([],function(){return wm}):"undefined"!=typeof module&&module.exports?module.exports=wm:scope.WebMidi||(scope.WebMidi=wm)}(this);
},{}],6:[function(require,module,exports){
// Use it like this:  
// const synth = require('pluggable-synth')
// But this is the test
const pluggableSynth = require('./index')
const audioCtx = new AudioContext(); 
const masterGain = audioCtx.createGain();
masterGain.gain.value = 0.1;

/**
 * A simple test synth
 * The synth which is going to be connected to the piano
 * must have a `start` and a `stop` method 
 */
function testSynth () {

    this.start = function (freq, options) {
        this.oscillator = audioCtx.createOscillator();
        this.oscillator.type = 'square';
        this.oscillator.frequency.value = freq; // value in hertz
        this.oscillator.connect(masterGain);
        masterGain.connect(audioCtx.destination);
        this.oscillator.start();
    }

    this.stop = function () {
        this.oscillator.stop();
    }
}


$(document).ready(function () {

    // console.log(piano)
    var elemID = 'piano-container'
    var p = new pluggableSynth(elemID, {
        octaves: 2,
        octaveBegin: 3    
    })
    
    // Draws piano
    p.createPiano()

    // Set synth
    p.synth = testSynth
    
    // Enable one octave of keyboard
    p.enableKeyboardEvents()
    
    // All midi tones will be played, but only two octaves is visiable
    p.enableMidiEvents()

})
},{"./index":1}]},{},[6])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3Vzci9saWIvbm9kZV9tb2R1bGVzL3dhdGNoaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJpbmRleC5qcyIsImtleWJvYXJkLXRvbmVzLmpzIiwibm9kZV9tb2R1bGVzL2pzLWNzcy1waWFuby9pbmRleC5qcyIsIm5vZGVfbW9kdWxlcy9ub3RlLXBhcnNlci9kaXN0L25vdGUtcGFyc2VyLmpzIiwibm9kZV9tb2R1bGVzL3dlYm1pZGkvd2VibWlkaS5taW4uanMiLCJ0ZXN0LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzlHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNqQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN2REE7QUFDQTtBQUNBOztBQ0ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzlCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCJjb25zdCBub3RlUGFyc2VyID0gcmVxdWlyZSgnbm90ZS1wYXJzZXInKVxuY29uc3Qgb2N0YXZlMSA9IHJlcXVpcmUoJy4va2V5Ym9hcmQtdG9uZXMuanMnKS5vY3RhdmUxO1xuY29uc3QganNDc3NQaWFubyA9IHJlcXVpcmUoJ2pzLWNzcy1waWFubycpO1xuY29uc3Qgd2VibWlkaSA9IHJlcXVpcmUoJ3dlYm1pZGknKVxuXG52YXIga2V5cyA9IHt9O1xuXG5qc0Nzc1BpYW5vLnByb3RvdHlwZSA9IHtcblxuICAgIGdldEZyZXF1ZW5jeTogZnVuY3Rpb24gKG5vdGUpIHtcbiAgICAgICAgbm90ZSA9IG5vdGUucmVwbGFjZSgncycsICcjJyk7XG4gICAgICAgIGxldCByZXMgPSBub3RlUGFyc2VyLnBhcnNlKG5vdGUpXG4gICAgICAgIGxldCBmcmVxID0gcmVzLmZyZXE7XG4gICAgICAgIHJldHVybiBmcmVxO1xuICAgIH0sXG5cbiAgICBzeW50aDogZnVuY3Rpb24gKCkge1xuICAgICAgICBjb25zb2xlLmxvZygnc2V0IGEgc3ludGgnKVxuICAgIH0sXG5cbiAgICB0b2dnbGVLZXk6IGZ1bmN0aW9uIChub3RlKSB7XG4gICAgICAgIGxldCBzZWxlY3RvciA9ICcjJyArIHRoaXMuZWxlbUlEICsgXCIgPiAucGlhbm8gbGlbZGF0YS1ub3RlPSdcIiArIG5vdGUgKyBcIiddXCJcbiAgICAgICAgbGV0IGVsZW0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKVxuICAgICAgICBpZiAoIWVsZW0pIHtcbiAgICAgICAgICAgIHJldHVyblxuICAgICAgICB9XG4gICAgICAgIGVsZW0uY2xhc3NMaXN0LnRvZ2dsZSgnYWN0aXZlJyk7XG4gICAgfSxcblxuICAgIHN5bnRoU3RhcnQ6IGZ1bmN0aW9uIChub3RlLCBvcHRpb25zKSB7XG4gICAgICAgIG5vdGUgPSBub3RlLnRvTG93ZXJDYXNlKClcbiAgICAgICAgdGhpcy50b2dnbGVLZXkobm90ZSlcbiAgICAgICAgbGV0IGZyZXEgPSB0aGlzLmdldEZyZXF1ZW5jeShub3RlKTtcbiAgICAgICAgbGV0IHN5bnRoID0gbmV3IHRoaXMuc3ludGgoKTtcblxuICAgICAgICBzeW50aC5zdGFydChmcmVxLCBvcHRpb25zKTtcbiAgICAgICAga2V5c1tub3RlXSA9IHN5bnRoO1xuICAgIH0sXG5cbiAgICBzeW50aFN0b3A6IGZ1bmN0aW9uIChub3RlKSB7XG4gICAgICAgIG5vdGUgPSBub3RlLnRvTG93ZXJDYXNlKClcbiAgICAgICAgdGhpcy50b2dnbGVLZXkobm90ZSlcbiAgICAgICAgbGV0IHN5bnRoID0ga2V5c1tub3RlXVxuICAgICAgICBzeW50aC5zdG9wKClcbiAgICAgICAgZGVsZXRlIGtleXNbbm90ZV1cbiAgICB9LFxuXG4gICAgLy8gRW5hYmxlIG9uZSBvciB0d28gb2N0YXZlcyBvbiBrZXlib2FyZFxuICAgIGVuYWJsZUtleWJvYXJkRXZlbnRzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIChlKSA9PiB7XG5cbiAgICAgICAgICAgIHZhciBrID0gZS5rZXk7XG4gICAgICAgICAgICBsZXQgbm90ZSA9IG9jdGF2ZTFba10gKyB0aGlzLm9wdGlvbnMub2N0YXZlQmVnaW5cblxuICAgICAgICAgICAgaWYgKGsgaW4gb2N0YXZlMSAmJiAhKG5vdGUgaW4ga2V5cykpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnN5bnRoU3RhcnQobm90ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXl1cFwiLCAoZSkgPT4ge1xuXG4gICAgICAgICAgICBsZXQgb2N0YXZlID0gdGhpcy5vcHRpb25zLm9jdGF2ZUJlZ2luXG4gICAgICAgICAgICB2YXIgayA9IGUua2V5O1xuICAgICAgICAgICAgbGV0IG5vdGUgPSBvY3RhdmUxW2tdICsgb2N0YXZlO1xuICAgICAgICAgICAgaWYgKGsgaW4gb2N0YXZlMSAmJiAobm90ZSBpbiBrZXlzKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc3ludGhTdG9wKG5vdGUpXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvLyBFbmFibGUgbWlkaSBrZXlib2FyZFxuICAgIGVuYWJsZU1pZGlFdmVudHM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgd2VibWlkaS5lbmFibGUoKGVycikgPT4ge1xuXG4gICAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJXZWJNaWRpIGNvdWxkIG5vdCBiZSBlbmFibGVkLlwiLCBlcnIpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJXZWJNaWRpIGVuYWJsZWQhXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zb2xlLmxvZyh3ZWJtaWRpLmlucHV0cylcbiAgICAgICAgICAgIHZhciBtaWRpSW5wdXQgPSB3ZWJtaWRpLmlucHV0c1sxXTtcblxuICAgICAgICAgICAgbWlkaUlucHV0LmFkZExpc3RlbmVyKCdub3Rlb24nLCBcImFsbFwiLCAoZSkgPT4ge1xuXG4gICAgICAgICAgICAgICAgbGV0IG9jdGF2ZSA9IHBhcnNlSW50KGUubm90ZS5vY3RhdmUpXG4gICAgICAgICAgICAgICAgbGV0IG5vdGUgPSBlLm5vdGUubmFtZSArIG9jdGF2ZVxuICAgICAgICAgICAgICAgIG5vdGUgPSBub3RlLnJlcGxhY2UoJyMnLCAncycpXG5cbiAgICAgICAgICAgICAgICBpZiAoIShub3RlIGluIGtleXMpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3ludGhTdGFydChub3RlLCBlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgbWlkaUlucHV0LmFkZExpc3RlbmVyKCdub3Rlb2ZmJywgXCJhbGxcIiwgKGUpID0+IHtcbiAgICAgICAgICAgICAgICBsZXQgb2N0YXZlID0gcGFyc2VJbnQoZS5ub3RlLm9jdGF2ZSk7XG4gICAgICAgICAgICAgICAgbGV0IG5vdGUgPSBlLm5vdGUubmFtZSArIG9jdGF2ZTtcblxuICAgICAgICAgICAgICAgIG5vdGUgPSBub3RlLnJlcGxhY2UoJyMnLCAncycpXG5cbiAgICAgICAgICAgICAgICB0aGlzLnN5bnRoU3RvcChub3RlKVxuXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICApO1xuICAgICAgICB9KTtcbiAgICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0ganNDc3NQaWFubztcbiIsInZhciBrZXlib2FyZFRvbmVzID0ge31cblxua2V5Ym9hcmRUb25lcy5vY3RhdmUxID0ge1xuICAgIGE6ICdjJyxcbiAgICB3OiAnY3MnLFxuICAgIHM6ICdkJyxcbiAgICBlOiAnZHMnLFxuICAgIGQ6ICdlJyxcbiAgICBmOiAnZicsXG4gICAgdDogJ2ZzJyxcbiAgICBnOiAnZycsXG4gICAgeTogJ2dzJyxcbiAgICBoOiAnYScsXG4gICAgdTogJ2FzJyxcbiAgICBqOiAnYidcbn07XG5cblxua2V5Ym9hcmRUb25lcy5vY3RhdmUyID0ge1xuICAgIHE6ICdjJyxcbiAgICAyOiAnY3MnLFxuICAgIHc6ICdkJyxcbiAgICAzOiAnZHMnLFxuICAgIGU6ICdlJyxcbiAgICByOiAnZicsXG4gICAgNTogJ2ZzJyxcbiAgICB0OiAnZycsXG4gICAgNjogJ2dzJyxcbiAgICB5OiAnYScsXG4gICAgNzogJ2FzJyxcbiAgICB1OiAnYidcbn07XG5cbm1vZHVsZS5leHBvcnRzID0ga2V5Ym9hcmRUb25lczsiLCJmdW5jdGlvbiBwaWFubyhlbGVtSUQsIG9wdHMpIHtcblxuICAgIHRoaXMuZWxlbUlEID0gZWxlbUlEXG4gICAgdGhpcy5lbGVtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZWxlbUlEKVxuICAgIFxuICAgIHRoaXMuZGVmYXVsdHMgPSB7XG4gICAgICAgIG9jdGF2ZXM6IDIsXG4gICAgICAgIG9jdGF2ZUJlZ2luOiAzXG4gICAgfVxuXG4gICAgdGhpcy5vcHRpb25zID0ge31cbiAgICBPYmplY3QuYXNzaWduKHRoaXMub3B0aW9ucywgdGhpcy5kZWZhdWx0cywgb3B0cylcbiAgICBcbiAgICB0aGlzLmNyZWF0ZVBpYW5vID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBsZXQgaHRtbCA9IHRoaXMuZ2V0UGlhbm9IVE1MKClcbiAgICAgICAgdGhpcy5lbGVtLmlubmVySFRNTCA9IGh0bWxcbiAgICB9XG5cbiAgICB0aGlzLmdldFBpYW5vSFRNTCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgXG4gICAgICAgIGxldCBvY3RhdmVCZWdpbiA9IHRoaXMub3B0aW9ucy5vY3RhdmVCZWdpblxuICAgICAgICBsZXQgaHRtbCA9IGA8dWwgY2xhc3M9XCJwaWFub1wiPmBcbiAgICAgICAgZm9yIChpID0gMTsgaSA8PSB0aGlzLm9wdGlvbnMub2N0YXZlczsgaSsrKSB7ICBcbiAgICAgICAgICAgIGh0bWwgKz0gdGhpcy5nZXRUb25lcyhvY3RhdmVCZWdpbilcbiAgICAgICAgICAgIG9jdGF2ZUJlZ2luKysgXG4gICAgICAgIH1cbiAgICAgICAgaHRtbCArPSBgPC91bD5gXG4gICAgICAgIHJldHVybiBodG1sXG4gICAgfVxuXG4gICAgdGhpcy5nZXROb3RlQW5kT2N0YXZlID0gZnVuY3Rpb24gKG5vdGUsIG9jdGF2ZSkge1xuICAgICAgICByZXR1cm4gbm90ZSArIG9jdGF2ZVxuICAgIH1cblxuICAgIHRoaXMuZ2V0VG9uZXMgPSBmdW5jdGlvbiAob2N0YXZlKSB7XG4gICAgICAgIGxldCBvY3RhdmVIVE1MID0gXG4gICAgICAgIGBcbiAgICAgICAgICAgIDxsaSBjbGFzcz1cIndoaXRlIGNcIiBkYXRhLW5vdGU9XCIke3RoaXMuZ2V0Tm90ZUFuZE9jdGF2ZSgnYycsIG9jdGF2ZSl9XCI+PC9saT5cbiAgICAgICAgICAgIDxsaSBjbGFzcz1cImJsYWNrIGNzXCIgZGF0YS1ub3RlPVwiJHt0aGlzLmdldE5vdGVBbmRPY3RhdmUoJ2NzJywgb2N0YXZlKX1cIj48L2xpPlxuICAgICAgICAgICAgPGxpIGNsYXNzPVwid2hpdGUgZFwiIGRhdGEtbm90ZT1cIiR7dGhpcy5nZXROb3RlQW5kT2N0YXZlKCdkJywgb2N0YXZlKX1cIj48L2xpPlxuICAgICAgICAgICAgPGxpIGNsYXNzPVwiYmxhY2sgZHNcIiBkYXRhLW5vdGU9XCIke3RoaXMuZ2V0Tm90ZUFuZE9jdGF2ZSgnZHMnLCBvY3RhdmUpfVwiPjwvbGk+XG4gICAgICAgICAgICA8bGkgY2xhc3M9XCJ3aGl0ZSBlXCIgZGF0YS1ub3RlPVwiJHt0aGlzLmdldE5vdGVBbmRPY3RhdmUoJ2UnLCBvY3RhdmUpfVwiPjwvbGk+XG4gICAgICAgICAgICA8bGkgY2xhc3M9XCJ3aGl0ZSBmXCIgZGF0YS1ub3RlPVwiJHt0aGlzLmdldE5vdGVBbmRPY3RhdmUoJ2YnLCBvY3RhdmUpfVwiPjwvbGk+XG4gICAgICAgICAgICA8bGkgY2xhc3M9XCJibGFjayBmc1wiIGRhdGEtbm90ZT1cIiR7dGhpcy5nZXROb3RlQW5kT2N0YXZlKCdmcycsIG9jdGF2ZSl9XCI+PC9saT5cbiAgICAgICAgICAgIDxsaSBjbGFzcz1cIndoaXRlIGdcIiBkYXRhLW5vdGU9XCIke3RoaXMuZ2V0Tm90ZUFuZE9jdGF2ZSgnZycsIG9jdGF2ZSl9XCI+PC9saT5cbiAgICAgICAgICAgIDxsaSBjbGFzcz1cImJsYWNrIGdzXCIgZGF0YS1ub3RlPVwiJHt0aGlzLmdldE5vdGVBbmRPY3RhdmUoJ2dzJywgb2N0YXZlKX1cIj48L2xpPlxuICAgICAgICAgICAgPGxpIGNsYXNzPVwid2hpdGUgYVwiIGRhdGEtbm90ZT1cIiR7dGhpcy5nZXROb3RlQW5kT2N0YXZlKCdhJywgb2N0YXZlKX1cIj48L2xpPlxuICAgICAgICAgICAgPGxpIGNsYXNzPVwiYmxhY2sgYXNcIiBkYXRhLW5vdGU9XCIke3RoaXMuZ2V0Tm90ZUFuZE9jdGF2ZSgnYXMnLCBvY3RhdmUpfVwiPjwvbGk+XG4gICAgICAgICAgICA8bGkgY2xhc3M9XCJ3aGl0ZSBiXCIgZGF0YS1ub3RlPVwiJHt0aGlzLmdldE5vdGVBbmRPY3RhdmUoJ2InLCBvY3RhdmUpfVwiPjwvbGk+YFxuICAgICAgICAgICAgXG4gICAgICAgIHJldHVybiBvY3RhdmVIVE1MXG4gICAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHBpYW5vO1xuIiwiIWZ1bmN0aW9uKHQsbil7XCJvYmplY3RcIj09dHlwZW9mIGV4cG9ydHMmJlwidW5kZWZpbmVkXCIhPXR5cGVvZiBtb2R1bGU/bihleHBvcnRzKTpcImZ1bmN0aW9uXCI9PXR5cGVvZiBkZWZpbmUmJmRlZmluZS5hbWQ/ZGVmaW5lKFtcImV4cG9ydHNcIl0sbik6bih0Lk5vdGVQYXJzZXI9dC5Ob3RlUGFyc2VyfHx7fSl9KHRoaXMsZnVuY3Rpb24odCl7XCJ1c2Ugc3RyaWN0XCI7ZnVuY3Rpb24gbih0LG4pe3JldHVybiBBcnJheShuKzEpLmpvaW4odCl9ZnVuY3Rpb24gcih0KXtyZXR1cm5cIm51bWJlclwiPT10eXBlb2YgdH1mdW5jdGlvbiBlKHQpe3JldHVyblwic3RyaW5nXCI9PXR5cGVvZiB0fWZ1bmN0aW9uIHUodCl7cmV0dXJuIHZvaWQgMCE9PXR9ZnVuY3Rpb24gYyh0LG4pe3JldHVybiBNYXRoLnBvdygyLCh0LTY5KS8xMikqKG58fDQ0MCl9ZnVuY3Rpb24gbygpe3JldHVybiBifWZ1bmN0aW9uIGkodCxuLHIpe2lmKFwic3RyaW5nXCIhPXR5cGVvZiB0KXJldHVybiBudWxsO3ZhciBlPWIuZXhlYyh0KTtpZighZXx8IW4mJmVbNF0pcmV0dXJuIG51bGw7dmFyIHU9e2xldHRlcjplWzFdLnRvVXBwZXJDYXNlKCksYWNjOmVbMl0ucmVwbGFjZSgveC9nLFwiIyNcIil9O3UucGM9dS5sZXR0ZXIrdS5hY2MsdS5zdGVwPSh1LmxldHRlci5jaGFyQ29kZUF0KDApKzMpJTcsdS5hbHQ9XCJiXCI9PT11LmFjY1swXT8tdS5hY2MubGVuZ3RoOnUuYWNjLmxlbmd0aDt2YXIgbz1BW3Uuc3RlcF0rdS5hbHQ7cmV0dXJuIHUuY2hyb21hPW88MD8xMitvOm8lMTIsZVszXSYmKHUub2N0PStlWzNdLHUubWlkaT1vKzEyKih1Lm9jdCsxKSx1LmZyZXE9Yyh1Lm1pZGkscikpLG4mJih1LnRvbmljT2Y9ZVs0XSksdX1mdW5jdGlvbiBmKHQpe3JldHVybiByKHQpP3Q8MD9uKFwiYlwiLC10KTpuKFwiI1wiLHQpOlwiXCJ9ZnVuY3Rpb24gYSh0KXtyZXR1cm4gcih0KT9cIlwiK3Q6XCJcIn1mdW5jdGlvbiBsKHQsbixyKXtyZXR1cm4gbnVsbD09PXR8fHZvaWQgMD09PXQ/bnVsbDp0LnN0ZXA/bCh0LnN0ZXAsdC5hbHQsdC5vY3QpOnQ8MHx8dD42P251bGw6Qy5jaGFyQXQodCkrZihuKSthKHIpfWZ1bmN0aW9uIHAodCl7aWYoKHIodCl8fGUodCkpJiZ0Pj0wJiZ0PDEyOClyZXR1cm4rdDt2YXIgbj1pKHQpO3JldHVybiBuJiZ1KG4ubWlkaSk/bi5taWRpOm51bGx9ZnVuY3Rpb24gcyh0LG4pe3ZhciByPXAodCk7cmV0dXJuIG51bGw9PT1yP251bGw6YyhyLG4pfWZ1bmN0aW9uIGQodCl7cmV0dXJuKGkodCl8fHt9KS5sZXR0ZXJ9ZnVuY3Rpb24gbSh0KXtyZXR1cm4oaSh0KXx8e30pLmFjY31mdW5jdGlvbiBoKHQpe3JldHVybihpKHQpfHx7fSkucGN9ZnVuY3Rpb24gdih0KXtyZXR1cm4oaSh0KXx8e30pLnN0ZXB9ZnVuY3Rpb24gZyh0KXtyZXR1cm4oaSh0KXx8e30pLmFsdH1mdW5jdGlvbiB4KHQpe3JldHVybihpKHQpfHx7fSkuY2hyb21hfWZ1bmN0aW9uIHkodCl7cmV0dXJuKGkodCl8fHt9KS5vY3R9dmFyIGI9L14oW2EtZ0EtR10pKCN7MSx9fGJ7MSx9fHh7MSx9fCkoLT9cXGQqKVxccyooLiopXFxzKiQvLEE9WzAsMiw0LDUsNyw5LDExXSxDPVwiQ0RFRkdBQlwiO3QucmVnZXg9byx0LnBhcnNlPWksdC5idWlsZD1sLHQubWlkaT1wLHQuZnJlcT1zLHQubGV0dGVyPWQsdC5hY2M9bSx0LnBjPWgsdC5zdGVwPXYsdC5hbHQ9Zyx0LmNocm9tYT14LHQub2N0PXl9KTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPW5vdGUtcGFyc2VyLmpzLm1hcFxuIiwiLypcblxuV2ViTWlkaSB2Mi4wLjAtcmMuOVxuXG5XZWJNaWRpLmpzIGhlbHBzIHlvdSB0YW1lIHRoZSBXZWIgTUlESSBBUEkuIFNlbmQgYW5kIHJlY2VpdmUgTUlESSBtZXNzYWdlcyB3aXRoIGVhc2UuIENvbnRyb2wgaW5zdHJ1bWVudHMgd2l0aCB1c2VyLWZyaWVuZGx5IGZ1bmN0aW9ucyAocGxheU5vdGUsIHNlbmRQaXRjaEJlbmQsIGV0Yy4pLiBSZWFjdCB0byBNSURJIGlucHV0IHdpdGggc2ltcGxlIGV2ZW50IGxpc3RlbmVycyAobm90ZW9uLCBwaXRjaGJlbmQsIGNvbnRyb2xjaGFuZ2UsIGV0Yy4pLlxuaHR0cHM6Ly9naXRodWIuY29tL2NvdGVqcC93ZWJtaWRpXG5cblxuVGhlIE1JVCBMaWNlbnNlIChNSVQpXG5cbkNvcHlyaWdodCAoYykgMjAxNS0yMDE2LCBKZWFuLVBoaWxpcHBlIEPDtHTDqVxuXG5QZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5IG9mIHRoaXMgc29mdHdhcmUgYW5kXG5hc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSBcIlNvZnR3YXJlXCIpLCB0byBkZWFsIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLFxuaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSxcbnN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpc1xuZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczpcblxuVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbFxucG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxuXG5USEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SIElNUExJRUQsIElOQ0xVRElORyBCVVRcbk5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EXG5OT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTXG5PUiBPVEhFUiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLCBPVVQgT0YgT1IgSU5cbkNPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTiBUSEUgU09GVFdBUkUuXG5cbiovXG5cbiFmdW5jdGlvbihzY29wZSl7XCJ1c2Ugc3RyaWN0XCI7ZnVuY3Rpb24gV2ViTWlkaSgpe2lmKFdlYk1pZGkucHJvdG90eXBlLl9zaW5nbGV0b24pdGhyb3cgbmV3IEVycm9yKFwiV2ViTWlkaSBpcyBhIHNpbmdsZXRvbiwgaXQgY2Fubm90IGJlIGluc3RhbnRpYXRlZCBkaXJlY3RseS5cIik7V2ViTWlkaS5wcm90b3R5cGUuX3NpbmdsZXRvbj10aGlzLHRoaXMuX2lucHV0cz1bXSx0aGlzLl9vdXRwdXRzPVtdLHRoaXMuX3VzZXJIYW5kbGVycz17fSx0aGlzLl9zdGF0ZUNoYW5nZVF1ZXVlPVtdLHRoaXMuX3Byb2Nlc3NpbmdTdGF0ZUNoYW5nZT0hMSx0aGlzLl9taWRpSW50ZXJmYWNlRXZlbnRzPVtcImNvbm5lY3RlZFwiLFwiZGlzY29ubmVjdGVkXCJdLHRoaXMuX25vdGVzPVtcIkNcIixcIkMjXCIsXCJEXCIsXCJEI1wiLFwiRVwiLFwiRlwiLFwiRiNcIixcIkdcIixcIkcjXCIsXCJBXCIsXCJBI1wiLFwiQlwiXSx0aGlzLl9zZW1pdG9uZXM9e0M6MCxEOjIsRTo0LEY6NSxHOjcsQTo5LEI6MTF9LE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRoaXMse01JRElfU1lTVEVNX01FU1NBR0VTOnt2YWx1ZTp7c3lzZXg6MjQwLHRpbWVjb2RlOjI0MSxzb25ncG9zaXRpb246MjQyLHNvbmdzZWxlY3Q6MjQzLHR1bmluZ3JlcXVlc3Q6MjQ2LHN5c2V4ZW5kOjI0NyxjbG9jazoyNDgsc3RhcnQ6MjUwLFwiY29udGludWVcIjoyNTEsc3RvcDoyNTIsYWN0aXZlc2Vuc2luZzoyNTQscmVzZXQ6MjU1LHVua25vd25zeXN0ZW1tZXNzYWdlOi0xfSx3cml0YWJsZTohMSxlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMX0sTUlESV9DSEFOTkVMX01FU1NBR0VTOnt2YWx1ZTp7bm90ZW9mZjo4LG5vdGVvbjo5LGtleWFmdGVydG91Y2g6MTAsY29udHJvbGNoYW5nZToxMSxjaGFubmVsbW9kZToxMSxwcm9ncmFtY2hhbmdlOjEyLGNoYW5uZWxhZnRlcnRvdWNoOjEzLHBpdGNoYmVuZDoxNH0sd3JpdGFibGU6ITEsZW51bWVyYWJsZTohMCxjb25maWd1cmFibGU6ITF9LE1JRElfUkVHSVNURVJFRF9QQVJBTUVURVI6e3ZhbHVlOntwaXRjaGJlbmRyYW5nZTpbMCwwXSxjaGFubmVsZmluZXR1bmluZzpbMCwxXSxjaGFubmVsY29hcnNldHVuaW5nOlswLDJdLHR1bmluZ3Byb2dyYW06WzAsM10sdHVuaW5nYmFuazpbMCw0XSxtb2R1bGF0aW9ucmFuZ2U6WzAsNV0sYXppbXV0aGFuZ2xlOls2MSwwXSxlbGV2YXRpb25hbmdsZTpbNjEsMV0sZ2FpbjpbNjEsMl0sZGlzdGFuY2VyYXRpbzpbNjEsM10sbWF4aW11bWRpc3RhbmNlOls2MSw0XSxtYXhpbXVtZGlzdGFuY2VnYWluOls2MSw1XSxyZWZlcmVuY2VkaXN0YW5jZXJhdGlvOls2MSw2XSxwYW5zcHJlYWRhbmdsZTpbNjEsN10scm9sbGFuZ2xlOls2MSw4XX0sd3JpdGFibGU6ITEsZW51bWVyYWJsZTohMCxjb25maWd1cmFibGU6ITF9LE1JRElfQ09OVFJPTF9DSEFOR0VfTUVTU0FHRVM6e3ZhbHVlOntiYW5rc2VsZWN0Y29hcnNlOjAsbW9kdWxhdGlvbndoZWVsY29hcnNlOjEsYnJlYXRoY29udHJvbGxlcmNvYXJzZToyLGZvb3Rjb250cm9sbGVyY29hcnNlOjQscG9ydGFtZW50b3RpbWVjb2Fyc2U6NSxkYXRhZW50cnljb2Fyc2U6Nix2b2x1bWVjb2Fyc2U6NyxiYWxhbmNlY29hcnNlOjgscGFuY29hcnNlOjEwLGV4cHJlc3Npb25jb2Fyc2U6MTEsZWZmZWN0Y29udHJvbDFjb2Fyc2U6MTIsZWZmZWN0Y29udHJvbDJjb2Fyc2U6MTMsZ2VuZXJhbHB1cnBvc2VzbGlkZXIxOjE2LGdlbmVyYWxwdXJwb3Nlc2xpZGVyMjoxNyxnZW5lcmFscHVycG9zZXNsaWRlcjM6MTgsZ2VuZXJhbHB1cnBvc2VzbGlkZXI0OjE5LGJhbmtzZWxlY3RmaW5lOjMyLG1vZHVsYXRpb253aGVlbGZpbmU6MzMsYnJlYXRoY29udHJvbGxlcmZpbmU6MzQsZm9vdGNvbnRyb2xsZXJmaW5lOjM2LHBvcnRhbWVudG90aW1lZmluZTozNyxkYXRhZW50cnlmaW5lOjM4LHZvbHVtZWZpbmU6MzksYmFsYW5jZWZpbmU6NDAscGFuZmluZTo0MixleHByZXNzaW9uZmluZTo0MyxlZmZlY3Rjb250cm9sMWZpbmU6NDQsZWZmZWN0Y29udHJvbDJmaW5lOjQ1LGhvbGRwZWRhbDo2NCxwb3J0YW1lbnRvOjY1LHN1c3RlbnV0b3BlZGFsOjY2LHNvZnRwZWRhbDo2NyxsZWdhdG9wZWRhbDo2OCxob2xkMnBlZGFsOjY5LHNvdW5kdmFyaWF0aW9uOjcwLHJlc29uYW5jZTo3MSxzb3VuZHJlbGVhc2V0aW1lOjcyLHNvdW5kYXR0YWNrdGltZTo3MyxicmlnaHRuZXNzOjc0LHNvdW5kY29udHJvbDY6NzUsc291bmRjb250cm9sNzo3Nixzb3VuZGNvbnRyb2w4Ojc3LHNvdW5kY29udHJvbDk6Nzgsc291bmRjb250cm9sMTA6NzksZ2VuZXJhbHB1cnBvc2VidXR0b24xOjgwLGdlbmVyYWxwdXJwb3NlYnV0dG9uMjo4MSxnZW5lcmFscHVycG9zZWJ1dHRvbjM6ODIsZ2VuZXJhbHB1cnBvc2VidXR0b240OjgzLHJldmVyYmxldmVsOjkxLHRyZW1vbG9sZXZlbDo5MixjaG9ydXNsZXZlbDo5MyxjZWxlc3RlbGV2ZWw6OTQscGhhc2VybGV2ZWw6OTUsZGF0YWJ1dHRvbmluY3JlbWVudDo5NixkYXRhYnV0dG9uZGVjcmVtZW50Ojk3LG5vbnJlZ2lzdGVyZWRwYXJhbWV0ZXJjb2Fyc2U6OTgsbm9ucmVnaXN0ZXJlZHBhcmFtZXRlcmZpbmU6OTkscmVnaXN0ZXJlZHBhcmFtZXRlcmNvYXJzZToxMDAscmVnaXN0ZXJlZHBhcmFtZXRlcmZpbmU6MTAxfSx3cml0YWJsZTohMSxlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMX0sTUlESV9DSEFOTkVMX01PREVfTUVTU0FHRVM6e3ZhbHVlOnthbGxzb3VuZG9mZjoxMjAscmVzZXRhbGxjb250cm9sbGVyczoxMjEsbG9jYWxjb250cm9sOjEyMixhbGxub3Rlc29mZjoxMjMsb21uaW1vZGVvZmY6MTI0LG9tbmltb2Rlb246MTI1LG1vbm9tb2Rlb246MTI2LHBvbHltb2Rlb246MTI3fSx3cml0YWJsZTohMSxlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMX19KSxPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0aGlzLHtzdXBwb3J0ZWQ6e2VudW1lcmFibGU6ITAsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuXCJyZXF1ZXN0TUlESUFjY2Vzc1wiaW4gbmF2aWdhdG9yfX0sZW5hYmxlZDp7ZW51bWVyYWJsZTohMCxnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdm9pZCAwIT09dGhpc1tcImludGVyZmFjZVwiXX0uYmluZCh0aGlzKX0saW5wdXRzOntlbnVtZXJhYmxlOiEwLGdldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9pbnB1dHN9LmJpbmQodGhpcyl9LG91dHB1dHM6e2VudW1lcmFibGU6ITAsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX291dHB1dHN9LmJpbmQodGhpcyl9LHN5c2V4RW5hYmxlZDp7ZW51bWVyYWJsZTohMCxnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4hKCF0aGlzW1wiaW50ZXJmYWNlXCJdfHwhdGhpc1tcImludGVyZmFjZVwiXS5zeXNleEVuYWJsZWQpfS5iaW5kKHRoaXMpfSx0aW1lOntlbnVtZXJhYmxlOiEwLGdldDpmdW5jdGlvbigpe3JldHVybiBwZXJmb3JtYW5jZS5ub3coKX19fSl9ZnVuY3Rpb24gSW5wdXQobWlkaUlucHV0KXt2YXIgdGhhdD10aGlzO3RoaXMuX3VzZXJIYW5kbGVycz17Y2hhbm5lbDp7fSxzeXN0ZW06e319LHRoaXMuX21pZGlJbnB1dD1taWRpSW5wdXQsT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGhpcyx7Y29ubmVjdGlvbjp7ZW51bWVyYWJsZTohMCxnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhhdC5fbWlkaUlucHV0LmNvbm5lY3Rpb259fSxpZDp7ZW51bWVyYWJsZTohMCxnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhhdC5fbWlkaUlucHV0LmlkfX0sbWFudWZhY3R1cmVyOntlbnVtZXJhYmxlOiEwLGdldDpmdW5jdGlvbigpe3JldHVybiB0aGF0Ll9taWRpSW5wdXQubWFudWZhY3R1cmVyfX0sbmFtZTp7ZW51bWVyYWJsZTohMCxnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhhdC5fbWlkaUlucHV0Lm5hbWV9fSxzdGF0ZTp7ZW51bWVyYWJsZTohMCxnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhhdC5fbWlkaUlucHV0LnN0YXRlfX19KSx0aGlzLl9pbml0aWFsaXplVXNlckhhbmRsZXJzKCl9ZnVuY3Rpb24gT3V0cHV0KG1pZGlPdXRwdXQpe3ZhciB0aGF0PXRoaXM7dGhpcy5fbWlkaU91dHB1dD1taWRpT3V0cHV0LE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRoaXMse2Nvbm5lY3Rpb246e2VudW1lcmFibGU6ITAsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoYXQuX21pZGlPdXRwdXQuY29ubmVjdGlvbn19LGlkOntlbnVtZXJhYmxlOiEwLGdldDpmdW5jdGlvbigpe3JldHVybiB0aGF0Ll9taWRpT3V0cHV0LmlkfX0sbWFudWZhY3R1cmVyOntlbnVtZXJhYmxlOiEwLGdldDpmdW5jdGlvbigpe3JldHVybiB0aGF0Ll9taWRpT3V0cHV0Lm1hbnVmYWN0dXJlcn19LG5hbWU6e2VudW1lcmFibGU6ITAsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoYXQuX21pZGlPdXRwdXQubmFtZX19LHN0YXRlOntlbnVtZXJhYmxlOiEwLGdldDpmdW5jdGlvbigpe3JldHVybiB0aGF0Ll9taWRpT3V0cHV0LnN0YXRlfX19KX12YXIgd209bmV3IFdlYk1pZGk7V2ViTWlkaS5wcm90b3R5cGUuZW5hYmxlPWZ1bmN0aW9uKGNhbGxiYWNrLHN5c2V4KXtyZXR1cm4gdGhpcy5lbmFibGVkP3ZvaWQgMDp0aGlzLnN1cHBvcnRlZD92b2lkIG5hdmlnYXRvci5yZXF1ZXN0TUlESUFjY2Vzcyh7c3lzZXg6c3lzZXh9KS50aGVuKGZ1bmN0aW9uKG1pZGlBY2Nlc3Mpe3RoaXNbXCJpbnRlcmZhY2VcIl09bWlkaUFjY2Vzcyx0aGlzLl9yZXNldEludGVyZmFjZVVzZXJIYW5kbGVycygpLHRoaXNbXCJpbnRlcmZhY2VcIl0ub25zdGF0ZWNoYW5nZT10aGlzLl9vbkludGVyZmFjZVN0YXRlQ2hhbmdlLmJpbmQodGhpcyksdGhpcy5fb25JbnRlcmZhY2VTdGF0ZUNoYW5nZShudWxsKSxcImZ1bmN0aW9uXCI9PXR5cGVvZiBjYWxsYmFjayYmY2FsbGJhY2suY2FsbCh0aGlzKX0uYmluZCh0aGlzKSxmdW5jdGlvbihlcnIpe1wiZnVuY3Rpb25cIj09dHlwZW9mIGNhbGxiYWNrJiZjYWxsYmFjay5jYWxsKHRoaXMsZXJyKX0uYmluZCh0aGlzKSk6dm9pZChcImZ1bmN0aW9uXCI9PXR5cGVvZiBjYWxsYmFjayYmY2FsbGJhY2sobmV3IEVycm9yKFwiVGhlIFdlYiBNSURJIEFQSSBpcyBub3Qgc3VwcG9ydGVkIGJ5IHlvdXIgYnJvd3Nlci5cIikpKX0sV2ViTWlkaS5wcm90b3R5cGUuZGlzYWJsZT1mdW5jdGlvbigpe2lmKCF0aGlzLnN1cHBvcnRlZCl0aHJvdyBuZXcgRXJyb3IoXCJUaGUgV2ViIE1JREkgQVBJIGlzIG5vdCBzdXBwb3J0ZWQgYnkgeW91ciBicm93c2VyLlwiKTt0aGlzW1wiaW50ZXJmYWNlXCJdLm9uc3RhdGVjaGFuZ2U9dm9pZCAwLHRoaXNbXCJpbnRlcmZhY2VcIl09dm9pZCAwLHRoaXMuX2lucHV0cz1bXSx0aGlzLl9vdXRwdXRzPVtdLHRoaXMuX3Jlc2V0SW50ZXJmYWNlVXNlckhhbmRsZXJzKCl9LFdlYk1pZGkucHJvdG90eXBlLmFkZExpc3RlbmVyPWZ1bmN0aW9uKHR5cGUsbGlzdGVuZXIpe2lmKCF0aGlzLmVuYWJsZWQpdGhyb3cgbmV3IEVycm9yKFwiV2ViTWlkaSBtdXN0IGJlIGVuYWJsZWQgYmVmb3JlIGFkZGluZyBldmVudCBsaXN0ZW5lcnMuXCIpO2lmKFwiZnVuY3Rpb25cIiE9dHlwZW9mIGxpc3RlbmVyKXRocm93IG5ldyBUeXBlRXJyb3IoXCJUaGUgJ2xpc3RlbmVyJyBwYXJhbWV0ZXIgbXVzdCBiZSBhIGZ1bmN0aW9uLlwiKTtpZighKHRoaXMuX21pZGlJbnRlcmZhY2VFdmVudHMuaW5kZXhPZih0eXBlKT49MCkpdGhyb3cgbmV3IFR5cGVFcnJvcihcIlRoZSBzcGVjaWZpZWQgZXZlbnQgdHlwZSBpcyBub3Qgc3VwcG9ydGVkLlwiKTtyZXR1cm4gdGhpcy5fdXNlckhhbmRsZXJzW3R5cGVdLnB1c2gobGlzdGVuZXIpLHRoaXN9LFdlYk1pZGkucHJvdG90eXBlLmhhc0xpc3RlbmVyPWZ1bmN0aW9uKHR5cGUsbGlzdGVuZXIpe2lmKCF0aGlzLmVuYWJsZWQpdGhyb3cgbmV3IEVycm9yKFwiV2ViTWlkaSBtdXN0IGJlIGVuYWJsZWQgYmVmb3JlIGNoZWNraW5nIGV2ZW50IGxpc3RlbmVycy5cIik7aWYoXCJmdW5jdGlvblwiIT10eXBlb2YgbGlzdGVuZXIpdGhyb3cgbmV3IFR5cGVFcnJvcihcIlRoZSAnbGlzdGVuZXInIHBhcmFtZXRlciBtdXN0IGJlIGEgZnVuY3Rpb24uXCIpO2lmKCEodGhpcy5fbWlkaUludGVyZmFjZUV2ZW50cy5pbmRleE9mKHR5cGUpPj0wKSl0aHJvdyBuZXcgVHlwZUVycm9yKFwiVGhlIHNwZWNpZmllZCBldmVudCB0eXBlIGlzIG5vdCBzdXBwb3J0ZWQuXCIpO2Zvcih2YXIgbz0wO288dGhpcy5fdXNlckhhbmRsZXJzW3R5cGVdLmxlbmd0aDtvKyspaWYodGhpcy5fdXNlckhhbmRsZXJzW3R5cGVdW29dPT09bGlzdGVuZXIpcmV0dXJuITA7cmV0dXJuITF9LFdlYk1pZGkucHJvdG90eXBlLnJlbW92ZUxpc3RlbmVyPWZ1bmN0aW9uKHR5cGUsbGlzdGVuZXIpe2lmKCF0aGlzLmVuYWJsZWQpdGhyb3cgbmV3IEVycm9yKFwiV2ViTWlkaSBtdXN0IGJlIGVuYWJsZWQgYmVmb3JlIHJlbW92aW5nIGV2ZW50IGxpc3RlbmVycy5cIik7aWYodm9pZCAwIT09bGlzdGVuZXImJlwiZnVuY3Rpb25cIiE9dHlwZW9mIGxpc3RlbmVyKXRocm93IG5ldyBUeXBlRXJyb3IoXCJUaGUgJ2xpc3RlbmVyJyBwYXJhbWV0ZXIgbXVzdCBiZSBhIGZ1bmN0aW9uLlwiKTtpZih0aGlzLl9taWRpSW50ZXJmYWNlRXZlbnRzLmluZGV4T2YodHlwZSk+PTApaWYobGlzdGVuZXIpZm9yKHZhciBvPTA7bzx0aGlzLl91c2VySGFuZGxlcnNbdHlwZV0ubGVuZ3RoO28rKyl0aGlzLl91c2VySGFuZGxlcnNbdHlwZV1bb109PT1saXN0ZW5lciYmdGhpcy5fdXNlckhhbmRsZXJzW3R5cGVdLnNwbGljZShvLDEpO2Vsc2UgdGhpcy5fdXNlckhhbmRsZXJzW3R5cGVdPVtdO2Vsc2V7aWYodm9pZCAwIT09dHlwZSl0aHJvdyBuZXcgVHlwZUVycm9yKFwiVGhlIHNwZWNpZmllZCBldmVudCB0eXBlIGlzIG5vdCBzdXBwb3J0ZWQuXCIpO3RoaXMuX3Jlc2V0SW50ZXJmYWNlVXNlckhhbmRsZXJzKCl9cmV0dXJuIHRoaXN9LFdlYk1pZGkucHJvdG90eXBlLmdldElucHV0QnlJZD1mdW5jdGlvbihpZCl7aWYoIXRoaXMuZW5hYmxlZCl0aHJvdyBuZXcgRXJyb3IoXCJXZWJNaWRpIGlzIG5vdCBlbmFibGVkLlwiKTtmb3IodmFyIGk9MDtpPHRoaXMuaW5wdXRzLmxlbmd0aDtpKyspaWYodGhpcy5pbnB1dHNbaV0uaWQ9PT1pZClyZXR1cm4gdGhpcy5pbnB1dHNbaV07cmV0dXJuITF9LFdlYk1pZGkucHJvdG90eXBlLmdldE91dHB1dEJ5SWQ9ZnVuY3Rpb24oaWQpe2lmKCF0aGlzLmVuYWJsZWQpdGhyb3cgbmV3IEVycm9yKFwiV2ViTWlkaSBpcyBub3QgZW5hYmxlZC5cIik7Zm9yKHZhciBpPTA7aTx0aGlzLm91dHB1dHMubGVuZ3RoO2krKylpZih0aGlzLm91dHB1dHNbaV0uaWQ9PT1pZClyZXR1cm4gdGhpcy5vdXRwdXRzW2ldO3JldHVybiExfSxXZWJNaWRpLnByb3RvdHlwZS5nZXRJbnB1dEJ5TmFtZT1mdW5jdGlvbihuYW1lKXtpZighdGhpcy5lbmFibGVkKXRocm93IG5ldyBFcnJvcihcIldlYk1pZGkgaXMgbm90IGVuYWJsZWQuXCIpO2Zvcih2YXIgaT0wO2k8dGhpcy5pbnB1dHMubGVuZ3RoO2krKylpZih+dGhpcy5pbnB1dHNbaV0ubmFtZS5pbmRleE9mKG5hbWUpKXJldHVybiB0aGlzLmlucHV0c1tpXTtyZXR1cm4hMX0sV2ViTWlkaS5wcm90b3R5cGUuZ2V0T2N0YXZlPWZ1bmN0aW9uKG51bWJlcil7cmV0dXJuIG51bWJlcj49MCYmMTI3Pj1udW1iZXI/TWF0aC5mbG9vcihwYXJzZUludChudW1iZXIpLzEyLTEpLTE6dm9pZCAwfSxXZWJNaWRpLnByb3RvdHlwZS5nZXRPdXRwdXRCeU5hbWU9ZnVuY3Rpb24obmFtZSl7aWYoIXRoaXMuZW5hYmxlZCl0aHJvdyBuZXcgRXJyb3IoXCJXZWJNaWRpIGlzIG5vdCBlbmFibGVkLlwiKTtmb3IodmFyIGk9MDtpPHRoaXMub3V0cHV0cy5sZW5ndGg7aSsrKWlmKH50aGlzLm91dHB1dHNbaV0ubmFtZS5pbmRleE9mKG5hbWUpKXJldHVybiB0aGlzLm91dHB1dHNbaV07cmV0dXJuITF9LFdlYk1pZGkucHJvdG90eXBlLmd1ZXNzTm90ZU51bWJlcj1mdW5jdGlvbihpbnB1dCl7dmFyIG91dHB1dD0hMTtpZihpbnB1dCYmaW5wdXQudG9GaXhlZCYmaW5wdXQ+PTAmJjEyNz49aW5wdXQ/b3V0cHV0PU1hdGgucm91bmQoaW5wdXQpOnBhcnNlSW50KGlucHV0KT49MCYmcGFyc2VJbnQoaW5wdXQpPD0xMjc/b3V0cHV0PXBhcnNlSW50KGlucHV0KTooXCJzdHJpbmdcIj09dHlwZW9mIGlucHV0fHxpbnB1dCBpbnN0YW5jZW9mIFN0cmluZykmJihvdXRwdXQ9dGhpcy5ub3RlTmFtZVRvTnVtYmVyKGlucHV0KSksb3V0cHV0PT09ITEpdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBub3RlIG51bWJlciAoXCIraW5wdXQrXCIpLlwiKTtyZXR1cm4gb3V0cHV0fSxXZWJNaWRpLnByb3RvdHlwZS5ub3RlTmFtZVRvTnVtYmVyPWZ1bmN0aW9uKG5hbWUpe1wic3RyaW5nXCIhPXR5cGVvZiBuYW1lJiYobmFtZT1cIlwiKTt2YXIgbWF0Y2hlcz1uYW1lLm1hdGNoKC8oW0NERUZHQUJdKSgjezAsMn18YnswLDJ9KSgtP1xcZCspL2kpO2lmKCFtYXRjaGVzKXRocm93IG5ldyBSYW5nZUVycm9yKFwiSW52YWxpZCBub3RlIG5hbWUuXCIpO3ZhciBzZW1pdG9uZXM9d20uX3NlbWl0b25lc1ttYXRjaGVzWzFdLnRvVXBwZXJDYXNlKCldLG9jdGF2ZT1wYXJzZUludChtYXRjaGVzWzNdKSxyZXN1bHQ9MTIqKG9jdGF2ZSsyKStzZW1pdG9uZXM7aWYobWF0Y2hlc1syXS50b0xvd2VyQ2FzZSgpLmluZGV4T2YoXCJiXCIpPi0xP3Jlc3VsdC09bWF0Y2hlc1syXS5sZW5ndGg6bWF0Y2hlc1syXS50b0xvd2VyQ2FzZSgpLmluZGV4T2YoXCIjXCIpPi0xJiYocmVzdWx0Kz1tYXRjaGVzWzJdLmxlbmd0aCksMD5zZW1pdG9uZXN8fC0yPm9jdGF2ZXx8b2N0YXZlPjh8fDA+cmVzdWx0fHxyZXN1bHQ+MTI3KXRocm93IG5ldyBSYW5nZUVycm9yKFwiSW52YWxpZCBub3RlIG5hbWUgb3Igbm90ZSBvdXRzaWRlIHZhbGlkIHJhbmdlLlwiKTtyZXR1cm4gcmVzdWx0fSxXZWJNaWRpLnByb3RvdHlwZS5fdXBkYXRlSW5wdXRzQW5kT3V0cHV0cz1mdW5jdGlvbigpe3RoaXMuX3VwZGF0ZUlucHV0cygpLHRoaXMuX3VwZGF0ZU91dHB1dHMoKX0sV2ViTWlkaS5wcm90b3R5cGUuX3VwZGF0ZUlucHV0cz1mdW5jdGlvbigpe2Zvcih2YXIgaT0wO2k8dGhpcy5faW5wdXRzLmxlbmd0aDtpKyspe2Zvcih2YXIgcmVtb3ZlPSEwLHVwZGF0ZWQ9dGhpc1tcImludGVyZmFjZVwiXS5pbnB1dHMudmFsdWVzKCksaW5wdXQ9dXBkYXRlZC5uZXh0KCk7aW5wdXQmJiFpbnB1dC5kb25lO2lucHV0PXVwZGF0ZWQubmV4dCgpKWlmKHRoaXMuX2lucHV0c1tpXS5fbWlkaUlucHV0PT09aW5wdXQudmFsdWUpe3JlbW92ZT0hMTticmVha31yZW1vdmUmJnRoaXMuX2lucHV0cy5zcGxpY2UoaSwxKX10aGlzW1wiaW50ZXJmYWNlXCJdLmlucHV0cy5mb3JFYWNoKGZ1bmN0aW9uKG5JbnB1dCl7Zm9yKHZhciBhZGQ9ITAsaj0wO2o8dGhpcy5faW5wdXRzLmxlbmd0aDtqKyspdGhpcy5faW5wdXRzW2pdLl9taWRpSW5wdXQ9PT1uSW5wdXQmJihhZGQ9ITEpO2FkZCYmdGhpcy5faW5wdXRzLnB1c2godGhpcy5fY3JlYXRlSW5wdXQobklucHV0KSl9LmJpbmQodGhpcykpfSxXZWJNaWRpLnByb3RvdHlwZS5fdXBkYXRlT3V0cHV0cz1mdW5jdGlvbigpe2Zvcih2YXIgaT0wO2k8dGhpcy5fb3V0cHV0cy5sZW5ndGg7aSsrKXtmb3IodmFyIHJlbW92ZT0hMCx1cGRhdGVkPXRoaXNbXCJpbnRlcmZhY2VcIl0ub3V0cHV0cy52YWx1ZXMoKSxvdXRwdXQ9dXBkYXRlZC5uZXh0KCk7b3V0cHV0JiYhb3V0cHV0LmRvbmU7b3V0cHV0PXVwZGF0ZWQubmV4dCgpKWlmKHRoaXMuX291dHB1dHNbaV0uX21pZGlPdXRwdXQ9PT1vdXRwdXQudmFsdWUpe3JlbW92ZT0hMTticmVha31yZW1vdmUmJnRoaXMuX291dHB1dHMuc3BsaWNlKGksMSl9dGhpc1tcImludGVyZmFjZVwiXS5vdXRwdXRzLmZvckVhY2goZnVuY3Rpb24obk91dHB1dCl7Zm9yKHZhciBhZGQ9ITAsaj0wO2o8dGhpcy5fb3V0cHV0cy5sZW5ndGg7aisrKXRoaXMuX291dHB1dHNbal0uX21pZGlPdXRwdXQ9PT1uT3V0cHV0JiYoYWRkPSExKTthZGQmJnRoaXMuX291dHB1dHMucHVzaCh0aGlzLl9jcmVhdGVPdXRwdXQobk91dHB1dCkpfS5iaW5kKHRoaXMpKX0sV2ViTWlkaS5wcm90b3R5cGUuX2NyZWF0ZUlucHV0PWZ1bmN0aW9uKG1pZGlJbnB1dCl7dmFyIGlucHV0PW5ldyBJbnB1dChtaWRpSW5wdXQpO3JldHVybiBpbnB1dC5fbWlkaUlucHV0Lm9ubWlkaW1lc3NhZ2U9aW5wdXQuX29uTWlkaU1lc3NhZ2UuYmluZChpbnB1dCksaW5wdXR9LFdlYk1pZGkucHJvdG90eXBlLl9jcmVhdGVPdXRwdXQ9ZnVuY3Rpb24obWlkaU91dHB1dCl7dmFyIG91dHB1dD1uZXcgT3V0cHV0KG1pZGlPdXRwdXQpO3JldHVybiBvdXRwdXQuX21pZGlPdXRwdXQub25taWRpbWVzc2FnZT1vdXRwdXQuX29uTWlkaU1lc3NhZ2UuYmluZChvdXRwdXQpLG91dHB1dH0sV2ViTWlkaS5wcm90b3R5cGUuX29uSW50ZXJmYWNlU3RhdGVDaGFuZ2U9ZnVuY3Rpb24oZSl7aWYodGhpcy5fc3RhdGVDaGFuZ2VRdWV1ZS5wdXNoKGUpLCF0aGlzLl9wcm9jZXNzaW5nU3RhdGVDaGFuZ2Upe2Zvcih0aGlzLl9wcm9jZXNzaW5nU3RhdGVDaGFuZ2U9ITA7dGhpcy5fc3RhdGVDaGFuZ2VRdWV1ZS5sZW5ndGg+MDspdGhpcy5fcHJvY2Vzc1N0YXRlQ2hhbmdlKHRoaXMuX3N0YXRlQ2hhbmdlUXVldWUuc2hpZnQoKSk7dGhpcy5fcHJvY2Vzc2luZ1N0YXRlQ2hhbmdlPSExfX0sV2ViTWlkaS5wcm90b3R5cGUuX3Byb2Nlc3NTdGF0ZUNoYW5nZT1mdW5jdGlvbihlKXtpZih0aGlzLl91cGRhdGVJbnB1dHNBbmRPdXRwdXRzKCksbnVsbCE9PWUpe3ZhciBldmVudD17dGltZXN0YW1wOmUudGltZVN0YW1wLHR5cGU6ZS5wb3J0LnN0YXRlLGlkOmUucG9ydC5pZCxtYW51ZmFjdHVyZXI6ZS5wb3J0Lm1hbnVmYWN0dXJlcixuYW1lOmUucG9ydC5uYW1lfTtcImNvbm5lY3RlZFwiPT09ZS5wb3J0LnN0YXRlJiYoXCJvdXRwdXRcIj09PWUucG9ydC50eXBlP2V2ZW50Lm91dHB1dD10aGlzLmdldE91dHB1dEJ5SWQoZS5wb3J0LmlkKTpcImlucHV0XCI9PT1lLnBvcnQudHlwZSYmKGV2ZW50LmlucHV0PXRoaXMuZ2V0SW5wdXRCeUlkKGUucG9ydC5pZCkpKSx0aGlzLl91c2VySGFuZGxlcnNbZS5wb3J0LnN0YXRlXS5mb3JFYWNoKGZ1bmN0aW9uKGhhbmRsZXIpe2hhbmRsZXIoZXZlbnQpfSl9fSxXZWJNaWRpLnByb3RvdHlwZS5fcmVzZXRJbnRlcmZhY2VVc2VySGFuZGxlcnM9ZnVuY3Rpb24oKXtmb3IodmFyIGk9MDtpPHRoaXMuX21pZGlJbnRlcmZhY2VFdmVudHMubGVuZ3RoO2krKyl0aGlzLl91c2VySGFuZGxlcnNbdGhpcy5fbWlkaUludGVyZmFjZUV2ZW50c1tpXV09W119LElucHV0LnByb3RvdHlwZS5hZGRMaXN0ZW5lcj1mdW5jdGlvbih0eXBlLGNoYW5uZWwsbGlzdGVuZXIpe3ZhciB0aGF0PXRoaXM7aWYodm9pZCAwPT09Y2hhbm5lbCYmKGNoYW5uZWw9XCJhbGxcIiksQXJyYXkuaXNBcnJheShjaGFubmVsKXx8KGNoYW5uZWw9W2NoYW5uZWxdKSxjaGFubmVsLmZvckVhY2goZnVuY3Rpb24oaXRlbSl7aWYoXCJhbGxcIiE9PWl0ZW0mJiEoaXRlbT49MSYmMTY+PWl0ZW0pKXRocm93IG5ldyBSYW5nZUVycm9yKFwiVGhlICdjaGFubmVsJyBwYXJhbWV0ZXIgaXMgaW52YWxpZC5cIil9KSxcImZ1bmN0aW9uXCIhPXR5cGVvZiBsaXN0ZW5lcil0aHJvdyBuZXcgVHlwZUVycm9yKFwiVGhlICdsaXN0ZW5lcicgcGFyYW1ldGVyIG11c3QgYmUgYSBmdW5jdGlvbi5cIik7aWYod20uTUlESV9TWVNURU1fTUVTU0FHRVNbdHlwZV0pdGhpcy5fdXNlckhhbmRsZXJzLnN5c3RlbVt0eXBlXXx8KHRoaXMuX3VzZXJIYW5kbGVycy5zeXN0ZW1bdHlwZV09W10pLHRoaXMuX3VzZXJIYW5kbGVycy5zeXN0ZW1bdHlwZV0ucHVzaChsaXN0ZW5lcik7ZWxzZXtpZighd20uTUlESV9DSEFOTkVMX01FU1NBR0VTW3R5cGVdKXRocm93IG5ldyBUeXBlRXJyb3IoXCJUaGUgc3BlY2lmaWVkIGV2ZW50IHR5cGUgaXMgbm90IHN1cHBvcnRlZC5cIik7aWYoY2hhbm5lbC5pbmRleE9mKFwiYWxsXCIpPi0xKXtjaGFubmVsPVtdO2Zvcih2YXIgaj0xOzE2Pj1qO2orKyljaGFubmVsLnB1c2goail9dGhpcy5fdXNlckhhbmRsZXJzLmNoYW5uZWxbdHlwZV18fCh0aGlzLl91c2VySGFuZGxlcnMuY2hhbm5lbFt0eXBlXT1bXSksY2hhbm5lbC5mb3JFYWNoKGZ1bmN0aW9uKGNoKXt0aGF0Ll91c2VySGFuZGxlcnMuY2hhbm5lbFt0eXBlXVtjaF18fCh0aGF0Ll91c2VySGFuZGxlcnMuY2hhbm5lbFt0eXBlXVtjaF09W10pLHRoYXQuX3VzZXJIYW5kbGVycy5jaGFubmVsW3R5cGVdW2NoXS5wdXNoKGxpc3RlbmVyKX0pfXJldHVybiB0aGlzfSxJbnB1dC5wcm90b3R5cGUub249SW5wdXQucHJvdG90eXBlLmFkZExpc3RlbmVyLElucHV0LnByb3RvdHlwZS5oYXNMaXN0ZW5lcj1mdW5jdGlvbih0eXBlLGNoYW5uZWwsbGlzdGVuZXIpe3ZhciB0aGF0PXRoaXM7aWYoXCJmdW5jdGlvblwiIT10eXBlb2YgbGlzdGVuZXIpdGhyb3cgbmV3IFR5cGVFcnJvcihcIlRoZSAnbGlzdGVuZXInIHBhcmFtZXRlciBtdXN0IGJlIGEgZnVuY3Rpb24uXCIpO2lmKHZvaWQgMD09PWNoYW5uZWwmJihjaGFubmVsPVwiYWxsXCIpLGNoYW5uZWwuY29uc3RydWN0b3IhPT1BcnJheSYmKGNoYW5uZWw9W2NoYW5uZWxdKSx3bS5NSURJX1NZU1RFTV9NRVNTQUdFU1t0eXBlXSl7Zm9yKHZhciBvPTA7bzx0aGlzLl91c2VySGFuZGxlcnMuc3lzdGVtW3R5cGVdLmxlbmd0aDtvKyspaWYodGhpcy5fdXNlckhhbmRsZXJzLnN5c3RlbVt0eXBlXVtvXT09PWxpc3RlbmVyKXJldHVybiEwfWVsc2UgaWYod20uTUlESV9DSEFOTkVMX01FU1NBR0VTW3R5cGVdKXtpZihjaGFubmVsLmluZGV4T2YoXCJhbGxcIik+LTEpe2NoYW5uZWw9W107Zm9yKHZhciBqPTE7MTY+PWo7aisrKWNoYW5uZWwucHVzaChqKX1yZXR1cm4gdGhpcy5fdXNlckhhbmRsZXJzLmNoYW5uZWxbdHlwZV0/Y2hhbm5lbC5ldmVyeShmdW5jdGlvbihjaE51bSl7dmFyIGxpc3RlbmVycz10aGF0Ll91c2VySGFuZGxlcnMuY2hhbm5lbFt0eXBlXVtjaE51bV07cmV0dXJuIGxpc3RlbmVycyYmbGlzdGVuZXJzLmluZGV4T2YobGlzdGVuZXIpPi0xfSk6ITF9cmV0dXJuITF9LElucHV0LnByb3RvdHlwZS5yZW1vdmVMaXN0ZW5lcj1mdW5jdGlvbih0eXBlLGNoYW5uZWwsbGlzdGVuZXIpe3ZhciB0aGF0PXRoaXM7aWYodm9pZCAwIT09bGlzdGVuZXImJlwiZnVuY3Rpb25cIiE9dHlwZW9mIGxpc3RlbmVyKXRocm93IG5ldyBUeXBlRXJyb3IoXCJUaGUgJ2xpc3RlbmVyJyBwYXJhbWV0ZXIgbXVzdCBiZSBhIGZ1bmN0aW9uLlwiKTtpZih2b2lkIDA9PT1jaGFubmVsJiYoY2hhbm5lbD1cImFsbFwiKSxjaGFubmVsLmNvbnN0cnVjdG9yIT09QXJyYXkmJihjaGFubmVsPVtjaGFubmVsXSksd20uTUlESV9TWVNURU1fTUVTU0FHRVNbdHlwZV0paWYodm9pZCAwPT09bGlzdGVuZXIpdGhpcy5fdXNlckhhbmRsZXJzLnN5c3RlbVt0eXBlXT1bXTtlbHNlIGZvcih2YXIgbz0wO288dGhpcy5fdXNlckhhbmRsZXJzLnN5c3RlbVt0eXBlXS5sZW5ndGg7bysrKXRoaXMuX3VzZXJIYW5kbGVycy5zeXN0ZW1bdHlwZV1bb109PT1saXN0ZW5lciYmdGhpcy5fdXNlckhhbmRsZXJzLnN5c3RlbVt0eXBlXS5zcGxpY2UobywxKTtlbHNlIGlmKHdtLk1JRElfQ0hBTk5FTF9NRVNTQUdFU1t0eXBlXSl7aWYoY2hhbm5lbC5pbmRleE9mKFwiYWxsXCIpPi0xKXtjaGFubmVsPVtdO2Zvcih2YXIgaj0xOzE2Pj1qO2orKyljaGFubmVsLnB1c2goail9aWYoIXRoaXMuX3VzZXJIYW5kbGVycy5jaGFubmVsW3R5cGVdKXJldHVybiB0aGlzO2NoYW5uZWwuZm9yRWFjaChmdW5jdGlvbihjaE51bSl7dmFyIGxpc3RlbmVycz10aGF0Ll91c2VySGFuZGxlcnMuY2hhbm5lbFt0eXBlXVtjaE51bV07aWYobGlzdGVuZXJzKWlmKHZvaWQgMD09PWxpc3RlbmVyKXRoYXQuX3VzZXJIYW5kbGVycy5jaGFubmVsW3R5cGVdW2NoTnVtXT1bXTtlbHNlIGZvcih2YXIgbD0wO2w8bGlzdGVuZXJzLmxlbmd0aDtsKyspbGlzdGVuZXJzW2xdPT09bGlzdGVuZXImJmxpc3RlbmVycy5zcGxpY2UobCwxKX0pfWVsc2V7aWYodm9pZCAwIT09dHlwZSl0aHJvdyBuZXcgVHlwZUVycm9yKFwiVGhlIHNwZWNpZmllZCBldmVudCB0eXBlIGlzIG5vdCBzdXBwb3J0ZWQuXCIpO3RoaXMuX2luaXRpYWxpemVVc2VySGFuZGxlcnMoKX1yZXR1cm4gdGhpc30sSW5wdXQucHJvdG90eXBlLl9pbml0aWFsaXplVXNlckhhbmRsZXJzPWZ1bmN0aW9uKCl7Zm9yKHZhciBwcm9wMSBpbiB3bS5NSURJX0NIQU5ORUxfTUVTU0FHRVMpd20uTUlESV9DSEFOTkVMX01FU1NBR0VTLmhhc093blByb3BlcnR5KHByb3AxKSYmKHRoaXMuX3VzZXJIYW5kbGVycy5jaGFubmVsW3Byb3AxXT17fSk7Zm9yKHZhciBwcm9wMiBpbiB3bS5NSURJX1NZU1RFTV9NRVNTQUdFUyl3bS5NSURJX1NZU1RFTV9NRVNTQUdFUy5oYXNPd25Qcm9wZXJ0eShwcm9wMikmJih0aGlzLl91c2VySGFuZGxlcnMuc3lzdGVtW3Byb3AyXT1bXSl9LElucHV0LnByb3RvdHlwZS5fb25NaWRpTWVzc2FnZT1mdW5jdGlvbihlKXtlLmRhdGFbMF08MjQwP3RoaXMuX3BhcnNlQ2hhbm5lbEV2ZW50KGUpOmUuZGF0YVswXTw9MjU1JiZ0aGlzLl9wYXJzZVN5c3RlbUV2ZW50KGUpfSxJbnB1dC5wcm90b3R5cGUuX3BhcnNlQ2hhbm5lbEV2ZW50PWZ1bmN0aW9uKGUpe3ZhciBkYXRhMSxkYXRhMixjb21tYW5kPWUuZGF0YVswXT4+NCxjaGFubmVsPSgxNSZlLmRhdGFbMF0pKzE7ZS5kYXRhLmxlbmd0aD4xJiYoZGF0YTE9ZS5kYXRhWzFdLGRhdGEyPWUuZGF0YS5sZW5ndGg+Mj9lLmRhdGFbMl06dm9pZCAwKTt2YXIgZXZlbnQ9e3RhcmdldDp0aGlzLGRhdGE6ZS5kYXRhLHRpbWVzdGFtcDplLnRpbWVTdGFtcCxjaGFubmVsOmNoYW5uZWx9O2NvbW1hbmQ9PT13bS5NSURJX0NIQU5ORUxfTUVTU0FHRVMubm90ZW9mZnx8Y29tbWFuZD09PXdtLk1JRElfQ0hBTk5FTF9NRVNTQUdFUy5ub3Rlb24mJjA9PT1kYXRhMj8oZXZlbnQudHlwZT1cIm5vdGVvZmZcIixldmVudC5ub3RlPXtudW1iZXI6ZGF0YTEsbmFtZTp3bS5fbm90ZXNbZGF0YTElMTJdLG9jdGF2ZTp3bS5nZXRPY3RhdmUoZGF0YTEpfSxldmVudC52ZWxvY2l0eT1kYXRhMi8xMjcsZXZlbnQucmF3VmVsb2NpdHk9ZGF0YTIpOmNvbW1hbmQ9PT13bS5NSURJX0NIQU5ORUxfTUVTU0FHRVMubm90ZW9uPyhldmVudC50eXBlPVwibm90ZW9uXCIsZXZlbnQubm90ZT17bnVtYmVyOmRhdGExLG5hbWU6d20uX25vdGVzW2RhdGExJTEyXSxvY3RhdmU6d20uZ2V0T2N0YXZlKGRhdGExKX0sZXZlbnQudmVsb2NpdHk9ZGF0YTIvMTI3LGV2ZW50LnJhd1ZlbG9jaXR5PWRhdGEyKTpjb21tYW5kPT09d20uTUlESV9DSEFOTkVMX01FU1NBR0VTLmtleWFmdGVydG91Y2g/KGV2ZW50LnR5cGU9XCJrZXlhZnRlcnRvdWNoXCIsZXZlbnQubm90ZT17bnVtYmVyOmRhdGExLG5hbWU6d20uX25vdGVzW2RhdGExJTEyXSxvY3RhdmU6d20uZ2V0T2N0YXZlKGRhdGExKX0sZXZlbnQudmFsdWU9ZGF0YTIvMTI3KTpjb21tYW5kPT09d20uTUlESV9DSEFOTkVMX01FU1NBR0VTLmNvbnRyb2xjaGFuZ2UmJmRhdGExPj0wJiYxMTk+PWRhdGExPyhldmVudC50eXBlPVwiY29udHJvbGNoYW5nZVwiLGV2ZW50LmNvbnRyb2xsZXI9e251bWJlcjpkYXRhMSxuYW1lOnRoaXMuZ2V0Q2NOYW1lQnlOdW1iZXIoZGF0YTEpfSxldmVudC52YWx1ZT1kYXRhMik6Y29tbWFuZD09PXdtLk1JRElfQ0hBTk5FTF9NRVNTQUdFUy5jaGFubmVsbW9kZSYmZGF0YTE+PTEyMCYmMTI3Pj1kYXRhMT8oZXZlbnQudHlwZT1cImNoYW5uZWxtb2RlXCIsZXZlbnQuY29udHJvbGxlcj17bnVtYmVyOmRhdGExLG5hbWU6dGhpcy5nZXRDaGFubmVsTW9kZUJ5TnVtYmVyKGRhdGExKX0sZXZlbnQudmFsdWU9ZGF0YTIpOmNvbW1hbmQ9PT13bS5NSURJX0NIQU5ORUxfTUVTU0FHRVMucHJvZ3JhbWNoYW5nZT8oZXZlbnQudHlwZT1cInByb2dyYW1jaGFuZ2VcIixldmVudC52YWx1ZT1kYXRhMSk6Y29tbWFuZD09PXdtLk1JRElfQ0hBTk5FTF9NRVNTQUdFUy5jaGFubmVsYWZ0ZXJ0b3VjaD8oZXZlbnQudHlwZT1cImNoYW5uZWxhZnRlcnRvdWNoXCIsZXZlbnQudmFsdWU9ZGF0YTEvMTI3KTpjb21tYW5kPT09d20uTUlESV9DSEFOTkVMX01FU1NBR0VTLnBpdGNoYmVuZD8oZXZlbnQudHlwZT1cInBpdGNoYmVuZFwiLGV2ZW50LnZhbHVlPSgoZGF0YTI8PDcpK2RhdGExLTgxOTIpLzgxOTIpOmV2ZW50LnR5cGU9XCJ1bmtub3duY2hhbm5lbG1lc3NhZ2VcIix0aGlzLl91c2VySGFuZGxlcnMuY2hhbm5lbFtldmVudC50eXBlXSYmdGhpcy5fdXNlckhhbmRsZXJzLmNoYW5uZWxbZXZlbnQudHlwZV1bY2hhbm5lbF0mJnRoaXMuX3VzZXJIYW5kbGVycy5jaGFubmVsW2V2ZW50LnR5cGVdW2NoYW5uZWxdLmZvckVhY2goZnVuY3Rpb24oY2FsbGJhY2spe2NhbGxiYWNrKGV2ZW50KX0pfSxJbnB1dC5wcm90b3R5cGUuZ2V0Q2NOYW1lQnlOdW1iZXI9ZnVuY3Rpb24obnVtYmVyKXtpZihudW1iZXI9cGFyc2VJbnQobnVtYmVyKSwhKG51bWJlcj49MCYmMTE5Pj1udW1iZXIpKXRocm93IG5ldyBSYW5nZUVycm9yKFwiVGhlIGNvbnRyb2wgY2hhbmdlIG51bWJlciBtdXN0IGJlIGJldHdlZW4gMCBhbmQgMTE5LlwiKTtmb3IodmFyIGNjIGluIHdtLk1JRElfQ09OVFJPTF9DSEFOR0VfTUVTU0FHRVMpaWYobnVtYmVyPT09d20uTUlESV9DT05UUk9MX0NIQU5HRV9NRVNTQUdFU1tjY10pcmV0dXJuIGNjO3JldHVybiB2b2lkIDB9LElucHV0LnByb3RvdHlwZS5nZXRDaGFubmVsTW9kZUJ5TnVtYmVyPWZ1bmN0aW9uKG51bWJlcil7aWYobnVtYmVyPXBhcnNlSW50KG51bWJlciksIShudW1iZXI+PTEyMCYmc3RhdHVzPD0xMjcpKXRocm93IG5ldyBSYW5nZUVycm9yKFwiVGhlIGNvbnRyb2wgY2hhbmdlIG51bWJlciBtdXN0IGJlIGJldHdlZW4gMTIwIGFuZCAxMjcuXCIpO2Zvcih2YXIgY20gaW4gd20uTUlESV9DSEFOTkVMX01PREVfTUVTU0FHRVMpaWYobnVtYmVyPT09d20uTUlESV9DSEFOTkVMX01PREVfTUVTU0FHRVNbY21dKXJldHVybiBjbX0sSW5wdXQucHJvdG90eXBlLl9wYXJzZVN5c3RlbUV2ZW50PWZ1bmN0aW9uKGUpe3ZhciBjb21tYW5kPWUuZGF0YVswXSxldmVudD17dGFyZ2V0OnRoaXMsZGF0YTplLmRhdGEsdGltZXN0YW1wOmUudGltZVN0YW1wfTtjb21tYW5kPT09d20uTUlESV9TWVNURU1fTUVTU0FHRVMuc3lzZXg/ZXZlbnQudHlwZT1cInN5c2V4XCI6Y29tbWFuZD09PXdtLk1JRElfU1lTVEVNX01FU1NBR0VTLnRpbWVjb2RlP2V2ZW50LnR5cGU9XCJ0aW1lY29kZVwiOmNvbW1hbmQ9PT13bS5NSURJX1NZU1RFTV9NRVNTQUdFUy5zb25ncG9zaXRpb24/ZXZlbnQudHlwZT1cInNvbmdwb3NpdGlvblwiOmNvbW1hbmQ9PT13bS5NSURJX1NZU1RFTV9NRVNTQUdFUy5zb25nc2VsZWN0PyhldmVudC50eXBlPVwic29uZ3NlbGVjdFwiLGV2ZW50LnNvbmc9ZS5kYXRhWzFdKTpjb21tYW5kPT09d20uTUlESV9TWVNURU1fTUVTU0FHRVMudHVuaW5ncmVxdWVzdD9ldmVudC50eXBlPVwidHVuaW5ncmVxdWVzdFwiOmNvbW1hbmQ9PT13bS5NSURJX1NZU1RFTV9NRVNTQUdFUy5jbG9jaz9ldmVudC50eXBlPVwiY2xvY2tcIjpjb21tYW5kPT09d20uTUlESV9TWVNURU1fTUVTU0FHRVMuc3RhcnQ/ZXZlbnQudHlwZT1cInN0YXJ0XCI6Y29tbWFuZD09PXdtLk1JRElfU1lTVEVNX01FU1NBR0VTW1wiY29udGludWVcIl0/ZXZlbnQudHlwZT1cImNvbnRpbnVlXCI6Y29tbWFuZD09PXdtLk1JRElfU1lTVEVNX01FU1NBR0VTLnN0b3A/ZXZlbnQudHlwZT1cInN0b3BcIjpjb21tYW5kPT09d20uTUlESV9TWVNURU1fTUVTU0FHRVMuYWN0aXZlc2Vuc2luZz9ldmVudC50eXBlPVwiYWN0aXZlc2Vuc2luZ1wiOmNvbW1hbmQ9PT13bS5NSURJX1NZU1RFTV9NRVNTQUdFUy5yZXNldD9ldmVudC50eXBlPVwicmVzZXRcIjpldmVudC50eXBlPVwidW5rbm93bnN5c3RlbW1lc3NhZ2VcIix0aGlzLl91c2VySGFuZGxlcnMuc3lzdGVtW2V2ZW50LnR5cGVdJiZ0aGlzLl91c2VySGFuZGxlcnMuc3lzdGVtW2V2ZW50LnR5cGVdLmZvckVhY2goZnVuY3Rpb24oY2FsbGJhY2spe2NhbGxiYWNrKGV2ZW50KX0pfSxPdXRwdXQucHJvdG90eXBlLnNlbmQ9ZnVuY3Rpb24oc3RhdHVzLGRhdGEsdGltZXN0YW1wKXtpZighKHN0YXR1cz49MTI4JiYyNTU+PXN0YXR1cykpdGhyb3cgbmV3IFJhbmdlRXJyb3IoXCJUaGUgc3RhdHVzIGJ5dGUgbXVzdCBiZSBhbiBpbnRlZ2VyIGJldHdlZW4gMTI4ICgweDgwKSBhbmQgMjU1ICgweEZGKS5cIik7QXJyYXkuaXNBcnJheShkYXRhKXx8KGRhdGE9cGFyc2VJbnQoZGF0YSk+PTAmJnBhcnNlSW50KGRhdGEpPD0xMjc/W3BhcnNlSW50KGRhdGEpXTpbXSk7dmFyIG1lc3NhZ2U9W3N0YXR1c107cmV0dXJuIGRhdGEuZm9yRWFjaChmdW5jdGlvbihpdGVtKXtpZighKGl0ZW0+PTAmJjI1NT49aXRlbSkpdGhyb3cgbmV3IFJhbmdlRXJyb3IoXCJUaGUgZGF0YSBieXRlcyBtdXN0IGJlIGludGVnZXJzIGJldHdlZW4gMCAoMHgwMCkgYW5kIDI1NSAoMHhGRikuXCIpO21lc3NhZ2UucHVzaChpdGVtKX0pLHRoaXMuX21pZGlPdXRwdXQuc2VuZChtZXNzYWdlLHBhcnNlRmxvYXQodGltZXN0YW1wKXx8MCksdGhpc30sT3V0cHV0LnByb3RvdHlwZS5zZW5kU3lzZXg9ZnVuY3Rpb24obWFudWZhY3R1cmVyLGRhdGEsb3B0aW9ucyl7aWYoIXdtLnN5c2V4RW5hYmxlZCl0aHJvdyBuZXcgRXJyb3IoXCJTeXNFeCBtZXNzYWdlIHN1cHBvcnQgbXVzdCBmaXJzdCBiZSBhY3RpdmF0ZWQuXCIpO3JldHVybiBvcHRpb25zPW9wdGlvbnN8fHt9LG1hbnVmYWN0dXJlcj1bXS5jb25jYXQobWFudWZhY3R1cmVyKSxkYXRhLmZvckVhY2goZnVuY3Rpb24oaXRlbSl7aWYoMD5pdGVtfHxpdGVtPjEyNyl0aHJvdyBuZXcgUmFuZ2VFcnJvcihcIlRoZSBkYXRhIGJ5dGVzIG9mIGEgU3lzRXggbWVzc2FnZSBtdXN0IGJlIGludGVnZXJzIGJldHdlZW4gMCAoMHgwMCkgYW5kIDEyNyAoMHg3RikuXCIpfSksZGF0YT1tYW51ZmFjdHVyZXIuY29uY2F0KGRhdGEsd20uTUlESV9TWVNURU1fTUVTU0FHRVMuc3lzZXhlbmQpLHRoaXMuc2VuZCh3bS5NSURJX1NZU1RFTV9NRVNTQUdFUy5zeXNleCxkYXRhLHRoaXMuX3BhcnNlVGltZVBhcmFtZXRlcihvcHRpb25zLnRpbWUpKSx0aGlzfSxPdXRwdXQucHJvdG90eXBlLnNlbmRUaW1lY29kZVF1YXJ0ZXJGcmFtZT1mdW5jdGlvbih2YWx1ZSxvcHRpb25zKXtyZXR1cm4gb3B0aW9ucz1vcHRpb25zfHx7fSx0aGlzLnNlbmQod20uTUlESV9TWVNURU1fTUVTU0FHRVMudGltZWNvZGUsdmFsdWUsdGhpcy5fcGFyc2VUaW1lUGFyYW1ldGVyKG9wdGlvbnMudGltZSkpLHRoaXN9LE91dHB1dC5wcm90b3R5cGUuc2VuZFNvbmdQb3NpdGlvbj1mdW5jdGlvbih2YWx1ZSxvcHRpb25zKXt2YWx1ZT1wYXJzZUludCh2YWx1ZSl8fDAsb3B0aW9ucz1vcHRpb25zfHx7fTt2YXIgbXNiPXZhbHVlPj43JjEyNyxsc2I9MTI3JnZhbHVlO3JldHVybiB0aGlzLnNlbmQod20uTUlESV9TWVNURU1fTUVTU0FHRVMuc29uZ3Bvc2l0aW9uLFttc2IsbHNiXSx0aGlzLl9wYXJzZVRpbWVQYXJhbWV0ZXIob3B0aW9ucy50aW1lKSksdGhpc30sT3V0cHV0LnByb3RvdHlwZS5zZW5kU29uZ1NlbGVjdD1mdW5jdGlvbih2YWx1ZSxvcHRpb25zKXtpZih2YWx1ZT1wYXJzZUludCh2YWx1ZSksb3B0aW9ucz1vcHRpb25zfHx7fSwhKHZhbHVlPj0wJiYxMjc+PXZhbHVlKSl0aHJvdyBuZXcgUmFuZ2VFcnJvcihcIlRoZSBzb25nIG51bWJlciBtdXN0IGJlIGJldHdlZW4gMCBhbmQgMTI3LlwiKTtyZXR1cm4gdGhpcy5zZW5kKHdtLk1JRElfU1lTVEVNX01FU1NBR0VTLnNvbmdzZWxlY3QsW3ZhbHVlXSx0aGlzLl9wYXJzZVRpbWVQYXJhbWV0ZXIob3B0aW9ucy50aW1lKSksdGhpc30sT3V0cHV0LnByb3RvdHlwZS5zZW5kVHVuaW5nUmVxdWVzdD1mdW5jdGlvbihvcHRpb25zKXtyZXR1cm4gb3B0aW9ucz1vcHRpb25zfHx7fSx0aGlzLnNlbmQod20uTUlESV9TWVNURU1fTUVTU0FHRVMudHVuaW5ncmVxdWVzdCx2b2lkIDAsdGhpcy5fcGFyc2VUaW1lUGFyYW1ldGVyKG9wdGlvbnMudGltZSkpLHRoaXN9LE91dHB1dC5wcm90b3R5cGUuc2VuZENsb2NrPWZ1bmN0aW9uKG9wdGlvbnMpe3JldHVybiBvcHRpb25zPW9wdGlvbnN8fHt9LHRoaXMuc2VuZCh3bS5NSURJX1NZU1RFTV9NRVNTQUdFUy5jbG9jayx2b2lkIDAsdGhpcy5fcGFyc2VUaW1lUGFyYW1ldGVyKG9wdGlvbnMudGltZSkpLHRoaXN9LE91dHB1dC5wcm90b3R5cGUuc2VuZFN0YXJ0PWZ1bmN0aW9uKG9wdGlvbnMpe3JldHVybiBvcHRpb25zPW9wdGlvbnN8fHt9LHRoaXMuc2VuZCh3bS5NSURJX1NZU1RFTV9NRVNTQUdFUy5zdGFydCx2b2lkIDAsdGhpcy5fcGFyc2VUaW1lUGFyYW1ldGVyKG9wdGlvbnMudGltZSkpLHRoaXN9LE91dHB1dC5wcm90b3R5cGUuc2VuZENvbnRpbnVlPWZ1bmN0aW9uKG9wdGlvbnMpe3JldHVybiBvcHRpb25zPW9wdGlvbnN8fHt9LHRoaXMuc2VuZCh3bS5NSURJX1NZU1RFTV9NRVNTQUdFU1tcImNvbnRpbnVlXCJdLHZvaWQgMCx0aGlzLl9wYXJzZVRpbWVQYXJhbWV0ZXIob3B0aW9ucy50aW1lKSksdGhpc30sT3V0cHV0LnByb3RvdHlwZS5zZW5kU3RvcD1mdW5jdGlvbihvcHRpb25zKXtyZXR1cm4gb3B0aW9ucz1vcHRpb25zfHx7fSx0aGlzLnNlbmQod20uTUlESV9TWVNURU1fTUVTU0FHRVMuc3RvcCx2b2lkIDAsdGhpcy5fcGFyc2VUaW1lUGFyYW1ldGVyKG9wdGlvbnMudGltZSkpLHRoaXN9LE91dHB1dC5wcm90b3R5cGUuc2VuZEFjdGl2ZVNlbnNpbmc9ZnVuY3Rpb24ob3B0aW9ucyl7cmV0dXJuIG9wdGlvbnM9b3B0aW9uc3x8e30sdGhpcy5zZW5kKHdtLk1JRElfU1lTVEVNX01FU1NBR0VTLmFjdGl2ZXNlbnNpbmcsdm9pZCAwLHRoaXMuX3BhcnNlVGltZVBhcmFtZXRlcihvcHRpb25zLnRpbWUpKSx0aGlzfSxPdXRwdXQucHJvdG90eXBlLnNlbmRSZXNldD1mdW5jdGlvbihvcHRpb25zKXtyZXR1cm4gb3B0aW9ucz1vcHRpb25zfHx7fSx0aGlzLnNlbmQod20uTUlESV9TWVNURU1fTUVTU0FHRVMucmVzZXQsdm9pZCAwLHRoaXMuX3BhcnNlVGltZVBhcmFtZXRlcihvcHRpb25zLnRpbWUpKSx0aGlzfSxPdXRwdXQucHJvdG90eXBlLnN0b3BOb3RlPWZ1bmN0aW9uKG5vdGUsY2hhbm5lbCxvcHRpb25zKXtpZihcImFsbFwiPT09bm90ZSlyZXR1cm4gdGhpcy5zZW5kQ2hhbm5lbE1vZGUoXCJhbGxub3Rlc29mZlwiLDAsY2hhbm5lbCxvcHRpb25zKTt2YXIgblZlbG9jaXR5PTY0O3JldHVybiBvcHRpb25zPW9wdGlvbnN8fHt9LG9wdGlvbnMudmVsb2NpdHk9cGFyc2VGbG9hdChvcHRpb25zLnZlbG9jaXR5KSxvcHRpb25zLnJhd1ZlbG9jaXR5PyFpc05hTihvcHRpb25zLnZlbG9jaXR5KSYmb3B0aW9ucy52ZWxvY2l0eT49MCYmb3B0aW9ucy52ZWxvY2l0eTw9MTI3JiYoblZlbG9jaXR5PW9wdGlvbnMudmVsb2NpdHkpOiFpc05hTihvcHRpb25zLnZlbG9jaXR5KSYmb3B0aW9ucy52ZWxvY2l0eT49MCYmb3B0aW9ucy52ZWxvY2l0eTw9MSYmKG5WZWxvY2l0eT0xMjcqb3B0aW9ucy52ZWxvY2l0eSksdGhpcy5fY29udmVydE5vdGVUb0FycmF5KG5vdGUpLmZvckVhY2goZnVuY3Rpb24oaXRlbSl7dGhpcy5fY29udmVydENoYW5uZWxUb0FycmF5KGNoYW5uZWwpLmZvckVhY2goZnVuY3Rpb24oY2gpe3RoaXMuc2VuZCgod20uTUlESV9DSEFOTkVMX01FU1NBR0VTLm5vdGVvZmY8PDQpKyhjaC0xKSxbaXRlbSxNYXRoLnJvdW5kKG5WZWxvY2l0eSldLHRoaXMuX3BhcnNlVGltZVBhcmFtZXRlcihvcHRpb25zLnRpbWUpKX0uYmluZCh0aGlzKSl9LmJpbmQodGhpcykpLHRoaXN9LE91dHB1dC5wcm90b3R5cGUucGxheU5vdGU9ZnVuY3Rpb24obm90ZSxjaGFubmVsLG9wdGlvbnMpe3ZhciBuVmVsb2NpdHk9NjQ7aWYob3B0aW9ucz1vcHRpb25zfHx7fSxvcHRpb25zLnZlbG9jaXR5PXBhcnNlRmxvYXQob3B0aW9ucy52ZWxvY2l0eSksb3B0aW9ucy5yYXdWZWxvY2l0eT8haXNOYU4ob3B0aW9ucy52ZWxvY2l0eSkmJm9wdGlvbnMudmVsb2NpdHk+PTAmJm9wdGlvbnMudmVsb2NpdHk8PTEyNyYmKG5WZWxvY2l0eT1vcHRpb25zLnZlbG9jaXR5KTohaXNOYU4ob3B0aW9ucy52ZWxvY2l0eSkmJm9wdGlvbnMudmVsb2NpdHk+PTAmJm9wdGlvbnMudmVsb2NpdHk8PTEmJihuVmVsb2NpdHk9MTI3Km9wdGlvbnMudmVsb2NpdHkpLG9wdGlvbnMudGltZT10aGlzLl9wYXJzZVRpbWVQYXJhbWV0ZXIob3B0aW9ucy50aW1lKSx0aGlzLl9jb252ZXJ0Tm90ZVRvQXJyYXkobm90ZSkuZm9yRWFjaChmdW5jdGlvbihpdGVtKXt0aGlzLl9jb252ZXJ0Q2hhbm5lbFRvQXJyYXkoY2hhbm5lbCkuZm9yRWFjaChmdW5jdGlvbihjaCl7dGhpcy5zZW5kKCh3bS5NSURJX0NIQU5ORUxfTUVTU0FHRVMubm90ZW9uPDw0KSsoY2gtMSksW2l0ZW0sTWF0aC5yb3VuZChuVmVsb2NpdHkpXSxvcHRpb25zLnRpbWUpfS5iaW5kKHRoaXMpKX0uYmluZCh0aGlzKSksb3B0aW9ucy5kdXJhdGlvbj1wYXJzZUZsb2F0KG9wdGlvbnMuZHVyYXRpb24pLG9wdGlvbnMuZHVyYXRpb24pe29wdGlvbnMuZHVyYXRpb248PTAmJihvcHRpb25zLmR1cmF0aW9uPTApO3ZhciBuUmVsZWFzZT02NDtvcHRpb25zLnJlbGVhc2U9cGFyc2VGbG9hdChvcHRpb25zLnJlbGVhc2UpLG9wdGlvbnMucmF3VmVsb2NpdHk/IWlzTmFOKG9wdGlvbnMucmVsZWFzZSkmJm9wdGlvbnMucmVsZWFzZT49MCYmb3B0aW9ucy5yZWxlYXNlPD0xMjcmJihuUmVsZWFzZT1vcHRpb25zLnJlbGVhc2UpOiFpc05hTihvcHRpb25zLnJlbGVhc2UpJiZvcHRpb25zLnJlbGVhc2U+PTAmJm9wdGlvbnMucmVsZWFzZTw9MSYmKG5SZWxlYXNlPTEyNypvcHRpb25zLnJlbGVhc2UpLHRoaXMuX2NvbnZlcnROb3RlVG9BcnJheShub3RlKS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pe3RoaXMuX2NvbnZlcnRDaGFubmVsVG9BcnJheShjaGFubmVsKS5mb3JFYWNoKGZ1bmN0aW9uKGNoKXt0aGlzLnNlbmQoKHdtLk1JRElfQ0hBTk5FTF9NRVNTQUdFUy5ub3Rlb2ZmPDw0KSsoY2gtMSksW2l0ZW0sTWF0aC5yb3VuZChuUmVsZWFzZSldLChvcHRpb25zLnRpbWV8fHdtLnRpbWUpK29wdGlvbnMuZHVyYXRpb24pfS5iaW5kKHRoaXMpKX0uYmluZCh0aGlzKSl9cmV0dXJuIHRoaXN9LE91dHB1dC5wcm90b3R5cGUuc2VuZEtleUFmdGVydG91Y2g9ZnVuY3Rpb24obm90ZSxjaGFubmVsLHByZXNzdXJlLG9wdGlvbnMpe3ZhciB0aGF0PXRoaXM7aWYob3B0aW9ucz1vcHRpb25zfHx7fSwxPmNoYW5uZWx8fGNoYW5uZWw+MTYpdGhyb3cgbmV3IFJhbmdlRXJyb3IoXCJUaGUgY2hhbm5lbCBtdXN0IGJlIGJldHdlZW4gMSBhbmQgMTYuXCIpO3ByZXNzdXJlPXBhcnNlRmxvYXQocHJlc3N1cmUpLChpc05hTihwcmVzc3VyZSl8fDA+cHJlc3N1cmV8fHByZXNzdXJlPjEpJiYocHJlc3N1cmU9LjUpO3ZhciBuUHJlc3N1cmU9TWF0aC5yb3VuZCgxMjcqcHJlc3N1cmUpO3JldHVybiB0aGlzLl9jb252ZXJ0Tm90ZVRvQXJyYXkobm90ZSkuZm9yRWFjaChmdW5jdGlvbihpdGVtKXt0aGF0Ll9jb252ZXJ0Q2hhbm5lbFRvQXJyYXkoY2hhbm5lbCkuZm9yRWFjaChmdW5jdGlvbihjaCl7dGhhdC5zZW5kKCh3bS5NSURJX0NIQU5ORUxfTUVTU0FHRVMua2V5YWZ0ZXJ0b3VjaDw8NCkrKGNoLTEpLFtpdGVtLG5QcmVzc3VyZV0sdGhhdC5fcGFyc2VUaW1lUGFyYW1ldGVyKG9wdGlvbnMudGltZSkpfSl9KSx0aGlzfSxPdXRwdXQucHJvdG90eXBlLnNlbmRDb250cm9sQ2hhbmdlPWZ1bmN0aW9uKGNvbnRyb2xsZXIsdmFsdWUsY2hhbm5lbCxvcHRpb25zKXtpZihvcHRpb25zPW9wdGlvbnN8fHt9LFwic3RyaW5nXCI9PXR5cGVvZiBjb250cm9sbGVyKXtpZihjb250cm9sbGVyPXdtLk1JRElfQ09OVFJPTF9DSEFOR0VfTUVTU0FHRVNbY29udHJvbGxlcl0sIWNvbnRyb2xsZXIpdGhyb3cgbmV3IFR5cGVFcnJvcihcIkludmFsaWQgY29udHJvbGxlciBuYW1lLlwiKX1lbHNlIGlmKGNvbnRyb2xsZXI9cGFyc2VJbnQoY29udHJvbGxlciksIShjb250cm9sbGVyPj0wJiYxMTk+PWNvbnRyb2xsZXIpKXRocm93IG5ldyBSYW5nZUVycm9yKFwiQ29udHJvbGxlciBudW1iZXJzIG11c3QgYmUgYmV0d2VlbiAwIGFuZCAxMTkuXCIpO2lmKHZhbHVlPXBhcnNlSW50KHZhbHVlKXx8MCwhKHZhbHVlPj0wJiYxMjc+PXZhbHVlKSl0aHJvdyBuZXcgUmFuZ2VFcnJvcihcIkNvbnRyb2xsZXIgdmFsdWUgbXVzdCBiZSBiZXR3ZWVuIDAgYW5kIDEyNy5cIik7cmV0dXJuIHRoaXMuX2NvbnZlcnRDaGFubmVsVG9BcnJheShjaGFubmVsKS5mb3JFYWNoKGZ1bmN0aW9uKGNoKXt0aGlzLnNlbmQoKHdtLk1JRElfQ0hBTk5FTF9NRVNTQUdFUy5jb250cm9sY2hhbmdlPDw0KSsoY2gtMSksW2NvbnRyb2xsZXIsdmFsdWVdLHRoaXMuX3BhcnNlVGltZVBhcmFtZXRlcihvcHRpb25zLnRpbWUpKX0uYmluZCh0aGlzKSksdGhpc30sT3V0cHV0LnByb3RvdHlwZS5fc2VsZWN0UmVnaXN0ZXJlZFBhcmFtZXRlcj1mdW5jdGlvbihwYXJhbWV0ZXIsY2hhbm5lbCx0aW1lKXt2YXIgdGhhdD10aGlzO2lmKHBhcmFtZXRlclswXT1wYXJzZUludChwYXJhbWV0ZXJbMF0pLCEocGFyYW1ldGVyWzBdPj0wJiZwYXJhbWV0ZXJbMF08PTEyNykpdGhyb3cgbmV3IFJhbmdlRXJyb3IoXCJUaGUgY29udHJvbDY1IHZhbHVlIG11c3QgYmUgYmV0d2VlbiAwIGFuZCAxMjdcIik7aWYocGFyYW1ldGVyWzFdPXBhcnNlSW50KHBhcmFtZXRlclsxXSksIShwYXJhbWV0ZXJbMV0+PTAmJnBhcmFtZXRlclsxXTw9MTI3KSl0aHJvdyBuZXcgUmFuZ2VFcnJvcihcIlRoZSBjb250cm9sNjQgdmFsdWUgbXVzdCBiZSBiZXR3ZWVuIDAgYW5kIDEyN1wiKTtyZXR1cm4gdGhpcy5fY29udmVydENoYW5uZWxUb0FycmF5KGNoYW5uZWwpLmZvckVhY2goZnVuY3Rpb24oY2gpe3RoYXQuc2VuZENvbnRyb2xDaGFuZ2UoMTAxLHBhcmFtZXRlclswXSxjaGFubmVsLHt0aW1lOnRpbWV9KSx0aGF0LnNlbmRDb250cm9sQ2hhbmdlKDEwMCxwYXJhbWV0ZXJbMV0sY2hhbm5lbCx7dGltZTp0aW1lfSl9KSx0aGlzfSxPdXRwdXQucHJvdG90eXBlLl9zZWxlY3ROb25SZWdpc3RlcmVkUGFyYW1ldGVyPWZ1bmN0aW9uKHBhcmFtZXRlcixjaGFubmVsLHRpbWUpe3ZhciB0aGF0PXRoaXM7aWYocGFyYW1ldGVyWzBdPXBhcnNlSW50KHBhcmFtZXRlclswXSksIShwYXJhbWV0ZXJbMF0+PTAmJnBhcmFtZXRlclswXTw9MTI3KSl0aHJvdyBuZXcgUmFuZ2VFcnJvcihcIlRoZSBjb250cm9sNjMgdmFsdWUgbXVzdCBiZSBiZXR3ZWVuIDAgYW5kIDEyN1wiKTtpZihwYXJhbWV0ZXJbMV09cGFyc2VJbnQocGFyYW1ldGVyWzFdKSwhKHBhcmFtZXRlclsxXT49MCYmcGFyYW1ldGVyWzFdPD0xMjcpKXRocm93IG5ldyBSYW5nZUVycm9yKFwiVGhlIGNvbnRyb2w2MiB2YWx1ZSBtdXN0IGJlIGJldHdlZW4gMCBhbmQgMTI3XCIpO3JldHVybiB0aGlzLl9jb252ZXJ0Q2hhbm5lbFRvQXJyYXkoY2hhbm5lbCkuZm9yRWFjaChmdW5jdGlvbihjaCl7dGhhdC5zZW5kQ29udHJvbENoYW5nZSg5OSxwYXJhbWV0ZXJbMF0sY2hhbm5lbCx7dGltZTp0aW1lfSksdGhhdC5zZW5kQ29udHJvbENoYW5nZSg5OCxwYXJhbWV0ZXJbMV0sY2hhbm5lbCx7dGltZTp0aW1lfSl9KSx0aGlzfSxPdXRwdXQucHJvdG90eXBlLl9zZXRDdXJyZW50UmVnaXN0ZXJlZFBhcmFtZXRlcj1mdW5jdGlvbihkYXRhLGNoYW5uZWwsdGltZSl7dmFyIHRoYXQ9dGhpcztpZihkYXRhPVtdLmNvbmNhdChkYXRhKSxkYXRhWzBdPXBhcnNlSW50KGRhdGFbMF0pLCEoZGF0YVswXT49MCYmZGF0YVswXTw9MTI3KSl0aHJvdyBuZXcgUmFuZ2VFcnJvcihcIlRoZSBtc2IgdmFsdWUgbXVzdCBiZSBiZXR3ZWVuIDAgYW5kIDEyN1wiKTtyZXR1cm4gdGhpcy5fY29udmVydENoYW5uZWxUb0FycmF5KGNoYW5uZWwpLmZvckVhY2goZnVuY3Rpb24oY2gpe3RoYXQuc2VuZENvbnRyb2xDaGFuZ2UoNixkYXRhWzBdLGNoYW5uZWwse3RpbWU6dGltZX0pfSksZGF0YVsxXT1wYXJzZUludChkYXRhWzFdKSxkYXRhWzFdPj0wJiZkYXRhWzFdPD0xMjcmJnRoaXMuX2NvbnZlcnRDaGFubmVsVG9BcnJheShjaGFubmVsKS5mb3JFYWNoKGZ1bmN0aW9uKGNoKXt0aGF0LnNlbmRDb250cm9sQ2hhbmdlKDM4LGRhdGFbMV0sY2hhbm5lbCx7dGltZTp0aW1lfSl9KSx0aGlzfSxPdXRwdXQucHJvdG90eXBlLl9kZXNlbGVjdFJlZ2lzdGVyZWRQYXJhbWV0ZXI9ZnVuY3Rpb24oY2hhbm5lbCx0aW1lKXt2YXIgdGhhdD10aGlzO3JldHVybiB0aGlzLl9jb252ZXJ0Q2hhbm5lbFRvQXJyYXkoY2hhbm5lbCkuZm9yRWFjaChmdW5jdGlvbihjaCl7dGhhdC5zZW5kQ29udHJvbENoYW5nZSgxMDEsMTI3LGNoYW5uZWwse3RpbWU6dGltZX0pLHRoYXQuc2VuZENvbnRyb2xDaGFuZ2UoMTAwLDEyNyxjaGFubmVsLHt0aW1lOnRpbWV9KX0pLHRoaXN9LE91dHB1dC5wcm90b3R5cGUuc2V0UmVnaXN0ZXJlZFBhcmFtZXRlcj1mdW5jdGlvbihwYXJhbWV0ZXIsZGF0YSxjaGFubmVsLG9wdGlvbnMpe3ZhciB0aGF0PXRoaXM7aWYob3B0aW9ucz1vcHRpb25zfHx7fSwhQXJyYXkuaXNBcnJheShwYXJhbWV0ZXIpKXtpZighd20uTUlESV9SRUdJU1RFUkVEX1BBUkFNRVRFUltwYXJhbWV0ZXJdKXRocm93IG5ldyBFcnJvcihcIlRoZSBzcGVjaWZpZWQgcGFyYW1ldGVyIGlzIG5vdCBhdmFpbGFibGUuXCIpO3BhcmFtZXRlcj13bS5NSURJX1JFR0lTVEVSRURfUEFSQU1FVEVSW3BhcmFtZXRlcl19cmV0dXJuIHRoaXMuX2NvbnZlcnRDaGFubmVsVG9BcnJheShjaGFubmVsKS5mb3JFYWNoKGZ1bmN0aW9uKGNoKXt0aGF0Ll9zZWxlY3RSZWdpc3RlcmVkUGFyYW1ldGVyKHBhcmFtZXRlcixjaGFubmVsLG9wdGlvbnMudGltZSksdGhhdC5fc2V0Q3VycmVudFJlZ2lzdGVyZWRQYXJhbWV0ZXIoZGF0YSxjaGFubmVsLG9wdGlvbnMudGltZSksdGhhdC5fZGVzZWxlY3RSZWdpc3RlcmVkUGFyYW1ldGVyKGNoYW5uZWwsb3B0aW9ucy50aW1lKX0pLHRoaXN9LE91dHB1dC5wcm90b3R5cGUuc2V0Tm9uUmVnaXN0ZXJlZFBhcmFtZXRlcj1mdW5jdGlvbihwYXJhbWV0ZXIsZGF0YSxjaGFubmVsLG9wdGlvbnMpe3ZhciB0aGF0PXRoaXM7aWYob3B0aW9ucz1vcHRpb25zfHx7fSwhKHBhcmFtZXRlclswXT49MCYmcGFyYW1ldGVyWzBdPD0xMjcmJnBhcmFtZXRlclsxXT49MCYmcGFyYW1ldGVyWzFdPD0xMjcpKXRocm93IG5ldyBFcnJvcihcIlBvc2l0aW9uIDAgYW5kIDEgb2YgdGhlIDItcG9zaXRpb24gcGFyYW1ldGVyIGFycmF5IG11c3QgYm90aCBiZSBiZXR3ZWVuIDAgYW5kIDEyNy5cIik7cmV0dXJuIGRhdGE9W10uY29uY2F0KGRhdGEpLHRoaXMuX2NvbnZlcnRDaGFubmVsVG9BcnJheShjaGFubmVsKS5mb3JFYWNoKGZ1bmN0aW9uKGNoKXt0aGF0Ll9zZWxlY3ROb25SZWdpc3RlcmVkUGFyYW1ldGVyKHBhcmFtZXRlcixjaGFubmVsLG9wdGlvbnMudGltZSksdGhhdC5fc2V0Q3VycmVudFJlZ2lzdGVyZWRQYXJhbWV0ZXIoZGF0YSxjaGFubmVsLG9wdGlvbnMudGltZSksdGhhdC5fZGVzZWxlY3RSZWdpc3RlcmVkUGFyYW1ldGVyKGNoYW5uZWwsb3B0aW9ucy50aW1lKX0pLHRoaXN9LE91dHB1dC5wcm90b3R5cGUuaW5jcmVtZW50UmVnaXN0ZXJlZFBhcmFtZXRlcj1mdW5jdGlvbihwYXJhbWV0ZXIsY2hhbm5lbCxvcHRpb25zKXt2YXIgdGhhdD10aGlzO2lmKG9wdGlvbnM9b3B0aW9uc3x8e30sIUFycmF5LmlzQXJyYXkocGFyYW1ldGVyKSl7aWYoIXdtLk1JRElfUkVHSVNURVJFRF9QQVJBTUVURVJbcGFyYW1ldGVyXSl0aHJvdyBuZXcgRXJyb3IoXCJUaGUgc3BlY2lmaWVkIHBhcmFtZXRlciBpcyBub3QgYXZhaWxhYmxlLlwiKTtwYXJhbWV0ZXI9d20uTUlESV9SRUdJU1RFUkVEX1BBUkFNRVRFUltwYXJhbWV0ZXJdfXJldHVybiB0aGlzLl9jb252ZXJ0Q2hhbm5lbFRvQXJyYXkoY2hhbm5lbCkuZm9yRWFjaChmdW5jdGlvbihjaCl7dGhhdC5fc2VsZWN0UmVnaXN0ZXJlZFBhcmFtZXRlcihwYXJhbWV0ZXIsY2hhbm5lbCxvcHRpb25zLnRpbWUpLHRoYXQuc2VuZENvbnRyb2xDaGFuZ2UoOTYsMCxjaGFubmVsLHt0aW1lOm9wdGlvbnMudGltZX0pLHRoYXQuX2Rlc2VsZWN0UmVnaXN0ZXJlZFBhcmFtZXRlcihjaGFubmVsLG9wdGlvbnMudGltZSl9KSx0aGlzfSxPdXRwdXQucHJvdG90eXBlLmRlY3JlbWVudFJlZ2lzdGVyZWRQYXJhbWV0ZXI9ZnVuY3Rpb24ocGFyYW1ldGVyLGNoYW5uZWwsb3B0aW9ucyl7aWYob3B0aW9ucz1vcHRpb25zfHx7fSwhQXJyYXkuaXNBcnJheShwYXJhbWV0ZXIpKXtpZighd20uTUlESV9SRUdJU1RFUkVEX1BBUkFNRVRFUltwYXJhbWV0ZXJdKXRocm93IG5ldyBUeXBlRXJyb3IoXCJUaGUgc3BlY2lmaWVkIHBhcmFtZXRlciBpcyBub3QgYXZhaWxhYmxlLlwiKTtwYXJhbWV0ZXI9d20uTUlESV9SRUdJU1RFUkVEX1BBUkFNRVRFUltwYXJhbWV0ZXJdfXJldHVybiB0aGlzLl9jb252ZXJ0Q2hhbm5lbFRvQXJyYXkoY2hhbm5lbCkuZm9yRWFjaChmdW5jdGlvbihjaCl7dGhpcy5fc2VsZWN0UmVnaXN0ZXJlZFBhcmFtZXRlcihwYXJhbWV0ZXIsY2hhbm5lbCxvcHRpb25zLnRpbWUpLHRoaXMuc2VuZENvbnRyb2xDaGFuZ2UoOTcsMCxjaGFubmVsLHt0aW1lOm9wdGlvbnMudGltZX0pLHRoaXMuX2Rlc2VsZWN0UmVnaXN0ZXJlZFBhcmFtZXRlcihjaGFubmVsLG9wdGlvbnMudGltZSl9LmJpbmQodGhpcykpLHRoaXN9LE91dHB1dC5wcm90b3R5cGUuc2V0UGl0Y2hCZW5kUmFuZ2U9ZnVuY3Rpb24oc2VtaXRvbmVzLGNlbnRzLGNoYW5uZWwsb3B0aW9ucyl7dmFyIHRoYXQ9dGhpcztpZihvcHRpb25zPW9wdGlvbnN8fHt9LHNlbWl0b25lcz1wYXJzZUludChzZW1pdG9uZXMpfHwwLCEoc2VtaXRvbmVzPj0wJiYxMjc+PXNlbWl0b25lcykpdGhyb3cgbmV3IFJhbmdlRXJyb3IoXCJUaGUgc2VtaXRvbmVzIHZhbHVlIG11c3QgYmUgYmV0d2VlbiAwIGFuZCAxMjdcIik7aWYoY2VudHM9cGFyc2VJbnQoY2VudHMpfHwwLCEoY2VudHM+PTAmJjEyNz49Y2VudHMpKXRocm93IG5ldyBSYW5nZUVycm9yKFwiVGhlIGNlbnRzIHZhbHVlIG11c3QgYmUgYmV0d2VlbiAwIGFuZCAxMjdcIik7cmV0dXJuIHRoaXMuX2NvbnZlcnRDaGFubmVsVG9BcnJheShjaGFubmVsKS5mb3JFYWNoKGZ1bmN0aW9uKGNoKXt0aGF0LnNldFJlZ2lzdGVyZWRQYXJhbWV0ZXIoXCJwaXRjaGJlbmRyYW5nZVwiLFtzZW1pdG9uZXMsY2VudHNdLGNoYW5uZWwse3RpbWU6b3B0aW9ucy50aW1lfSl9KSx0aGlzfSxPdXRwdXQucHJvdG90eXBlLnNldE1vZHVsYXRpb25SYW5nZT1mdW5jdGlvbihzZW1pdG9uZXMsY2VudHMsY2hhbm5lbCxvcHRpb25zKXt2YXIgdGhhdD10aGlzO2lmKG9wdGlvbnM9b3B0aW9uc3x8e30sc2VtaXRvbmVzPXBhcnNlSW50KHNlbWl0b25lcyl8fDAsIShzZW1pdG9uZXM+PTAmJjEyNz49c2VtaXRvbmVzKSl0aHJvdyBuZXcgUmFuZ2VFcnJvcihcIlRoZSBzZW1pdG9uZXMgdmFsdWUgbXVzdCBiZSBiZXR3ZWVuIDAgYW5kIDEyN1wiKTtpZihjZW50cz1wYXJzZUludChjZW50cyl8fDAsIShjZW50cz49MCYmMTI3Pj1jZW50cykpdGhyb3cgbmV3IFJhbmdlRXJyb3IoXCJUaGUgY2VudHMgdmFsdWUgbXVzdCBiZSBiZXR3ZWVuIDAgYW5kIDEyN1wiKTtyZXR1cm4gdGhpcy5fY29udmVydENoYW5uZWxUb0FycmF5KGNoYW5uZWwpLmZvckVhY2goZnVuY3Rpb24oY2gpe3RoYXQuc2V0UmVnaXN0ZXJlZFBhcmFtZXRlcihcIm1vZHVsYXRpb25yYW5nZVwiLFtzZW1pdG9uZXMsY2VudHNdLGNoYW5uZWwse3RpbWU6b3B0aW9ucy50aW1lfSl9KSx0aGlzfSxPdXRwdXQucHJvdG90eXBlLnNldE1hc3RlclR1bmluZz1mdW5jdGlvbih2YWx1ZSxjaGFubmVsLG9wdGlvbnMpe3ZhciB0aGF0PXRoaXM7aWYob3B0aW9ucz1vcHRpb25zfHx7fSx2YWx1ZT1wYXJzZUZsb2F0KHZhbHVlKXx8MCwtNjU+PXZhbHVlfHx2YWx1ZT49NjQpdGhyb3cgbmV3IFJhbmdlRXJyb3IoXCJUaGUgdmFsdWUgbXVzdCBiZSBhIGRlY2ltYWwgbnVtYmVyIGxhcmdlciB0aGFuIC02NSBhbmQgc21hbGxlciB0aGFuIDY0LlwiKTt2YXIgY29hcnNlPXBhcnNlSW50KHZhbHVlKSs2NCxmaW5lPXZhbHVlLXBhcnNlSW50KHZhbHVlKTtmaW5lPU1hdGgucm91bmQoKGZpbmUrMSkvMioxNjM4Myk7dmFyIG1zYj1maW5lPj43JjEyNyxsc2I9MTI3JmZpbmU7cmV0dXJuIHRoaXMuX2NvbnZlcnRDaGFubmVsVG9BcnJheShjaGFubmVsKS5mb3JFYWNoKGZ1bmN0aW9uKGNoKXt0aGF0LnNldFJlZ2lzdGVyZWRQYXJhbWV0ZXIoXCJjaGFubmVsY29hcnNldHVuaW5nXCIsY29hcnNlLGNoYW5uZWwse3RpbWU6b3B0aW9ucy50aW1lfSksdGhhdC5zZXRSZWdpc3RlcmVkUGFyYW1ldGVyKFwiY2hhbm5lbGZpbmV0dW5pbmdcIixbbXNiLGxzYl0sY2hhbm5lbCx7dGltZTpvcHRpb25zLnRpbWV9KX0pLHRoaXN9LE91dHB1dC5wcm90b3R5cGUuc2V0VHVuaW5nUHJvZ3JhbT1mdW5jdGlvbih2YWx1ZSxjaGFubmVsLG9wdGlvbnMpe3ZhciB0aGF0PXRoaXM7aWYob3B0aW9ucz1vcHRpb25zfHx7fSx2YWx1ZT1wYXJzZUludCh2YWx1ZSl8fDAsISh2YWx1ZT49MCYmMTI3Pj12YWx1ZSkpdGhyb3cgbmV3IFJhbmdlRXJyb3IoXCJUaGUgcHJvZ3JhbSB2YWx1ZSBtdXN0IGJlIGJldHdlZW4gMCBhbmQgMTI3XCIpO3JldHVybiB0aGlzLl9jb252ZXJ0Q2hhbm5lbFRvQXJyYXkoY2hhbm5lbCkuZm9yRWFjaChmdW5jdGlvbihjaCl7dGhhdC5zZXRSZWdpc3RlcmVkUGFyYW1ldGVyKFwidHVuaW5ncHJvZ3JhbVwiLHZhbHVlLGNoYW5uZWwse3RpbWU6b3B0aW9ucy50aW1lfSl9KSx0aGlzfSxPdXRwdXQucHJvdG90eXBlLnNldFR1bmluZ0Jhbms9ZnVuY3Rpb24odmFsdWUsY2hhbm5lbCxvcHRpb25zKXt2YXIgdGhhdD10aGlzO2lmKG9wdGlvbnM9b3B0aW9uc3x8e30sdmFsdWU9cGFyc2VJbnQodmFsdWUpfHwwLCEodmFsdWU+PTAmJjEyNz49dmFsdWUpKXRocm93IG5ldyBSYW5nZUVycm9yKFwiVGhlIGJhbmsgdmFsdWUgbXVzdCBiZSBiZXR3ZWVuIDAgYW5kIDEyN1wiKTtyZXR1cm4gdGhpcy5fY29udmVydENoYW5uZWxUb0FycmF5KGNoYW5uZWwpLmZvckVhY2goZnVuY3Rpb24oY2gpe3RoYXQuc2V0UmVnaXN0ZXJlZFBhcmFtZXRlcihcInR1bmluZ2JhbmtcIix2YWx1ZSxjaGFubmVsLHt0aW1lOm9wdGlvbnMudGltZX0pfSksdGhpc30sT3V0cHV0LnByb3RvdHlwZS5zZW5kQ2hhbm5lbE1vZGU9ZnVuY3Rpb24oY29tbWFuZCx2YWx1ZSxjaGFubmVsLG9wdGlvbnMpe2lmKG9wdGlvbnM9b3B0aW9uc3x8e30sXCJzdHJpbmdcIj09dHlwZW9mIGNvbW1hbmQpe2lmKGNvbW1hbmQ9d20uTUlESV9DSEFOTkVMX01PREVfTUVTU0FHRVNbY29tbWFuZF0sIWNvbW1hbmQpdGhyb3cgbmV3IFR5cGVFcnJvcihcIkludmFsaWQgY2hhbm5lbCBtb2RlIG1lc3NhZ2UgbmFtZS5cIil9ZWxzZSBpZihjb21tYW5kPXBhcnNlSW50KGNvbW1hbmQpLCEoY29tbWFuZD49MTIwJiYxMjc+PWNvbW1hbmQpKXRocm93IG5ldyBSYW5nZUVycm9yKFwiQ2hhbm5lbCBtb2RlIG51bWVyaWNhbCBpZGVudGlmaWVycyBtdXN0IGJlIGJldHdlZW4gMTIwIGFuZCAxMjcuXCIpO2lmKHZhbHVlPXBhcnNlSW50KHZhbHVlKXx8MCwwPnZhbHVlfHx2YWx1ZT4xMjcpdGhyb3cgbmV3IFJhbmdlRXJyb3IoXCJWYWx1ZSBtdXN0IGJlIGFuIGludGVnZXIgYmV0d2VlbiAwIGFuZCAxMjcuXCIpO3JldHVybiB0aGlzLl9jb252ZXJ0Q2hhbm5lbFRvQXJyYXkoY2hhbm5lbCkuZm9yRWFjaChmdW5jdGlvbihjaCl7dGhpcy5zZW5kKCh3bS5NSURJX0NIQU5ORUxfTUVTU0FHRVMuY2hhbm5lbG1vZGU8PDQpKyhjaC0xKSxbY29tbWFuZCx2YWx1ZV0sdGhpcy5fcGFyc2VUaW1lUGFyYW1ldGVyKG9wdGlvbnMudGltZSkpfS5iaW5kKHRoaXMpKSx0aGlzfSxPdXRwdXQucHJvdG90eXBlLnNlbmRQcm9ncmFtQ2hhbmdlPWZ1bmN0aW9uKHByb2dyYW0sY2hhbm5lbCxvcHRpb25zKXt2YXIgdGhhdD10aGlzO2lmKG9wdGlvbnM9b3B0aW9uc3x8e30scHJvZ3JhbT1wYXJzZUludChwcm9ncmFtKSxpc05hTihwcm9ncmFtKXx8MD5wcm9ncmFtfHxwcm9ncmFtPjEyNyl0aHJvdyBuZXcgUmFuZ2VFcnJvcihcIlByb2dyYW0gbnVtYmVycyBtdXN0IGJlIGJldHdlZW4gMCBhbmQgMTI3LlwiKTtyZXR1cm4gdGhpcy5fY29udmVydENoYW5uZWxUb0FycmF5KGNoYW5uZWwpLmZvckVhY2goZnVuY3Rpb24oY2gpe3RoYXQuc2VuZCgod20uTUlESV9DSEFOTkVMX01FU1NBR0VTLnByb2dyYW1jaGFuZ2U8PDQpKyhjaC0xKSxbcHJvZ3JhbV0sdGhhdC5fcGFyc2VUaW1lUGFyYW1ldGVyKG9wdGlvbnMudGltZSkpfSksdGhpc30sT3V0cHV0LnByb3RvdHlwZS5zZW5kQ2hhbm5lbEFmdGVydG91Y2g9ZnVuY3Rpb24ocHJlc3N1cmUsY2hhbm5lbCxvcHRpb25zKXt2YXIgdGhhdD10aGlzO29wdGlvbnM9b3B0aW9uc3x8e30scHJlc3N1cmU9cGFyc2VGbG9hdChwcmVzc3VyZSksKGlzTmFOKHByZXNzdXJlKXx8MD5wcmVzc3VyZXx8cHJlc3N1cmU+MSkmJihwcmVzc3VyZT0uNSk7dmFyIG5QcmVzc3VyZT1NYXRoLnJvdW5kKDEyNypwcmVzc3VyZSk7cmV0dXJuIHRoaXMuX2NvbnZlcnRDaGFubmVsVG9BcnJheShjaGFubmVsKS5mb3JFYWNoKGZ1bmN0aW9uKGNoKXt0aGF0LnNlbmQoKHdtLk1JRElfQ0hBTk5FTF9NRVNTQUdFUy5jaGFubmVsYWZ0ZXJ0b3VjaDw8NCkrKGNoLTEpLFtuUHJlc3N1cmVdLHRoYXQuX3BhcnNlVGltZVBhcmFtZXRlcihvcHRpb25zLnRpbWUpKX0pLHRoaXN9LE91dHB1dC5wcm90b3R5cGUuc2VuZFBpdGNoQmVuZD1mdW5jdGlvbihiZW5kLGNoYW5uZWwsb3B0aW9ucyl7XG52YXIgdGhhdD10aGlzO2lmKG9wdGlvbnM9b3B0aW9uc3x8e30sYmVuZD1wYXJzZUZsb2F0KGJlbmQpLGlzTmFOKGJlbmQpfHwtMT5iZW5kfHxiZW5kPjEpdGhyb3cgbmV3IFJhbmdlRXJyb3IoXCJQaXRjaCBiZW5kIHZhbHVlIG11c3QgYmUgYmV0d2VlbiAtMSBhbmQgMS5cIik7dmFyIG5MZXZlbD1NYXRoLnJvdW5kKChiZW5kKzEpLzIqMTYzODMpLG1zYj1uTGV2ZWw+PjcmMTI3LGxzYj0xMjcmbkxldmVsO3JldHVybiB0aGlzLl9jb252ZXJ0Q2hhbm5lbFRvQXJyYXkoY2hhbm5lbCkuZm9yRWFjaChmdW5jdGlvbihjaCl7dGhhdC5zZW5kKCh3bS5NSURJX0NIQU5ORUxfTUVTU0FHRVMucGl0Y2hiZW5kPDw0KSsoY2gtMSksW2xzYixtc2JdLHRoYXQuX3BhcnNlVGltZVBhcmFtZXRlcihvcHRpb25zLnRpbWUpKX0pLHRoaXN9LE91dHB1dC5wcm90b3R5cGUuX3BhcnNlVGltZVBhcmFtZXRlcj1mdW5jdGlvbih0aW1lKXt2YXIgcGFyc2VkLHZhbHVlO3JldHVyblwic3RyaW5nXCI9PXR5cGVvZiB0aW1lJiZcIitcIj09PXRpbWUuc3Vic3RyaW5nKDAsMSk/KHBhcnNlZD1wYXJzZUZsb2F0KHRpbWUpLHBhcnNlZCYmcGFyc2VkPjAmJih2YWx1ZT13bS50aW1lK3BhcnNlZCkpOihwYXJzZWQ9cGFyc2VGbG9hdCh0aW1lKSxwYXJzZWQ+d20udGltZSYmKHZhbHVlPXBhcnNlZCkpLHZhbHVlfSxPdXRwdXQucHJvdG90eXBlLl9jb252ZXJ0Tm90ZVRvQXJyYXk9ZnVuY3Rpb24obm90ZSl7dmFyIG5vdGVzPVtdO3JldHVybiBBcnJheS5pc0FycmF5KG5vdGUpfHwobm90ZT1bbm90ZV0pLG5vdGUuZm9yRWFjaChmdW5jdGlvbihpdGVtKXtub3Rlcy5wdXNoKHdtLmd1ZXNzTm90ZU51bWJlcihpdGVtKSl9KSxub3Rlc30sT3V0cHV0LnByb3RvdHlwZS5fY29udmVydENoYW5uZWxUb0FycmF5PWZ1bmN0aW9uKGNoYW5uZWwpe2lmKChcImFsbFwiPT09Y2hhbm5lbHx8dm9pZCAwPT09Y2hhbm5lbCkmJihjaGFubmVsPVtcImFsbFwiXSksQXJyYXkuaXNBcnJheShjaGFubmVsKXx8KGNoYW5uZWw9W2NoYW5uZWxdKSxjaGFubmVsLmluZGV4T2YoXCJhbGxcIik+LTEpe2NoYW5uZWw9W107Zm9yKHZhciBpPTE7MTY+PWk7aSsrKWNoYW5uZWwucHVzaChpKX1yZXR1cm4gY2hhbm5lbC5mb3JFYWNoKGZ1bmN0aW9uKGNoKXtpZighKGNoPj0xJiYxNj49Y2gpKXRocm93IG5ldyBSYW5nZUVycm9yKFwiTUlESSBjaGFubmVscyBtdXN0IGJlIGJldHdlZW4gMSBhbmQgMTYuXCIpfSksY2hhbm5lbH0sT3V0cHV0LnByb3RvdHlwZS5fb25NaWRpTWVzc2FnZT1mdW5jdGlvbihlKXt9LFwiZnVuY3Rpb25cIj09dHlwZW9mIGRlZmluZSYmXCJvYmplY3RcIj09dHlwZW9mIGRlZmluZS5hbWQ/ZGVmaW5lKFtdLGZ1bmN0aW9uKCl7cmV0dXJuIHdtfSk6XCJ1bmRlZmluZWRcIiE9dHlwZW9mIG1vZHVsZSYmbW9kdWxlLmV4cG9ydHM/bW9kdWxlLmV4cG9ydHM9d206c2NvcGUuV2ViTWlkaXx8KHNjb3BlLldlYk1pZGk9d20pfSh0aGlzKTsiLCIvLyBVc2UgaXQgbGlrZSB0aGlzOiAgXG4vLyBjb25zdCBzeW50aCA9IHJlcXVpcmUoJ3BsdWdnYWJsZS1zeW50aCcpXG4vLyBCdXQgdGhpcyBpcyB0aGUgdGVzdFxuY29uc3QgcGx1Z2dhYmxlU3ludGggPSByZXF1aXJlKCcuL2luZGV4JylcbmNvbnN0IGF1ZGlvQ3R4ID0gbmV3IEF1ZGlvQ29udGV4dCgpOyBcbmNvbnN0IG1hc3RlckdhaW4gPSBhdWRpb0N0eC5jcmVhdGVHYWluKCk7XG5tYXN0ZXJHYWluLmdhaW4udmFsdWUgPSAwLjE7XG5cbi8qKlxuICogQSBzaW1wbGUgdGVzdCBzeW50aFxuICogVGhlIHN5bnRoIHdoaWNoIGlzIGdvaW5nIHRvIGJlIGNvbm5lY3RlZCB0byB0aGUgcGlhbm9cbiAqIG11c3QgaGF2ZSBhIGBzdGFydGAgYW5kIGEgYHN0b3BgIG1ldGhvZCBcbiAqL1xuZnVuY3Rpb24gdGVzdFN5bnRoICgpIHtcblxuICAgIHRoaXMuc3RhcnQgPSBmdW5jdGlvbiAoZnJlcSwgb3B0aW9ucykge1xuICAgICAgICB0aGlzLm9zY2lsbGF0b3IgPSBhdWRpb0N0eC5jcmVhdGVPc2NpbGxhdG9yKCk7XG4gICAgICAgIHRoaXMub3NjaWxsYXRvci50eXBlID0gJ3NxdWFyZSc7XG4gICAgICAgIHRoaXMub3NjaWxsYXRvci5mcmVxdWVuY3kudmFsdWUgPSBmcmVxOyAvLyB2YWx1ZSBpbiBoZXJ0elxuICAgICAgICB0aGlzLm9zY2lsbGF0b3IuY29ubmVjdChtYXN0ZXJHYWluKTtcbiAgICAgICAgbWFzdGVyR2Fpbi5jb25uZWN0KGF1ZGlvQ3R4LmRlc3RpbmF0aW9uKTtcbiAgICAgICAgdGhpcy5vc2NpbGxhdG9yLnN0YXJ0KCk7XG4gICAgfVxuXG4gICAgdGhpcy5zdG9wID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLm9zY2lsbGF0b3Iuc3RvcCgpO1xuICAgIH1cbn1cblxuXG4kKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7XG5cbiAgICAvLyBjb25zb2xlLmxvZyhwaWFubylcbiAgICB2YXIgZWxlbUlEID0gJ3BpYW5vLWNvbnRhaW5lcidcbiAgICB2YXIgcCA9IG5ldyBwbHVnZ2FibGVTeW50aChlbGVtSUQsIHtcbiAgICAgICAgb2N0YXZlczogMixcbiAgICAgICAgb2N0YXZlQmVnaW46IDMgICAgXG4gICAgfSlcbiAgICBcbiAgICAvLyBEcmF3cyBwaWFub1xuICAgIHAuY3JlYXRlUGlhbm8oKVxuXG4gICAgLy8gU2V0IHN5bnRoXG4gICAgcC5zeW50aCA9IHRlc3RTeW50aFxuICAgIFxuICAgIC8vIEVuYWJsZSBvbmUgb2N0YXZlIG9mIGtleWJvYXJkXG4gICAgcC5lbmFibGVLZXlib2FyZEV2ZW50cygpXG4gICAgXG4gICAgLy8gQWxsIG1pZGkgdG9uZXMgd2lsbCBiZSBwbGF5ZWQsIGJ1dCBvbmx5IHR3byBvY3RhdmVzIGlzIHZpc2lhYmxlXG4gICAgcC5lbmFibGVNaWRpRXZlbnRzKClcblxufSkiXX0=
