(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
const noteParser = require('note-parser')
const octave1 = require('./keyboard-tones.js').octave1;
const jsCssPiano = require('js-css-piano');
const webmidi = require('webmidi')


var keys = {};

jsCssPiano.prototype = {

    getFrequency: function (note) {
        note = note.replace('s', '#');
        let res = noteParser.parse(note)
        let freq = res.freq;
        return freq;
    },

    synth: function () {
        console.log('set a synth')
    },

    toggleKey: function (note) {
        let selector = '#' + this.elemID + " > .piano li[data-note='" + note + "']"
        let elem = document.querySelector(selector)
        if (!elem) {
            return
        }
        elem.classList.toggle('active');
    },

    synthStart: function (note, options) {
        note = note.toLowerCase()
        this.toggleKey(note)
        let freq = this.getFrequency(note);
        let synth = new this.synth();

        synth.start(freq, options);
        keys[note] = synth;
    },

    synthStop: function (note) {
        note = note.toLowerCase()
        this.toggleKey(note)
        let synth = keys[note]
        synth.stop()
        delete keys[note]
    },

    // Enable one or two octaves on keyboard
    enableKeyboardEvents: function () {
        document.addEventListener("keydown", (e) => {

            var k = e.key;
            let note = octave1[k] + this.options.octaveBegin

            if (k in octave1 && !(note in keys)) {
                this.synthStart(note);
            }
        });

        document.addEventListener("keyup", (e) => {

            let octave = this.options.octaveBegin
            var k = e.key;
            let note = octave1[k] + octave;
            if (k in octave1 && (note in keys)) {
                this.synthStop(note)
            }
        });
    },

    // Enable midi keyboard
    enableMidiEvents: function (port) {
        if (port == undefined) {
            port = 1
        }

        webmidi.enable( (err) => {

            if (err) {
                console.log("WebMidi could not be enabled." + err);
                return false;
            }

            if ( !(port in webmidi.inputs)) {
               console.log('Modi port does not exists ' + port)
               return false;
            }

            // Port is ok
            var midiInput = webmidi.inputs[port];
            midiInput.addListener('noteon', "all", (e) => {

                let octave = parseInt(e.note.octave)
                let note = e.note.name + octave
                note = note.replace('#', 's')

                if (!(note in keys)) {
                    this.synthStart(note, e);
                }
            });

            midiInput.addListener('noteoff', "all", (e) => {
                let octave = parseInt(e.note.octave);
                let note = e.note.name + octave;

                note = note.replace('#', 's')

                this.synthStop(note)

            });
        })
    },
}

module.exports = jsCssPiano;

},{"./keyboard-tones.js":2,"js-css-piano":4,"note-parser":5,"webmidi":7}],2:[function(require,module,exports){
var keyboardTones = {}

keyboardTones.octave1 = {
    a: 'c',
    w: 'cs',
    s: 'd',
    e: 'ds',
    d: 'e',
    f: 'f',
    t: 'fs',
    g: 'g',
    y: 'gs',
    h: 'a',
    u: 'as',
    j: 'b'
};


keyboardTones.octave2 = {
    q: 'c',
    2: 'cs',
    w: 'd',
    3: 'ds',
    e: 'e',
    r: 'f',
    5: 'fs',
    t: 'g',
    6: 'gs',
    y: 'a',
    7: 'as',
    u: 'b'
};

module.exports = keyboardTones;
},{}],3:[function(require,module,exports){
function Gain(ctx) {

    this.ctx = ctx;

    this.secondsToTimeConstant = function (sec) {
        return (sec * 2) / 8;
    };

    this.options = {
        initGain: 0.1, // Init gain on note
        maxGain: 1.0, // Max gain on note
        attackTime: 0.1, // AttackTime. gain.init to gain.max in attackTime
        sustainTime: 1, // Sustain note in time
        releaseTime: 1, // Approximated end time. Calculated with secondsToTimeConstant()
        // disconnect: false // Should we autodisconnect. Default is true
    };

    this.setOptions = function (options) {
        this.options = options;
    };

    this.gainNode;
    /**
     * The gainNode
     * @param {float} begin ctx time
     * @returns {Gain.getGainNode.gainNode}
     */
    this.getGainNode = function (begin) {

        this.gainNode = this.ctx.createGain();
        this.gainNode.gain.value = this.options.initGain;

        // Attack to max
        this.gainNode.gain.setTargetAtTime(
                this.options.maxGain,
                begin + this.options.attackTime,
                this.options.attackTime);

        // Sustain and end note
        this.gainNode.gain.setTargetAtTime(
                0.0,
                begin + this.options.attackTime + this.options.sustainTime,
                this.secondsToTimeConstant(this.options.releaseTime));
        
        if (this.options.disconnect !== false) {
            this.disconnect(begin);
        }
        
        return this.gainNode;
    };

    this.getTotalLength = function () {
        return this.options.attackTime + this.options.sustainTime + this.options.releaseTime
    }
    
    this.disconnect = function() {
        var totalLength = this.getTotalLength();
        
        setTimeout( () => {
            this.gainNode.disconnect();
        },
        totalLength * 1000);
    };
}

module.exports = Gain;
},{}],4:[function(require,module,exports){
function piano(elemID, opts) {

    this.elemID = elemID
    this.elem = document.getElementById(elemID)
    
    this.defaults = {
        octaves: 2,
        octaveBegin: 3
    }

    this.options = {}
    Object.assign(this.options, this.defaults, opts)
    
    this.createPiano = function () {
        let html = this.getPianoHTML()
        this.elem.innerHTML = html
    }

    this.getPianoHTML = function () {
        
        let octaveBegin = this.options.octaveBegin
        let html = `<ul class="piano">`
        for (i = 1; i <= this.options.octaves; i++) {  
            html += this.getTones(octaveBegin)
            octaveBegin++ 
        }
        html += `</ul>`
        return html
    }

    this.getNoteAndOctave = function (note, octave) {
        return note + octave
    }

    this.getTones = function (octave) {
        let octaveHTML = 
        `
            <li class="white c" data-note="${this.getNoteAndOctave('c', octave)}"></li>
            <li class="black cs" data-note="${this.getNoteAndOctave('cs', octave)}"></li>
            <li class="white d" data-note="${this.getNoteAndOctave('d', octave)}"></li>
            <li class="black ds" data-note="${this.getNoteAndOctave('ds', octave)}"></li>
            <li class="white e" data-note="${this.getNoteAndOctave('e', octave)}"></li>
            <li class="white f" data-note="${this.getNoteAndOctave('f', octave)}"></li>
            <li class="black fs" data-note="${this.getNoteAndOctave('fs', octave)}"></li>
            <li class="white g" data-note="${this.getNoteAndOctave('g', octave)}"></li>
            <li class="black gs" data-note="${this.getNoteAndOctave('gs', octave)}"></li>
            <li class="white a" data-note="${this.getNoteAndOctave('a', octave)}"></li>
            <li class="black as" data-note="${this.getNoteAndOctave('as', octave)}"></li>
            <li class="white b" data-note="${this.getNoteAndOctave('b', octave)}"></li>`
            
        return octaveHTML
    }
}

module.exports = piano;

},{}],5:[function(require,module,exports){
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n(t.NoteParser=t.NoteParser||{})}(this,function(t){"use strict";function n(t,n){return Array(n+1).join(t)}function r(t){return"number"==typeof t}function e(t){return"string"==typeof t}function u(t){return void 0!==t}function c(t,n){return Math.pow(2,(t-69)/12)*(n||440)}function o(){return b}function i(t,n,r){if("string"!=typeof t)return null;var e=b.exec(t);if(!e||!n&&e[4])return null;var u={letter:e[1].toUpperCase(),acc:e[2].replace(/x/g,"##")};u.pc=u.letter+u.acc,u.step=(u.letter.charCodeAt(0)+3)%7,u.alt="b"===u.acc[0]?-u.acc.length:u.acc.length;var o=A[u.step]+u.alt;return u.chroma=o<0?12+o:o%12,e[3]&&(u.oct=+e[3],u.midi=o+12*(u.oct+1),u.freq=c(u.midi,r)),n&&(u.tonicOf=e[4]),u}function f(t){return r(t)?t<0?n("b",-t):n("#",t):""}function a(t){return r(t)?""+t:""}function l(t,n,r){return null===t||void 0===t?null:t.step?l(t.step,t.alt,t.oct):t<0||t>6?null:C.charAt(t)+f(n)+a(r)}function p(t){if((r(t)||e(t))&&t>=0&&t<128)return+t;var n=i(t);return n&&u(n.midi)?n.midi:null}function s(t,n){var r=p(t);return null===r?null:c(r,n)}function d(t){return(i(t)||{}).letter}function m(t){return(i(t)||{}).acc}function h(t){return(i(t)||{}).pc}function v(t){return(i(t)||{}).step}function g(t){return(i(t)||{}).alt}function x(t){return(i(t)||{}).chroma}function y(t){return(i(t)||{}).oct}var b=/^([a-gA-G])(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)\s*$/,A=[0,2,4,5,7,9,11],C="CDEFGAB";t.regex=o,t.parse=i,t.build=l,t.midi=p,t.freq=s,t.letter=d,t.acc=m,t.pc=h,t.step=v,t.alt=g,t.chroma=x,t.oct=y});


},{}],6:[function(require,module,exports){
// See e.g. http://www.phy.mtu.edu/~suits/NoteFreqCalcs.html
function noteFrequency() {
    
    this.base = 440; // A
    this.numSteps = 12; // 12
    
    this.getStepSize = function () {
        return Math.pow(2, 1/this.numSteps);
    };
    
    // Return hz of the step, e.g. for the default settings tihs yields:
    // 0 = 440 (A)
    // 5 = 587.329... (D)
    // -12 = 220 
    this.getToneStep =function(step) {
        return Math.pow(this.getStepSize(), step) * this.base;
    };  
}

module.exports = new noteFrequency();

},{}],7:[function(require,module,exports){
/*

WebMidi v2.0.0-rc.9

WebMidi.js helps you tame the Web MIDI API. Send and receive MIDI messages with ease. Control instruments with user-friendly functions (playNote, sendPitchBend, etc.). React to MIDI input with simple event listeners (noteon, pitchbend, controlchange, etc.).
https://github.com/cotejp/webmidi


The MIT License (MIT)

Copyright (c) 2015-2016, Jean-Philippe Côté

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and
associated documentation files (the "Software"), to deal in the Software without restriction,
including without limitation the rights to use, copy, modify, merge, publish, distribute,
sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial
portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT
NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES
OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

*/

!function(scope){"use strict";function WebMidi(){if(WebMidi.prototype._singleton)throw new Error("WebMidi is a singleton, it cannot be instantiated directly.");WebMidi.prototype._singleton=this,this._inputs=[],this._outputs=[],this._userHandlers={},this._stateChangeQueue=[],this._processingStateChange=!1,this._midiInterfaceEvents=["connected","disconnected"],this._notes=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],this._semitones={C:0,D:2,E:4,F:5,G:7,A:9,B:11},Object.defineProperties(this,{MIDI_SYSTEM_MESSAGES:{value:{sysex:240,timecode:241,songposition:242,songselect:243,tuningrequest:246,sysexend:247,clock:248,start:250,"continue":251,stop:252,activesensing:254,reset:255,unknownsystemmessage:-1},writable:!1,enumerable:!0,configurable:!1},MIDI_CHANNEL_MESSAGES:{value:{noteoff:8,noteon:9,keyaftertouch:10,controlchange:11,channelmode:11,programchange:12,channelaftertouch:13,pitchbend:14},writable:!1,enumerable:!0,configurable:!1},MIDI_REGISTERED_PARAMETER:{value:{pitchbendrange:[0,0],channelfinetuning:[0,1],channelcoarsetuning:[0,2],tuningprogram:[0,3],tuningbank:[0,4],modulationrange:[0,5],azimuthangle:[61,0],elevationangle:[61,1],gain:[61,2],distanceratio:[61,3],maximumdistance:[61,4],maximumdistancegain:[61,5],referencedistanceratio:[61,6],panspreadangle:[61,7],rollangle:[61,8]},writable:!1,enumerable:!0,configurable:!1},MIDI_CONTROL_CHANGE_MESSAGES:{value:{bankselectcoarse:0,modulationwheelcoarse:1,breathcontrollercoarse:2,footcontrollercoarse:4,portamentotimecoarse:5,dataentrycoarse:6,volumecoarse:7,balancecoarse:8,pancoarse:10,expressioncoarse:11,effectcontrol1coarse:12,effectcontrol2coarse:13,generalpurposeslider1:16,generalpurposeslider2:17,generalpurposeslider3:18,generalpurposeslider4:19,bankselectfine:32,modulationwheelfine:33,breathcontrollerfine:34,footcontrollerfine:36,portamentotimefine:37,dataentryfine:38,volumefine:39,balancefine:40,panfine:42,expressionfine:43,effectcontrol1fine:44,effectcontrol2fine:45,holdpedal:64,portamento:65,sustenutopedal:66,softpedal:67,legatopedal:68,hold2pedal:69,soundvariation:70,resonance:71,soundreleasetime:72,soundattacktime:73,brightness:74,soundcontrol6:75,soundcontrol7:76,soundcontrol8:77,soundcontrol9:78,soundcontrol10:79,generalpurposebutton1:80,generalpurposebutton2:81,generalpurposebutton3:82,generalpurposebutton4:83,reverblevel:91,tremololevel:92,choruslevel:93,celestelevel:94,phaserlevel:95,databuttonincrement:96,databuttondecrement:97,nonregisteredparametercoarse:98,nonregisteredparameterfine:99,registeredparametercoarse:100,registeredparameterfine:101},writable:!1,enumerable:!0,configurable:!1},MIDI_CHANNEL_MODE_MESSAGES:{value:{allsoundoff:120,resetallcontrollers:121,localcontrol:122,allnotesoff:123,omnimodeoff:124,omnimodeon:125,monomodeon:126,polymodeon:127},writable:!1,enumerable:!0,configurable:!1}}),Object.defineProperties(this,{supported:{enumerable:!0,get:function(){return"requestMIDIAccess"in navigator}},enabled:{enumerable:!0,get:function(){return void 0!==this["interface"]}.bind(this)},inputs:{enumerable:!0,get:function(){return this._inputs}.bind(this)},outputs:{enumerable:!0,get:function(){return this._outputs}.bind(this)},sysexEnabled:{enumerable:!0,get:function(){return!(!this["interface"]||!this["interface"].sysexEnabled)}.bind(this)},time:{enumerable:!0,get:function(){return performance.now()}}})}function Input(midiInput){var that=this;this._userHandlers={channel:{},system:{}},this._midiInput=midiInput,Object.defineProperties(this,{connection:{enumerable:!0,get:function(){return that._midiInput.connection}},id:{enumerable:!0,get:function(){return that._midiInput.id}},manufacturer:{enumerable:!0,get:function(){return that._midiInput.manufacturer}},name:{enumerable:!0,get:function(){return that._midiInput.name}},state:{enumerable:!0,get:function(){return that._midiInput.state}}}),this._initializeUserHandlers()}function Output(midiOutput){var that=this;this._midiOutput=midiOutput,Object.defineProperties(this,{connection:{enumerable:!0,get:function(){return that._midiOutput.connection}},id:{enumerable:!0,get:function(){return that._midiOutput.id}},manufacturer:{enumerable:!0,get:function(){return that._midiOutput.manufacturer}},name:{enumerable:!0,get:function(){return that._midiOutput.name}},state:{enumerable:!0,get:function(){return that._midiOutput.state}}})}var wm=new WebMidi;WebMidi.prototype.enable=function(callback,sysex){return this.enabled?void 0:this.supported?void navigator.requestMIDIAccess({sysex:sysex}).then(function(midiAccess){this["interface"]=midiAccess,this._resetInterfaceUserHandlers(),this["interface"].onstatechange=this._onInterfaceStateChange.bind(this),this._onInterfaceStateChange(null),"function"==typeof callback&&callback.call(this)}.bind(this),function(err){"function"==typeof callback&&callback.call(this,err)}.bind(this)):void("function"==typeof callback&&callback(new Error("The Web MIDI API is not supported by your browser.")))},WebMidi.prototype.disable=function(){if(!this.supported)throw new Error("The Web MIDI API is not supported by your browser.");this["interface"].onstatechange=void 0,this["interface"]=void 0,this._inputs=[],this._outputs=[],this._resetInterfaceUserHandlers()},WebMidi.prototype.addListener=function(type,listener){if(!this.enabled)throw new Error("WebMidi must be enabled before adding event listeners.");if("function"!=typeof listener)throw new TypeError("The 'listener' parameter must be a function.");if(!(this._midiInterfaceEvents.indexOf(type)>=0))throw new TypeError("The specified event type is not supported.");return this._userHandlers[type].push(listener),this},WebMidi.prototype.hasListener=function(type,listener){if(!this.enabled)throw new Error("WebMidi must be enabled before checking event listeners.");if("function"!=typeof listener)throw new TypeError("The 'listener' parameter must be a function.");if(!(this._midiInterfaceEvents.indexOf(type)>=0))throw new TypeError("The specified event type is not supported.");for(var o=0;o<this._userHandlers[type].length;o++)if(this._userHandlers[type][o]===listener)return!0;return!1},WebMidi.prototype.removeListener=function(type,listener){if(!this.enabled)throw new Error("WebMidi must be enabled before removing event listeners.");if(void 0!==listener&&"function"!=typeof listener)throw new TypeError("The 'listener' parameter must be a function.");if(this._midiInterfaceEvents.indexOf(type)>=0)if(listener)for(var o=0;o<this._userHandlers[type].length;o++)this._userHandlers[type][o]===listener&&this._userHandlers[type].splice(o,1);else this._userHandlers[type]=[];else{if(void 0!==type)throw new TypeError("The specified event type is not supported.");this._resetInterfaceUserHandlers()}return this},WebMidi.prototype.getInputById=function(id){if(!this.enabled)throw new Error("WebMidi is not enabled.");for(var i=0;i<this.inputs.length;i++)if(this.inputs[i].id===id)return this.inputs[i];return!1},WebMidi.prototype.getOutputById=function(id){if(!this.enabled)throw new Error("WebMidi is not enabled.");for(var i=0;i<this.outputs.length;i++)if(this.outputs[i].id===id)return this.outputs[i];return!1},WebMidi.prototype.getInputByName=function(name){if(!this.enabled)throw new Error("WebMidi is not enabled.");for(var i=0;i<this.inputs.length;i++)if(~this.inputs[i].name.indexOf(name))return this.inputs[i];return!1},WebMidi.prototype.getOctave=function(number){return number>=0&&127>=number?Math.floor(parseInt(number)/12-1)-1:void 0},WebMidi.prototype.getOutputByName=function(name){if(!this.enabled)throw new Error("WebMidi is not enabled.");for(var i=0;i<this.outputs.length;i++)if(~this.outputs[i].name.indexOf(name))return this.outputs[i];return!1},WebMidi.prototype.guessNoteNumber=function(input){var output=!1;if(input&&input.toFixed&&input>=0&&127>=input?output=Math.round(input):parseInt(input)>=0&&parseInt(input)<=127?output=parseInt(input):("string"==typeof input||input instanceof String)&&(output=this.noteNameToNumber(input)),output===!1)throw new Error("Invalid note number ("+input+").");return output},WebMidi.prototype.noteNameToNumber=function(name){"string"!=typeof name&&(name="");var matches=name.match(/([CDEFGAB])(#{0,2}|b{0,2})(-?\d+)/i);if(!matches)throw new RangeError("Invalid note name.");var semitones=wm._semitones[matches[1].toUpperCase()],octave=parseInt(matches[3]),result=12*(octave+2)+semitones;if(matches[2].toLowerCase().indexOf("b")>-1?result-=matches[2].length:matches[2].toLowerCase().indexOf("#")>-1&&(result+=matches[2].length),0>semitones||-2>octave||octave>8||0>result||result>127)throw new RangeError("Invalid note name or note outside valid range.");return result},WebMidi.prototype._updateInputsAndOutputs=function(){this._updateInputs(),this._updateOutputs()},WebMidi.prototype._updateInputs=function(){for(var i=0;i<this._inputs.length;i++){for(var remove=!0,updated=this["interface"].inputs.values(),input=updated.next();input&&!input.done;input=updated.next())if(this._inputs[i]._midiInput===input.value){remove=!1;break}remove&&this._inputs.splice(i,1)}this["interface"].inputs.forEach(function(nInput){for(var add=!0,j=0;j<this._inputs.length;j++)this._inputs[j]._midiInput===nInput&&(add=!1);add&&this._inputs.push(this._createInput(nInput))}.bind(this))},WebMidi.prototype._updateOutputs=function(){for(var i=0;i<this._outputs.length;i++){for(var remove=!0,updated=this["interface"].outputs.values(),output=updated.next();output&&!output.done;output=updated.next())if(this._outputs[i]._midiOutput===output.value){remove=!1;break}remove&&this._outputs.splice(i,1)}this["interface"].outputs.forEach(function(nOutput){for(var add=!0,j=0;j<this._outputs.length;j++)this._outputs[j]._midiOutput===nOutput&&(add=!1);add&&this._outputs.push(this._createOutput(nOutput))}.bind(this))},WebMidi.prototype._createInput=function(midiInput){var input=new Input(midiInput);return input._midiInput.onmidimessage=input._onMidiMessage.bind(input),input},WebMidi.prototype._createOutput=function(midiOutput){var output=new Output(midiOutput);return output._midiOutput.onmidimessage=output._onMidiMessage.bind(output),output},WebMidi.prototype._onInterfaceStateChange=function(e){if(this._stateChangeQueue.push(e),!this._processingStateChange){for(this._processingStateChange=!0;this._stateChangeQueue.length>0;)this._processStateChange(this._stateChangeQueue.shift());this._processingStateChange=!1}},WebMidi.prototype._processStateChange=function(e){if(this._updateInputsAndOutputs(),null!==e){var event={timestamp:e.timeStamp,type:e.port.state,id:e.port.id,manufacturer:e.port.manufacturer,name:e.port.name};"connected"===e.port.state&&("output"===e.port.type?event.output=this.getOutputById(e.port.id):"input"===e.port.type&&(event.input=this.getInputById(e.port.id))),this._userHandlers[e.port.state].forEach(function(handler){handler(event)})}},WebMidi.prototype._resetInterfaceUserHandlers=function(){for(var i=0;i<this._midiInterfaceEvents.length;i++)this._userHandlers[this._midiInterfaceEvents[i]]=[]},Input.prototype.addListener=function(type,channel,listener){var that=this;if(void 0===channel&&(channel="all"),Array.isArray(channel)||(channel=[channel]),channel.forEach(function(item){if("all"!==item&&!(item>=1&&16>=item))throw new RangeError("The 'channel' parameter is invalid.")}),"function"!=typeof listener)throw new TypeError("The 'listener' parameter must be a function.");if(wm.MIDI_SYSTEM_MESSAGES[type])this._userHandlers.system[type]||(this._userHandlers.system[type]=[]),this._userHandlers.system[type].push(listener);else{if(!wm.MIDI_CHANNEL_MESSAGES[type])throw new TypeError("The specified event type is not supported.");if(channel.indexOf("all")>-1){channel=[];for(var j=1;16>=j;j++)channel.push(j)}this._userHandlers.channel[type]||(this._userHandlers.channel[type]=[]),channel.forEach(function(ch){that._userHandlers.channel[type][ch]||(that._userHandlers.channel[type][ch]=[]),that._userHandlers.channel[type][ch].push(listener)})}return this},Input.prototype.on=Input.prototype.addListener,Input.prototype.hasListener=function(type,channel,listener){var that=this;if("function"!=typeof listener)throw new TypeError("The 'listener' parameter must be a function.");if(void 0===channel&&(channel="all"),channel.constructor!==Array&&(channel=[channel]),wm.MIDI_SYSTEM_MESSAGES[type]){for(var o=0;o<this._userHandlers.system[type].length;o++)if(this._userHandlers.system[type][o]===listener)return!0}else if(wm.MIDI_CHANNEL_MESSAGES[type]){if(channel.indexOf("all")>-1){channel=[];for(var j=1;16>=j;j++)channel.push(j)}return this._userHandlers.channel[type]?channel.every(function(chNum){var listeners=that._userHandlers.channel[type][chNum];return listeners&&listeners.indexOf(listener)>-1}):!1}return!1},Input.prototype.removeListener=function(type,channel,listener){var that=this;if(void 0!==listener&&"function"!=typeof listener)throw new TypeError("The 'listener' parameter must be a function.");if(void 0===channel&&(channel="all"),channel.constructor!==Array&&(channel=[channel]),wm.MIDI_SYSTEM_MESSAGES[type])if(void 0===listener)this._userHandlers.system[type]=[];else for(var o=0;o<this._userHandlers.system[type].length;o++)this._userHandlers.system[type][o]===listener&&this._userHandlers.system[type].splice(o,1);else if(wm.MIDI_CHANNEL_MESSAGES[type]){if(channel.indexOf("all")>-1){channel=[];for(var j=1;16>=j;j++)channel.push(j)}if(!this._userHandlers.channel[type])return this;channel.forEach(function(chNum){var listeners=that._userHandlers.channel[type][chNum];if(listeners)if(void 0===listener)that._userHandlers.channel[type][chNum]=[];else for(var l=0;l<listeners.length;l++)listeners[l]===listener&&listeners.splice(l,1)})}else{if(void 0!==type)throw new TypeError("The specified event type is not supported.");this._initializeUserHandlers()}return this},Input.prototype._initializeUserHandlers=function(){for(var prop1 in wm.MIDI_CHANNEL_MESSAGES)wm.MIDI_CHANNEL_MESSAGES.hasOwnProperty(prop1)&&(this._userHandlers.channel[prop1]={});for(var prop2 in wm.MIDI_SYSTEM_MESSAGES)wm.MIDI_SYSTEM_MESSAGES.hasOwnProperty(prop2)&&(this._userHandlers.system[prop2]=[])},Input.prototype._onMidiMessage=function(e){e.data[0]<240?this._parseChannelEvent(e):e.data[0]<=255&&this._parseSystemEvent(e)},Input.prototype._parseChannelEvent=function(e){var data1,data2,command=e.data[0]>>4,channel=(15&e.data[0])+1;e.data.length>1&&(data1=e.data[1],data2=e.data.length>2?e.data[2]:void 0);var event={target:this,data:e.data,timestamp:e.timeStamp,channel:channel};command===wm.MIDI_CHANNEL_MESSAGES.noteoff||command===wm.MIDI_CHANNEL_MESSAGES.noteon&&0===data2?(event.type="noteoff",event.note={number:data1,name:wm._notes[data1%12],octave:wm.getOctave(data1)},event.velocity=data2/127,event.rawVelocity=data2):command===wm.MIDI_CHANNEL_MESSAGES.noteon?(event.type="noteon",event.note={number:data1,name:wm._notes[data1%12],octave:wm.getOctave(data1)},event.velocity=data2/127,event.rawVelocity=data2):command===wm.MIDI_CHANNEL_MESSAGES.keyaftertouch?(event.type="keyaftertouch",event.note={number:data1,name:wm._notes[data1%12],octave:wm.getOctave(data1)},event.value=data2/127):command===wm.MIDI_CHANNEL_MESSAGES.controlchange&&data1>=0&&119>=data1?(event.type="controlchange",event.controller={number:data1,name:this.getCcNameByNumber(data1)},event.value=data2):command===wm.MIDI_CHANNEL_MESSAGES.channelmode&&data1>=120&&127>=data1?(event.type="channelmode",event.controller={number:data1,name:this.getChannelModeByNumber(data1)},event.value=data2):command===wm.MIDI_CHANNEL_MESSAGES.programchange?(event.type="programchange",event.value=data1):command===wm.MIDI_CHANNEL_MESSAGES.channelaftertouch?(event.type="channelaftertouch",event.value=data1/127):command===wm.MIDI_CHANNEL_MESSAGES.pitchbend?(event.type="pitchbend",event.value=((data2<<7)+data1-8192)/8192):event.type="unknownchannelmessage",this._userHandlers.channel[event.type]&&this._userHandlers.channel[event.type][channel]&&this._userHandlers.channel[event.type][channel].forEach(function(callback){callback(event)})},Input.prototype.getCcNameByNumber=function(number){if(number=parseInt(number),!(number>=0&&119>=number))throw new RangeError("The control change number must be between 0 and 119.");for(var cc in wm.MIDI_CONTROL_CHANGE_MESSAGES)if(number===wm.MIDI_CONTROL_CHANGE_MESSAGES[cc])return cc;return void 0},Input.prototype.getChannelModeByNumber=function(number){if(number=parseInt(number),!(number>=120&&status<=127))throw new RangeError("The control change number must be between 120 and 127.");for(var cm in wm.MIDI_CHANNEL_MODE_MESSAGES)if(number===wm.MIDI_CHANNEL_MODE_MESSAGES[cm])return cm},Input.prototype._parseSystemEvent=function(e){var command=e.data[0],event={target:this,data:e.data,timestamp:e.timeStamp};command===wm.MIDI_SYSTEM_MESSAGES.sysex?event.type="sysex":command===wm.MIDI_SYSTEM_MESSAGES.timecode?event.type="timecode":command===wm.MIDI_SYSTEM_MESSAGES.songposition?event.type="songposition":command===wm.MIDI_SYSTEM_MESSAGES.songselect?(event.type="songselect",event.song=e.data[1]):command===wm.MIDI_SYSTEM_MESSAGES.tuningrequest?event.type="tuningrequest":command===wm.MIDI_SYSTEM_MESSAGES.clock?event.type="clock":command===wm.MIDI_SYSTEM_MESSAGES.start?event.type="start":command===wm.MIDI_SYSTEM_MESSAGES["continue"]?event.type="continue":command===wm.MIDI_SYSTEM_MESSAGES.stop?event.type="stop":command===wm.MIDI_SYSTEM_MESSAGES.activesensing?event.type="activesensing":command===wm.MIDI_SYSTEM_MESSAGES.reset?event.type="reset":event.type="unknownsystemmessage",this._userHandlers.system[event.type]&&this._userHandlers.system[event.type].forEach(function(callback){callback(event)})},Output.prototype.send=function(status,data,timestamp){if(!(status>=128&&255>=status))throw new RangeError("The status byte must be an integer between 128 (0x80) and 255 (0xFF).");Array.isArray(data)||(data=parseInt(data)>=0&&parseInt(data)<=127?[parseInt(data)]:[]);var message=[status];return data.forEach(function(item){if(!(item>=0&&255>=item))throw new RangeError("The data bytes must be integers between 0 (0x00) and 255 (0xFF).");message.push(item)}),this._midiOutput.send(message,parseFloat(timestamp)||0),this},Output.prototype.sendSysex=function(manufacturer,data,options){if(!wm.sysexEnabled)throw new Error("SysEx message support must first be activated.");return options=options||{},manufacturer=[].concat(manufacturer),data.forEach(function(item){if(0>item||item>127)throw new RangeError("The data bytes of a SysEx message must be integers between 0 (0x00) and 127 (0x7F).")}),data=manufacturer.concat(data,wm.MIDI_SYSTEM_MESSAGES.sysexend),this.send(wm.MIDI_SYSTEM_MESSAGES.sysex,data,this._parseTimeParameter(options.time)),this},Output.prototype.sendTimecodeQuarterFrame=function(value,options){return options=options||{},this.send(wm.MIDI_SYSTEM_MESSAGES.timecode,value,this._parseTimeParameter(options.time)),this},Output.prototype.sendSongPosition=function(value,options){value=parseInt(value)||0,options=options||{};var msb=value>>7&127,lsb=127&value;return this.send(wm.MIDI_SYSTEM_MESSAGES.songposition,[msb,lsb],this._parseTimeParameter(options.time)),this},Output.prototype.sendSongSelect=function(value,options){if(value=parseInt(value),options=options||{},!(value>=0&&127>=value))throw new RangeError("The song number must be between 0 and 127.");return this.send(wm.MIDI_SYSTEM_MESSAGES.songselect,[value],this._parseTimeParameter(options.time)),this},Output.prototype.sendTuningRequest=function(options){return options=options||{},this.send(wm.MIDI_SYSTEM_MESSAGES.tuningrequest,void 0,this._parseTimeParameter(options.time)),this},Output.prototype.sendClock=function(options){return options=options||{},this.send(wm.MIDI_SYSTEM_MESSAGES.clock,void 0,this._parseTimeParameter(options.time)),this},Output.prototype.sendStart=function(options){return options=options||{},this.send(wm.MIDI_SYSTEM_MESSAGES.start,void 0,this._parseTimeParameter(options.time)),this},Output.prototype.sendContinue=function(options){return options=options||{},this.send(wm.MIDI_SYSTEM_MESSAGES["continue"],void 0,this._parseTimeParameter(options.time)),this},Output.prototype.sendStop=function(options){return options=options||{},this.send(wm.MIDI_SYSTEM_MESSAGES.stop,void 0,this._parseTimeParameter(options.time)),this},Output.prototype.sendActiveSensing=function(options){return options=options||{},this.send(wm.MIDI_SYSTEM_MESSAGES.activesensing,void 0,this._parseTimeParameter(options.time)),this},Output.prototype.sendReset=function(options){return options=options||{},this.send(wm.MIDI_SYSTEM_MESSAGES.reset,void 0,this._parseTimeParameter(options.time)),this},Output.prototype.stopNote=function(note,channel,options){if("all"===note)return this.sendChannelMode("allnotesoff",0,channel,options);var nVelocity=64;return options=options||{},options.velocity=parseFloat(options.velocity),options.rawVelocity?!isNaN(options.velocity)&&options.velocity>=0&&options.velocity<=127&&(nVelocity=options.velocity):!isNaN(options.velocity)&&options.velocity>=0&&options.velocity<=1&&(nVelocity=127*options.velocity),this._convertNoteToArray(note).forEach(function(item){this._convertChannelToArray(channel).forEach(function(ch){this.send((wm.MIDI_CHANNEL_MESSAGES.noteoff<<4)+(ch-1),[item,Math.round(nVelocity)],this._parseTimeParameter(options.time))}.bind(this))}.bind(this)),this},Output.prototype.playNote=function(note,channel,options){var nVelocity=64;if(options=options||{},options.velocity=parseFloat(options.velocity),options.rawVelocity?!isNaN(options.velocity)&&options.velocity>=0&&options.velocity<=127&&(nVelocity=options.velocity):!isNaN(options.velocity)&&options.velocity>=0&&options.velocity<=1&&(nVelocity=127*options.velocity),options.time=this._parseTimeParameter(options.time),this._convertNoteToArray(note).forEach(function(item){this._convertChannelToArray(channel).forEach(function(ch){this.send((wm.MIDI_CHANNEL_MESSAGES.noteon<<4)+(ch-1),[item,Math.round(nVelocity)],options.time)}.bind(this))}.bind(this)),options.duration=parseFloat(options.duration),options.duration){options.duration<=0&&(options.duration=0);var nRelease=64;options.release=parseFloat(options.release),options.rawVelocity?!isNaN(options.release)&&options.release>=0&&options.release<=127&&(nRelease=options.release):!isNaN(options.release)&&options.release>=0&&options.release<=1&&(nRelease=127*options.release),this._convertNoteToArray(note).forEach(function(item){this._convertChannelToArray(channel).forEach(function(ch){this.send((wm.MIDI_CHANNEL_MESSAGES.noteoff<<4)+(ch-1),[item,Math.round(nRelease)],(options.time||wm.time)+options.duration)}.bind(this))}.bind(this))}return this},Output.prototype.sendKeyAftertouch=function(note,channel,pressure,options){var that=this;if(options=options||{},1>channel||channel>16)throw new RangeError("The channel must be between 1 and 16.");pressure=parseFloat(pressure),(isNaN(pressure)||0>pressure||pressure>1)&&(pressure=.5);var nPressure=Math.round(127*pressure);return this._convertNoteToArray(note).forEach(function(item){that._convertChannelToArray(channel).forEach(function(ch){that.send((wm.MIDI_CHANNEL_MESSAGES.keyaftertouch<<4)+(ch-1),[item,nPressure],that._parseTimeParameter(options.time))})}),this},Output.prototype.sendControlChange=function(controller,value,channel,options){if(options=options||{},"string"==typeof controller){if(controller=wm.MIDI_CONTROL_CHANGE_MESSAGES[controller],!controller)throw new TypeError("Invalid controller name.")}else if(controller=parseInt(controller),!(controller>=0&&119>=controller))throw new RangeError("Controller numbers must be between 0 and 119.");if(value=parseInt(value)||0,!(value>=0&&127>=value))throw new RangeError("Controller value must be between 0 and 127.");return this._convertChannelToArray(channel).forEach(function(ch){this.send((wm.MIDI_CHANNEL_MESSAGES.controlchange<<4)+(ch-1),[controller,value],this._parseTimeParameter(options.time))}.bind(this)),this},Output.prototype._selectRegisteredParameter=function(parameter,channel,time){var that=this;if(parameter[0]=parseInt(parameter[0]),!(parameter[0]>=0&&parameter[0]<=127))throw new RangeError("The control65 value must be between 0 and 127");if(parameter[1]=parseInt(parameter[1]),!(parameter[1]>=0&&parameter[1]<=127))throw new RangeError("The control64 value must be between 0 and 127");return this._convertChannelToArray(channel).forEach(function(ch){that.sendControlChange(101,parameter[0],channel,{time:time}),that.sendControlChange(100,parameter[1],channel,{time:time})}),this},Output.prototype._selectNonRegisteredParameter=function(parameter,channel,time){var that=this;if(parameter[0]=parseInt(parameter[0]),!(parameter[0]>=0&&parameter[0]<=127))throw new RangeError("The control63 value must be between 0 and 127");if(parameter[1]=parseInt(parameter[1]),!(parameter[1]>=0&&parameter[1]<=127))throw new RangeError("The control62 value must be between 0 and 127");return this._convertChannelToArray(channel).forEach(function(ch){that.sendControlChange(99,parameter[0],channel,{time:time}),that.sendControlChange(98,parameter[1],channel,{time:time})}),this},Output.prototype._setCurrentRegisteredParameter=function(data,channel,time){var that=this;if(data=[].concat(data),data[0]=parseInt(data[0]),!(data[0]>=0&&data[0]<=127))throw new RangeError("The msb value must be between 0 and 127");return this._convertChannelToArray(channel).forEach(function(ch){that.sendControlChange(6,data[0],channel,{time:time})}),data[1]=parseInt(data[1]),data[1]>=0&&data[1]<=127&&this._convertChannelToArray(channel).forEach(function(ch){that.sendControlChange(38,data[1],channel,{time:time})}),this},Output.prototype._deselectRegisteredParameter=function(channel,time){var that=this;return this._convertChannelToArray(channel).forEach(function(ch){that.sendControlChange(101,127,channel,{time:time}),that.sendControlChange(100,127,channel,{time:time})}),this},Output.prototype.setRegisteredParameter=function(parameter,data,channel,options){var that=this;if(options=options||{},!Array.isArray(parameter)){if(!wm.MIDI_REGISTERED_PARAMETER[parameter])throw new Error("The specified parameter is not available.");parameter=wm.MIDI_REGISTERED_PARAMETER[parameter]}return this._convertChannelToArray(channel).forEach(function(ch){that._selectRegisteredParameter(parameter,channel,options.time),that._setCurrentRegisteredParameter(data,channel,options.time),that._deselectRegisteredParameter(channel,options.time)}),this},Output.prototype.setNonRegisteredParameter=function(parameter,data,channel,options){var that=this;if(options=options||{},!(parameter[0]>=0&&parameter[0]<=127&&parameter[1]>=0&&parameter[1]<=127))throw new Error("Position 0 and 1 of the 2-position parameter array must both be between 0 and 127.");return data=[].concat(data),this._convertChannelToArray(channel).forEach(function(ch){that._selectNonRegisteredParameter(parameter,channel,options.time),that._setCurrentRegisteredParameter(data,channel,options.time),that._deselectRegisteredParameter(channel,options.time)}),this},Output.prototype.incrementRegisteredParameter=function(parameter,channel,options){var that=this;if(options=options||{},!Array.isArray(parameter)){if(!wm.MIDI_REGISTERED_PARAMETER[parameter])throw new Error("The specified parameter is not available.");parameter=wm.MIDI_REGISTERED_PARAMETER[parameter]}return this._convertChannelToArray(channel).forEach(function(ch){that._selectRegisteredParameter(parameter,channel,options.time),that.sendControlChange(96,0,channel,{time:options.time}),that._deselectRegisteredParameter(channel,options.time)}),this},Output.prototype.decrementRegisteredParameter=function(parameter,channel,options){if(options=options||{},!Array.isArray(parameter)){if(!wm.MIDI_REGISTERED_PARAMETER[parameter])throw new TypeError("The specified parameter is not available.");parameter=wm.MIDI_REGISTERED_PARAMETER[parameter]}return this._convertChannelToArray(channel).forEach(function(ch){this._selectRegisteredParameter(parameter,channel,options.time),this.sendControlChange(97,0,channel,{time:options.time}),this._deselectRegisteredParameter(channel,options.time)}.bind(this)),this},Output.prototype.setPitchBendRange=function(semitones,cents,channel,options){var that=this;if(options=options||{},semitones=parseInt(semitones)||0,!(semitones>=0&&127>=semitones))throw new RangeError("The semitones value must be between 0 and 127");if(cents=parseInt(cents)||0,!(cents>=0&&127>=cents))throw new RangeError("The cents value must be between 0 and 127");return this._convertChannelToArray(channel).forEach(function(ch){that.setRegisteredParameter("pitchbendrange",[semitones,cents],channel,{time:options.time})}),this},Output.prototype.setModulationRange=function(semitones,cents,channel,options){var that=this;if(options=options||{},semitones=parseInt(semitones)||0,!(semitones>=0&&127>=semitones))throw new RangeError("The semitones value must be between 0 and 127");if(cents=parseInt(cents)||0,!(cents>=0&&127>=cents))throw new RangeError("The cents value must be between 0 and 127");return this._convertChannelToArray(channel).forEach(function(ch){that.setRegisteredParameter("modulationrange",[semitones,cents],channel,{time:options.time})}),this},Output.prototype.setMasterTuning=function(value,channel,options){var that=this;if(options=options||{},value=parseFloat(value)||0,-65>=value||value>=64)throw new RangeError("The value must be a decimal number larger than -65 and smaller than 64.");var coarse=parseInt(value)+64,fine=value-parseInt(value);fine=Math.round((fine+1)/2*16383);var msb=fine>>7&127,lsb=127&fine;return this._convertChannelToArray(channel).forEach(function(ch){that.setRegisteredParameter("channelcoarsetuning",coarse,channel,{time:options.time}),that.setRegisteredParameter("channelfinetuning",[msb,lsb],channel,{time:options.time})}),this},Output.prototype.setTuningProgram=function(value,channel,options){var that=this;if(options=options||{},value=parseInt(value)||0,!(value>=0&&127>=value))throw new RangeError("The program value must be between 0 and 127");return this._convertChannelToArray(channel).forEach(function(ch){that.setRegisteredParameter("tuningprogram",value,channel,{time:options.time})}),this},Output.prototype.setTuningBank=function(value,channel,options){var that=this;if(options=options||{},value=parseInt(value)||0,!(value>=0&&127>=value))throw new RangeError("The bank value must be between 0 and 127");return this._convertChannelToArray(channel).forEach(function(ch){that.setRegisteredParameter("tuningbank",value,channel,{time:options.time})}),this},Output.prototype.sendChannelMode=function(command,value,channel,options){if(options=options||{},"string"==typeof command){if(command=wm.MIDI_CHANNEL_MODE_MESSAGES[command],!command)throw new TypeError("Invalid channel mode message name.")}else if(command=parseInt(command),!(command>=120&&127>=command))throw new RangeError("Channel mode numerical identifiers must be between 120 and 127.");if(value=parseInt(value)||0,0>value||value>127)throw new RangeError("Value must be an integer between 0 and 127.");return this._convertChannelToArray(channel).forEach(function(ch){this.send((wm.MIDI_CHANNEL_MESSAGES.channelmode<<4)+(ch-1),[command,value],this._parseTimeParameter(options.time))}.bind(this)),this},Output.prototype.sendProgramChange=function(program,channel,options){var that=this;if(options=options||{},program=parseInt(program),isNaN(program)||0>program||program>127)throw new RangeError("Program numbers must be between 0 and 127.");return this._convertChannelToArray(channel).forEach(function(ch){that.send((wm.MIDI_CHANNEL_MESSAGES.programchange<<4)+(ch-1),[program],that._parseTimeParameter(options.time))}),this},Output.prototype.sendChannelAftertouch=function(pressure,channel,options){var that=this;options=options||{},pressure=parseFloat(pressure),(isNaN(pressure)||0>pressure||pressure>1)&&(pressure=.5);var nPressure=Math.round(127*pressure);return this._convertChannelToArray(channel).forEach(function(ch){that.send((wm.MIDI_CHANNEL_MESSAGES.channelaftertouch<<4)+(ch-1),[nPressure],that._parseTimeParameter(options.time))}),this},Output.prototype.sendPitchBend=function(bend,channel,options){
var that=this;if(options=options||{},bend=parseFloat(bend),isNaN(bend)||-1>bend||bend>1)throw new RangeError("Pitch bend value must be between -1 and 1.");var nLevel=Math.round((bend+1)/2*16383),msb=nLevel>>7&127,lsb=127&nLevel;return this._convertChannelToArray(channel).forEach(function(ch){that.send((wm.MIDI_CHANNEL_MESSAGES.pitchbend<<4)+(ch-1),[lsb,msb],that._parseTimeParameter(options.time))}),this},Output.prototype._parseTimeParameter=function(time){var parsed,value;return"string"==typeof time&&"+"===time.substring(0,1)?(parsed=parseFloat(time),parsed&&parsed>0&&(value=wm.time+parsed)):(parsed=parseFloat(time),parsed>wm.time&&(value=parsed)),value},Output.prototype._convertNoteToArray=function(note){var notes=[];return Array.isArray(note)||(note=[note]),note.forEach(function(item){notes.push(wm.guessNoteNumber(item))}),notes},Output.prototype._convertChannelToArray=function(channel){if(("all"===channel||void 0===channel)&&(channel=["all"]),Array.isArray(channel)||(channel=[channel]),channel.indexOf("all")>-1){channel=[];for(var i=1;16>=i;i++)channel.push(i)}return channel.forEach(function(ch){if(!(ch>=1&&16>=ch))throw new RangeError("MIDI channels must be between 1 and 16.")}),channel},Output.prototype._onMidiMessage=function(e){},"function"==typeof define&&"object"==typeof define.amd?define([],function(){return wm}):"undefined"!=typeof module&&module.exports?module.exports=wm:scope.WebMidi||(scope.WebMidi=wm)}(this);
},{}],8:[function(require,module,exports){
const toneFrequency = require('tone-frequency');
const adsrGainNode = require('adsr-gain-node');

let audioCtx = new AudioContext(); 
let masterGain = audioCtx.createGain();

masterGain.gain.value = 0.3;
masterGain.connect(audioCtx.destination);



function getBeatingOsc(audioCtx, freq, velocity) {

    this.osc1 = audioCtx.createOscillator();
    this.osc1.type = 'square';

    this.osc2 = audioCtx.createOscillator();
    this.osc2.type = 'square';
    
    this.osc3 = audioCtx.createOscillator();
    this.osc3.type = 'square';

    let synthGain = new adsrGainNode(audioCtx);
    
    if (velocity === undefined) {
        velocity = 0.3
    } 
    
    
    synthGain.setOptions({
        initGain: 0.1, // Init gain on note
        maxGain: velocity, // Max gain on note
        attackTime: 0.1, // AttackTime. gain.init to gain.max in attackTime
        sustainTime: 3, // Sustain note in time
        releaseTime: 1 // Approximated end time. Calculated with secondsToTimeConstant()
    
    });
    
    this.gain = synthGain.getGainNode(audioCtx.currentTime);

    this.osc1.frequency.value = freq // e.g. 400
    this.osc2.frequency.value = freq + (freq*0.01) // Add a little

    this.osc1.connect(this.gain);
    this.osc2.connect(this.gain);
    this.gain.connect(masterGain);

    this.start = function() {
        this.osc1.start();
        this.osc2.start();
        this.osc3.start();
    }

    this.disconnect = function () {

        let length = audioCtx.currentTime + synthGain.getTotalLength();
        this.osc1.stop(length);
        this.osc2.stop(length);
        this.osc3.stop(length);
    }
}

function getMultiBeatingOsc () {

    this.start = function(freq, options) {

        let velocity = 0.3
        if (options) {
            velocity = options.velocity
        }

        toneFrequency.base = freq;
        this.synth1 = new getBeatingOsc(audioCtx, freq, velocity)
    
        let lowFreq = toneFrequency.getToneStep(+7)
        this.synth2 = new getBeatingOsc(audioCtx, lowFreq*2, velocity)
    
        let highFreq = toneFrequency.getToneStep(+12)
        this.synth3 = new getBeatingOsc(audioCtx, lowFreq*3, velocity)

        this.synth1.start();
        this.synth2.start();
        this.synth3.start();
    }

    this.stop = function () {
        this.synth1.disconnect();
        this.synth2.disconnect();
        //this.synth3.disconnect();
    }
}

module.exports = getMultiBeatingOsc

},{"adsr-gain-node":3,"tone-frequency":6}],9:[function(require,module,exports){
// Use it like this:  
// const synth = require('pluggable-synth')
// But this is the test
const pluggableSynth = require('./index')
const audioCtx = new AudioContext(); 
const masterGain = audioCtx.createGain();
masterGain.gain.value = 0.1;

/**
 * A simple test synth
 * The synth which is going to be connected to the piano
 * must have a `start` and a `stop` method 
 */
function testSynth () {

    this.start = function (freq, options) {
        this.oscillator = audioCtx.createOscillator();
        this.oscillator.type = 'square';
        this.oscillator.frequency.value = freq; // value in hertz
        this.oscillator.connect(masterGain);
        masterGain.connect(audioCtx.destination);
        this.oscillator.start();
    }

    this.stop = function () {
        this.oscillator.stop();
    }
}

var testSynth2 = require('./synth') 

$(document).ready(function () {

    var elemID = 'piano-container'
    var p = new pluggableSynth(elemID, {
        octaves: 2,
        octaveBegin: 3    
    })
    
    // Draws piano
    p.createPiano()

    // Set synth
    p.synth = testSynth2
    
    // Enable one octave of keyboard
    p.enableKeyboardEvents()
    
    // All midi tones will be played, but only two octaves is visible
    // You can specify input port, but defaults to 1 
    p.enableMidiEvents(1)

})
},{"./index":1,"./synth":8}]},{},[9])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3Vzci9saWIvbm9kZV9tb2R1bGVzL3dhdGNoaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJpbmRleC5qcyIsImtleWJvYXJkLXRvbmVzLmpzIiwibm9kZV9tb2R1bGVzL2Fkc3ItZ2Fpbi1ub2RlL2luZGV4LmpzIiwibm9kZV9tb2R1bGVzL2pzLWNzcy1waWFuby9pbmRleC5qcyIsIm5vZGVfbW9kdWxlcy9ub3RlLXBhcnNlci9kaXN0L25vdGUtcGFyc2VyLmpzIiwibm9kZV9tb2R1bGVzL3RvbmUtZnJlcXVlbmN5L2luZGV4LmpzIiwibm9kZV9tb2R1bGVzL3dlYm1pZGkvd2VibWlkaS5taW4uanMiLCJzeW50aC5qcyIsInRlc3QuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDcEhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2pDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDakVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdkRBO0FBQ0E7QUFDQTs7QUNGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDcEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzlCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM3RkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCJjb25zdCBub3RlUGFyc2VyID0gcmVxdWlyZSgnbm90ZS1wYXJzZXInKVxuY29uc3Qgb2N0YXZlMSA9IHJlcXVpcmUoJy4va2V5Ym9hcmQtdG9uZXMuanMnKS5vY3RhdmUxO1xuY29uc3QganNDc3NQaWFubyA9IHJlcXVpcmUoJ2pzLWNzcy1waWFubycpO1xuY29uc3Qgd2VibWlkaSA9IHJlcXVpcmUoJ3dlYm1pZGknKVxuXG5cbnZhciBrZXlzID0ge307XG5cbmpzQ3NzUGlhbm8ucHJvdG90eXBlID0ge1xuXG4gICAgZ2V0RnJlcXVlbmN5OiBmdW5jdGlvbiAobm90ZSkge1xuICAgICAgICBub3RlID0gbm90ZS5yZXBsYWNlKCdzJywgJyMnKTtcbiAgICAgICAgbGV0IHJlcyA9IG5vdGVQYXJzZXIucGFyc2Uobm90ZSlcbiAgICAgICAgbGV0IGZyZXEgPSByZXMuZnJlcTtcbiAgICAgICAgcmV0dXJuIGZyZXE7XG4gICAgfSxcblxuICAgIHN5bnRoOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdzZXQgYSBzeW50aCcpXG4gICAgfSxcblxuICAgIHRvZ2dsZUtleTogZnVuY3Rpb24gKG5vdGUpIHtcbiAgICAgICAgbGV0IHNlbGVjdG9yID0gJyMnICsgdGhpcy5lbGVtSUQgKyBcIiA+IC5waWFubyBsaVtkYXRhLW5vdGU9J1wiICsgbm90ZSArIFwiJ11cIlxuICAgICAgICBsZXQgZWxlbSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3IpXG4gICAgICAgIGlmICghZWxlbSkge1xuICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgIH1cbiAgICAgICAgZWxlbS5jbGFzc0xpc3QudG9nZ2xlKCdhY3RpdmUnKTtcbiAgICB9LFxuXG4gICAgc3ludGhTdGFydDogZnVuY3Rpb24gKG5vdGUsIG9wdGlvbnMpIHtcbiAgICAgICAgbm90ZSA9IG5vdGUudG9Mb3dlckNhc2UoKVxuICAgICAgICB0aGlzLnRvZ2dsZUtleShub3RlKVxuICAgICAgICBsZXQgZnJlcSA9IHRoaXMuZ2V0RnJlcXVlbmN5KG5vdGUpO1xuICAgICAgICBsZXQgc3ludGggPSBuZXcgdGhpcy5zeW50aCgpO1xuXG4gICAgICAgIHN5bnRoLnN0YXJ0KGZyZXEsIG9wdGlvbnMpO1xuICAgICAgICBrZXlzW25vdGVdID0gc3ludGg7XG4gICAgfSxcblxuICAgIHN5bnRoU3RvcDogZnVuY3Rpb24gKG5vdGUpIHtcbiAgICAgICAgbm90ZSA9IG5vdGUudG9Mb3dlckNhc2UoKVxuICAgICAgICB0aGlzLnRvZ2dsZUtleShub3RlKVxuICAgICAgICBsZXQgc3ludGggPSBrZXlzW25vdGVdXG4gICAgICAgIHN5bnRoLnN0b3AoKVxuICAgICAgICBkZWxldGUga2V5c1tub3RlXVxuICAgIH0sXG5cbiAgICAvLyBFbmFibGUgb25lIG9yIHR3byBvY3RhdmVzIG9uIGtleWJvYXJkXG4gICAgZW5hYmxlS2V5Ym9hcmRFdmVudHM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgKGUpID0+IHtcblxuICAgICAgICAgICAgdmFyIGsgPSBlLmtleTtcbiAgICAgICAgICAgIGxldCBub3RlID0gb2N0YXZlMVtrXSArIHRoaXMub3B0aW9ucy5vY3RhdmVCZWdpblxuXG4gICAgICAgICAgICBpZiAoayBpbiBvY3RhdmUxICYmICEobm90ZSBpbiBrZXlzKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc3ludGhTdGFydChub3RlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleXVwXCIsIChlKSA9PiB7XG5cbiAgICAgICAgICAgIGxldCBvY3RhdmUgPSB0aGlzLm9wdGlvbnMub2N0YXZlQmVnaW5cbiAgICAgICAgICAgIHZhciBrID0gZS5rZXk7XG4gICAgICAgICAgICBsZXQgbm90ZSA9IG9jdGF2ZTFba10gKyBvY3RhdmU7XG4gICAgICAgICAgICBpZiAoayBpbiBvY3RhdmUxICYmIChub3RlIGluIGtleXMpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zeW50aFN0b3Aobm90ZSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8vIEVuYWJsZSBtaWRpIGtleWJvYXJkXG4gICAgZW5hYmxlTWlkaUV2ZW50czogZnVuY3Rpb24gKHBvcnQpIHtcbiAgICAgICAgaWYgKHBvcnQgPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBwb3J0ID0gMVxuICAgICAgICB9XG5cbiAgICAgICAgd2VibWlkaS5lbmFibGUoIChlcnIpID0+IHtcblxuICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiV2ViTWlkaSBjb3VsZCBub3QgYmUgZW5hYmxlZC5cIiArIGVycik7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoICEocG9ydCBpbiB3ZWJtaWRpLmlucHV0cykpIHtcbiAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdNb2RpIHBvcnQgZG9lcyBub3QgZXhpc3RzICcgKyBwb3J0KVxuICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBQb3J0IGlzIG9rXG4gICAgICAgICAgICB2YXIgbWlkaUlucHV0ID0gd2VibWlkaS5pbnB1dHNbcG9ydF07XG4gICAgICAgICAgICBtaWRpSW5wdXQuYWRkTGlzdGVuZXIoJ25vdGVvbicsIFwiYWxsXCIsIChlKSA9PiB7XG5cbiAgICAgICAgICAgICAgICBsZXQgb2N0YXZlID0gcGFyc2VJbnQoZS5ub3RlLm9jdGF2ZSlcbiAgICAgICAgICAgICAgICBsZXQgbm90ZSA9IGUubm90ZS5uYW1lICsgb2N0YXZlXG4gICAgICAgICAgICAgICAgbm90ZSA9IG5vdGUucmVwbGFjZSgnIycsICdzJylcblxuICAgICAgICAgICAgICAgIGlmICghKG5vdGUgaW4ga2V5cykpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zeW50aFN0YXJ0KG5vdGUsIGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBtaWRpSW5wdXQuYWRkTGlzdGVuZXIoJ25vdGVvZmYnLCBcImFsbFwiLCAoZSkgPT4ge1xuICAgICAgICAgICAgICAgIGxldCBvY3RhdmUgPSBwYXJzZUludChlLm5vdGUub2N0YXZlKTtcbiAgICAgICAgICAgICAgICBsZXQgbm90ZSA9IGUubm90ZS5uYW1lICsgb2N0YXZlO1xuXG4gICAgICAgICAgICAgICAgbm90ZSA9IG5vdGUucmVwbGFjZSgnIycsICdzJylcblxuICAgICAgICAgICAgICAgIHRoaXMuc3ludGhTdG9wKG5vdGUpXG5cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KVxuICAgIH0sXG59XG5cbm1vZHVsZS5leHBvcnRzID0ganNDc3NQaWFubztcbiIsInZhciBrZXlib2FyZFRvbmVzID0ge31cblxua2V5Ym9hcmRUb25lcy5vY3RhdmUxID0ge1xuICAgIGE6ICdjJyxcbiAgICB3OiAnY3MnLFxuICAgIHM6ICdkJyxcbiAgICBlOiAnZHMnLFxuICAgIGQ6ICdlJyxcbiAgICBmOiAnZicsXG4gICAgdDogJ2ZzJyxcbiAgICBnOiAnZycsXG4gICAgeTogJ2dzJyxcbiAgICBoOiAnYScsXG4gICAgdTogJ2FzJyxcbiAgICBqOiAnYidcbn07XG5cblxua2V5Ym9hcmRUb25lcy5vY3RhdmUyID0ge1xuICAgIHE6ICdjJyxcbiAgICAyOiAnY3MnLFxuICAgIHc6ICdkJyxcbiAgICAzOiAnZHMnLFxuICAgIGU6ICdlJyxcbiAgICByOiAnZicsXG4gICAgNTogJ2ZzJyxcbiAgICB0OiAnZycsXG4gICAgNjogJ2dzJyxcbiAgICB5OiAnYScsXG4gICAgNzogJ2FzJyxcbiAgICB1OiAnYidcbn07XG5cbm1vZHVsZS5leHBvcnRzID0ga2V5Ym9hcmRUb25lczsiLCJmdW5jdGlvbiBHYWluKGN0eCkge1xuXG4gICAgdGhpcy5jdHggPSBjdHg7XG5cbiAgICB0aGlzLnNlY29uZHNUb1RpbWVDb25zdGFudCA9IGZ1bmN0aW9uIChzZWMpIHtcbiAgICAgICAgcmV0dXJuIChzZWMgKiAyKSAvIDg7XG4gICAgfTtcblxuICAgIHRoaXMub3B0aW9ucyA9IHtcbiAgICAgICAgaW5pdEdhaW46IDAuMSwgLy8gSW5pdCBnYWluIG9uIG5vdGVcbiAgICAgICAgbWF4R2FpbjogMS4wLCAvLyBNYXggZ2FpbiBvbiBub3RlXG4gICAgICAgIGF0dGFja1RpbWU6IDAuMSwgLy8gQXR0YWNrVGltZS4gZ2Fpbi5pbml0IHRvIGdhaW4ubWF4IGluIGF0dGFja1RpbWVcbiAgICAgICAgc3VzdGFpblRpbWU6IDEsIC8vIFN1c3RhaW4gbm90ZSBpbiB0aW1lXG4gICAgICAgIHJlbGVhc2VUaW1lOiAxLCAvLyBBcHByb3hpbWF0ZWQgZW5kIHRpbWUuIENhbGN1bGF0ZWQgd2l0aCBzZWNvbmRzVG9UaW1lQ29uc3RhbnQoKVxuICAgICAgICAvLyBkaXNjb25uZWN0OiBmYWxzZSAvLyBTaG91bGQgd2UgYXV0b2Rpc2Nvbm5lY3QuIERlZmF1bHQgaXMgdHJ1ZVxuICAgIH07XG5cbiAgICB0aGlzLnNldE9wdGlvbnMgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuICAgIH07XG5cbiAgICB0aGlzLmdhaW5Ob2RlO1xuICAgIC8qKlxuICAgICAqIFRoZSBnYWluTm9kZVxuICAgICAqIEBwYXJhbSB7ZmxvYXR9IGJlZ2luIGN0eCB0aW1lXG4gICAgICogQHJldHVybnMge0dhaW4uZ2V0R2Fpbk5vZGUuZ2Fpbk5vZGV9XG4gICAgICovXG4gICAgdGhpcy5nZXRHYWluTm9kZSA9IGZ1bmN0aW9uIChiZWdpbikge1xuXG4gICAgICAgIHRoaXMuZ2Fpbk5vZGUgPSB0aGlzLmN0eC5jcmVhdGVHYWluKCk7XG4gICAgICAgIHRoaXMuZ2Fpbk5vZGUuZ2Fpbi52YWx1ZSA9IHRoaXMub3B0aW9ucy5pbml0R2FpbjtcblxuICAgICAgICAvLyBBdHRhY2sgdG8gbWF4XG4gICAgICAgIHRoaXMuZ2Fpbk5vZGUuZ2Fpbi5zZXRUYXJnZXRBdFRpbWUoXG4gICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLm1heEdhaW4sXG4gICAgICAgICAgICAgICAgYmVnaW4gKyB0aGlzLm9wdGlvbnMuYXR0YWNrVGltZSxcbiAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMuYXR0YWNrVGltZSk7XG5cbiAgICAgICAgLy8gU3VzdGFpbiBhbmQgZW5kIG5vdGVcbiAgICAgICAgdGhpcy5nYWluTm9kZS5nYWluLnNldFRhcmdldEF0VGltZShcbiAgICAgICAgICAgICAgICAwLjAsXG4gICAgICAgICAgICAgICAgYmVnaW4gKyB0aGlzLm9wdGlvbnMuYXR0YWNrVGltZSArIHRoaXMub3B0aW9ucy5zdXN0YWluVGltZSxcbiAgICAgICAgICAgICAgICB0aGlzLnNlY29uZHNUb1RpbWVDb25zdGFudCh0aGlzLm9wdGlvbnMucmVsZWFzZVRpbWUpKTtcbiAgICAgICAgXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuZGlzY29ubmVjdCAhPT0gZmFsc2UpIHtcbiAgICAgICAgICAgIHRoaXMuZGlzY29ubmVjdChiZWdpbik7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHJldHVybiB0aGlzLmdhaW5Ob2RlO1xuICAgIH07XG5cbiAgICB0aGlzLmdldFRvdGFsTGVuZ3RoID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLmF0dGFja1RpbWUgKyB0aGlzLm9wdGlvbnMuc3VzdGFpblRpbWUgKyB0aGlzLm9wdGlvbnMucmVsZWFzZVRpbWVcbiAgICB9XG4gICAgXG4gICAgdGhpcy5kaXNjb25uZWN0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciB0b3RhbExlbmd0aCA9IHRoaXMuZ2V0VG90YWxMZW5ndGgoKTtcbiAgICAgICAgXG4gICAgICAgIHNldFRpbWVvdXQoICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuZ2Fpbk5vZGUuZGlzY29ubmVjdCgpO1xuICAgICAgICB9LFxuICAgICAgICB0b3RhbExlbmd0aCAqIDEwMDApO1xuICAgIH07XG59XG5cbm1vZHVsZS5leHBvcnRzID0gR2FpbjsiLCJmdW5jdGlvbiBwaWFubyhlbGVtSUQsIG9wdHMpIHtcblxuICAgIHRoaXMuZWxlbUlEID0gZWxlbUlEXG4gICAgdGhpcy5lbGVtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZWxlbUlEKVxuICAgIFxuICAgIHRoaXMuZGVmYXVsdHMgPSB7XG4gICAgICAgIG9jdGF2ZXM6IDIsXG4gICAgICAgIG9jdGF2ZUJlZ2luOiAzXG4gICAgfVxuXG4gICAgdGhpcy5vcHRpb25zID0ge31cbiAgICBPYmplY3QuYXNzaWduKHRoaXMub3B0aW9ucywgdGhpcy5kZWZhdWx0cywgb3B0cylcbiAgICBcbiAgICB0aGlzLmNyZWF0ZVBpYW5vID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBsZXQgaHRtbCA9IHRoaXMuZ2V0UGlhbm9IVE1MKClcbiAgICAgICAgdGhpcy5lbGVtLmlubmVySFRNTCA9IGh0bWxcbiAgICB9XG5cbiAgICB0aGlzLmdldFBpYW5vSFRNTCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgXG4gICAgICAgIGxldCBvY3RhdmVCZWdpbiA9IHRoaXMub3B0aW9ucy5vY3RhdmVCZWdpblxuICAgICAgICBsZXQgaHRtbCA9IGA8dWwgY2xhc3M9XCJwaWFub1wiPmBcbiAgICAgICAgZm9yIChpID0gMTsgaSA8PSB0aGlzLm9wdGlvbnMub2N0YXZlczsgaSsrKSB7ICBcbiAgICAgICAgICAgIGh0bWwgKz0gdGhpcy5nZXRUb25lcyhvY3RhdmVCZWdpbilcbiAgICAgICAgICAgIG9jdGF2ZUJlZ2luKysgXG4gICAgICAgIH1cbiAgICAgICAgaHRtbCArPSBgPC91bD5gXG4gICAgICAgIHJldHVybiBodG1sXG4gICAgfVxuXG4gICAgdGhpcy5nZXROb3RlQW5kT2N0YXZlID0gZnVuY3Rpb24gKG5vdGUsIG9jdGF2ZSkge1xuICAgICAgICByZXR1cm4gbm90ZSArIG9jdGF2ZVxuICAgIH1cblxuICAgIHRoaXMuZ2V0VG9uZXMgPSBmdW5jdGlvbiAob2N0YXZlKSB7XG4gICAgICAgIGxldCBvY3RhdmVIVE1MID0gXG4gICAgICAgIGBcbiAgICAgICAgICAgIDxsaSBjbGFzcz1cIndoaXRlIGNcIiBkYXRhLW5vdGU9XCIke3RoaXMuZ2V0Tm90ZUFuZE9jdGF2ZSgnYycsIG9jdGF2ZSl9XCI+PC9saT5cbiAgICAgICAgICAgIDxsaSBjbGFzcz1cImJsYWNrIGNzXCIgZGF0YS1ub3RlPVwiJHt0aGlzLmdldE5vdGVBbmRPY3RhdmUoJ2NzJywgb2N0YXZlKX1cIj48L2xpPlxuICAgICAgICAgICAgPGxpIGNsYXNzPVwid2hpdGUgZFwiIGRhdGEtbm90ZT1cIiR7dGhpcy5nZXROb3RlQW5kT2N0YXZlKCdkJywgb2N0YXZlKX1cIj48L2xpPlxuICAgICAgICAgICAgPGxpIGNsYXNzPVwiYmxhY2sgZHNcIiBkYXRhLW5vdGU9XCIke3RoaXMuZ2V0Tm90ZUFuZE9jdGF2ZSgnZHMnLCBvY3RhdmUpfVwiPjwvbGk+XG4gICAgICAgICAgICA8bGkgY2xhc3M9XCJ3aGl0ZSBlXCIgZGF0YS1ub3RlPVwiJHt0aGlzLmdldE5vdGVBbmRPY3RhdmUoJ2UnLCBvY3RhdmUpfVwiPjwvbGk+XG4gICAgICAgICAgICA8bGkgY2xhc3M9XCJ3aGl0ZSBmXCIgZGF0YS1ub3RlPVwiJHt0aGlzLmdldE5vdGVBbmRPY3RhdmUoJ2YnLCBvY3RhdmUpfVwiPjwvbGk+XG4gICAgICAgICAgICA8bGkgY2xhc3M9XCJibGFjayBmc1wiIGRhdGEtbm90ZT1cIiR7dGhpcy5nZXROb3RlQW5kT2N0YXZlKCdmcycsIG9jdGF2ZSl9XCI+PC9saT5cbiAgICAgICAgICAgIDxsaSBjbGFzcz1cIndoaXRlIGdcIiBkYXRhLW5vdGU9XCIke3RoaXMuZ2V0Tm90ZUFuZE9jdGF2ZSgnZycsIG9jdGF2ZSl9XCI+PC9saT5cbiAgICAgICAgICAgIDxsaSBjbGFzcz1cImJsYWNrIGdzXCIgZGF0YS1ub3RlPVwiJHt0aGlzLmdldE5vdGVBbmRPY3RhdmUoJ2dzJywgb2N0YXZlKX1cIj48L2xpPlxuICAgICAgICAgICAgPGxpIGNsYXNzPVwid2hpdGUgYVwiIGRhdGEtbm90ZT1cIiR7dGhpcy5nZXROb3RlQW5kT2N0YXZlKCdhJywgb2N0YXZlKX1cIj48L2xpPlxuICAgICAgICAgICAgPGxpIGNsYXNzPVwiYmxhY2sgYXNcIiBkYXRhLW5vdGU9XCIke3RoaXMuZ2V0Tm90ZUFuZE9jdGF2ZSgnYXMnLCBvY3RhdmUpfVwiPjwvbGk+XG4gICAgICAgICAgICA8bGkgY2xhc3M9XCJ3aGl0ZSBiXCIgZGF0YS1ub3RlPVwiJHt0aGlzLmdldE5vdGVBbmRPY3RhdmUoJ2InLCBvY3RhdmUpfVwiPjwvbGk+YFxuICAgICAgICAgICAgXG4gICAgICAgIHJldHVybiBvY3RhdmVIVE1MXG4gICAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHBpYW5vO1xuIiwiIWZ1bmN0aW9uKHQsbil7XCJvYmplY3RcIj09dHlwZW9mIGV4cG9ydHMmJlwidW5kZWZpbmVkXCIhPXR5cGVvZiBtb2R1bGU/bihleHBvcnRzKTpcImZ1bmN0aW9uXCI9PXR5cGVvZiBkZWZpbmUmJmRlZmluZS5hbWQ/ZGVmaW5lKFtcImV4cG9ydHNcIl0sbik6bih0Lk5vdGVQYXJzZXI9dC5Ob3RlUGFyc2VyfHx7fSl9KHRoaXMsZnVuY3Rpb24odCl7XCJ1c2Ugc3RyaWN0XCI7ZnVuY3Rpb24gbih0LG4pe3JldHVybiBBcnJheShuKzEpLmpvaW4odCl9ZnVuY3Rpb24gcih0KXtyZXR1cm5cIm51bWJlclwiPT10eXBlb2YgdH1mdW5jdGlvbiBlKHQpe3JldHVyblwic3RyaW5nXCI9PXR5cGVvZiB0fWZ1bmN0aW9uIHUodCl7cmV0dXJuIHZvaWQgMCE9PXR9ZnVuY3Rpb24gYyh0LG4pe3JldHVybiBNYXRoLnBvdygyLCh0LTY5KS8xMikqKG58fDQ0MCl9ZnVuY3Rpb24gbygpe3JldHVybiBifWZ1bmN0aW9uIGkodCxuLHIpe2lmKFwic3RyaW5nXCIhPXR5cGVvZiB0KXJldHVybiBudWxsO3ZhciBlPWIuZXhlYyh0KTtpZighZXx8IW4mJmVbNF0pcmV0dXJuIG51bGw7dmFyIHU9e2xldHRlcjplWzFdLnRvVXBwZXJDYXNlKCksYWNjOmVbMl0ucmVwbGFjZSgveC9nLFwiIyNcIil9O3UucGM9dS5sZXR0ZXIrdS5hY2MsdS5zdGVwPSh1LmxldHRlci5jaGFyQ29kZUF0KDApKzMpJTcsdS5hbHQ9XCJiXCI9PT11LmFjY1swXT8tdS5hY2MubGVuZ3RoOnUuYWNjLmxlbmd0aDt2YXIgbz1BW3Uuc3RlcF0rdS5hbHQ7cmV0dXJuIHUuY2hyb21hPW88MD8xMitvOm8lMTIsZVszXSYmKHUub2N0PStlWzNdLHUubWlkaT1vKzEyKih1Lm9jdCsxKSx1LmZyZXE9Yyh1Lm1pZGkscikpLG4mJih1LnRvbmljT2Y9ZVs0XSksdX1mdW5jdGlvbiBmKHQpe3JldHVybiByKHQpP3Q8MD9uKFwiYlwiLC10KTpuKFwiI1wiLHQpOlwiXCJ9ZnVuY3Rpb24gYSh0KXtyZXR1cm4gcih0KT9cIlwiK3Q6XCJcIn1mdW5jdGlvbiBsKHQsbixyKXtyZXR1cm4gbnVsbD09PXR8fHZvaWQgMD09PXQ/bnVsbDp0LnN0ZXA/bCh0LnN0ZXAsdC5hbHQsdC5vY3QpOnQ8MHx8dD42P251bGw6Qy5jaGFyQXQodCkrZihuKSthKHIpfWZ1bmN0aW9uIHAodCl7aWYoKHIodCl8fGUodCkpJiZ0Pj0wJiZ0PDEyOClyZXR1cm4rdDt2YXIgbj1pKHQpO3JldHVybiBuJiZ1KG4ubWlkaSk/bi5taWRpOm51bGx9ZnVuY3Rpb24gcyh0LG4pe3ZhciByPXAodCk7cmV0dXJuIG51bGw9PT1yP251bGw6YyhyLG4pfWZ1bmN0aW9uIGQodCl7cmV0dXJuKGkodCl8fHt9KS5sZXR0ZXJ9ZnVuY3Rpb24gbSh0KXtyZXR1cm4oaSh0KXx8e30pLmFjY31mdW5jdGlvbiBoKHQpe3JldHVybihpKHQpfHx7fSkucGN9ZnVuY3Rpb24gdih0KXtyZXR1cm4oaSh0KXx8e30pLnN0ZXB9ZnVuY3Rpb24gZyh0KXtyZXR1cm4oaSh0KXx8e30pLmFsdH1mdW5jdGlvbiB4KHQpe3JldHVybihpKHQpfHx7fSkuY2hyb21hfWZ1bmN0aW9uIHkodCl7cmV0dXJuKGkodCl8fHt9KS5vY3R9dmFyIGI9L14oW2EtZ0EtR10pKCN7MSx9fGJ7MSx9fHh7MSx9fCkoLT9cXGQqKVxccyooLiopXFxzKiQvLEE9WzAsMiw0LDUsNyw5LDExXSxDPVwiQ0RFRkdBQlwiO3QucmVnZXg9byx0LnBhcnNlPWksdC5idWlsZD1sLHQubWlkaT1wLHQuZnJlcT1zLHQubGV0dGVyPWQsdC5hY2M9bSx0LnBjPWgsdC5zdGVwPXYsdC5hbHQ9Zyx0LmNocm9tYT14LHQub2N0PXl9KTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPW5vdGUtcGFyc2VyLmpzLm1hcFxuIiwiLy8gU2VlIGUuZy4gaHR0cDovL3d3dy5waHkubXR1LmVkdS9+c3VpdHMvTm90ZUZyZXFDYWxjcy5odG1sXG5mdW5jdGlvbiBub3RlRnJlcXVlbmN5KCkge1xuICAgIFxuICAgIHRoaXMuYmFzZSA9IDQ0MDsgLy8gQVxuICAgIHRoaXMubnVtU3RlcHMgPSAxMjsgLy8gMTJcbiAgICBcbiAgICB0aGlzLmdldFN0ZXBTaXplID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gTWF0aC5wb3coMiwgMS90aGlzLm51bVN0ZXBzKTtcbiAgICB9O1xuICAgIFxuICAgIC8vIFJldHVybiBoeiBvZiB0aGUgc3RlcCwgZS5nLiBmb3IgdGhlIGRlZmF1bHQgc2V0dGluZ3MgdGlocyB5aWVsZHM6XG4gICAgLy8gMCA9IDQ0MCAoQSlcbiAgICAvLyA1ID0gNTg3LjMyOS4uLiAoRClcbiAgICAvLyAtMTIgPSAyMjAgXG4gICAgdGhpcy5nZXRUb25lU3RlcCA9ZnVuY3Rpb24oc3RlcCkge1xuICAgICAgICByZXR1cm4gTWF0aC5wb3codGhpcy5nZXRTdGVwU2l6ZSgpLCBzdGVwKSAqIHRoaXMuYmFzZTtcbiAgICB9OyAgXG59XG5cbm1vZHVsZS5leHBvcnRzID0gbmV3IG5vdGVGcmVxdWVuY3koKTtcbiIsIi8qXG5cbldlYk1pZGkgdjIuMC4wLXJjLjlcblxuV2ViTWlkaS5qcyBoZWxwcyB5b3UgdGFtZSB0aGUgV2ViIE1JREkgQVBJLiBTZW5kIGFuZCByZWNlaXZlIE1JREkgbWVzc2FnZXMgd2l0aCBlYXNlLiBDb250cm9sIGluc3RydW1lbnRzIHdpdGggdXNlci1mcmllbmRseSBmdW5jdGlvbnMgKHBsYXlOb3RlLCBzZW5kUGl0Y2hCZW5kLCBldGMuKS4gUmVhY3QgdG8gTUlESSBpbnB1dCB3aXRoIHNpbXBsZSBldmVudCBsaXN0ZW5lcnMgKG5vdGVvbiwgcGl0Y2hiZW5kLCBjb250cm9sY2hhbmdlLCBldGMuKS5cbmh0dHBzOi8vZ2l0aHViLmNvbS9jb3RlanAvd2VibWlkaVxuXG5cblRoZSBNSVQgTGljZW5zZSAoTUlUKVxuXG5Db3B5cmlnaHQgKGMpIDIwMTUtMjAxNiwgSmVhbi1QaGlsaXBwZSBDw7R0w6lcblxuUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weSBvZiB0aGlzIHNvZnR3YXJlIGFuZFxuYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgXCJTb2Z0d2FyZVwiKSwgdG8gZGVhbCBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbixcbmluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0cyB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsXG5zdWJsaWNlbnNlLCBhbmQvb3Igc2VsbCBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXNcbmZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6XG5cblRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWxcbnBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS5cblxuVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUiBJTVBMSUVELCBJTkNMVURJTkcgQlVUXG5OT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORFxuTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFU1xuT1IgT1RIRVIgTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwgT1VUIE9GIE9SIElOXG5DT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFIFNPRlRXQVJFLlxuXG4qL1xuXG4hZnVuY3Rpb24oc2NvcGUpe1widXNlIHN0cmljdFwiO2Z1bmN0aW9uIFdlYk1pZGkoKXtpZihXZWJNaWRpLnByb3RvdHlwZS5fc2luZ2xldG9uKXRocm93IG5ldyBFcnJvcihcIldlYk1pZGkgaXMgYSBzaW5nbGV0b24sIGl0IGNhbm5vdCBiZSBpbnN0YW50aWF0ZWQgZGlyZWN0bHkuXCIpO1dlYk1pZGkucHJvdG90eXBlLl9zaW5nbGV0b249dGhpcyx0aGlzLl9pbnB1dHM9W10sdGhpcy5fb3V0cHV0cz1bXSx0aGlzLl91c2VySGFuZGxlcnM9e30sdGhpcy5fc3RhdGVDaGFuZ2VRdWV1ZT1bXSx0aGlzLl9wcm9jZXNzaW5nU3RhdGVDaGFuZ2U9ITEsdGhpcy5fbWlkaUludGVyZmFjZUV2ZW50cz1bXCJjb25uZWN0ZWRcIixcImRpc2Nvbm5lY3RlZFwiXSx0aGlzLl9ub3Rlcz1bXCJDXCIsXCJDI1wiLFwiRFwiLFwiRCNcIixcIkVcIixcIkZcIixcIkYjXCIsXCJHXCIsXCJHI1wiLFwiQVwiLFwiQSNcIixcIkJcIl0sdGhpcy5fc2VtaXRvbmVzPXtDOjAsRDoyLEU6NCxGOjUsRzo3LEE6OSxCOjExfSxPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0aGlzLHtNSURJX1NZU1RFTV9NRVNTQUdFUzp7dmFsdWU6e3N5c2V4OjI0MCx0aW1lY29kZToyNDEsc29uZ3Bvc2l0aW9uOjI0Mixzb25nc2VsZWN0OjI0Myx0dW5pbmdyZXF1ZXN0OjI0NixzeXNleGVuZDoyNDcsY2xvY2s6MjQ4LHN0YXJ0OjI1MCxcImNvbnRpbnVlXCI6MjUxLHN0b3A6MjUyLGFjdGl2ZXNlbnNpbmc6MjU0LHJlc2V0OjI1NSx1bmtub3duc3lzdGVtbWVzc2FnZTotMX0sd3JpdGFibGU6ITEsZW51bWVyYWJsZTohMCxjb25maWd1cmFibGU6ITF9LE1JRElfQ0hBTk5FTF9NRVNTQUdFUzp7dmFsdWU6e25vdGVvZmY6OCxub3Rlb246OSxrZXlhZnRlcnRvdWNoOjEwLGNvbnRyb2xjaGFuZ2U6MTEsY2hhbm5lbG1vZGU6MTEscHJvZ3JhbWNoYW5nZToxMixjaGFubmVsYWZ0ZXJ0b3VjaDoxMyxwaXRjaGJlbmQ6MTR9LHdyaXRhYmxlOiExLGVudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiExfSxNSURJX1JFR0lTVEVSRURfUEFSQU1FVEVSOnt2YWx1ZTp7cGl0Y2hiZW5kcmFuZ2U6WzAsMF0sY2hhbm5lbGZpbmV0dW5pbmc6WzAsMV0sY2hhbm5lbGNvYXJzZXR1bmluZzpbMCwyXSx0dW5pbmdwcm9ncmFtOlswLDNdLHR1bmluZ2Jhbms6WzAsNF0sbW9kdWxhdGlvbnJhbmdlOlswLDVdLGF6aW11dGhhbmdsZTpbNjEsMF0sZWxldmF0aW9uYW5nbGU6WzYxLDFdLGdhaW46WzYxLDJdLGRpc3RhbmNlcmF0aW86WzYxLDNdLG1heGltdW1kaXN0YW5jZTpbNjEsNF0sbWF4aW11bWRpc3RhbmNlZ2FpbjpbNjEsNV0scmVmZXJlbmNlZGlzdGFuY2VyYXRpbzpbNjEsNl0scGFuc3ByZWFkYW5nbGU6WzYxLDddLHJvbGxhbmdsZTpbNjEsOF19LHdyaXRhYmxlOiExLGVudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiExfSxNSURJX0NPTlRST0xfQ0hBTkdFX01FU1NBR0VTOnt2YWx1ZTp7YmFua3NlbGVjdGNvYXJzZTowLG1vZHVsYXRpb253aGVlbGNvYXJzZToxLGJyZWF0aGNvbnRyb2xsZXJjb2Fyc2U6Mixmb290Y29udHJvbGxlcmNvYXJzZTo0LHBvcnRhbWVudG90aW1lY29hcnNlOjUsZGF0YWVudHJ5Y29hcnNlOjYsdm9sdW1lY29hcnNlOjcsYmFsYW5jZWNvYXJzZTo4LHBhbmNvYXJzZToxMCxleHByZXNzaW9uY29hcnNlOjExLGVmZmVjdGNvbnRyb2wxY29hcnNlOjEyLGVmZmVjdGNvbnRyb2wyY29hcnNlOjEzLGdlbmVyYWxwdXJwb3Nlc2xpZGVyMToxNixnZW5lcmFscHVycG9zZXNsaWRlcjI6MTcsZ2VuZXJhbHB1cnBvc2VzbGlkZXIzOjE4LGdlbmVyYWxwdXJwb3Nlc2xpZGVyNDoxOSxiYW5rc2VsZWN0ZmluZTozMixtb2R1bGF0aW9ud2hlZWxmaW5lOjMzLGJyZWF0aGNvbnRyb2xsZXJmaW5lOjM0LGZvb3Rjb250cm9sbGVyZmluZTozNixwb3J0YW1lbnRvdGltZWZpbmU6MzcsZGF0YWVudHJ5ZmluZTozOCx2b2x1bWVmaW5lOjM5LGJhbGFuY2VmaW5lOjQwLHBhbmZpbmU6NDIsZXhwcmVzc2lvbmZpbmU6NDMsZWZmZWN0Y29udHJvbDFmaW5lOjQ0LGVmZmVjdGNvbnRyb2wyZmluZTo0NSxob2xkcGVkYWw6NjQscG9ydGFtZW50bzo2NSxzdXN0ZW51dG9wZWRhbDo2Nixzb2Z0cGVkYWw6NjcsbGVnYXRvcGVkYWw6NjgsaG9sZDJwZWRhbDo2OSxzb3VuZHZhcmlhdGlvbjo3MCxyZXNvbmFuY2U6NzEsc291bmRyZWxlYXNldGltZTo3Mixzb3VuZGF0dGFja3RpbWU6NzMsYnJpZ2h0bmVzczo3NCxzb3VuZGNvbnRyb2w2Ojc1LHNvdW5kY29udHJvbDc6NzYsc291bmRjb250cm9sODo3Nyxzb3VuZGNvbnRyb2w5Ojc4LHNvdW5kY29udHJvbDEwOjc5LGdlbmVyYWxwdXJwb3NlYnV0dG9uMTo4MCxnZW5lcmFscHVycG9zZWJ1dHRvbjI6ODEsZ2VuZXJhbHB1cnBvc2VidXR0b24zOjgyLGdlbmVyYWxwdXJwb3NlYnV0dG9uNDo4MyxyZXZlcmJsZXZlbDo5MSx0cmVtb2xvbGV2ZWw6OTIsY2hvcnVzbGV2ZWw6OTMsY2VsZXN0ZWxldmVsOjk0LHBoYXNlcmxldmVsOjk1LGRhdGFidXR0b25pbmNyZW1lbnQ6OTYsZGF0YWJ1dHRvbmRlY3JlbWVudDo5Nyxub25yZWdpc3RlcmVkcGFyYW1ldGVyY29hcnNlOjk4LG5vbnJlZ2lzdGVyZWRwYXJhbWV0ZXJmaW5lOjk5LHJlZ2lzdGVyZWRwYXJhbWV0ZXJjb2Fyc2U6MTAwLHJlZ2lzdGVyZWRwYXJhbWV0ZXJmaW5lOjEwMX0sd3JpdGFibGU6ITEsZW51bWVyYWJsZTohMCxjb25maWd1cmFibGU6ITF9LE1JRElfQ0hBTk5FTF9NT0RFX01FU1NBR0VTOnt2YWx1ZTp7YWxsc291bmRvZmY6MTIwLHJlc2V0YWxsY29udHJvbGxlcnM6MTIxLGxvY2FsY29udHJvbDoxMjIsYWxsbm90ZXNvZmY6MTIzLG9tbmltb2Rlb2ZmOjEyNCxvbW5pbW9kZW9uOjEyNSxtb25vbW9kZW9uOjEyNixwb2x5bW9kZW9uOjEyN30sd3JpdGFibGU6ITEsZW51bWVyYWJsZTohMCxjb25maWd1cmFibGU6ITF9fSksT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGhpcyx7c3VwcG9ydGVkOntlbnVtZXJhYmxlOiEwLGdldDpmdW5jdGlvbigpe3JldHVyblwicmVxdWVzdE1JRElBY2Nlc3NcImluIG5hdmlnYXRvcn19LGVuYWJsZWQ6e2VudW1lcmFibGU6ITAsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHZvaWQgMCE9PXRoaXNbXCJpbnRlcmZhY2VcIl19LmJpbmQodGhpcyl9LGlucHV0czp7ZW51bWVyYWJsZTohMCxnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5faW5wdXRzfS5iaW5kKHRoaXMpfSxvdXRwdXRzOntlbnVtZXJhYmxlOiEwLGdldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9vdXRwdXRzfS5iaW5kKHRoaXMpfSxzeXNleEVuYWJsZWQ6e2VudW1lcmFibGU6ITAsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuISghdGhpc1tcImludGVyZmFjZVwiXXx8IXRoaXNbXCJpbnRlcmZhY2VcIl0uc3lzZXhFbmFibGVkKX0uYmluZCh0aGlzKX0sdGltZTp7ZW51bWVyYWJsZTohMCxnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gcGVyZm9ybWFuY2Uubm93KCl9fX0pfWZ1bmN0aW9uIElucHV0KG1pZGlJbnB1dCl7dmFyIHRoYXQ9dGhpczt0aGlzLl91c2VySGFuZGxlcnM9e2NoYW5uZWw6e30sc3lzdGVtOnt9fSx0aGlzLl9taWRpSW5wdXQ9bWlkaUlucHV0LE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRoaXMse2Nvbm5lY3Rpb246e2VudW1lcmFibGU6ITAsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoYXQuX21pZGlJbnB1dC5jb25uZWN0aW9ufX0saWQ6e2VudW1lcmFibGU6ITAsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoYXQuX21pZGlJbnB1dC5pZH19LG1hbnVmYWN0dXJlcjp7ZW51bWVyYWJsZTohMCxnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhhdC5fbWlkaUlucHV0Lm1hbnVmYWN0dXJlcn19LG5hbWU6e2VudW1lcmFibGU6ITAsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoYXQuX21pZGlJbnB1dC5uYW1lfX0sc3RhdGU6e2VudW1lcmFibGU6ITAsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoYXQuX21pZGlJbnB1dC5zdGF0ZX19fSksdGhpcy5faW5pdGlhbGl6ZVVzZXJIYW5kbGVycygpfWZ1bmN0aW9uIE91dHB1dChtaWRpT3V0cHV0KXt2YXIgdGhhdD10aGlzO3RoaXMuX21pZGlPdXRwdXQ9bWlkaU91dHB1dCxPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0aGlzLHtjb25uZWN0aW9uOntlbnVtZXJhYmxlOiEwLGdldDpmdW5jdGlvbigpe3JldHVybiB0aGF0Ll9taWRpT3V0cHV0LmNvbm5lY3Rpb259fSxpZDp7ZW51bWVyYWJsZTohMCxnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhhdC5fbWlkaU91dHB1dC5pZH19LG1hbnVmYWN0dXJlcjp7ZW51bWVyYWJsZTohMCxnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhhdC5fbWlkaU91dHB1dC5tYW51ZmFjdHVyZXJ9fSxuYW1lOntlbnVtZXJhYmxlOiEwLGdldDpmdW5jdGlvbigpe3JldHVybiB0aGF0Ll9taWRpT3V0cHV0Lm5hbWV9fSxzdGF0ZTp7ZW51bWVyYWJsZTohMCxnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhhdC5fbWlkaU91dHB1dC5zdGF0ZX19fSl9dmFyIHdtPW5ldyBXZWJNaWRpO1dlYk1pZGkucHJvdG90eXBlLmVuYWJsZT1mdW5jdGlvbihjYWxsYmFjayxzeXNleCl7cmV0dXJuIHRoaXMuZW5hYmxlZD92b2lkIDA6dGhpcy5zdXBwb3J0ZWQ/dm9pZCBuYXZpZ2F0b3IucmVxdWVzdE1JRElBY2Nlc3Moe3N5c2V4OnN5c2V4fSkudGhlbihmdW5jdGlvbihtaWRpQWNjZXNzKXt0aGlzW1wiaW50ZXJmYWNlXCJdPW1pZGlBY2Nlc3MsdGhpcy5fcmVzZXRJbnRlcmZhY2VVc2VySGFuZGxlcnMoKSx0aGlzW1wiaW50ZXJmYWNlXCJdLm9uc3RhdGVjaGFuZ2U9dGhpcy5fb25JbnRlcmZhY2VTdGF0ZUNoYW5nZS5iaW5kKHRoaXMpLHRoaXMuX29uSW50ZXJmYWNlU3RhdGVDaGFuZ2UobnVsbCksXCJmdW5jdGlvblwiPT10eXBlb2YgY2FsbGJhY2smJmNhbGxiYWNrLmNhbGwodGhpcyl9LmJpbmQodGhpcyksZnVuY3Rpb24oZXJyKXtcImZ1bmN0aW9uXCI9PXR5cGVvZiBjYWxsYmFjayYmY2FsbGJhY2suY2FsbCh0aGlzLGVycil9LmJpbmQodGhpcykpOnZvaWQoXCJmdW5jdGlvblwiPT10eXBlb2YgY2FsbGJhY2smJmNhbGxiYWNrKG5ldyBFcnJvcihcIlRoZSBXZWIgTUlESSBBUEkgaXMgbm90IHN1cHBvcnRlZCBieSB5b3VyIGJyb3dzZXIuXCIpKSl9LFdlYk1pZGkucHJvdG90eXBlLmRpc2FibGU9ZnVuY3Rpb24oKXtpZighdGhpcy5zdXBwb3J0ZWQpdGhyb3cgbmV3IEVycm9yKFwiVGhlIFdlYiBNSURJIEFQSSBpcyBub3Qgc3VwcG9ydGVkIGJ5IHlvdXIgYnJvd3Nlci5cIik7dGhpc1tcImludGVyZmFjZVwiXS5vbnN0YXRlY2hhbmdlPXZvaWQgMCx0aGlzW1wiaW50ZXJmYWNlXCJdPXZvaWQgMCx0aGlzLl9pbnB1dHM9W10sdGhpcy5fb3V0cHV0cz1bXSx0aGlzLl9yZXNldEludGVyZmFjZVVzZXJIYW5kbGVycygpfSxXZWJNaWRpLnByb3RvdHlwZS5hZGRMaXN0ZW5lcj1mdW5jdGlvbih0eXBlLGxpc3RlbmVyKXtpZighdGhpcy5lbmFibGVkKXRocm93IG5ldyBFcnJvcihcIldlYk1pZGkgbXVzdCBiZSBlbmFibGVkIGJlZm9yZSBhZGRpbmcgZXZlbnQgbGlzdGVuZXJzLlwiKTtpZihcImZ1bmN0aW9uXCIhPXR5cGVvZiBsaXN0ZW5lcil0aHJvdyBuZXcgVHlwZUVycm9yKFwiVGhlICdsaXN0ZW5lcicgcGFyYW1ldGVyIG11c3QgYmUgYSBmdW5jdGlvbi5cIik7aWYoISh0aGlzLl9taWRpSW50ZXJmYWNlRXZlbnRzLmluZGV4T2YodHlwZSk+PTApKXRocm93IG5ldyBUeXBlRXJyb3IoXCJUaGUgc3BlY2lmaWVkIGV2ZW50IHR5cGUgaXMgbm90IHN1cHBvcnRlZC5cIik7cmV0dXJuIHRoaXMuX3VzZXJIYW5kbGVyc1t0eXBlXS5wdXNoKGxpc3RlbmVyKSx0aGlzfSxXZWJNaWRpLnByb3RvdHlwZS5oYXNMaXN0ZW5lcj1mdW5jdGlvbih0eXBlLGxpc3RlbmVyKXtpZighdGhpcy5lbmFibGVkKXRocm93IG5ldyBFcnJvcihcIldlYk1pZGkgbXVzdCBiZSBlbmFibGVkIGJlZm9yZSBjaGVja2luZyBldmVudCBsaXN0ZW5lcnMuXCIpO2lmKFwiZnVuY3Rpb25cIiE9dHlwZW9mIGxpc3RlbmVyKXRocm93IG5ldyBUeXBlRXJyb3IoXCJUaGUgJ2xpc3RlbmVyJyBwYXJhbWV0ZXIgbXVzdCBiZSBhIGZ1bmN0aW9uLlwiKTtpZighKHRoaXMuX21pZGlJbnRlcmZhY2VFdmVudHMuaW5kZXhPZih0eXBlKT49MCkpdGhyb3cgbmV3IFR5cGVFcnJvcihcIlRoZSBzcGVjaWZpZWQgZXZlbnQgdHlwZSBpcyBub3Qgc3VwcG9ydGVkLlwiKTtmb3IodmFyIG89MDtvPHRoaXMuX3VzZXJIYW5kbGVyc1t0eXBlXS5sZW5ndGg7bysrKWlmKHRoaXMuX3VzZXJIYW5kbGVyc1t0eXBlXVtvXT09PWxpc3RlbmVyKXJldHVybiEwO3JldHVybiExfSxXZWJNaWRpLnByb3RvdHlwZS5yZW1vdmVMaXN0ZW5lcj1mdW5jdGlvbih0eXBlLGxpc3RlbmVyKXtpZighdGhpcy5lbmFibGVkKXRocm93IG5ldyBFcnJvcihcIldlYk1pZGkgbXVzdCBiZSBlbmFibGVkIGJlZm9yZSByZW1vdmluZyBldmVudCBsaXN0ZW5lcnMuXCIpO2lmKHZvaWQgMCE9PWxpc3RlbmVyJiZcImZ1bmN0aW9uXCIhPXR5cGVvZiBsaXN0ZW5lcil0aHJvdyBuZXcgVHlwZUVycm9yKFwiVGhlICdsaXN0ZW5lcicgcGFyYW1ldGVyIG11c3QgYmUgYSBmdW5jdGlvbi5cIik7aWYodGhpcy5fbWlkaUludGVyZmFjZUV2ZW50cy5pbmRleE9mKHR5cGUpPj0wKWlmKGxpc3RlbmVyKWZvcih2YXIgbz0wO288dGhpcy5fdXNlckhhbmRsZXJzW3R5cGVdLmxlbmd0aDtvKyspdGhpcy5fdXNlckhhbmRsZXJzW3R5cGVdW29dPT09bGlzdGVuZXImJnRoaXMuX3VzZXJIYW5kbGVyc1t0eXBlXS5zcGxpY2UobywxKTtlbHNlIHRoaXMuX3VzZXJIYW5kbGVyc1t0eXBlXT1bXTtlbHNle2lmKHZvaWQgMCE9PXR5cGUpdGhyb3cgbmV3IFR5cGVFcnJvcihcIlRoZSBzcGVjaWZpZWQgZXZlbnQgdHlwZSBpcyBub3Qgc3VwcG9ydGVkLlwiKTt0aGlzLl9yZXNldEludGVyZmFjZVVzZXJIYW5kbGVycygpfXJldHVybiB0aGlzfSxXZWJNaWRpLnByb3RvdHlwZS5nZXRJbnB1dEJ5SWQ9ZnVuY3Rpb24oaWQpe2lmKCF0aGlzLmVuYWJsZWQpdGhyb3cgbmV3IEVycm9yKFwiV2ViTWlkaSBpcyBub3QgZW5hYmxlZC5cIik7Zm9yKHZhciBpPTA7aTx0aGlzLmlucHV0cy5sZW5ndGg7aSsrKWlmKHRoaXMuaW5wdXRzW2ldLmlkPT09aWQpcmV0dXJuIHRoaXMuaW5wdXRzW2ldO3JldHVybiExfSxXZWJNaWRpLnByb3RvdHlwZS5nZXRPdXRwdXRCeUlkPWZ1bmN0aW9uKGlkKXtpZighdGhpcy5lbmFibGVkKXRocm93IG5ldyBFcnJvcihcIldlYk1pZGkgaXMgbm90IGVuYWJsZWQuXCIpO2Zvcih2YXIgaT0wO2k8dGhpcy5vdXRwdXRzLmxlbmd0aDtpKyspaWYodGhpcy5vdXRwdXRzW2ldLmlkPT09aWQpcmV0dXJuIHRoaXMub3V0cHV0c1tpXTtyZXR1cm4hMX0sV2ViTWlkaS5wcm90b3R5cGUuZ2V0SW5wdXRCeU5hbWU9ZnVuY3Rpb24obmFtZSl7aWYoIXRoaXMuZW5hYmxlZCl0aHJvdyBuZXcgRXJyb3IoXCJXZWJNaWRpIGlzIG5vdCBlbmFibGVkLlwiKTtmb3IodmFyIGk9MDtpPHRoaXMuaW5wdXRzLmxlbmd0aDtpKyspaWYofnRoaXMuaW5wdXRzW2ldLm5hbWUuaW5kZXhPZihuYW1lKSlyZXR1cm4gdGhpcy5pbnB1dHNbaV07cmV0dXJuITF9LFdlYk1pZGkucHJvdG90eXBlLmdldE9jdGF2ZT1mdW5jdGlvbihudW1iZXIpe3JldHVybiBudW1iZXI+PTAmJjEyNz49bnVtYmVyP01hdGguZmxvb3IocGFyc2VJbnQobnVtYmVyKS8xMi0xKS0xOnZvaWQgMH0sV2ViTWlkaS5wcm90b3R5cGUuZ2V0T3V0cHV0QnlOYW1lPWZ1bmN0aW9uKG5hbWUpe2lmKCF0aGlzLmVuYWJsZWQpdGhyb3cgbmV3IEVycm9yKFwiV2ViTWlkaSBpcyBub3QgZW5hYmxlZC5cIik7Zm9yKHZhciBpPTA7aTx0aGlzLm91dHB1dHMubGVuZ3RoO2krKylpZih+dGhpcy5vdXRwdXRzW2ldLm5hbWUuaW5kZXhPZihuYW1lKSlyZXR1cm4gdGhpcy5vdXRwdXRzW2ldO3JldHVybiExfSxXZWJNaWRpLnByb3RvdHlwZS5ndWVzc05vdGVOdW1iZXI9ZnVuY3Rpb24oaW5wdXQpe3ZhciBvdXRwdXQ9ITE7aWYoaW5wdXQmJmlucHV0LnRvRml4ZWQmJmlucHV0Pj0wJiYxMjc+PWlucHV0P291dHB1dD1NYXRoLnJvdW5kKGlucHV0KTpwYXJzZUludChpbnB1dCk+PTAmJnBhcnNlSW50KGlucHV0KTw9MTI3P291dHB1dD1wYXJzZUludChpbnB1dCk6KFwic3RyaW5nXCI9PXR5cGVvZiBpbnB1dHx8aW5wdXQgaW5zdGFuY2VvZiBTdHJpbmcpJiYob3V0cHV0PXRoaXMubm90ZU5hbWVUb051bWJlcihpbnB1dCkpLG91dHB1dD09PSExKXRocm93IG5ldyBFcnJvcihcIkludmFsaWQgbm90ZSBudW1iZXIgKFwiK2lucHV0K1wiKS5cIik7cmV0dXJuIG91dHB1dH0sV2ViTWlkaS5wcm90b3R5cGUubm90ZU5hbWVUb051bWJlcj1mdW5jdGlvbihuYW1lKXtcInN0cmluZ1wiIT10eXBlb2YgbmFtZSYmKG5hbWU9XCJcIik7dmFyIG1hdGNoZXM9bmFtZS5tYXRjaCgvKFtDREVGR0FCXSkoI3swLDJ9fGJ7MCwyfSkoLT9cXGQrKS9pKTtpZighbWF0Y2hlcyl0aHJvdyBuZXcgUmFuZ2VFcnJvcihcIkludmFsaWQgbm90ZSBuYW1lLlwiKTt2YXIgc2VtaXRvbmVzPXdtLl9zZW1pdG9uZXNbbWF0Y2hlc1sxXS50b1VwcGVyQ2FzZSgpXSxvY3RhdmU9cGFyc2VJbnQobWF0Y2hlc1szXSkscmVzdWx0PTEyKihvY3RhdmUrMikrc2VtaXRvbmVzO2lmKG1hdGNoZXNbMl0udG9Mb3dlckNhc2UoKS5pbmRleE9mKFwiYlwiKT4tMT9yZXN1bHQtPW1hdGNoZXNbMl0ubGVuZ3RoOm1hdGNoZXNbMl0udG9Mb3dlckNhc2UoKS5pbmRleE9mKFwiI1wiKT4tMSYmKHJlc3VsdCs9bWF0Y2hlc1syXS5sZW5ndGgpLDA+c2VtaXRvbmVzfHwtMj5vY3RhdmV8fG9jdGF2ZT44fHwwPnJlc3VsdHx8cmVzdWx0PjEyNyl0aHJvdyBuZXcgUmFuZ2VFcnJvcihcIkludmFsaWQgbm90ZSBuYW1lIG9yIG5vdGUgb3V0c2lkZSB2YWxpZCByYW5nZS5cIik7cmV0dXJuIHJlc3VsdH0sV2ViTWlkaS5wcm90b3R5cGUuX3VwZGF0ZUlucHV0c0FuZE91dHB1dHM9ZnVuY3Rpb24oKXt0aGlzLl91cGRhdGVJbnB1dHMoKSx0aGlzLl91cGRhdGVPdXRwdXRzKCl9LFdlYk1pZGkucHJvdG90eXBlLl91cGRhdGVJbnB1dHM9ZnVuY3Rpb24oKXtmb3IodmFyIGk9MDtpPHRoaXMuX2lucHV0cy5sZW5ndGg7aSsrKXtmb3IodmFyIHJlbW92ZT0hMCx1cGRhdGVkPXRoaXNbXCJpbnRlcmZhY2VcIl0uaW5wdXRzLnZhbHVlcygpLGlucHV0PXVwZGF0ZWQubmV4dCgpO2lucHV0JiYhaW5wdXQuZG9uZTtpbnB1dD11cGRhdGVkLm5leHQoKSlpZih0aGlzLl9pbnB1dHNbaV0uX21pZGlJbnB1dD09PWlucHV0LnZhbHVlKXtyZW1vdmU9ITE7YnJlYWt9cmVtb3ZlJiZ0aGlzLl9pbnB1dHMuc3BsaWNlKGksMSl9dGhpc1tcImludGVyZmFjZVwiXS5pbnB1dHMuZm9yRWFjaChmdW5jdGlvbihuSW5wdXQpe2Zvcih2YXIgYWRkPSEwLGo9MDtqPHRoaXMuX2lucHV0cy5sZW5ndGg7aisrKXRoaXMuX2lucHV0c1tqXS5fbWlkaUlucHV0PT09bklucHV0JiYoYWRkPSExKTthZGQmJnRoaXMuX2lucHV0cy5wdXNoKHRoaXMuX2NyZWF0ZUlucHV0KG5JbnB1dCkpfS5iaW5kKHRoaXMpKX0sV2ViTWlkaS5wcm90b3R5cGUuX3VwZGF0ZU91dHB1dHM9ZnVuY3Rpb24oKXtmb3IodmFyIGk9MDtpPHRoaXMuX291dHB1dHMubGVuZ3RoO2krKyl7Zm9yKHZhciByZW1vdmU9ITAsdXBkYXRlZD10aGlzW1wiaW50ZXJmYWNlXCJdLm91dHB1dHMudmFsdWVzKCksb3V0cHV0PXVwZGF0ZWQubmV4dCgpO291dHB1dCYmIW91dHB1dC5kb25lO291dHB1dD11cGRhdGVkLm5leHQoKSlpZih0aGlzLl9vdXRwdXRzW2ldLl9taWRpT3V0cHV0PT09b3V0cHV0LnZhbHVlKXtyZW1vdmU9ITE7YnJlYWt9cmVtb3ZlJiZ0aGlzLl9vdXRwdXRzLnNwbGljZShpLDEpfXRoaXNbXCJpbnRlcmZhY2VcIl0ub3V0cHV0cy5mb3JFYWNoKGZ1bmN0aW9uKG5PdXRwdXQpe2Zvcih2YXIgYWRkPSEwLGo9MDtqPHRoaXMuX291dHB1dHMubGVuZ3RoO2orKyl0aGlzLl9vdXRwdXRzW2pdLl9taWRpT3V0cHV0PT09bk91dHB1dCYmKGFkZD0hMSk7YWRkJiZ0aGlzLl9vdXRwdXRzLnB1c2godGhpcy5fY3JlYXRlT3V0cHV0KG5PdXRwdXQpKX0uYmluZCh0aGlzKSl9LFdlYk1pZGkucHJvdG90eXBlLl9jcmVhdGVJbnB1dD1mdW5jdGlvbihtaWRpSW5wdXQpe3ZhciBpbnB1dD1uZXcgSW5wdXQobWlkaUlucHV0KTtyZXR1cm4gaW5wdXQuX21pZGlJbnB1dC5vbm1pZGltZXNzYWdlPWlucHV0Ll9vbk1pZGlNZXNzYWdlLmJpbmQoaW5wdXQpLGlucHV0fSxXZWJNaWRpLnByb3RvdHlwZS5fY3JlYXRlT3V0cHV0PWZ1bmN0aW9uKG1pZGlPdXRwdXQpe3ZhciBvdXRwdXQ9bmV3IE91dHB1dChtaWRpT3V0cHV0KTtyZXR1cm4gb3V0cHV0Ll9taWRpT3V0cHV0Lm9ubWlkaW1lc3NhZ2U9b3V0cHV0Ll9vbk1pZGlNZXNzYWdlLmJpbmQob3V0cHV0KSxvdXRwdXR9LFdlYk1pZGkucHJvdG90eXBlLl9vbkludGVyZmFjZVN0YXRlQ2hhbmdlPWZ1bmN0aW9uKGUpe2lmKHRoaXMuX3N0YXRlQ2hhbmdlUXVldWUucHVzaChlKSwhdGhpcy5fcHJvY2Vzc2luZ1N0YXRlQ2hhbmdlKXtmb3IodGhpcy5fcHJvY2Vzc2luZ1N0YXRlQ2hhbmdlPSEwO3RoaXMuX3N0YXRlQ2hhbmdlUXVldWUubGVuZ3RoPjA7KXRoaXMuX3Byb2Nlc3NTdGF0ZUNoYW5nZSh0aGlzLl9zdGF0ZUNoYW5nZVF1ZXVlLnNoaWZ0KCkpO3RoaXMuX3Byb2Nlc3NpbmdTdGF0ZUNoYW5nZT0hMX19LFdlYk1pZGkucHJvdG90eXBlLl9wcm9jZXNzU3RhdGVDaGFuZ2U9ZnVuY3Rpb24oZSl7aWYodGhpcy5fdXBkYXRlSW5wdXRzQW5kT3V0cHV0cygpLG51bGwhPT1lKXt2YXIgZXZlbnQ9e3RpbWVzdGFtcDplLnRpbWVTdGFtcCx0eXBlOmUucG9ydC5zdGF0ZSxpZDplLnBvcnQuaWQsbWFudWZhY3R1cmVyOmUucG9ydC5tYW51ZmFjdHVyZXIsbmFtZTplLnBvcnQubmFtZX07XCJjb25uZWN0ZWRcIj09PWUucG9ydC5zdGF0ZSYmKFwib3V0cHV0XCI9PT1lLnBvcnQudHlwZT9ldmVudC5vdXRwdXQ9dGhpcy5nZXRPdXRwdXRCeUlkKGUucG9ydC5pZCk6XCJpbnB1dFwiPT09ZS5wb3J0LnR5cGUmJihldmVudC5pbnB1dD10aGlzLmdldElucHV0QnlJZChlLnBvcnQuaWQpKSksdGhpcy5fdXNlckhhbmRsZXJzW2UucG9ydC5zdGF0ZV0uZm9yRWFjaChmdW5jdGlvbihoYW5kbGVyKXtoYW5kbGVyKGV2ZW50KX0pfX0sV2ViTWlkaS5wcm90b3R5cGUuX3Jlc2V0SW50ZXJmYWNlVXNlckhhbmRsZXJzPWZ1bmN0aW9uKCl7Zm9yKHZhciBpPTA7aTx0aGlzLl9taWRpSW50ZXJmYWNlRXZlbnRzLmxlbmd0aDtpKyspdGhpcy5fdXNlckhhbmRsZXJzW3RoaXMuX21pZGlJbnRlcmZhY2VFdmVudHNbaV1dPVtdfSxJbnB1dC5wcm90b3R5cGUuYWRkTGlzdGVuZXI9ZnVuY3Rpb24odHlwZSxjaGFubmVsLGxpc3RlbmVyKXt2YXIgdGhhdD10aGlzO2lmKHZvaWQgMD09PWNoYW5uZWwmJihjaGFubmVsPVwiYWxsXCIpLEFycmF5LmlzQXJyYXkoY2hhbm5lbCl8fChjaGFubmVsPVtjaGFubmVsXSksY2hhbm5lbC5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pe2lmKFwiYWxsXCIhPT1pdGVtJiYhKGl0ZW0+PTEmJjE2Pj1pdGVtKSl0aHJvdyBuZXcgUmFuZ2VFcnJvcihcIlRoZSAnY2hhbm5lbCcgcGFyYW1ldGVyIGlzIGludmFsaWQuXCIpfSksXCJmdW5jdGlvblwiIT10eXBlb2YgbGlzdGVuZXIpdGhyb3cgbmV3IFR5cGVFcnJvcihcIlRoZSAnbGlzdGVuZXInIHBhcmFtZXRlciBtdXN0IGJlIGEgZnVuY3Rpb24uXCIpO2lmKHdtLk1JRElfU1lTVEVNX01FU1NBR0VTW3R5cGVdKXRoaXMuX3VzZXJIYW5kbGVycy5zeXN0ZW1bdHlwZV18fCh0aGlzLl91c2VySGFuZGxlcnMuc3lzdGVtW3R5cGVdPVtdKSx0aGlzLl91c2VySGFuZGxlcnMuc3lzdGVtW3R5cGVdLnB1c2gobGlzdGVuZXIpO2Vsc2V7aWYoIXdtLk1JRElfQ0hBTk5FTF9NRVNTQUdFU1t0eXBlXSl0aHJvdyBuZXcgVHlwZUVycm9yKFwiVGhlIHNwZWNpZmllZCBldmVudCB0eXBlIGlzIG5vdCBzdXBwb3J0ZWQuXCIpO2lmKGNoYW5uZWwuaW5kZXhPZihcImFsbFwiKT4tMSl7Y2hhbm5lbD1bXTtmb3IodmFyIGo9MTsxNj49ajtqKyspY2hhbm5lbC5wdXNoKGopfXRoaXMuX3VzZXJIYW5kbGVycy5jaGFubmVsW3R5cGVdfHwodGhpcy5fdXNlckhhbmRsZXJzLmNoYW5uZWxbdHlwZV09W10pLGNoYW5uZWwuZm9yRWFjaChmdW5jdGlvbihjaCl7dGhhdC5fdXNlckhhbmRsZXJzLmNoYW5uZWxbdHlwZV1bY2hdfHwodGhhdC5fdXNlckhhbmRsZXJzLmNoYW5uZWxbdHlwZV1bY2hdPVtdKSx0aGF0Ll91c2VySGFuZGxlcnMuY2hhbm5lbFt0eXBlXVtjaF0ucHVzaChsaXN0ZW5lcil9KX1yZXR1cm4gdGhpc30sSW5wdXQucHJvdG90eXBlLm9uPUlucHV0LnByb3RvdHlwZS5hZGRMaXN0ZW5lcixJbnB1dC5wcm90b3R5cGUuaGFzTGlzdGVuZXI9ZnVuY3Rpb24odHlwZSxjaGFubmVsLGxpc3RlbmVyKXt2YXIgdGhhdD10aGlzO2lmKFwiZnVuY3Rpb25cIiE9dHlwZW9mIGxpc3RlbmVyKXRocm93IG5ldyBUeXBlRXJyb3IoXCJUaGUgJ2xpc3RlbmVyJyBwYXJhbWV0ZXIgbXVzdCBiZSBhIGZ1bmN0aW9uLlwiKTtpZih2b2lkIDA9PT1jaGFubmVsJiYoY2hhbm5lbD1cImFsbFwiKSxjaGFubmVsLmNvbnN0cnVjdG9yIT09QXJyYXkmJihjaGFubmVsPVtjaGFubmVsXSksd20uTUlESV9TWVNURU1fTUVTU0FHRVNbdHlwZV0pe2Zvcih2YXIgbz0wO288dGhpcy5fdXNlckhhbmRsZXJzLnN5c3RlbVt0eXBlXS5sZW5ndGg7bysrKWlmKHRoaXMuX3VzZXJIYW5kbGVycy5zeXN0ZW1bdHlwZV1bb109PT1saXN0ZW5lcilyZXR1cm4hMH1lbHNlIGlmKHdtLk1JRElfQ0hBTk5FTF9NRVNTQUdFU1t0eXBlXSl7aWYoY2hhbm5lbC5pbmRleE9mKFwiYWxsXCIpPi0xKXtjaGFubmVsPVtdO2Zvcih2YXIgaj0xOzE2Pj1qO2orKyljaGFubmVsLnB1c2goail9cmV0dXJuIHRoaXMuX3VzZXJIYW5kbGVycy5jaGFubmVsW3R5cGVdP2NoYW5uZWwuZXZlcnkoZnVuY3Rpb24oY2hOdW0pe3ZhciBsaXN0ZW5lcnM9dGhhdC5fdXNlckhhbmRsZXJzLmNoYW5uZWxbdHlwZV1bY2hOdW1dO3JldHVybiBsaXN0ZW5lcnMmJmxpc3RlbmVycy5pbmRleE9mKGxpc3RlbmVyKT4tMX0pOiExfXJldHVybiExfSxJbnB1dC5wcm90b3R5cGUucmVtb3ZlTGlzdGVuZXI9ZnVuY3Rpb24odHlwZSxjaGFubmVsLGxpc3RlbmVyKXt2YXIgdGhhdD10aGlzO2lmKHZvaWQgMCE9PWxpc3RlbmVyJiZcImZ1bmN0aW9uXCIhPXR5cGVvZiBsaXN0ZW5lcil0aHJvdyBuZXcgVHlwZUVycm9yKFwiVGhlICdsaXN0ZW5lcicgcGFyYW1ldGVyIG11c3QgYmUgYSBmdW5jdGlvbi5cIik7aWYodm9pZCAwPT09Y2hhbm5lbCYmKGNoYW5uZWw9XCJhbGxcIiksY2hhbm5lbC5jb25zdHJ1Y3RvciE9PUFycmF5JiYoY2hhbm5lbD1bY2hhbm5lbF0pLHdtLk1JRElfU1lTVEVNX01FU1NBR0VTW3R5cGVdKWlmKHZvaWQgMD09PWxpc3RlbmVyKXRoaXMuX3VzZXJIYW5kbGVycy5zeXN0ZW1bdHlwZV09W107ZWxzZSBmb3IodmFyIG89MDtvPHRoaXMuX3VzZXJIYW5kbGVycy5zeXN0ZW1bdHlwZV0ubGVuZ3RoO28rKyl0aGlzLl91c2VySGFuZGxlcnMuc3lzdGVtW3R5cGVdW29dPT09bGlzdGVuZXImJnRoaXMuX3VzZXJIYW5kbGVycy5zeXN0ZW1bdHlwZV0uc3BsaWNlKG8sMSk7ZWxzZSBpZih3bS5NSURJX0NIQU5ORUxfTUVTU0FHRVNbdHlwZV0pe2lmKGNoYW5uZWwuaW5kZXhPZihcImFsbFwiKT4tMSl7Y2hhbm5lbD1bXTtmb3IodmFyIGo9MTsxNj49ajtqKyspY2hhbm5lbC5wdXNoKGopfWlmKCF0aGlzLl91c2VySGFuZGxlcnMuY2hhbm5lbFt0eXBlXSlyZXR1cm4gdGhpcztjaGFubmVsLmZvckVhY2goZnVuY3Rpb24oY2hOdW0pe3ZhciBsaXN0ZW5lcnM9dGhhdC5fdXNlckhhbmRsZXJzLmNoYW5uZWxbdHlwZV1bY2hOdW1dO2lmKGxpc3RlbmVycylpZih2b2lkIDA9PT1saXN0ZW5lcil0aGF0Ll91c2VySGFuZGxlcnMuY2hhbm5lbFt0eXBlXVtjaE51bV09W107ZWxzZSBmb3IodmFyIGw9MDtsPGxpc3RlbmVycy5sZW5ndGg7bCsrKWxpc3RlbmVyc1tsXT09PWxpc3RlbmVyJiZsaXN0ZW5lcnMuc3BsaWNlKGwsMSl9KX1lbHNle2lmKHZvaWQgMCE9PXR5cGUpdGhyb3cgbmV3IFR5cGVFcnJvcihcIlRoZSBzcGVjaWZpZWQgZXZlbnQgdHlwZSBpcyBub3Qgc3VwcG9ydGVkLlwiKTt0aGlzLl9pbml0aWFsaXplVXNlckhhbmRsZXJzKCl9cmV0dXJuIHRoaXN9LElucHV0LnByb3RvdHlwZS5faW5pdGlhbGl6ZVVzZXJIYW5kbGVycz1mdW5jdGlvbigpe2Zvcih2YXIgcHJvcDEgaW4gd20uTUlESV9DSEFOTkVMX01FU1NBR0VTKXdtLk1JRElfQ0hBTk5FTF9NRVNTQUdFUy5oYXNPd25Qcm9wZXJ0eShwcm9wMSkmJih0aGlzLl91c2VySGFuZGxlcnMuY2hhbm5lbFtwcm9wMV09e30pO2Zvcih2YXIgcHJvcDIgaW4gd20uTUlESV9TWVNURU1fTUVTU0FHRVMpd20uTUlESV9TWVNURU1fTUVTU0FHRVMuaGFzT3duUHJvcGVydHkocHJvcDIpJiYodGhpcy5fdXNlckhhbmRsZXJzLnN5c3RlbVtwcm9wMl09W10pfSxJbnB1dC5wcm90b3R5cGUuX29uTWlkaU1lc3NhZ2U9ZnVuY3Rpb24oZSl7ZS5kYXRhWzBdPDI0MD90aGlzLl9wYXJzZUNoYW5uZWxFdmVudChlKTplLmRhdGFbMF08PTI1NSYmdGhpcy5fcGFyc2VTeXN0ZW1FdmVudChlKX0sSW5wdXQucHJvdG90eXBlLl9wYXJzZUNoYW5uZWxFdmVudD1mdW5jdGlvbihlKXt2YXIgZGF0YTEsZGF0YTIsY29tbWFuZD1lLmRhdGFbMF0+PjQsY2hhbm5lbD0oMTUmZS5kYXRhWzBdKSsxO2UuZGF0YS5sZW5ndGg+MSYmKGRhdGExPWUuZGF0YVsxXSxkYXRhMj1lLmRhdGEubGVuZ3RoPjI/ZS5kYXRhWzJdOnZvaWQgMCk7dmFyIGV2ZW50PXt0YXJnZXQ6dGhpcyxkYXRhOmUuZGF0YSx0aW1lc3RhbXA6ZS50aW1lU3RhbXAsY2hhbm5lbDpjaGFubmVsfTtjb21tYW5kPT09d20uTUlESV9DSEFOTkVMX01FU1NBR0VTLm5vdGVvZmZ8fGNvbW1hbmQ9PT13bS5NSURJX0NIQU5ORUxfTUVTU0FHRVMubm90ZW9uJiYwPT09ZGF0YTI/KGV2ZW50LnR5cGU9XCJub3Rlb2ZmXCIsZXZlbnQubm90ZT17bnVtYmVyOmRhdGExLG5hbWU6d20uX25vdGVzW2RhdGExJTEyXSxvY3RhdmU6d20uZ2V0T2N0YXZlKGRhdGExKX0sZXZlbnQudmVsb2NpdHk9ZGF0YTIvMTI3LGV2ZW50LnJhd1ZlbG9jaXR5PWRhdGEyKTpjb21tYW5kPT09d20uTUlESV9DSEFOTkVMX01FU1NBR0VTLm5vdGVvbj8oZXZlbnQudHlwZT1cIm5vdGVvblwiLGV2ZW50Lm5vdGU9e251bWJlcjpkYXRhMSxuYW1lOndtLl9ub3Rlc1tkYXRhMSUxMl0sb2N0YXZlOndtLmdldE9jdGF2ZShkYXRhMSl9LGV2ZW50LnZlbG9jaXR5PWRhdGEyLzEyNyxldmVudC5yYXdWZWxvY2l0eT1kYXRhMik6Y29tbWFuZD09PXdtLk1JRElfQ0hBTk5FTF9NRVNTQUdFUy5rZXlhZnRlcnRvdWNoPyhldmVudC50eXBlPVwia2V5YWZ0ZXJ0b3VjaFwiLGV2ZW50Lm5vdGU9e251bWJlcjpkYXRhMSxuYW1lOndtLl9ub3Rlc1tkYXRhMSUxMl0sb2N0YXZlOndtLmdldE9jdGF2ZShkYXRhMSl9LGV2ZW50LnZhbHVlPWRhdGEyLzEyNyk6Y29tbWFuZD09PXdtLk1JRElfQ0hBTk5FTF9NRVNTQUdFUy5jb250cm9sY2hhbmdlJiZkYXRhMT49MCYmMTE5Pj1kYXRhMT8oZXZlbnQudHlwZT1cImNvbnRyb2xjaGFuZ2VcIixldmVudC5jb250cm9sbGVyPXtudW1iZXI6ZGF0YTEsbmFtZTp0aGlzLmdldENjTmFtZUJ5TnVtYmVyKGRhdGExKX0sZXZlbnQudmFsdWU9ZGF0YTIpOmNvbW1hbmQ9PT13bS5NSURJX0NIQU5ORUxfTUVTU0FHRVMuY2hhbm5lbG1vZGUmJmRhdGExPj0xMjAmJjEyNz49ZGF0YTE/KGV2ZW50LnR5cGU9XCJjaGFubmVsbW9kZVwiLGV2ZW50LmNvbnRyb2xsZXI9e251bWJlcjpkYXRhMSxuYW1lOnRoaXMuZ2V0Q2hhbm5lbE1vZGVCeU51bWJlcihkYXRhMSl9LGV2ZW50LnZhbHVlPWRhdGEyKTpjb21tYW5kPT09d20uTUlESV9DSEFOTkVMX01FU1NBR0VTLnByb2dyYW1jaGFuZ2U/KGV2ZW50LnR5cGU9XCJwcm9ncmFtY2hhbmdlXCIsZXZlbnQudmFsdWU9ZGF0YTEpOmNvbW1hbmQ9PT13bS5NSURJX0NIQU5ORUxfTUVTU0FHRVMuY2hhbm5lbGFmdGVydG91Y2g/KGV2ZW50LnR5cGU9XCJjaGFubmVsYWZ0ZXJ0b3VjaFwiLGV2ZW50LnZhbHVlPWRhdGExLzEyNyk6Y29tbWFuZD09PXdtLk1JRElfQ0hBTk5FTF9NRVNTQUdFUy5waXRjaGJlbmQ/KGV2ZW50LnR5cGU9XCJwaXRjaGJlbmRcIixldmVudC52YWx1ZT0oKGRhdGEyPDw3KStkYXRhMS04MTkyKS84MTkyKTpldmVudC50eXBlPVwidW5rbm93bmNoYW5uZWxtZXNzYWdlXCIsdGhpcy5fdXNlckhhbmRsZXJzLmNoYW5uZWxbZXZlbnQudHlwZV0mJnRoaXMuX3VzZXJIYW5kbGVycy5jaGFubmVsW2V2ZW50LnR5cGVdW2NoYW5uZWxdJiZ0aGlzLl91c2VySGFuZGxlcnMuY2hhbm5lbFtldmVudC50eXBlXVtjaGFubmVsXS5mb3JFYWNoKGZ1bmN0aW9uKGNhbGxiYWNrKXtjYWxsYmFjayhldmVudCl9KX0sSW5wdXQucHJvdG90eXBlLmdldENjTmFtZUJ5TnVtYmVyPWZ1bmN0aW9uKG51bWJlcil7aWYobnVtYmVyPXBhcnNlSW50KG51bWJlciksIShudW1iZXI+PTAmJjExOT49bnVtYmVyKSl0aHJvdyBuZXcgUmFuZ2VFcnJvcihcIlRoZSBjb250cm9sIGNoYW5nZSBudW1iZXIgbXVzdCBiZSBiZXR3ZWVuIDAgYW5kIDExOS5cIik7Zm9yKHZhciBjYyBpbiB3bS5NSURJX0NPTlRST0xfQ0hBTkdFX01FU1NBR0VTKWlmKG51bWJlcj09PXdtLk1JRElfQ09OVFJPTF9DSEFOR0VfTUVTU0FHRVNbY2NdKXJldHVybiBjYztyZXR1cm4gdm9pZCAwfSxJbnB1dC5wcm90b3R5cGUuZ2V0Q2hhbm5lbE1vZGVCeU51bWJlcj1mdW5jdGlvbihudW1iZXIpe2lmKG51bWJlcj1wYXJzZUludChudW1iZXIpLCEobnVtYmVyPj0xMjAmJnN0YXR1czw9MTI3KSl0aHJvdyBuZXcgUmFuZ2VFcnJvcihcIlRoZSBjb250cm9sIGNoYW5nZSBudW1iZXIgbXVzdCBiZSBiZXR3ZWVuIDEyMCBhbmQgMTI3LlwiKTtmb3IodmFyIGNtIGluIHdtLk1JRElfQ0hBTk5FTF9NT0RFX01FU1NBR0VTKWlmKG51bWJlcj09PXdtLk1JRElfQ0hBTk5FTF9NT0RFX01FU1NBR0VTW2NtXSlyZXR1cm4gY219LElucHV0LnByb3RvdHlwZS5fcGFyc2VTeXN0ZW1FdmVudD1mdW5jdGlvbihlKXt2YXIgY29tbWFuZD1lLmRhdGFbMF0sZXZlbnQ9e3RhcmdldDp0aGlzLGRhdGE6ZS5kYXRhLHRpbWVzdGFtcDplLnRpbWVTdGFtcH07Y29tbWFuZD09PXdtLk1JRElfU1lTVEVNX01FU1NBR0VTLnN5c2V4P2V2ZW50LnR5cGU9XCJzeXNleFwiOmNvbW1hbmQ9PT13bS5NSURJX1NZU1RFTV9NRVNTQUdFUy50aW1lY29kZT9ldmVudC50eXBlPVwidGltZWNvZGVcIjpjb21tYW5kPT09d20uTUlESV9TWVNURU1fTUVTU0FHRVMuc29uZ3Bvc2l0aW9uP2V2ZW50LnR5cGU9XCJzb25ncG9zaXRpb25cIjpjb21tYW5kPT09d20uTUlESV9TWVNURU1fTUVTU0FHRVMuc29uZ3NlbGVjdD8oZXZlbnQudHlwZT1cInNvbmdzZWxlY3RcIixldmVudC5zb25nPWUuZGF0YVsxXSk6Y29tbWFuZD09PXdtLk1JRElfU1lTVEVNX01FU1NBR0VTLnR1bmluZ3JlcXVlc3Q/ZXZlbnQudHlwZT1cInR1bmluZ3JlcXVlc3RcIjpjb21tYW5kPT09d20uTUlESV9TWVNURU1fTUVTU0FHRVMuY2xvY2s/ZXZlbnQudHlwZT1cImNsb2NrXCI6Y29tbWFuZD09PXdtLk1JRElfU1lTVEVNX01FU1NBR0VTLnN0YXJ0P2V2ZW50LnR5cGU9XCJzdGFydFwiOmNvbW1hbmQ9PT13bS5NSURJX1NZU1RFTV9NRVNTQUdFU1tcImNvbnRpbnVlXCJdP2V2ZW50LnR5cGU9XCJjb250aW51ZVwiOmNvbW1hbmQ9PT13bS5NSURJX1NZU1RFTV9NRVNTQUdFUy5zdG9wP2V2ZW50LnR5cGU9XCJzdG9wXCI6Y29tbWFuZD09PXdtLk1JRElfU1lTVEVNX01FU1NBR0VTLmFjdGl2ZXNlbnNpbmc/ZXZlbnQudHlwZT1cImFjdGl2ZXNlbnNpbmdcIjpjb21tYW5kPT09d20uTUlESV9TWVNURU1fTUVTU0FHRVMucmVzZXQ/ZXZlbnQudHlwZT1cInJlc2V0XCI6ZXZlbnQudHlwZT1cInVua25vd25zeXN0ZW1tZXNzYWdlXCIsdGhpcy5fdXNlckhhbmRsZXJzLnN5c3RlbVtldmVudC50eXBlXSYmdGhpcy5fdXNlckhhbmRsZXJzLnN5c3RlbVtldmVudC50eXBlXS5mb3JFYWNoKGZ1bmN0aW9uKGNhbGxiYWNrKXtjYWxsYmFjayhldmVudCl9KX0sT3V0cHV0LnByb3RvdHlwZS5zZW5kPWZ1bmN0aW9uKHN0YXR1cyxkYXRhLHRpbWVzdGFtcCl7aWYoIShzdGF0dXM+PTEyOCYmMjU1Pj1zdGF0dXMpKXRocm93IG5ldyBSYW5nZUVycm9yKFwiVGhlIHN0YXR1cyBieXRlIG11c3QgYmUgYW4gaW50ZWdlciBiZXR3ZWVuIDEyOCAoMHg4MCkgYW5kIDI1NSAoMHhGRikuXCIpO0FycmF5LmlzQXJyYXkoZGF0YSl8fChkYXRhPXBhcnNlSW50KGRhdGEpPj0wJiZwYXJzZUludChkYXRhKTw9MTI3P1twYXJzZUludChkYXRhKV06W10pO3ZhciBtZXNzYWdlPVtzdGF0dXNdO3JldHVybiBkYXRhLmZvckVhY2goZnVuY3Rpb24oaXRlbSl7aWYoIShpdGVtPj0wJiYyNTU+PWl0ZW0pKXRocm93IG5ldyBSYW5nZUVycm9yKFwiVGhlIGRhdGEgYnl0ZXMgbXVzdCBiZSBpbnRlZ2VycyBiZXR3ZWVuIDAgKDB4MDApIGFuZCAyNTUgKDB4RkYpLlwiKTttZXNzYWdlLnB1c2goaXRlbSl9KSx0aGlzLl9taWRpT3V0cHV0LnNlbmQobWVzc2FnZSxwYXJzZUZsb2F0KHRpbWVzdGFtcCl8fDApLHRoaXN9LE91dHB1dC5wcm90b3R5cGUuc2VuZFN5c2V4PWZ1bmN0aW9uKG1hbnVmYWN0dXJlcixkYXRhLG9wdGlvbnMpe2lmKCF3bS5zeXNleEVuYWJsZWQpdGhyb3cgbmV3IEVycm9yKFwiU3lzRXggbWVzc2FnZSBzdXBwb3J0IG11c3QgZmlyc3QgYmUgYWN0aXZhdGVkLlwiKTtyZXR1cm4gb3B0aW9ucz1vcHRpb25zfHx7fSxtYW51ZmFjdHVyZXI9W10uY29uY2F0KG1hbnVmYWN0dXJlciksZGF0YS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pe2lmKDA+aXRlbXx8aXRlbT4xMjcpdGhyb3cgbmV3IFJhbmdlRXJyb3IoXCJUaGUgZGF0YSBieXRlcyBvZiBhIFN5c0V4IG1lc3NhZ2UgbXVzdCBiZSBpbnRlZ2VycyBiZXR3ZWVuIDAgKDB4MDApIGFuZCAxMjcgKDB4N0YpLlwiKX0pLGRhdGE9bWFudWZhY3R1cmVyLmNvbmNhdChkYXRhLHdtLk1JRElfU1lTVEVNX01FU1NBR0VTLnN5c2V4ZW5kKSx0aGlzLnNlbmQod20uTUlESV9TWVNURU1fTUVTU0FHRVMuc3lzZXgsZGF0YSx0aGlzLl9wYXJzZVRpbWVQYXJhbWV0ZXIob3B0aW9ucy50aW1lKSksdGhpc30sT3V0cHV0LnByb3RvdHlwZS5zZW5kVGltZWNvZGVRdWFydGVyRnJhbWU9ZnVuY3Rpb24odmFsdWUsb3B0aW9ucyl7cmV0dXJuIG9wdGlvbnM9b3B0aW9uc3x8e30sdGhpcy5zZW5kKHdtLk1JRElfU1lTVEVNX01FU1NBR0VTLnRpbWVjb2RlLHZhbHVlLHRoaXMuX3BhcnNlVGltZVBhcmFtZXRlcihvcHRpb25zLnRpbWUpKSx0aGlzfSxPdXRwdXQucHJvdG90eXBlLnNlbmRTb25nUG9zaXRpb249ZnVuY3Rpb24odmFsdWUsb3B0aW9ucyl7dmFsdWU9cGFyc2VJbnQodmFsdWUpfHwwLG9wdGlvbnM9b3B0aW9uc3x8e307dmFyIG1zYj12YWx1ZT4+NyYxMjcsbHNiPTEyNyZ2YWx1ZTtyZXR1cm4gdGhpcy5zZW5kKHdtLk1JRElfU1lTVEVNX01FU1NBR0VTLnNvbmdwb3NpdGlvbixbbXNiLGxzYl0sdGhpcy5fcGFyc2VUaW1lUGFyYW1ldGVyKG9wdGlvbnMudGltZSkpLHRoaXN9LE91dHB1dC5wcm90b3R5cGUuc2VuZFNvbmdTZWxlY3Q9ZnVuY3Rpb24odmFsdWUsb3B0aW9ucyl7aWYodmFsdWU9cGFyc2VJbnQodmFsdWUpLG9wdGlvbnM9b3B0aW9uc3x8e30sISh2YWx1ZT49MCYmMTI3Pj12YWx1ZSkpdGhyb3cgbmV3IFJhbmdlRXJyb3IoXCJUaGUgc29uZyBudW1iZXIgbXVzdCBiZSBiZXR3ZWVuIDAgYW5kIDEyNy5cIik7cmV0dXJuIHRoaXMuc2VuZCh3bS5NSURJX1NZU1RFTV9NRVNTQUdFUy5zb25nc2VsZWN0LFt2YWx1ZV0sdGhpcy5fcGFyc2VUaW1lUGFyYW1ldGVyKG9wdGlvbnMudGltZSkpLHRoaXN9LE91dHB1dC5wcm90b3R5cGUuc2VuZFR1bmluZ1JlcXVlc3Q9ZnVuY3Rpb24ob3B0aW9ucyl7cmV0dXJuIG9wdGlvbnM9b3B0aW9uc3x8e30sdGhpcy5zZW5kKHdtLk1JRElfU1lTVEVNX01FU1NBR0VTLnR1bmluZ3JlcXVlc3Qsdm9pZCAwLHRoaXMuX3BhcnNlVGltZVBhcmFtZXRlcihvcHRpb25zLnRpbWUpKSx0aGlzfSxPdXRwdXQucHJvdG90eXBlLnNlbmRDbG9jaz1mdW5jdGlvbihvcHRpb25zKXtyZXR1cm4gb3B0aW9ucz1vcHRpb25zfHx7fSx0aGlzLnNlbmQod20uTUlESV9TWVNURU1fTUVTU0FHRVMuY2xvY2ssdm9pZCAwLHRoaXMuX3BhcnNlVGltZVBhcmFtZXRlcihvcHRpb25zLnRpbWUpKSx0aGlzfSxPdXRwdXQucHJvdG90eXBlLnNlbmRTdGFydD1mdW5jdGlvbihvcHRpb25zKXtyZXR1cm4gb3B0aW9ucz1vcHRpb25zfHx7fSx0aGlzLnNlbmQod20uTUlESV9TWVNURU1fTUVTU0FHRVMuc3RhcnQsdm9pZCAwLHRoaXMuX3BhcnNlVGltZVBhcmFtZXRlcihvcHRpb25zLnRpbWUpKSx0aGlzfSxPdXRwdXQucHJvdG90eXBlLnNlbmRDb250aW51ZT1mdW5jdGlvbihvcHRpb25zKXtyZXR1cm4gb3B0aW9ucz1vcHRpb25zfHx7fSx0aGlzLnNlbmQod20uTUlESV9TWVNURU1fTUVTU0FHRVNbXCJjb250aW51ZVwiXSx2b2lkIDAsdGhpcy5fcGFyc2VUaW1lUGFyYW1ldGVyKG9wdGlvbnMudGltZSkpLHRoaXN9LE91dHB1dC5wcm90b3R5cGUuc2VuZFN0b3A9ZnVuY3Rpb24ob3B0aW9ucyl7cmV0dXJuIG9wdGlvbnM9b3B0aW9uc3x8e30sdGhpcy5zZW5kKHdtLk1JRElfU1lTVEVNX01FU1NBR0VTLnN0b3Asdm9pZCAwLHRoaXMuX3BhcnNlVGltZVBhcmFtZXRlcihvcHRpb25zLnRpbWUpKSx0aGlzfSxPdXRwdXQucHJvdG90eXBlLnNlbmRBY3RpdmVTZW5zaW5nPWZ1bmN0aW9uKG9wdGlvbnMpe3JldHVybiBvcHRpb25zPW9wdGlvbnN8fHt9LHRoaXMuc2VuZCh3bS5NSURJX1NZU1RFTV9NRVNTQUdFUy5hY3RpdmVzZW5zaW5nLHZvaWQgMCx0aGlzLl9wYXJzZVRpbWVQYXJhbWV0ZXIob3B0aW9ucy50aW1lKSksdGhpc30sT3V0cHV0LnByb3RvdHlwZS5zZW5kUmVzZXQ9ZnVuY3Rpb24ob3B0aW9ucyl7cmV0dXJuIG9wdGlvbnM9b3B0aW9uc3x8e30sdGhpcy5zZW5kKHdtLk1JRElfU1lTVEVNX01FU1NBR0VTLnJlc2V0LHZvaWQgMCx0aGlzLl9wYXJzZVRpbWVQYXJhbWV0ZXIob3B0aW9ucy50aW1lKSksdGhpc30sT3V0cHV0LnByb3RvdHlwZS5zdG9wTm90ZT1mdW5jdGlvbihub3RlLGNoYW5uZWwsb3B0aW9ucyl7aWYoXCJhbGxcIj09PW5vdGUpcmV0dXJuIHRoaXMuc2VuZENoYW5uZWxNb2RlKFwiYWxsbm90ZXNvZmZcIiwwLGNoYW5uZWwsb3B0aW9ucyk7dmFyIG5WZWxvY2l0eT02NDtyZXR1cm4gb3B0aW9ucz1vcHRpb25zfHx7fSxvcHRpb25zLnZlbG9jaXR5PXBhcnNlRmxvYXQob3B0aW9ucy52ZWxvY2l0eSksb3B0aW9ucy5yYXdWZWxvY2l0eT8haXNOYU4ob3B0aW9ucy52ZWxvY2l0eSkmJm9wdGlvbnMudmVsb2NpdHk+PTAmJm9wdGlvbnMudmVsb2NpdHk8PTEyNyYmKG5WZWxvY2l0eT1vcHRpb25zLnZlbG9jaXR5KTohaXNOYU4ob3B0aW9ucy52ZWxvY2l0eSkmJm9wdGlvbnMudmVsb2NpdHk+PTAmJm9wdGlvbnMudmVsb2NpdHk8PTEmJihuVmVsb2NpdHk9MTI3Km9wdGlvbnMudmVsb2NpdHkpLHRoaXMuX2NvbnZlcnROb3RlVG9BcnJheShub3RlKS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pe3RoaXMuX2NvbnZlcnRDaGFubmVsVG9BcnJheShjaGFubmVsKS5mb3JFYWNoKGZ1bmN0aW9uKGNoKXt0aGlzLnNlbmQoKHdtLk1JRElfQ0hBTk5FTF9NRVNTQUdFUy5ub3Rlb2ZmPDw0KSsoY2gtMSksW2l0ZW0sTWF0aC5yb3VuZChuVmVsb2NpdHkpXSx0aGlzLl9wYXJzZVRpbWVQYXJhbWV0ZXIob3B0aW9ucy50aW1lKSl9LmJpbmQodGhpcykpfS5iaW5kKHRoaXMpKSx0aGlzfSxPdXRwdXQucHJvdG90eXBlLnBsYXlOb3RlPWZ1bmN0aW9uKG5vdGUsY2hhbm5lbCxvcHRpb25zKXt2YXIgblZlbG9jaXR5PTY0O2lmKG9wdGlvbnM9b3B0aW9uc3x8e30sb3B0aW9ucy52ZWxvY2l0eT1wYXJzZUZsb2F0KG9wdGlvbnMudmVsb2NpdHkpLG9wdGlvbnMucmF3VmVsb2NpdHk/IWlzTmFOKG9wdGlvbnMudmVsb2NpdHkpJiZvcHRpb25zLnZlbG9jaXR5Pj0wJiZvcHRpb25zLnZlbG9jaXR5PD0xMjcmJihuVmVsb2NpdHk9b3B0aW9ucy52ZWxvY2l0eSk6IWlzTmFOKG9wdGlvbnMudmVsb2NpdHkpJiZvcHRpb25zLnZlbG9jaXR5Pj0wJiZvcHRpb25zLnZlbG9jaXR5PD0xJiYoblZlbG9jaXR5PTEyNypvcHRpb25zLnZlbG9jaXR5KSxvcHRpb25zLnRpbWU9dGhpcy5fcGFyc2VUaW1lUGFyYW1ldGVyKG9wdGlvbnMudGltZSksdGhpcy5fY29udmVydE5vdGVUb0FycmF5KG5vdGUpLmZvckVhY2goZnVuY3Rpb24oaXRlbSl7dGhpcy5fY29udmVydENoYW5uZWxUb0FycmF5KGNoYW5uZWwpLmZvckVhY2goZnVuY3Rpb24oY2gpe3RoaXMuc2VuZCgod20uTUlESV9DSEFOTkVMX01FU1NBR0VTLm5vdGVvbjw8NCkrKGNoLTEpLFtpdGVtLE1hdGgucm91bmQoblZlbG9jaXR5KV0sb3B0aW9ucy50aW1lKX0uYmluZCh0aGlzKSl9LmJpbmQodGhpcykpLG9wdGlvbnMuZHVyYXRpb249cGFyc2VGbG9hdChvcHRpb25zLmR1cmF0aW9uKSxvcHRpb25zLmR1cmF0aW9uKXtvcHRpb25zLmR1cmF0aW9uPD0wJiYob3B0aW9ucy5kdXJhdGlvbj0wKTt2YXIgblJlbGVhc2U9NjQ7b3B0aW9ucy5yZWxlYXNlPXBhcnNlRmxvYXQob3B0aW9ucy5yZWxlYXNlKSxvcHRpb25zLnJhd1ZlbG9jaXR5PyFpc05hTihvcHRpb25zLnJlbGVhc2UpJiZvcHRpb25zLnJlbGVhc2U+PTAmJm9wdGlvbnMucmVsZWFzZTw9MTI3JiYoblJlbGVhc2U9b3B0aW9ucy5yZWxlYXNlKTohaXNOYU4ob3B0aW9ucy5yZWxlYXNlKSYmb3B0aW9ucy5yZWxlYXNlPj0wJiZvcHRpb25zLnJlbGVhc2U8PTEmJihuUmVsZWFzZT0xMjcqb3B0aW9ucy5yZWxlYXNlKSx0aGlzLl9jb252ZXJ0Tm90ZVRvQXJyYXkobm90ZSkuZm9yRWFjaChmdW5jdGlvbihpdGVtKXt0aGlzLl9jb252ZXJ0Q2hhbm5lbFRvQXJyYXkoY2hhbm5lbCkuZm9yRWFjaChmdW5jdGlvbihjaCl7dGhpcy5zZW5kKCh3bS5NSURJX0NIQU5ORUxfTUVTU0FHRVMubm90ZW9mZjw8NCkrKGNoLTEpLFtpdGVtLE1hdGgucm91bmQoblJlbGVhc2UpXSwob3B0aW9ucy50aW1lfHx3bS50aW1lKStvcHRpb25zLmR1cmF0aW9uKX0uYmluZCh0aGlzKSl9LmJpbmQodGhpcykpfXJldHVybiB0aGlzfSxPdXRwdXQucHJvdG90eXBlLnNlbmRLZXlBZnRlcnRvdWNoPWZ1bmN0aW9uKG5vdGUsY2hhbm5lbCxwcmVzc3VyZSxvcHRpb25zKXt2YXIgdGhhdD10aGlzO2lmKG9wdGlvbnM9b3B0aW9uc3x8e30sMT5jaGFubmVsfHxjaGFubmVsPjE2KXRocm93IG5ldyBSYW5nZUVycm9yKFwiVGhlIGNoYW5uZWwgbXVzdCBiZSBiZXR3ZWVuIDEgYW5kIDE2LlwiKTtwcmVzc3VyZT1wYXJzZUZsb2F0KHByZXNzdXJlKSwoaXNOYU4ocHJlc3N1cmUpfHwwPnByZXNzdXJlfHxwcmVzc3VyZT4xKSYmKHByZXNzdXJlPS41KTt2YXIgblByZXNzdXJlPU1hdGgucm91bmQoMTI3KnByZXNzdXJlKTtyZXR1cm4gdGhpcy5fY29udmVydE5vdGVUb0FycmF5KG5vdGUpLmZvckVhY2goZnVuY3Rpb24oaXRlbSl7dGhhdC5fY29udmVydENoYW5uZWxUb0FycmF5KGNoYW5uZWwpLmZvckVhY2goZnVuY3Rpb24oY2gpe3RoYXQuc2VuZCgod20uTUlESV9DSEFOTkVMX01FU1NBR0VTLmtleWFmdGVydG91Y2g8PDQpKyhjaC0xKSxbaXRlbSxuUHJlc3N1cmVdLHRoYXQuX3BhcnNlVGltZVBhcmFtZXRlcihvcHRpb25zLnRpbWUpKX0pfSksdGhpc30sT3V0cHV0LnByb3RvdHlwZS5zZW5kQ29udHJvbENoYW5nZT1mdW5jdGlvbihjb250cm9sbGVyLHZhbHVlLGNoYW5uZWwsb3B0aW9ucyl7aWYob3B0aW9ucz1vcHRpb25zfHx7fSxcInN0cmluZ1wiPT10eXBlb2YgY29udHJvbGxlcil7aWYoY29udHJvbGxlcj13bS5NSURJX0NPTlRST0xfQ0hBTkdFX01FU1NBR0VTW2NvbnRyb2xsZXJdLCFjb250cm9sbGVyKXRocm93IG5ldyBUeXBlRXJyb3IoXCJJbnZhbGlkIGNvbnRyb2xsZXIgbmFtZS5cIil9ZWxzZSBpZihjb250cm9sbGVyPXBhcnNlSW50KGNvbnRyb2xsZXIpLCEoY29udHJvbGxlcj49MCYmMTE5Pj1jb250cm9sbGVyKSl0aHJvdyBuZXcgUmFuZ2VFcnJvcihcIkNvbnRyb2xsZXIgbnVtYmVycyBtdXN0IGJlIGJldHdlZW4gMCBhbmQgMTE5LlwiKTtpZih2YWx1ZT1wYXJzZUludCh2YWx1ZSl8fDAsISh2YWx1ZT49MCYmMTI3Pj12YWx1ZSkpdGhyb3cgbmV3IFJhbmdlRXJyb3IoXCJDb250cm9sbGVyIHZhbHVlIG11c3QgYmUgYmV0d2VlbiAwIGFuZCAxMjcuXCIpO3JldHVybiB0aGlzLl9jb252ZXJ0Q2hhbm5lbFRvQXJyYXkoY2hhbm5lbCkuZm9yRWFjaChmdW5jdGlvbihjaCl7dGhpcy5zZW5kKCh3bS5NSURJX0NIQU5ORUxfTUVTU0FHRVMuY29udHJvbGNoYW5nZTw8NCkrKGNoLTEpLFtjb250cm9sbGVyLHZhbHVlXSx0aGlzLl9wYXJzZVRpbWVQYXJhbWV0ZXIob3B0aW9ucy50aW1lKSl9LmJpbmQodGhpcykpLHRoaXN9LE91dHB1dC5wcm90b3R5cGUuX3NlbGVjdFJlZ2lzdGVyZWRQYXJhbWV0ZXI9ZnVuY3Rpb24ocGFyYW1ldGVyLGNoYW5uZWwsdGltZSl7dmFyIHRoYXQ9dGhpcztpZihwYXJhbWV0ZXJbMF09cGFyc2VJbnQocGFyYW1ldGVyWzBdKSwhKHBhcmFtZXRlclswXT49MCYmcGFyYW1ldGVyWzBdPD0xMjcpKXRocm93IG5ldyBSYW5nZUVycm9yKFwiVGhlIGNvbnRyb2w2NSB2YWx1ZSBtdXN0IGJlIGJldHdlZW4gMCBhbmQgMTI3XCIpO2lmKHBhcmFtZXRlclsxXT1wYXJzZUludChwYXJhbWV0ZXJbMV0pLCEocGFyYW1ldGVyWzFdPj0wJiZwYXJhbWV0ZXJbMV08PTEyNykpdGhyb3cgbmV3IFJhbmdlRXJyb3IoXCJUaGUgY29udHJvbDY0IHZhbHVlIG11c3QgYmUgYmV0d2VlbiAwIGFuZCAxMjdcIik7cmV0dXJuIHRoaXMuX2NvbnZlcnRDaGFubmVsVG9BcnJheShjaGFubmVsKS5mb3JFYWNoKGZ1bmN0aW9uKGNoKXt0aGF0LnNlbmRDb250cm9sQ2hhbmdlKDEwMSxwYXJhbWV0ZXJbMF0sY2hhbm5lbCx7dGltZTp0aW1lfSksdGhhdC5zZW5kQ29udHJvbENoYW5nZSgxMDAscGFyYW1ldGVyWzFdLGNoYW5uZWwse3RpbWU6dGltZX0pfSksdGhpc30sT3V0cHV0LnByb3RvdHlwZS5fc2VsZWN0Tm9uUmVnaXN0ZXJlZFBhcmFtZXRlcj1mdW5jdGlvbihwYXJhbWV0ZXIsY2hhbm5lbCx0aW1lKXt2YXIgdGhhdD10aGlzO2lmKHBhcmFtZXRlclswXT1wYXJzZUludChwYXJhbWV0ZXJbMF0pLCEocGFyYW1ldGVyWzBdPj0wJiZwYXJhbWV0ZXJbMF08PTEyNykpdGhyb3cgbmV3IFJhbmdlRXJyb3IoXCJUaGUgY29udHJvbDYzIHZhbHVlIG11c3QgYmUgYmV0d2VlbiAwIGFuZCAxMjdcIik7aWYocGFyYW1ldGVyWzFdPXBhcnNlSW50KHBhcmFtZXRlclsxXSksIShwYXJhbWV0ZXJbMV0+PTAmJnBhcmFtZXRlclsxXTw9MTI3KSl0aHJvdyBuZXcgUmFuZ2VFcnJvcihcIlRoZSBjb250cm9sNjIgdmFsdWUgbXVzdCBiZSBiZXR3ZWVuIDAgYW5kIDEyN1wiKTtyZXR1cm4gdGhpcy5fY29udmVydENoYW5uZWxUb0FycmF5KGNoYW5uZWwpLmZvckVhY2goZnVuY3Rpb24oY2gpe3RoYXQuc2VuZENvbnRyb2xDaGFuZ2UoOTkscGFyYW1ldGVyWzBdLGNoYW5uZWwse3RpbWU6dGltZX0pLHRoYXQuc2VuZENvbnRyb2xDaGFuZ2UoOTgscGFyYW1ldGVyWzFdLGNoYW5uZWwse3RpbWU6dGltZX0pfSksdGhpc30sT3V0cHV0LnByb3RvdHlwZS5fc2V0Q3VycmVudFJlZ2lzdGVyZWRQYXJhbWV0ZXI9ZnVuY3Rpb24oZGF0YSxjaGFubmVsLHRpbWUpe3ZhciB0aGF0PXRoaXM7aWYoZGF0YT1bXS5jb25jYXQoZGF0YSksZGF0YVswXT1wYXJzZUludChkYXRhWzBdKSwhKGRhdGFbMF0+PTAmJmRhdGFbMF08PTEyNykpdGhyb3cgbmV3IFJhbmdlRXJyb3IoXCJUaGUgbXNiIHZhbHVlIG11c3QgYmUgYmV0d2VlbiAwIGFuZCAxMjdcIik7cmV0dXJuIHRoaXMuX2NvbnZlcnRDaGFubmVsVG9BcnJheShjaGFubmVsKS5mb3JFYWNoKGZ1bmN0aW9uKGNoKXt0aGF0LnNlbmRDb250cm9sQ2hhbmdlKDYsZGF0YVswXSxjaGFubmVsLHt0aW1lOnRpbWV9KX0pLGRhdGFbMV09cGFyc2VJbnQoZGF0YVsxXSksZGF0YVsxXT49MCYmZGF0YVsxXTw9MTI3JiZ0aGlzLl9jb252ZXJ0Q2hhbm5lbFRvQXJyYXkoY2hhbm5lbCkuZm9yRWFjaChmdW5jdGlvbihjaCl7dGhhdC5zZW5kQ29udHJvbENoYW5nZSgzOCxkYXRhWzFdLGNoYW5uZWwse3RpbWU6dGltZX0pfSksdGhpc30sT3V0cHV0LnByb3RvdHlwZS5fZGVzZWxlY3RSZWdpc3RlcmVkUGFyYW1ldGVyPWZ1bmN0aW9uKGNoYW5uZWwsdGltZSl7dmFyIHRoYXQ9dGhpcztyZXR1cm4gdGhpcy5fY29udmVydENoYW5uZWxUb0FycmF5KGNoYW5uZWwpLmZvckVhY2goZnVuY3Rpb24oY2gpe3RoYXQuc2VuZENvbnRyb2xDaGFuZ2UoMTAxLDEyNyxjaGFubmVsLHt0aW1lOnRpbWV9KSx0aGF0LnNlbmRDb250cm9sQ2hhbmdlKDEwMCwxMjcsY2hhbm5lbCx7dGltZTp0aW1lfSl9KSx0aGlzfSxPdXRwdXQucHJvdG90eXBlLnNldFJlZ2lzdGVyZWRQYXJhbWV0ZXI9ZnVuY3Rpb24ocGFyYW1ldGVyLGRhdGEsY2hhbm5lbCxvcHRpb25zKXt2YXIgdGhhdD10aGlzO2lmKG9wdGlvbnM9b3B0aW9uc3x8e30sIUFycmF5LmlzQXJyYXkocGFyYW1ldGVyKSl7aWYoIXdtLk1JRElfUkVHSVNURVJFRF9QQVJBTUVURVJbcGFyYW1ldGVyXSl0aHJvdyBuZXcgRXJyb3IoXCJUaGUgc3BlY2lmaWVkIHBhcmFtZXRlciBpcyBub3QgYXZhaWxhYmxlLlwiKTtwYXJhbWV0ZXI9d20uTUlESV9SRUdJU1RFUkVEX1BBUkFNRVRFUltwYXJhbWV0ZXJdfXJldHVybiB0aGlzLl9jb252ZXJ0Q2hhbm5lbFRvQXJyYXkoY2hhbm5lbCkuZm9yRWFjaChmdW5jdGlvbihjaCl7dGhhdC5fc2VsZWN0UmVnaXN0ZXJlZFBhcmFtZXRlcihwYXJhbWV0ZXIsY2hhbm5lbCxvcHRpb25zLnRpbWUpLHRoYXQuX3NldEN1cnJlbnRSZWdpc3RlcmVkUGFyYW1ldGVyKGRhdGEsY2hhbm5lbCxvcHRpb25zLnRpbWUpLHRoYXQuX2Rlc2VsZWN0UmVnaXN0ZXJlZFBhcmFtZXRlcihjaGFubmVsLG9wdGlvbnMudGltZSl9KSx0aGlzfSxPdXRwdXQucHJvdG90eXBlLnNldE5vblJlZ2lzdGVyZWRQYXJhbWV0ZXI9ZnVuY3Rpb24ocGFyYW1ldGVyLGRhdGEsY2hhbm5lbCxvcHRpb25zKXt2YXIgdGhhdD10aGlzO2lmKG9wdGlvbnM9b3B0aW9uc3x8e30sIShwYXJhbWV0ZXJbMF0+PTAmJnBhcmFtZXRlclswXTw9MTI3JiZwYXJhbWV0ZXJbMV0+PTAmJnBhcmFtZXRlclsxXTw9MTI3KSl0aHJvdyBuZXcgRXJyb3IoXCJQb3NpdGlvbiAwIGFuZCAxIG9mIHRoZSAyLXBvc2l0aW9uIHBhcmFtZXRlciBhcnJheSBtdXN0IGJvdGggYmUgYmV0d2VlbiAwIGFuZCAxMjcuXCIpO3JldHVybiBkYXRhPVtdLmNvbmNhdChkYXRhKSx0aGlzLl9jb252ZXJ0Q2hhbm5lbFRvQXJyYXkoY2hhbm5lbCkuZm9yRWFjaChmdW5jdGlvbihjaCl7dGhhdC5fc2VsZWN0Tm9uUmVnaXN0ZXJlZFBhcmFtZXRlcihwYXJhbWV0ZXIsY2hhbm5lbCxvcHRpb25zLnRpbWUpLHRoYXQuX3NldEN1cnJlbnRSZWdpc3RlcmVkUGFyYW1ldGVyKGRhdGEsY2hhbm5lbCxvcHRpb25zLnRpbWUpLHRoYXQuX2Rlc2VsZWN0UmVnaXN0ZXJlZFBhcmFtZXRlcihjaGFubmVsLG9wdGlvbnMudGltZSl9KSx0aGlzfSxPdXRwdXQucHJvdG90eXBlLmluY3JlbWVudFJlZ2lzdGVyZWRQYXJhbWV0ZXI9ZnVuY3Rpb24ocGFyYW1ldGVyLGNoYW5uZWwsb3B0aW9ucyl7dmFyIHRoYXQ9dGhpcztpZihvcHRpb25zPW9wdGlvbnN8fHt9LCFBcnJheS5pc0FycmF5KHBhcmFtZXRlcikpe2lmKCF3bS5NSURJX1JFR0lTVEVSRURfUEFSQU1FVEVSW3BhcmFtZXRlcl0pdGhyb3cgbmV3IEVycm9yKFwiVGhlIHNwZWNpZmllZCBwYXJhbWV0ZXIgaXMgbm90IGF2YWlsYWJsZS5cIik7cGFyYW1ldGVyPXdtLk1JRElfUkVHSVNURVJFRF9QQVJBTUVURVJbcGFyYW1ldGVyXX1yZXR1cm4gdGhpcy5fY29udmVydENoYW5uZWxUb0FycmF5KGNoYW5uZWwpLmZvckVhY2goZnVuY3Rpb24oY2gpe3RoYXQuX3NlbGVjdFJlZ2lzdGVyZWRQYXJhbWV0ZXIocGFyYW1ldGVyLGNoYW5uZWwsb3B0aW9ucy50aW1lKSx0aGF0LnNlbmRDb250cm9sQ2hhbmdlKDk2LDAsY2hhbm5lbCx7dGltZTpvcHRpb25zLnRpbWV9KSx0aGF0Ll9kZXNlbGVjdFJlZ2lzdGVyZWRQYXJhbWV0ZXIoY2hhbm5lbCxvcHRpb25zLnRpbWUpfSksdGhpc30sT3V0cHV0LnByb3RvdHlwZS5kZWNyZW1lbnRSZWdpc3RlcmVkUGFyYW1ldGVyPWZ1bmN0aW9uKHBhcmFtZXRlcixjaGFubmVsLG9wdGlvbnMpe2lmKG9wdGlvbnM9b3B0aW9uc3x8e30sIUFycmF5LmlzQXJyYXkocGFyYW1ldGVyKSl7aWYoIXdtLk1JRElfUkVHSVNURVJFRF9QQVJBTUVURVJbcGFyYW1ldGVyXSl0aHJvdyBuZXcgVHlwZUVycm9yKFwiVGhlIHNwZWNpZmllZCBwYXJhbWV0ZXIgaXMgbm90IGF2YWlsYWJsZS5cIik7cGFyYW1ldGVyPXdtLk1JRElfUkVHSVNURVJFRF9QQVJBTUVURVJbcGFyYW1ldGVyXX1yZXR1cm4gdGhpcy5fY29udmVydENoYW5uZWxUb0FycmF5KGNoYW5uZWwpLmZvckVhY2goZnVuY3Rpb24oY2gpe3RoaXMuX3NlbGVjdFJlZ2lzdGVyZWRQYXJhbWV0ZXIocGFyYW1ldGVyLGNoYW5uZWwsb3B0aW9ucy50aW1lKSx0aGlzLnNlbmRDb250cm9sQ2hhbmdlKDk3LDAsY2hhbm5lbCx7dGltZTpvcHRpb25zLnRpbWV9KSx0aGlzLl9kZXNlbGVjdFJlZ2lzdGVyZWRQYXJhbWV0ZXIoY2hhbm5lbCxvcHRpb25zLnRpbWUpfS5iaW5kKHRoaXMpKSx0aGlzfSxPdXRwdXQucHJvdG90eXBlLnNldFBpdGNoQmVuZFJhbmdlPWZ1bmN0aW9uKHNlbWl0b25lcyxjZW50cyxjaGFubmVsLG9wdGlvbnMpe3ZhciB0aGF0PXRoaXM7aWYob3B0aW9ucz1vcHRpb25zfHx7fSxzZW1pdG9uZXM9cGFyc2VJbnQoc2VtaXRvbmVzKXx8MCwhKHNlbWl0b25lcz49MCYmMTI3Pj1zZW1pdG9uZXMpKXRocm93IG5ldyBSYW5nZUVycm9yKFwiVGhlIHNlbWl0b25lcyB2YWx1ZSBtdXN0IGJlIGJldHdlZW4gMCBhbmQgMTI3XCIpO2lmKGNlbnRzPXBhcnNlSW50KGNlbnRzKXx8MCwhKGNlbnRzPj0wJiYxMjc+PWNlbnRzKSl0aHJvdyBuZXcgUmFuZ2VFcnJvcihcIlRoZSBjZW50cyB2YWx1ZSBtdXN0IGJlIGJldHdlZW4gMCBhbmQgMTI3XCIpO3JldHVybiB0aGlzLl9jb252ZXJ0Q2hhbm5lbFRvQXJyYXkoY2hhbm5lbCkuZm9yRWFjaChmdW5jdGlvbihjaCl7dGhhdC5zZXRSZWdpc3RlcmVkUGFyYW1ldGVyKFwicGl0Y2hiZW5kcmFuZ2VcIixbc2VtaXRvbmVzLGNlbnRzXSxjaGFubmVsLHt0aW1lOm9wdGlvbnMudGltZX0pfSksdGhpc30sT3V0cHV0LnByb3RvdHlwZS5zZXRNb2R1bGF0aW9uUmFuZ2U9ZnVuY3Rpb24oc2VtaXRvbmVzLGNlbnRzLGNoYW5uZWwsb3B0aW9ucyl7dmFyIHRoYXQ9dGhpcztpZihvcHRpb25zPW9wdGlvbnN8fHt9LHNlbWl0b25lcz1wYXJzZUludChzZW1pdG9uZXMpfHwwLCEoc2VtaXRvbmVzPj0wJiYxMjc+PXNlbWl0b25lcykpdGhyb3cgbmV3IFJhbmdlRXJyb3IoXCJUaGUgc2VtaXRvbmVzIHZhbHVlIG11c3QgYmUgYmV0d2VlbiAwIGFuZCAxMjdcIik7aWYoY2VudHM9cGFyc2VJbnQoY2VudHMpfHwwLCEoY2VudHM+PTAmJjEyNz49Y2VudHMpKXRocm93IG5ldyBSYW5nZUVycm9yKFwiVGhlIGNlbnRzIHZhbHVlIG11c3QgYmUgYmV0d2VlbiAwIGFuZCAxMjdcIik7cmV0dXJuIHRoaXMuX2NvbnZlcnRDaGFubmVsVG9BcnJheShjaGFubmVsKS5mb3JFYWNoKGZ1bmN0aW9uKGNoKXt0aGF0LnNldFJlZ2lzdGVyZWRQYXJhbWV0ZXIoXCJtb2R1bGF0aW9ucmFuZ2VcIixbc2VtaXRvbmVzLGNlbnRzXSxjaGFubmVsLHt0aW1lOm9wdGlvbnMudGltZX0pfSksdGhpc30sT3V0cHV0LnByb3RvdHlwZS5zZXRNYXN0ZXJUdW5pbmc9ZnVuY3Rpb24odmFsdWUsY2hhbm5lbCxvcHRpb25zKXt2YXIgdGhhdD10aGlzO2lmKG9wdGlvbnM9b3B0aW9uc3x8e30sdmFsdWU9cGFyc2VGbG9hdCh2YWx1ZSl8fDAsLTY1Pj12YWx1ZXx8dmFsdWU+PTY0KXRocm93IG5ldyBSYW5nZUVycm9yKFwiVGhlIHZhbHVlIG11c3QgYmUgYSBkZWNpbWFsIG51bWJlciBsYXJnZXIgdGhhbiAtNjUgYW5kIHNtYWxsZXIgdGhhbiA2NC5cIik7dmFyIGNvYXJzZT1wYXJzZUludCh2YWx1ZSkrNjQsZmluZT12YWx1ZS1wYXJzZUludCh2YWx1ZSk7ZmluZT1NYXRoLnJvdW5kKChmaW5lKzEpLzIqMTYzODMpO3ZhciBtc2I9ZmluZT4+NyYxMjcsbHNiPTEyNyZmaW5lO3JldHVybiB0aGlzLl9jb252ZXJ0Q2hhbm5lbFRvQXJyYXkoY2hhbm5lbCkuZm9yRWFjaChmdW5jdGlvbihjaCl7dGhhdC5zZXRSZWdpc3RlcmVkUGFyYW1ldGVyKFwiY2hhbm5lbGNvYXJzZXR1bmluZ1wiLGNvYXJzZSxjaGFubmVsLHt0aW1lOm9wdGlvbnMudGltZX0pLHRoYXQuc2V0UmVnaXN0ZXJlZFBhcmFtZXRlcihcImNoYW5uZWxmaW5ldHVuaW5nXCIsW21zYixsc2JdLGNoYW5uZWwse3RpbWU6b3B0aW9ucy50aW1lfSl9KSx0aGlzfSxPdXRwdXQucHJvdG90eXBlLnNldFR1bmluZ1Byb2dyYW09ZnVuY3Rpb24odmFsdWUsY2hhbm5lbCxvcHRpb25zKXt2YXIgdGhhdD10aGlzO2lmKG9wdGlvbnM9b3B0aW9uc3x8e30sdmFsdWU9cGFyc2VJbnQodmFsdWUpfHwwLCEodmFsdWU+PTAmJjEyNz49dmFsdWUpKXRocm93IG5ldyBSYW5nZUVycm9yKFwiVGhlIHByb2dyYW0gdmFsdWUgbXVzdCBiZSBiZXR3ZWVuIDAgYW5kIDEyN1wiKTtyZXR1cm4gdGhpcy5fY29udmVydENoYW5uZWxUb0FycmF5KGNoYW5uZWwpLmZvckVhY2goZnVuY3Rpb24oY2gpe3RoYXQuc2V0UmVnaXN0ZXJlZFBhcmFtZXRlcihcInR1bmluZ3Byb2dyYW1cIix2YWx1ZSxjaGFubmVsLHt0aW1lOm9wdGlvbnMudGltZX0pfSksdGhpc30sT3V0cHV0LnByb3RvdHlwZS5zZXRUdW5pbmdCYW5rPWZ1bmN0aW9uKHZhbHVlLGNoYW5uZWwsb3B0aW9ucyl7dmFyIHRoYXQ9dGhpcztpZihvcHRpb25zPW9wdGlvbnN8fHt9LHZhbHVlPXBhcnNlSW50KHZhbHVlKXx8MCwhKHZhbHVlPj0wJiYxMjc+PXZhbHVlKSl0aHJvdyBuZXcgUmFuZ2VFcnJvcihcIlRoZSBiYW5rIHZhbHVlIG11c3QgYmUgYmV0d2VlbiAwIGFuZCAxMjdcIik7cmV0dXJuIHRoaXMuX2NvbnZlcnRDaGFubmVsVG9BcnJheShjaGFubmVsKS5mb3JFYWNoKGZ1bmN0aW9uKGNoKXt0aGF0LnNldFJlZ2lzdGVyZWRQYXJhbWV0ZXIoXCJ0dW5pbmdiYW5rXCIsdmFsdWUsY2hhbm5lbCx7dGltZTpvcHRpb25zLnRpbWV9KX0pLHRoaXN9LE91dHB1dC5wcm90b3R5cGUuc2VuZENoYW5uZWxNb2RlPWZ1bmN0aW9uKGNvbW1hbmQsdmFsdWUsY2hhbm5lbCxvcHRpb25zKXtpZihvcHRpb25zPW9wdGlvbnN8fHt9LFwic3RyaW5nXCI9PXR5cGVvZiBjb21tYW5kKXtpZihjb21tYW5kPXdtLk1JRElfQ0hBTk5FTF9NT0RFX01FU1NBR0VTW2NvbW1hbmRdLCFjb21tYW5kKXRocm93IG5ldyBUeXBlRXJyb3IoXCJJbnZhbGlkIGNoYW5uZWwgbW9kZSBtZXNzYWdlIG5hbWUuXCIpfWVsc2UgaWYoY29tbWFuZD1wYXJzZUludChjb21tYW5kKSwhKGNvbW1hbmQ+PTEyMCYmMTI3Pj1jb21tYW5kKSl0aHJvdyBuZXcgUmFuZ2VFcnJvcihcIkNoYW5uZWwgbW9kZSBudW1lcmljYWwgaWRlbnRpZmllcnMgbXVzdCBiZSBiZXR3ZWVuIDEyMCBhbmQgMTI3LlwiKTtpZih2YWx1ZT1wYXJzZUludCh2YWx1ZSl8fDAsMD52YWx1ZXx8dmFsdWU+MTI3KXRocm93IG5ldyBSYW5nZUVycm9yKFwiVmFsdWUgbXVzdCBiZSBhbiBpbnRlZ2VyIGJldHdlZW4gMCBhbmQgMTI3LlwiKTtyZXR1cm4gdGhpcy5fY29udmVydENoYW5uZWxUb0FycmF5KGNoYW5uZWwpLmZvckVhY2goZnVuY3Rpb24oY2gpe3RoaXMuc2VuZCgod20uTUlESV9DSEFOTkVMX01FU1NBR0VTLmNoYW5uZWxtb2RlPDw0KSsoY2gtMSksW2NvbW1hbmQsdmFsdWVdLHRoaXMuX3BhcnNlVGltZVBhcmFtZXRlcihvcHRpb25zLnRpbWUpKX0uYmluZCh0aGlzKSksdGhpc30sT3V0cHV0LnByb3RvdHlwZS5zZW5kUHJvZ3JhbUNoYW5nZT1mdW5jdGlvbihwcm9ncmFtLGNoYW5uZWwsb3B0aW9ucyl7dmFyIHRoYXQ9dGhpcztpZihvcHRpb25zPW9wdGlvbnN8fHt9LHByb2dyYW09cGFyc2VJbnQocHJvZ3JhbSksaXNOYU4ocHJvZ3JhbSl8fDA+cHJvZ3JhbXx8cHJvZ3JhbT4xMjcpdGhyb3cgbmV3IFJhbmdlRXJyb3IoXCJQcm9ncmFtIG51bWJlcnMgbXVzdCBiZSBiZXR3ZWVuIDAgYW5kIDEyNy5cIik7cmV0dXJuIHRoaXMuX2NvbnZlcnRDaGFubmVsVG9BcnJheShjaGFubmVsKS5mb3JFYWNoKGZ1bmN0aW9uKGNoKXt0aGF0LnNlbmQoKHdtLk1JRElfQ0hBTk5FTF9NRVNTQUdFUy5wcm9ncmFtY2hhbmdlPDw0KSsoY2gtMSksW3Byb2dyYW1dLHRoYXQuX3BhcnNlVGltZVBhcmFtZXRlcihvcHRpb25zLnRpbWUpKX0pLHRoaXN9LE91dHB1dC5wcm90b3R5cGUuc2VuZENoYW5uZWxBZnRlcnRvdWNoPWZ1bmN0aW9uKHByZXNzdXJlLGNoYW5uZWwsb3B0aW9ucyl7dmFyIHRoYXQ9dGhpcztvcHRpb25zPW9wdGlvbnN8fHt9LHByZXNzdXJlPXBhcnNlRmxvYXQocHJlc3N1cmUpLChpc05hTihwcmVzc3VyZSl8fDA+cHJlc3N1cmV8fHByZXNzdXJlPjEpJiYocHJlc3N1cmU9LjUpO3ZhciBuUHJlc3N1cmU9TWF0aC5yb3VuZCgxMjcqcHJlc3N1cmUpO3JldHVybiB0aGlzLl9jb252ZXJ0Q2hhbm5lbFRvQXJyYXkoY2hhbm5lbCkuZm9yRWFjaChmdW5jdGlvbihjaCl7dGhhdC5zZW5kKCh3bS5NSURJX0NIQU5ORUxfTUVTU0FHRVMuY2hhbm5lbGFmdGVydG91Y2g8PDQpKyhjaC0xKSxbblByZXNzdXJlXSx0aGF0Ll9wYXJzZVRpbWVQYXJhbWV0ZXIob3B0aW9ucy50aW1lKSl9KSx0aGlzfSxPdXRwdXQucHJvdG90eXBlLnNlbmRQaXRjaEJlbmQ9ZnVuY3Rpb24oYmVuZCxjaGFubmVsLG9wdGlvbnMpe1xudmFyIHRoYXQ9dGhpcztpZihvcHRpb25zPW9wdGlvbnN8fHt9LGJlbmQ9cGFyc2VGbG9hdChiZW5kKSxpc05hTihiZW5kKXx8LTE+YmVuZHx8YmVuZD4xKXRocm93IG5ldyBSYW5nZUVycm9yKFwiUGl0Y2ggYmVuZCB2YWx1ZSBtdXN0IGJlIGJldHdlZW4gLTEgYW5kIDEuXCIpO3ZhciBuTGV2ZWw9TWF0aC5yb3VuZCgoYmVuZCsxKS8yKjE2MzgzKSxtc2I9bkxldmVsPj43JjEyNyxsc2I9MTI3Jm5MZXZlbDtyZXR1cm4gdGhpcy5fY29udmVydENoYW5uZWxUb0FycmF5KGNoYW5uZWwpLmZvckVhY2goZnVuY3Rpb24oY2gpe3RoYXQuc2VuZCgod20uTUlESV9DSEFOTkVMX01FU1NBR0VTLnBpdGNoYmVuZDw8NCkrKGNoLTEpLFtsc2IsbXNiXSx0aGF0Ll9wYXJzZVRpbWVQYXJhbWV0ZXIob3B0aW9ucy50aW1lKSl9KSx0aGlzfSxPdXRwdXQucHJvdG90eXBlLl9wYXJzZVRpbWVQYXJhbWV0ZXI9ZnVuY3Rpb24odGltZSl7dmFyIHBhcnNlZCx2YWx1ZTtyZXR1cm5cInN0cmluZ1wiPT10eXBlb2YgdGltZSYmXCIrXCI9PT10aW1lLnN1YnN0cmluZygwLDEpPyhwYXJzZWQ9cGFyc2VGbG9hdCh0aW1lKSxwYXJzZWQmJnBhcnNlZD4wJiYodmFsdWU9d20udGltZStwYXJzZWQpKToocGFyc2VkPXBhcnNlRmxvYXQodGltZSkscGFyc2VkPndtLnRpbWUmJih2YWx1ZT1wYXJzZWQpKSx2YWx1ZX0sT3V0cHV0LnByb3RvdHlwZS5fY29udmVydE5vdGVUb0FycmF5PWZ1bmN0aW9uKG5vdGUpe3ZhciBub3Rlcz1bXTtyZXR1cm4gQXJyYXkuaXNBcnJheShub3RlKXx8KG5vdGU9W25vdGVdKSxub3RlLmZvckVhY2goZnVuY3Rpb24oaXRlbSl7bm90ZXMucHVzaCh3bS5ndWVzc05vdGVOdW1iZXIoaXRlbSkpfSksbm90ZXN9LE91dHB1dC5wcm90b3R5cGUuX2NvbnZlcnRDaGFubmVsVG9BcnJheT1mdW5jdGlvbihjaGFubmVsKXtpZigoXCJhbGxcIj09PWNoYW5uZWx8fHZvaWQgMD09PWNoYW5uZWwpJiYoY2hhbm5lbD1bXCJhbGxcIl0pLEFycmF5LmlzQXJyYXkoY2hhbm5lbCl8fChjaGFubmVsPVtjaGFubmVsXSksY2hhbm5lbC5pbmRleE9mKFwiYWxsXCIpPi0xKXtjaGFubmVsPVtdO2Zvcih2YXIgaT0xOzE2Pj1pO2krKyljaGFubmVsLnB1c2goaSl9cmV0dXJuIGNoYW5uZWwuZm9yRWFjaChmdW5jdGlvbihjaCl7aWYoIShjaD49MSYmMTY+PWNoKSl0aHJvdyBuZXcgUmFuZ2VFcnJvcihcIk1JREkgY2hhbm5lbHMgbXVzdCBiZSBiZXR3ZWVuIDEgYW5kIDE2LlwiKX0pLGNoYW5uZWx9LE91dHB1dC5wcm90b3R5cGUuX29uTWlkaU1lc3NhZ2U9ZnVuY3Rpb24oZSl7fSxcImZ1bmN0aW9uXCI9PXR5cGVvZiBkZWZpbmUmJlwib2JqZWN0XCI9PXR5cGVvZiBkZWZpbmUuYW1kP2RlZmluZShbXSxmdW5jdGlvbigpe3JldHVybiB3bX0pOlwidW5kZWZpbmVkXCIhPXR5cGVvZiBtb2R1bGUmJm1vZHVsZS5leHBvcnRzP21vZHVsZS5leHBvcnRzPXdtOnNjb3BlLldlYk1pZGl8fChzY29wZS5XZWJNaWRpPXdtKX0odGhpcyk7IiwiY29uc3QgdG9uZUZyZXF1ZW5jeSA9IHJlcXVpcmUoJ3RvbmUtZnJlcXVlbmN5Jyk7XG5jb25zdCBhZHNyR2Fpbk5vZGUgPSByZXF1aXJlKCdhZHNyLWdhaW4tbm9kZScpO1xuXG5sZXQgYXVkaW9DdHggPSBuZXcgQXVkaW9Db250ZXh0KCk7IFxubGV0IG1hc3RlckdhaW4gPSBhdWRpb0N0eC5jcmVhdGVHYWluKCk7XG5cbm1hc3RlckdhaW4uZ2Fpbi52YWx1ZSA9IDAuMztcbm1hc3RlckdhaW4uY29ubmVjdChhdWRpb0N0eC5kZXN0aW5hdGlvbik7XG5cblxuXG5mdW5jdGlvbiBnZXRCZWF0aW5nT3NjKGF1ZGlvQ3R4LCBmcmVxLCB2ZWxvY2l0eSkge1xuXG4gICAgdGhpcy5vc2MxID0gYXVkaW9DdHguY3JlYXRlT3NjaWxsYXRvcigpO1xuICAgIHRoaXMub3NjMS50eXBlID0gJ3NxdWFyZSc7XG5cbiAgICB0aGlzLm9zYzIgPSBhdWRpb0N0eC5jcmVhdGVPc2NpbGxhdG9yKCk7XG4gICAgdGhpcy5vc2MyLnR5cGUgPSAnc3F1YXJlJztcbiAgICBcbiAgICB0aGlzLm9zYzMgPSBhdWRpb0N0eC5jcmVhdGVPc2NpbGxhdG9yKCk7XG4gICAgdGhpcy5vc2MzLnR5cGUgPSAnc3F1YXJlJztcblxuICAgIGxldCBzeW50aEdhaW4gPSBuZXcgYWRzckdhaW5Ob2RlKGF1ZGlvQ3R4KTtcbiAgICBcbiAgICBpZiAodmVsb2NpdHkgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICB2ZWxvY2l0eSA9IDAuM1xuICAgIH0gXG4gICAgXG4gICAgXG4gICAgc3ludGhHYWluLnNldE9wdGlvbnMoe1xuICAgICAgICBpbml0R2FpbjogMC4xLCAvLyBJbml0IGdhaW4gb24gbm90ZVxuICAgICAgICBtYXhHYWluOiB2ZWxvY2l0eSwgLy8gTWF4IGdhaW4gb24gbm90ZVxuICAgICAgICBhdHRhY2tUaW1lOiAwLjEsIC8vIEF0dGFja1RpbWUuIGdhaW4uaW5pdCB0byBnYWluLm1heCBpbiBhdHRhY2tUaW1lXG4gICAgICAgIHN1c3RhaW5UaW1lOiAzLCAvLyBTdXN0YWluIG5vdGUgaW4gdGltZVxuICAgICAgICByZWxlYXNlVGltZTogMSAvLyBBcHByb3hpbWF0ZWQgZW5kIHRpbWUuIENhbGN1bGF0ZWQgd2l0aCBzZWNvbmRzVG9UaW1lQ29uc3RhbnQoKVxuICAgIFxuICAgIH0pO1xuICAgIFxuICAgIHRoaXMuZ2FpbiA9IHN5bnRoR2Fpbi5nZXRHYWluTm9kZShhdWRpb0N0eC5jdXJyZW50VGltZSk7XG5cbiAgICB0aGlzLm9zYzEuZnJlcXVlbmN5LnZhbHVlID0gZnJlcSAvLyBlLmcuIDQwMFxuICAgIHRoaXMub3NjMi5mcmVxdWVuY3kudmFsdWUgPSBmcmVxICsgKGZyZXEqMC4wMSkgLy8gQWRkIGEgbGl0dGxlXG5cbiAgICB0aGlzLm9zYzEuY29ubmVjdCh0aGlzLmdhaW4pO1xuICAgIHRoaXMub3NjMi5jb25uZWN0KHRoaXMuZ2Fpbik7XG4gICAgdGhpcy5nYWluLmNvbm5lY3QobWFzdGVyR2Fpbik7XG5cbiAgICB0aGlzLnN0YXJ0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMub3NjMS5zdGFydCgpO1xuICAgICAgICB0aGlzLm9zYzIuc3RhcnQoKTtcbiAgICAgICAgdGhpcy5vc2MzLnN0YXJ0KCk7XG4gICAgfVxuXG4gICAgdGhpcy5kaXNjb25uZWN0ID0gZnVuY3Rpb24gKCkge1xuXG4gICAgICAgIGxldCBsZW5ndGggPSBhdWRpb0N0eC5jdXJyZW50VGltZSArIHN5bnRoR2Fpbi5nZXRUb3RhbExlbmd0aCgpO1xuICAgICAgICB0aGlzLm9zYzEuc3RvcChsZW5ndGgpO1xuICAgICAgICB0aGlzLm9zYzIuc3RvcChsZW5ndGgpO1xuICAgICAgICB0aGlzLm9zYzMuc3RvcChsZW5ndGgpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gZ2V0TXVsdGlCZWF0aW5nT3NjICgpIHtcblxuICAgIHRoaXMuc3RhcnQgPSBmdW5jdGlvbihmcmVxLCBvcHRpb25zKSB7XG5cbiAgICAgICAgbGV0IHZlbG9jaXR5ID0gMC4zXG4gICAgICAgIGlmIChvcHRpb25zKSB7XG4gICAgICAgICAgICB2ZWxvY2l0eSA9IG9wdGlvbnMudmVsb2NpdHlcbiAgICAgICAgfVxuXG4gICAgICAgIHRvbmVGcmVxdWVuY3kuYmFzZSA9IGZyZXE7XG4gICAgICAgIHRoaXMuc3ludGgxID0gbmV3IGdldEJlYXRpbmdPc2MoYXVkaW9DdHgsIGZyZXEsIHZlbG9jaXR5KVxuICAgIFxuICAgICAgICBsZXQgbG93RnJlcSA9IHRvbmVGcmVxdWVuY3kuZ2V0VG9uZVN0ZXAoKzcpXG4gICAgICAgIHRoaXMuc3ludGgyID0gbmV3IGdldEJlYXRpbmdPc2MoYXVkaW9DdHgsIGxvd0ZyZXEqMiwgdmVsb2NpdHkpXG4gICAgXG4gICAgICAgIGxldCBoaWdoRnJlcSA9IHRvbmVGcmVxdWVuY3kuZ2V0VG9uZVN0ZXAoKzEyKVxuICAgICAgICB0aGlzLnN5bnRoMyA9IG5ldyBnZXRCZWF0aW5nT3NjKGF1ZGlvQ3R4LCBsb3dGcmVxKjMsIHZlbG9jaXR5KVxuXG4gICAgICAgIHRoaXMuc3ludGgxLnN0YXJ0KCk7XG4gICAgICAgIHRoaXMuc3ludGgyLnN0YXJ0KCk7XG4gICAgICAgIHRoaXMuc3ludGgzLnN0YXJ0KCk7XG4gICAgfVxuXG4gICAgdGhpcy5zdG9wID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnN5bnRoMS5kaXNjb25uZWN0KCk7XG4gICAgICAgIHRoaXMuc3ludGgyLmRpc2Nvbm5lY3QoKTtcbiAgICAgICAgLy90aGlzLnN5bnRoMy5kaXNjb25uZWN0KCk7XG4gICAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IGdldE11bHRpQmVhdGluZ09zY1xuIiwiLy8gVXNlIGl0IGxpa2UgdGhpczogIFxuLy8gY29uc3Qgc3ludGggPSByZXF1aXJlKCdwbHVnZ2FibGUtc3ludGgnKVxuLy8gQnV0IHRoaXMgaXMgdGhlIHRlc3RcbmNvbnN0IHBsdWdnYWJsZVN5bnRoID0gcmVxdWlyZSgnLi9pbmRleCcpXG5jb25zdCBhdWRpb0N0eCA9IG5ldyBBdWRpb0NvbnRleHQoKTsgXG5jb25zdCBtYXN0ZXJHYWluID0gYXVkaW9DdHguY3JlYXRlR2FpbigpO1xubWFzdGVyR2Fpbi5nYWluLnZhbHVlID0gMC4xO1xuXG4vKipcbiAqIEEgc2ltcGxlIHRlc3Qgc3ludGhcbiAqIFRoZSBzeW50aCB3aGljaCBpcyBnb2luZyB0byBiZSBjb25uZWN0ZWQgdG8gdGhlIHBpYW5vXG4gKiBtdXN0IGhhdmUgYSBgc3RhcnRgIGFuZCBhIGBzdG9wYCBtZXRob2QgXG4gKi9cbmZ1bmN0aW9uIHRlc3RTeW50aCAoKSB7XG5cbiAgICB0aGlzLnN0YXJ0ID0gZnVuY3Rpb24gKGZyZXEsIG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5vc2NpbGxhdG9yID0gYXVkaW9DdHguY3JlYXRlT3NjaWxsYXRvcigpO1xuICAgICAgICB0aGlzLm9zY2lsbGF0b3IudHlwZSA9ICdzcXVhcmUnO1xuICAgICAgICB0aGlzLm9zY2lsbGF0b3IuZnJlcXVlbmN5LnZhbHVlID0gZnJlcTsgLy8gdmFsdWUgaW4gaGVydHpcbiAgICAgICAgdGhpcy5vc2NpbGxhdG9yLmNvbm5lY3QobWFzdGVyR2Fpbik7XG4gICAgICAgIG1hc3RlckdhaW4uY29ubmVjdChhdWRpb0N0eC5kZXN0aW5hdGlvbik7XG4gICAgICAgIHRoaXMub3NjaWxsYXRvci5zdGFydCgpO1xuICAgIH1cblxuICAgIHRoaXMuc3RvcCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5vc2NpbGxhdG9yLnN0b3AoKTtcbiAgICB9XG59XG5cbnZhciB0ZXN0U3ludGgyID0gcmVxdWlyZSgnLi9zeW50aCcpIFxuXG4kKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7XG5cbiAgICB2YXIgZWxlbUlEID0gJ3BpYW5vLWNvbnRhaW5lcidcbiAgICB2YXIgcCA9IG5ldyBwbHVnZ2FibGVTeW50aChlbGVtSUQsIHtcbiAgICAgICAgb2N0YXZlczogMixcbiAgICAgICAgb2N0YXZlQmVnaW46IDMgICAgXG4gICAgfSlcbiAgICBcbiAgICAvLyBEcmF3cyBwaWFub1xuICAgIHAuY3JlYXRlUGlhbm8oKVxuXG4gICAgLy8gU2V0IHN5bnRoXG4gICAgcC5zeW50aCA9IHRlc3RTeW50aDJcbiAgICBcbiAgICAvLyBFbmFibGUgb25lIG9jdGF2ZSBvZiBrZXlib2FyZFxuICAgIHAuZW5hYmxlS2V5Ym9hcmRFdmVudHMoKVxuICAgIFxuICAgIC8vIEFsbCBtaWRpIHRvbmVzIHdpbGwgYmUgcGxheWVkLCBidXQgb25seSB0d28gb2N0YXZlcyBpcyB2aXNpYmxlXG4gICAgLy8gWW91IGNhbiBzcGVjaWZ5IGlucHV0IHBvcnQsIGJ1dCBkZWZhdWx0cyB0byAxIFxuICAgIHAuZW5hYmxlTWlkaUV2ZW50cygxKVxuXG59KSJdfQ==
