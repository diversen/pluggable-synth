(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
function AdsrGainNode(ctx) {

    this.ctx = ctx;

    this.options = {
        attackAmp: 0.1, 
        decayAmp: 0.3,
        sustainAmp: 0.7,
        releaseAmp: 0.01,
        attackTime: 0.1,
        decayTime: 0.2,
        sustainTime: 1.0, 
        releaseTime: 3.4,
        autoRelease: true
    };

    /**
     * Set options or use defaults
     * @param {object} options 
     */
    this.setOptions = function (options) {
        this.options = Object.assign(this.options, options);
    };

    this.gainNode
    this.audioTime
    
    /**
     * Get a gain node from defined options
     * @param {float} audioTime an audio context time stamp
     */
    this.getGainNode =  (audioTime) => {

        this.gainNode = this.ctx.createGain();
        this.audioTime = audioTime

        this.gainNode.gain.setValueAtTime(0, audioTime)        
        
        // Attack
        this.gainNode.gain.exponentialRampToValueAtTime(
            this.options.attackAmp, 
            audioTime + this.options.attackTime)

        // Decay
        this.gainNode.gain.exponentialRampToValueAtTime(
            this.options.decayAmp, 
            audioTime + this.options.attackTime + this.options.decayTime)

        // Sustain
        this.gainNode.gain.exponentialRampToValueAtTime(
            this.options.sustainAmp, 
            audioTime + this.options.attackTime + this.options.sustainTime)

        // Check if auto-release
        // Then calculate when note should stop
        if (this.options.autoRelease) {
            this.gainNode.gain.exponentialRampToValueAtTime(
                this.options.releaseAmp,
                audioTime + this.releaseTime()
            )
            
            // Disconnect the gain node 
            this.disconnect(audioTime + this.releaseTime())
        }
        return this.gainNode;
    };

    /**
     * Release the note dynamicaly
     * E.g. if your are making a keyboard, and you want the note
     * to be released according to current audio time added the ADSR release time 
     */
    this.releaseNow = () => {
        this.gainNode.gain.exponentialRampToValueAtTime(
            this.options.releaseAmp,
            this.ctx.currentTime + this.options.releaseTime) 
        this.disconnect(this.options.releaseTime)
    }

    /**
     * Get release time according to the adsr release time
     */
    this.releaseTime = function() {
        return this.options.attackTime + this.options.decayTime + this.options.sustainTime + this.options.releaseTime
    }

    /**
     * Get release time according to 'now'
     */
    this.releaseTimeNow = function () {
        return this.ctx.currentTime + this.releaseTime()
    }
    
    /**
     * 
     * @param {float} disconnectTime the time when gainNode should disconnect 
     */
    this.disconnect = (disconnectTime) => {
        setTimeout( () => {
            this.gainNode.disconnect();
        },
        disconnectTime * 1000);
    };
}

module.exports = AdsrGainNode;

},{}],2:[function(require,module,exports){
function piano(elemID, opts) {

    this.elemID = elemID
    this.elem = document.getElementById(elemID)
    
    this.defaults = {
        octaves: 2,
        octaveBegin: 3
    }

    this.options = {}
    Object.assign(this.options, this.defaults, opts)
    
    this.createPiano = function () {
        let svg = this.getPianoSVG()
        this.elem.innerHTML = svg
    }

    this.getPianoSVG = function () {
        let boxX = this.options.octaves * 140
        
        let octaveBegin = this.options.octaveBegin
        let html = `
        <svg 
            xmlns="http://www.w3.org/2000/svg" 
            preserveAspectRatio="none" 
            viewBox="0 0 ${boxX} 80" 
            id="piano">
			<g>`;
        for (i = 1; i <= this.options.octaves; i++) {  
            html += this.getTones(octaveBegin)
            octaveBegin++ 
        }
        html += `
            </g>
		</svg>`
        return html
    }

    this.getNoteAndOctave = function (note, octave) {
        return note + octave
    }

    this.currentX = 0
    this.getCurrentX = function (x) {
        return x + this.currentX
    }

    this.getTones = function (octave) {
        let octaveHTML = 
        `
        <rect class="white c" data-note="${this.getNoteAndOctave('c', octave)}" width="20" height="80" x="${this.getCurrentX(0)}" y="0" />
        <rect class="white d" data-note="${this.getNoteAndOctave('d', octave)}" width="20" height="80" x="${this.getCurrentX(20)}" y="0" />
        <rect class="white e" data-note="${this.getNoteAndOctave('e', octave)}" width="20" height="80" x="${this.getCurrentX(40)}" y="0" />
        <rect class="white f" data-note="${this.getNoteAndOctave('f', octave)}" width="20" height="80" x="${this.getCurrentX(60)}" y="0" />
        <rect class="white g" data-note="${this.getNoteAndOctave('g', octave)}" width="20" height="80" x="${this.getCurrentX(80)}" y="0" />
        <rect class="white a" data-note="${this.getNoteAndOctave('a', octave)}" width="20" height="80" x="${this.getCurrentX(100)}" y="0" />
        <rect class="white b" data-note="${this.getNoteAndOctave('b', octave)}" width="20" height="80" x="${this.getCurrentX(120)}" y="0" />
        <rect class="black cs" data-note="${this.getNoteAndOctave('cs', octave)}" width="16" height="50" x="${this.getCurrentX(12)}" y="0" />
        <rect class="black ds" data-note="${this.getNoteAndOctave('ds', octave)}" width="16" height="50" x="${this.getCurrentX(32)}" y="0" />
        <rect class="black fs" data-note="${this.getNoteAndOctave('fs', octave)}" width="16" height="50" x="${this.getCurrentX(72)}" y="0" />
        <rect class="black gs" data-note="${this.getNoteAndOctave('gs', octave)}" width="16" height="50" x="${this.getCurrentX(92)}" y="0" />
        <rect class="black as" data-note="${this.getNoteAndOctave('as', octave)}" width="16" height="50" x="${this.getCurrentX(112)}" y="0" />`
    
        this.currentX+= 140
        return octaveHTML
    }
}

module.exports = piano;

},{}],3:[function(require,module,exports){
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n(t.NoteParser=t.NoteParser||{})}(this,function(t){"use strict";function n(t,n){return Array(n+1).join(t)}function r(t){return"number"==typeof t}function e(t){return"string"==typeof t}function u(t){return void 0!==t}function c(t,n){return Math.pow(2,(t-69)/12)*(n||440)}function o(){return b}function i(t,n,r){if("string"!=typeof t)return null;var e=b.exec(t);if(!e||!n&&e[4])return null;var u={letter:e[1].toUpperCase(),acc:e[2].replace(/x/g,"##")};u.pc=u.letter+u.acc,u.step=(u.letter.charCodeAt(0)+3)%7,u.alt="b"===u.acc[0]?-u.acc.length:u.acc.length;var o=A[u.step]+u.alt;return u.chroma=o<0?12+o:o%12,e[3]&&(u.oct=+e[3],u.midi=o+12*(u.oct+1),u.freq=c(u.midi,r)),n&&(u.tonicOf=e[4]),u}function f(t){return r(t)?t<0?n("b",-t):n("#",t):""}function a(t){return r(t)?""+t:""}function l(t,n,r){return null===t||void 0===t?null:t.step?l(t.step,t.alt,t.oct):t<0||t>6?null:C.charAt(t)+f(n)+a(r)}function p(t){if((r(t)||e(t))&&t>=0&&t<128)return+t;var n=i(t);return n&&u(n.midi)?n.midi:null}function s(t,n){var r=p(t);return null===r?null:c(r,n)}function d(t){return(i(t)||{}).letter}function m(t){return(i(t)||{}).acc}function h(t){return(i(t)||{}).pc}function v(t){return(i(t)||{}).step}function g(t){return(i(t)||{}).alt}function x(t){return(i(t)||{}).chroma}function y(t){return(i(t)||{}).oct}var b=/^([a-gA-G])(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)\s*$/,A=[0,2,4,5,7,9,11],C="CDEFGAB";t.regex=o,t.parse=i,t.build=l,t.midi=p,t.freq=s,t.letter=d,t.acc=m,t.pc=h,t.step=v,t.alt=g,t.chroma=x,t.oct=y});


},{}],4:[function(require,module,exports){
const noteParser = require('note-parser')
const keyboardTones = require('./keyboard-tones.js');
const jsSvgPiano = require('js-svg-piano');
const webmidi = require('webmidi')

var keys = {};

jsSvgPiano.prototype = {

    getFrequency: function (note) {
        note = note.replace('s', '#');
        let res = noteParser.parse(note)
        let freq = res.freq;
        return freq;
    },

    synth: function () {
        console.log('set a synth')
    },

    toggleKey: function (note) {
        note = note.toLowerCase(note)
        let selector = '#' + this.elemID + " rect[data-note='" + note + "']"
        let elem = document.querySelector(selector)
        if (!elem) {
            return
        }
        elem.classList.toggle('active');
    },

    synthStart: function (note, options) {

        this.toggleKey(note)
        let freq = this.getFrequency(note);
        let synth = new this.synth();

        synth.start(freq, options);
        console.log(note)
        keys[note] = synth;
    },

    synthStop: function (note) {

        this.toggleKey(note)
        let synth = keys[note]
        synth.stop()
        delete keys[note]
    },

    // Enable two octaves on keyboard
    enableKeyboardEvents: function () {
        document.addEventListener("keydown", (e) => {

            let k = e.code;
            let keyAry = keyboardTones[k];
            if (!keyAry) return

            let note = keyAry[0] + (keyAry[1] + this.options.octaveBegin)

            if (k in keyboardTones && !(note in keys)) {
                this.synthStart(note);
            }
        });

        document.addEventListener("keyup", (e) => {
            let k = e.code;
            let keyAry = keyboardTones[k];
            if (!keyAry) return
            
            let note = keyAry[0] + (keyAry[1] + this.options.octaveBegin)
            if (k in keyboardTones && (note in keys)) {
                this.synthStop(note)
            }
        });
    },
    
    // Enable mousedown and mouseup
    enableMouseEvents: function () {
        
        document.addEventListener("mousedown", (e) => {
            
            var note = e.srcElement.dataset.note;
            if (!note) {
                return;
            }

            this.synthStart(note);
        });

        document.addEventListener("mouseup", (e) => {

            var note = e.srcElement.dataset.note;
            if (note in keys) {
                this.synthStop(note)
            }
        });

        document.addEventListener("mouseout", (e) => {
            
            var note = e.srcElement.dataset.note;
            if (!note) {
                return;
            }
            
            if (note in keys) {
                this.synthStop(note)
            }
        });
    },


    // Enable midi keyboard
    enableMidiEvents: function (port) {
        if (port == undefined) {
            port = 1
        }

        webmidi.enable( (err) => {

            if (err) {
                console.log("WebMidi could not be enabled." + err);
                return false;
            }

            if ( !(port in webmidi.inputs)) {
               console.log('Modi port does not exists ' + port)
               return false;
            }

            // Port is ok
            var midiInput = webmidi.inputs[port];
            midiInput.addListener('noteon', "all", (e) => {

                let octave = parseInt(e.note.octave)
                let note = e.note.name + octave
                note = note.replace('#', 's')

                if (!(note in keys)) {
                    this.synthStart(note, e);
                }
            });

            midiInput.addListener('noteoff', "all", (e) => {
                let octave = parseInt(e.note.octave);
                let note = e.note.name + octave;

                note = note.replace('#', 's')

                this.synthStop(note)

            });
        })
    },
}

module.exports = jsSvgPiano;

},{"./keyboard-tones.js":5,"js-svg-piano":2,"note-parser":3,"webmidi":9}],5:[function(require,module,exports){
var keyboardTones = {
    KeyQ: ['c', 0],
    Digit2: ['cs', 0],
    KeyW: ['d', 0],
    Digit3: ['ds', 0],
    KeyE: ['e', 0],
    KeyR: ['f',0],
    Digit5: ['fs',0],
    KeyT: ['g',0],
    Digit6: ['gs',0],
    KeyY: ['a',0],
    Digit7: ['as',0],
    KeyU: ['b',0],

    KeyZ: ['c',1],
    KeyS: ['cs',1],
    KeyX: ['d',1],
    KeyD: ['ds',1],
    KeyC: ['e',1],
    KeyV: ['f',1],
    KeyG: ['fs',1],
    KeyB: ['g',1],
    KeyH: ['gs',1],
    KeyN: ['a',1],
    KeyJ: ['as',1],
    KeyM: ['b',1]
};

module.exports = keyboardTones;

},{}],6:[function(require,module,exports){
const toneFrequency = require('tone-frequency');
const adsrGainNode = require('adsr-gain-node');

let audioCtx = new AudioContext(); 
let masterGain = audioCtx.createGain();

masterGain.gain.setTargetAtTime(0.3, audioCtx.currentTime, 0.0)
// masterGain.gain.value = 0.3;
masterGain.connect(audioCtx.destination);

function getBeatingOsc(audioCtx, freq, velocity) {

    this.osc1 = audioCtx.createOscillator();
    this.osc1.type = 'square';

    this.osc2 = audioCtx.createOscillator();
    this.osc2.type = 'square';
    
    this.osc3 = audioCtx.createOscillator();
    this.osc3.type = 'square';

    let synthGain = new adsrGainNode(audioCtx);
    
    if (velocity === undefined) {
        velocity = 0.3
    } 
    
    
    synthGain.setOptions({
        initGain: 0.1, // Init gain on note
        maxGain: velocity, // Max gain on note
        attackTime: 1.0, // AttackTime. gain.init to gain.max in attackTime
        sustainTime: 0.2, // Sustain note in time
        releaseTime: 0.5 // Approximated end time. Calculated with secondsToTimeConstant()
    
    });
    
    this.gain = synthGain.getGainNode(audioCtx.currentTime);

    // this.osc1.frequency.value = freq // e.g. 400
    this.osc1.frequency.setValueAtTime(freq, audioCtx.currentTime)
    // this.osc2.frequency.value = freq + (freq*0.01) // Add a little
    this.osc2.frequency.setValueAtTime(freq, audioCtx.currentTime)

    this.osc1.connect(this.gain);
    this.osc2.connect(this.gain);
    this.gain.connect(masterGain);

    this.start = function() {
        this.osc1.start();
        this.osc2.start();
        this.osc3.start();
    }

    this.disconnect = function () {

        let length = audioCtx.currentTime + synthGain.getTotalLength();
        this.osc1.stop(length);
        this.osc2.stop(length);
        this.osc3.stop(length);
    }
}

function getMultiBeatingOsc () {

    this.start = function(freq, options) {

        let velocity = 0.3
        if (options) {
            velocity = options.velocity
        }

        toneFrequency.base = freq;
        this.synth1 = new getBeatingOsc(audioCtx, freq, velocity)
    
        let lowFreq = toneFrequency.getToneStep(+7)
        this.synth2 = new getBeatingOsc(audioCtx, lowFreq*2, velocity)
    
        let highFreq = toneFrequency.getToneStep(+12)
        this.synth3 = new getBeatingOsc(audioCtx, lowFreq*3, velocity)

        this.synth1.start();
        this.synth2.start();
        this.synth3.start();
    }

    this.stop = function () {
        this.synth1.disconnect();
        this.synth2.disconnect();
        //this.synth3.disconnect();
    }
}

module.exports = getMultiBeatingOsc

},{"adsr-gain-node":1,"tone-frequency":8}],7:[function(require,module,exports){
// Use it like this:  
// const synth = require('pluggable-synth')
// But this is the test so include index
const pluggableSynth = require('./index')

const audioCtx = new AudioContext(); 
const masterGain = audioCtx.createGain();
masterGain.gain.setTargetAtTime(0.1, audioCtx.currentTime, 0.5)
// masterGain.gain.value = 0.1;

/**
 * A very simple example synth object
 * The synth which is going to be connected to the piano.
 * Implement a `start` and a `stop` method 
 * 
 * 
 */
function testSynth () {

    this.start = function (freq, options) {

        this.oscillator = audioCtx.createOscillator();
        this.oscillator.type = 'square';
        this.oscillator.frequency.value = freq; // value in hertz
        this.oscillator.connect(masterGain);
        masterGain.connect(audioCtx.destination);
        this.oscillator.start();
    }

    this.stop = function () {
        this.oscillator.stop();
    }
}

// Use a more interesting synth
var testSynth2 = require('./synth') 

$(document).ready(function () {

    var elemID = 'piano-container'
    var p = new pluggableSynth(elemID, {
        octaves: 3, 
        octaveBegin: 3    
    })
    
    // Draws the piano
    p.createPiano()

    // Set synth to test synth above
    p.synth = testSynth2
    
    // enable keyboard events
    p.enableKeyboardEvents()
    
    // Enable mouse events
    p.enableMouseEvents()
    
    // All midi tones will be played, but only 3 octaves is visible
    // You can specify input port, but defaults to 1 
    p.enableMidiEvents(1)

})

},{"./index":4,"./synth":6}],8:[function(require,module,exports){
// See e.g. http://www.phy.mtu.edu/~suits/NoteFreqCalcs.html
function noteFrequency() {
    
    this.base = 440; // A
    this.numSteps = 12; // 12
    
    this.getStepSize = function () {
        return Math.pow(2, 1/this.numSteps);
    };
    
    // Return hz of the step, e.g. for the default settings tihs yields:
    // 0 = 440 (A)
    // 5 = 587.329... (D)
    // -12 = 220 
    this.getToneStep =function(step) {
        return Math.pow(this.getStepSize(), step) * this.base;
    };  
}

module.exports = new noteFrequency();

},{}],9:[function(require,module,exports){
/*

WebMidi v2.0.4

WebMidi.js helps you tame the Web MIDI API. Send and receive MIDI messages with ease. Control instruments with user-friendly functions (playNote, sendPitchBend, etc.). React to MIDI input with simple event listeners (noteon, pitchbend, controlchange, etc.).
https://github.com/cotejp/webmidi


The MIT License (MIT)

Copyright (c) 2015-2018, Jean-Philippe Côté

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and
associated documentation files (the "Software"), to deal in the Software without restriction,
including without limitation the rights to use, copy, modify, merge, publish, distribute,
sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial
portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT
NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES
OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

*/

!function(scope){"use strict";function WebMidi(){if(WebMidi.prototype._singleton)throw new Error("WebMidi is a singleton, it cannot be instantiated directly.");WebMidi.prototype._singleton=this,this._inputs=[],this._outputs=[],this._userHandlers={},this._stateChangeQueue=[],this._processingStateChange=!1,this._midiInterfaceEvents=["connected","disconnected"],this._notes=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],this._semitones={C:0,D:2,E:4,F:5,G:7,A:9,B:11},Object.defineProperties(this,{MIDI_SYSTEM_MESSAGES:{value:{sysex:240,timecode:241,songposition:242,songselect:243,tuningrequest:246,sysexend:247,clock:248,start:250,"continue":251,stop:252,activesensing:254,reset:255,unknownsystemmessage:-1},writable:!1,enumerable:!0,configurable:!1},MIDI_CHANNEL_MESSAGES:{value:{noteoff:8,noteon:9,keyaftertouch:10,controlchange:11,channelmode:11,programchange:12,channelaftertouch:13,pitchbend:14},writable:!1,enumerable:!0,configurable:!1},MIDI_REGISTERED_PARAMETER:{value:{pitchbendrange:[0,0],channelfinetuning:[0,1],channelcoarsetuning:[0,2],tuningprogram:[0,3],tuningbank:[0,4],modulationrange:[0,5],azimuthangle:[61,0],elevationangle:[61,1],gain:[61,2],distanceratio:[61,3],maximumdistance:[61,4],maximumdistancegain:[61,5],referencedistanceratio:[61,6],panspreadangle:[61,7],rollangle:[61,8]},writable:!1,enumerable:!0,configurable:!1},MIDI_CONTROL_CHANGE_MESSAGES:{value:{bankselectcoarse:0,modulationwheelcoarse:1,breathcontrollercoarse:2,footcontrollercoarse:4,portamentotimecoarse:5,dataentrycoarse:6,volumecoarse:7,balancecoarse:8,pancoarse:10,expressioncoarse:11,effectcontrol1coarse:12,effectcontrol2coarse:13,generalpurposeslider1:16,generalpurposeslider2:17,generalpurposeslider3:18,generalpurposeslider4:19,bankselectfine:32,modulationwheelfine:33,breathcontrollerfine:34,footcontrollerfine:36,portamentotimefine:37,dataentryfine:38,volumefine:39,balancefine:40,panfine:42,expressionfine:43,effectcontrol1fine:44,effectcontrol2fine:45,holdpedal:64,portamento:65,sustenutopedal:66,softpedal:67,legatopedal:68,hold2pedal:69,soundvariation:70,resonance:71,soundreleasetime:72,soundattacktime:73,brightness:74,soundcontrol6:75,soundcontrol7:76,soundcontrol8:77,soundcontrol9:78,soundcontrol10:79,generalpurposebutton1:80,generalpurposebutton2:81,generalpurposebutton3:82,generalpurposebutton4:83,reverblevel:91,tremololevel:92,choruslevel:93,celestelevel:94,phaserlevel:95,databuttonincrement:96,databuttondecrement:97,nonregisteredparametercoarse:98,nonregisteredparameterfine:99,registeredparametercoarse:100,registeredparameterfine:101},writable:!1,enumerable:!0,configurable:!1},MIDI_CHANNEL_MODE_MESSAGES:{value:{allsoundoff:120,resetallcontrollers:121,localcontrol:122,allnotesoff:123,omnimodeoff:124,omnimodeon:125,monomodeon:126,polymodeon:127},writable:!1,enumerable:!0,configurable:!1}}),Object.defineProperties(this,{supported:{enumerable:!0,get:function(){return"requestMIDIAccess"in navigator}},enabled:{enumerable:!0,get:function(){return void 0!==this["interface"]}.bind(this)},inputs:{enumerable:!0,get:function(){return this._inputs}.bind(this)},outputs:{enumerable:!0,get:function(){return this._outputs}.bind(this)},sysexEnabled:{enumerable:!0,get:function(){return!(!this["interface"]||!this["interface"].sysexEnabled)}.bind(this)},time:{enumerable:!0,get:function(){return performance.now()}}})}function Input(midiInput){var that=this;this._userHandlers={channel:{},system:{}},this._midiInput=midiInput,Object.defineProperties(this,{connection:{enumerable:!0,get:function(){return that._midiInput.connection}},id:{enumerable:!0,get:function(){return that._midiInput.id}},manufacturer:{enumerable:!0,get:function(){return that._midiInput.manufacturer}},name:{enumerable:!0,get:function(){return that._midiInput.name}},state:{enumerable:!0,get:function(){return that._midiInput.state}},type:{enumerable:!0,get:function(){return that._midiInput.type}}}),this._initializeUserHandlers()}function Output(midiOutput){var that=this;this._midiOutput=midiOutput,Object.defineProperties(this,{connection:{enumerable:!0,get:function(){return that._midiOutput.connection}},id:{enumerable:!0,get:function(){return that._midiOutput.id}},manufacturer:{enumerable:!0,get:function(){return that._midiOutput.manufacturer}},name:{enumerable:!0,get:function(){return that._midiOutput.name}},state:{enumerable:!0,get:function(){return that._midiOutput.state}},type:{enumerable:!0,get:function(){return that._midiOutput.type}}})}var wm=new WebMidi;WebMidi.prototype.enable=function(callback,sysex){return this.enabled?void 0:this.supported?void navigator.requestMIDIAccess({sysex:sysex}).then(function(midiAccess){function onPortsOpen(){this._updateInputsAndOutputs(),this["interface"].onstatechange=this._onInterfaceStateChange.bind(this),"function"==typeof callback&&callback.call(this),events.forEach(function(event){this._onInterfaceStateChange(event)}.bind(this))}var events=[],promises=[];this["interface"]=midiAccess,this._resetInterfaceUserHandlers(),this["interface"].onstatechange=function(e){events.push(e)};for(var inputs=midiAccess.inputs.values(),input=inputs.next();input&&!input.done;input=inputs.next())promises.push(input.value.open());for(var outputs=midiAccess.outputs.values(),output=outputs.next();output&&!output.done;output=outputs.next())promises.push(output.value.open());Promise?Promise.all(promises)["catch"](function(err){}).then(onPortsOpen.bind(this)):setTimeout(onPortsOpen.bind(this),200)}.bind(this),function(err){"function"==typeof callback&&callback.call(this,err)}.bind(this)):void("function"==typeof callback&&callback(new Error("The Web MIDI API is not supported by your browser.")))},WebMidi.prototype.disable=function(){if(!this.supported)throw new Error("The Web MIDI API is not supported by your browser.");this["interface"]&&(this["interface"].onstatechange=void 0),this["interface"]=void 0,this._inputs=[],this._outputs=[],this._resetInterfaceUserHandlers()},WebMidi.prototype.addListener=function(type,listener){if(!this.enabled)throw new Error("WebMidi must be enabled before adding event listeners.");if("function"!=typeof listener)throw new TypeError("The 'listener' parameter must be a function.");if(!(this._midiInterfaceEvents.indexOf(type)>=0))throw new TypeError("The specified event type is not supported.");return this._userHandlers[type].push(listener),this},WebMidi.prototype.hasListener=function(type,listener){if(!this.enabled)throw new Error("WebMidi must be enabled before checking event listeners.");if("function"!=typeof listener)throw new TypeError("The 'listener' parameter must be a function.");if(!(this._midiInterfaceEvents.indexOf(type)>=0))throw new TypeError("The specified event type is not supported.");for(var o=0;o<this._userHandlers[type].length;o++)if(this._userHandlers[type][o]===listener)return!0;return!1},WebMidi.prototype.removeListener=function(type,listener){if(!this.enabled)throw new Error("WebMidi must be enabled before removing event listeners.");if(void 0!==listener&&"function"!=typeof listener)throw new TypeError("The 'listener' parameter must be a function.");if(this._midiInterfaceEvents.indexOf(type)>=0)if(listener)for(var o=0;o<this._userHandlers[type].length;o++)this._userHandlers[type][o]===listener&&this._userHandlers[type].splice(o,1);else this._userHandlers[type]=[];else{if(void 0!==type)throw new TypeError("The specified event type is not supported.");this._resetInterfaceUserHandlers()}return this},WebMidi.prototype.toMIDIChannels=function(channel){var channels;return channels="all"===channel||void 0===channel?["all"]:Array.isArray(channel)?channel:[channel],channels.indexOf("all")>-1&&(channels=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]),channels.map(function(ch){return parseInt(ch)}).filter(function(ch){return ch>=1&&16>=ch})},WebMidi.prototype.getInputById=function(id){if(!this.enabled)throw new Error("WebMidi is not enabled.");for(var i=0;i<this.inputs.length;i++)if(this.inputs[i].id===id)return this.inputs[i];return!1},WebMidi.prototype.getOutputById=function(id){if(!this.enabled)throw new Error("WebMidi is not enabled.");for(var i=0;i<this.outputs.length;i++)if(this.outputs[i].id===id)return this.outputs[i];return!1},WebMidi.prototype.getInputByName=function(name){if(!this.enabled)throw new Error("WebMidi is not enabled.");for(var i=0;i<this.inputs.length;i++)if(~this.inputs[i].name.indexOf(name))return this.inputs[i];return!1},WebMidi.prototype.getOctave=function(number){return number&&number>=0&&127>=number?Math.floor(parseInt(number)/12-1)-1:void 0},WebMidi.prototype.getOutputByName=function(name){if(!this.enabled)throw new Error("WebMidi is not enabled.");for(var i=0;i<this.outputs.length;i++)if(~this.outputs[i].name.indexOf(name))return this.outputs[i];return!1},WebMidi.prototype.guessNoteNumber=function(input){var output=!1;if(input&&input.toFixed&&input>=0&&127>=input?output=Math.round(input):parseInt(input)>=0&&parseInt(input)<=127?output=parseInt(input):("string"==typeof input||input instanceof String)&&(output=this.noteNameToNumber(input)),output===!1)throw new Error("Invalid note number ("+input+").");return output},WebMidi.prototype.noteNameToNumber=function(name){"string"!=typeof name&&(name="");var matches=name.match(/([CDEFGAB])(#{0,2}|b{0,2})(-?\d+)/i);if(!matches)throw new RangeError("Invalid note name.");var semitones=wm._semitones[matches[1].toUpperCase()],octave=parseInt(matches[3]),result=12*(octave+2)+semitones;if(matches[2].toLowerCase().indexOf("b")>-1?result-=matches[2].length:matches[2].toLowerCase().indexOf("#")>-1&&(result+=matches[2].length),0>semitones||-2>octave||octave>8||0>result||result>127)throw new RangeError("Invalid note name or note outside valid range.");return result},WebMidi.prototype._updateInputsAndOutputs=function(){this._updateInputs(),this._updateOutputs()},WebMidi.prototype._updateInputs=function(){for(var i=0;i<this._inputs.length;i++){for(var remove=!0,updated=this["interface"].inputs.values(),input=updated.next();input&&!input.done;input=updated.next())if(this._inputs[i]._midiInput===input.value){remove=!1;break}remove&&this._inputs.splice(i,1)}this["interface"]&&this["interface"].inputs.forEach(function(nInput){for(var add=!0,j=0;j<this._inputs.length;j++)this._inputs[j]._midiInput===nInput&&(add=!1);add&&this._inputs.push(this._createInput(nInput))}.bind(this))},WebMidi.prototype._updateOutputs=function(){for(var i=0;i<this._outputs.length;i++){for(var remove=!0,updated=this["interface"].outputs.values(),output=updated.next();output&&!output.done;output=updated.next())if(this._outputs[i]._midiOutput===output.value){remove=!1;break}remove&&this._outputs.splice(i,1)}this["interface"]&&this["interface"].outputs.forEach(function(nOutput){for(var add=!0,j=0;j<this._outputs.length;j++)this._outputs[j]._midiOutput===nOutput&&(add=!1);add&&this._outputs.push(this._createOutput(nOutput))}.bind(this))},WebMidi.prototype._createInput=function(midiInput){var input=new Input(midiInput);return input._midiInput.onmidimessage=input._onMidiMessage.bind(input),input},WebMidi.prototype._createOutput=function(midiOutput){var output=new Output(midiOutput);return output._midiOutput.onmidimessage=output._onMidiMessage.bind(output),output},WebMidi.prototype._onInterfaceStateChange=function(e){this._updateInputsAndOutputs();var event={timestamp:e.timeStamp,type:e.port.state};this["interface"]&&"connected"===e.port.state?"output"===e.port.type?event.port=this.getOutputById(e.port.id):"input"===e.port.type&&(event.port=this.getInputById(e.port.id)):event.port={connection:"closed",id:e.port.id,manufacturer:e.port.manufacturer,name:e.port.name,state:e.port.state,type:e.port.type},this._userHandlers[e.port.state].forEach(function(handler){handler(event)})},WebMidi.prototype._resetInterfaceUserHandlers=function(){for(var i=0;i<this._midiInterfaceEvents.length;i++)this._userHandlers[this._midiInterfaceEvents[i]]=[]},Input.prototype.addListener=function(type,channel,listener){var that=this;if(void 0===channel&&(channel="all"),Array.isArray(channel)||(channel=[channel]),channel.forEach(function(item){if("all"!==item&&!(item>=1&&16>=item))throw new RangeError("The 'channel' parameter is invalid.")}),"function"!=typeof listener)throw new TypeError("The 'listener' parameter must be a function.");if(wm.MIDI_SYSTEM_MESSAGES[type])this._userHandlers.system[type]||(this._userHandlers.system[type]=[]),this._userHandlers.system[type].push(listener);else{if(!wm.MIDI_CHANNEL_MESSAGES[type])throw new TypeError("The specified event type is not supported.");if(channel.indexOf("all")>-1){channel=[];for(var j=1;16>=j;j++)channel.push(j)}this._userHandlers.channel[type]||(this._userHandlers.channel[type]=[]),channel.forEach(function(ch){that._userHandlers.channel[type][ch]||(that._userHandlers.channel[type][ch]=[]),that._userHandlers.channel[type][ch].push(listener)})}return this},Input.prototype.on=Input.prototype.addListener,Input.prototype.hasListener=function(type,channel,listener){var that=this;if("function"!=typeof listener)throw new TypeError("The 'listener' parameter must be a function.");if(void 0===channel&&(channel="all"),channel.constructor!==Array&&(channel=[channel]),wm.MIDI_SYSTEM_MESSAGES[type]){for(var o=0;o<this._userHandlers.system[type].length;o++)if(this._userHandlers.system[type][o]===listener)return!0}else if(wm.MIDI_CHANNEL_MESSAGES[type]){if(channel.indexOf("all")>-1){channel=[];for(var j=1;16>=j;j++)channel.push(j)}return this._userHandlers.channel[type]?channel.every(function(chNum){var listeners=that._userHandlers.channel[type][chNum];return listeners&&listeners.indexOf(listener)>-1}):!1}return!1},Input.prototype.removeListener=function(type,channel,listener){var that=this;if(void 0!==listener&&"function"!=typeof listener)throw new TypeError("The 'listener' parameter must be a function.");if(void 0===channel&&(channel="all"),channel.constructor!==Array&&(channel=[channel]),wm.MIDI_SYSTEM_MESSAGES[type])if(void 0===listener)this._userHandlers.system[type]=[];else for(var o=0;o<this._userHandlers.system[type].length;o++)this._userHandlers.system[type][o]===listener&&this._userHandlers.system[type].splice(o,1);else if(wm.MIDI_CHANNEL_MESSAGES[type]){if(channel.indexOf("all")>-1){channel=[];for(var j=1;16>=j;j++)channel.push(j)}if(!this._userHandlers.channel[type])return this;channel.forEach(function(chNum){var listeners=that._userHandlers.channel[type][chNum];if(listeners)if(void 0===listener)that._userHandlers.channel[type][chNum]=[];else for(var l=0;l<listeners.length;l++)listeners[l]===listener&&listeners.splice(l,1)})}else{if(void 0!==type)throw new TypeError("The specified event type is not supported.");this._initializeUserHandlers()}return this},Input.prototype._initializeUserHandlers=function(){for(var prop1 in wm.MIDI_CHANNEL_MESSAGES)wm.MIDI_CHANNEL_MESSAGES.hasOwnProperty(prop1)&&(this._userHandlers.channel[prop1]={});for(var prop2 in wm.MIDI_SYSTEM_MESSAGES)wm.MIDI_SYSTEM_MESSAGES.hasOwnProperty(prop2)&&(this._userHandlers.system[prop2]=[])},Input.prototype._onMidiMessage=function(e){e.data[0]<240?this._parseChannelEvent(e):e.data[0]<=255&&this._parseSystemEvent(e)},Input.prototype._parseChannelEvent=function(e){var data1,data2,command=e.data[0]>>4,channel=(15&e.data[0])+1;e.data.length>1&&(data1=e.data[1],data2=e.data.length>2?e.data[2]:void 0);var event={target:this,data:e.data,timestamp:e.timeStamp,channel:channel};command===wm.MIDI_CHANNEL_MESSAGES.noteoff||command===wm.MIDI_CHANNEL_MESSAGES.noteon&&0===data2?(event.type="noteoff",event.note={number:data1,name:wm._notes[data1%12],octave:wm.getOctave(data1)},event.velocity=data2/127,event.rawVelocity=data2):command===wm.MIDI_CHANNEL_MESSAGES.noteon?(event.type="noteon",event.note={number:data1,name:wm._notes[data1%12],octave:wm.getOctave(data1)},event.velocity=data2/127,event.rawVelocity=data2):command===wm.MIDI_CHANNEL_MESSAGES.keyaftertouch?(event.type="keyaftertouch",event.note={number:data1,name:wm._notes[data1%12],octave:wm.getOctave(data1)},event.value=data2/127):command===wm.MIDI_CHANNEL_MESSAGES.controlchange&&data1>=0&&119>=data1?(event.type="controlchange",event.controller={number:data1,name:this.getCcNameByNumber(data1)},event.value=data2):command===wm.MIDI_CHANNEL_MESSAGES.channelmode&&data1>=120&&127>=data1?(event.type="channelmode",event.controller={number:data1,name:this.getChannelModeByNumber(data1)},event.value=data2):command===wm.MIDI_CHANNEL_MESSAGES.programchange?(event.type="programchange",event.value=data1):command===wm.MIDI_CHANNEL_MESSAGES.channelaftertouch?(event.type="channelaftertouch",event.value=data1/127):command===wm.MIDI_CHANNEL_MESSAGES.pitchbend?(event.type="pitchbend",event.value=((data2<<7)+data1-8192)/8192):event.type="unknownchannelmessage",this._userHandlers.channel[event.type]&&this._userHandlers.channel[event.type][channel]&&this._userHandlers.channel[event.type][channel].forEach(function(callback){callback(event)})},Input.prototype.getCcNameByNumber=function(number){if(number=parseInt(number),!(number>=0&&119>=number))throw new RangeError("The control change number must be between 0 and 119.");for(var cc in wm.MIDI_CONTROL_CHANGE_MESSAGES)if(number===wm.MIDI_CONTROL_CHANGE_MESSAGES[cc])return cc;return void 0},Input.prototype.getChannelModeByNumber=function(number){if(number=parseInt(number),!(number>=120&&status<=127))throw new RangeError("The control change number must be between 120 and 127.");for(var cm in wm.MIDI_CHANNEL_MODE_MESSAGES)if(number===wm.MIDI_CHANNEL_MODE_MESSAGES[cm])return cm},Input.prototype._parseSystemEvent=function(e){var command=e.data[0],event={target:this,data:e.data,timestamp:e.timeStamp};command===wm.MIDI_SYSTEM_MESSAGES.sysex?event.type="sysex":command===wm.MIDI_SYSTEM_MESSAGES.timecode?event.type="timecode":command===wm.MIDI_SYSTEM_MESSAGES.songposition?event.type="songposition":command===wm.MIDI_SYSTEM_MESSAGES.songselect?(event.type="songselect",event.song=e.data[1]):command===wm.MIDI_SYSTEM_MESSAGES.tuningrequest?event.type="tuningrequest":command===wm.MIDI_SYSTEM_MESSAGES.clock?event.type="clock":command===wm.MIDI_SYSTEM_MESSAGES.start?event.type="start":command===wm.MIDI_SYSTEM_MESSAGES["continue"]?event.type="continue":command===wm.MIDI_SYSTEM_MESSAGES.stop?event.type="stop":command===wm.MIDI_SYSTEM_MESSAGES.activesensing?event.type="activesensing":command===wm.MIDI_SYSTEM_MESSAGES.reset?event.type="reset":event.type="unknownsystemmessage",this._userHandlers.system[event.type]&&this._userHandlers.system[event.type].forEach(function(callback){callback(event)})},Output.prototype.send=function(status,data,timestamp){if(!(status>=128&&255>=status))throw new RangeError("The status byte must be an integer between 128 (0x80) and 255 (0xFF).");void 0===data&&(data=[]),Array.isArray(data)||(data=[data]);var message=[];return data.forEach(function(item,index){var parsed=parseInt(item);if(!(parsed>=0&&255>=parsed))throw new RangeError("Data bytes must be integers between 0 (0x00) and 255 (0xFF).");message.push(parsed)}),this._midiOutput.send([status].concat(message),parseFloat(timestamp)||0),this},Output.prototype.sendSysex=function(manufacturer,data,options){if(!wm.sysexEnabled)throw new Error("Sysex message support must first be activated.");return options=options||{},manufacturer=[].concat(manufacturer),data.forEach(function(item){if(0>item||item>127)throw new RangeError("The data bytes of a sysex message must be integers between 0 (0x00) and 127 (0x7F).")}),data=manufacturer.concat(data,wm.MIDI_SYSTEM_MESSAGES.sysexend),this.send(wm.MIDI_SYSTEM_MESSAGES.sysex,data,this._parseTimeParameter(options.time)),this},Output.prototype.sendTimecodeQuarterFrame=function(value,options){return options=options||{},this.send(wm.MIDI_SYSTEM_MESSAGES.timecode,value,this._parseTimeParameter(options.time)),this},Output.prototype.sendSongPosition=function(value,options){value=parseInt(value)||0,options=options||{};var msb=value>>7&127,lsb=127&value;return this.send(wm.MIDI_SYSTEM_MESSAGES.songposition,[msb,lsb],this._parseTimeParameter(options.time)),this},Output.prototype.sendSongSelect=function(value,options){if(value=parseInt(value),options=options||{},!(value>=0&&127>=value))throw new RangeError("The song number must be between 0 and 127.");return this.send(wm.MIDI_SYSTEM_MESSAGES.songselect,[value],this._parseTimeParameter(options.time)),this},Output.prototype.sendTuningRequest=function(options){return options=options||{},this.send(wm.MIDI_SYSTEM_MESSAGES.tuningrequest,void 0,this._parseTimeParameter(options.time)),this},Output.prototype.sendClock=function(options){return options=options||{},this.send(wm.MIDI_SYSTEM_MESSAGES.clock,void 0,this._parseTimeParameter(options.time)),this},Output.prototype.sendStart=function(options){return options=options||{},this.send(wm.MIDI_SYSTEM_MESSAGES.start,void 0,this._parseTimeParameter(options.time)),this},Output.prototype.sendContinue=function(options){return options=options||{},this.send(wm.MIDI_SYSTEM_MESSAGES["continue"],void 0,this._parseTimeParameter(options.time)),this},Output.prototype.sendStop=function(options){return options=options||{},this.send(wm.MIDI_SYSTEM_MESSAGES.stop,void 0,this._parseTimeParameter(options.time)),this},Output.prototype.sendActiveSensing=function(options){return options=options||{},this.send(wm.MIDI_SYSTEM_MESSAGES.activesensing,[],this._parseTimeParameter(options.time)),this},Output.prototype.sendReset=function(options){return options=options||{},this.send(wm.MIDI_SYSTEM_MESSAGES.reset,void 0,this._parseTimeParameter(options.time)),this},Output.prototype.stopNote=function(note,channel,options){if("all"===note)return this.sendChannelMode("allnotesoff",0,channel,options);var nVelocity=64;return options=options||{},options.velocity=parseFloat(options.velocity),options.rawVelocity?!isNaN(options.velocity)&&options.velocity>=0&&options.velocity<=127&&(nVelocity=options.velocity):!isNaN(options.velocity)&&options.velocity>=0&&options.velocity<=1&&(nVelocity=127*options.velocity),this._convertNoteToArray(note).forEach(function(item){wm.toMIDIChannels(channel).forEach(function(ch){this.send((wm.MIDI_CHANNEL_MESSAGES.noteoff<<4)+(ch-1),[item,Math.round(nVelocity)],this._parseTimeParameter(options.time))}.bind(this))}.bind(this)),this},Output.prototype.playNote=function(note,channel,options){var nVelocity=64;if(options=options||{},options.velocity=parseFloat(options.velocity),options.rawVelocity?!isNaN(options.velocity)&&options.velocity>=0&&options.velocity<=127&&(nVelocity=options.velocity):!isNaN(options.velocity)&&options.velocity>=0&&options.velocity<=1&&(nVelocity=127*options.velocity),options.time=this._parseTimeParameter(options.time),this._convertNoteToArray(note).forEach(function(item){wm.toMIDIChannels(channel).forEach(function(ch){this.send((wm.MIDI_CHANNEL_MESSAGES.noteon<<4)+(ch-1),[item,Math.round(nVelocity)],options.time)}.bind(this))}.bind(this)),options.duration=parseFloat(options.duration),options.duration){options.duration<=0&&(options.duration=0);var nRelease=64;options.release=parseFloat(options.release),options.rawVelocity?!isNaN(options.release)&&options.release>=0&&options.release<=127&&(nRelease=options.release):!isNaN(options.release)&&options.release>=0&&options.release<=1&&(nRelease=127*options.release),this._convertNoteToArray(note).forEach(function(item){wm.toMIDIChannels(channel).forEach(function(ch){this.send((wm.MIDI_CHANNEL_MESSAGES.noteoff<<4)+(ch-1),[item,Math.round(nRelease)],(options.time||wm.time)+options.duration)}.bind(this))}.bind(this))}return this},Output.prototype.sendKeyAftertouch=function(note,channel,pressure,options){var that=this;if(options=options||{},1>channel||channel>16)throw new RangeError("The channel must be between 1 and 16.");pressure=parseFloat(pressure),(isNaN(pressure)||0>pressure||pressure>1)&&(pressure=.5);var nPressure=Math.round(127*pressure);return this._convertNoteToArray(note).forEach(function(item){wm.toMIDIChannels(channel).forEach(function(ch){that.send((wm.MIDI_CHANNEL_MESSAGES.keyaftertouch<<4)+(ch-1),[item,nPressure],that._parseTimeParameter(options.time))})}),this},Output.prototype.sendControlChange=function(controller,value,channel,options){if(options=options||{},"string"==typeof controller){if(controller=wm.MIDI_CONTROL_CHANGE_MESSAGES[controller],!controller)throw new TypeError("Invalid controller name.")}else if(controller=parseInt(controller),!(controller>=0&&119>=controller))throw new RangeError("Controller numbers must be between 0 and 119.");if(value=parseInt(value)||0,!(value>=0&&127>=value))throw new RangeError("Controller value must be between 0 and 127.");return wm.toMIDIChannels(channel).forEach(function(ch){this.send((wm.MIDI_CHANNEL_MESSAGES.controlchange<<4)+(ch-1),[controller,value],this._parseTimeParameter(options.time))}.bind(this)),this},Output.prototype._selectRegisteredParameter=function(parameter,channel,time){var that=this;if(parameter[0]=parseInt(parameter[0]),!(parameter[0]>=0&&parameter[0]<=127))throw new RangeError("The control65 value must be between 0 and 127");if(parameter[1]=parseInt(parameter[1]),!(parameter[1]>=0&&parameter[1]<=127))throw new RangeError("The control64 value must be between 0 and 127");return wm.toMIDIChannels(channel).forEach(function(ch){that.sendControlChange(101,parameter[0],channel,{time:time}),that.sendControlChange(100,parameter[1],channel,{time:time})}),this},Output.prototype._selectNonRegisteredParameter=function(parameter,channel,time){var that=this;if(parameter[0]=parseInt(parameter[0]),!(parameter[0]>=0&&parameter[0]<=127))throw new RangeError("The control63 value must be between 0 and 127");if(parameter[1]=parseInt(parameter[1]),!(parameter[1]>=0&&parameter[1]<=127))throw new RangeError("The control62 value must be between 0 and 127");return wm.toMIDIChannels(channel).forEach(function(ch){that.sendControlChange(99,parameter[0],channel,{time:time}),that.sendControlChange(98,parameter[1],channel,{time:time})}),this},Output.prototype._setCurrentRegisteredParameter=function(data,channel,time){var that=this;if(data=[].concat(data),data[0]=parseInt(data[0]),!(data[0]>=0&&data[0]<=127))throw new RangeError("The msb value must be between 0 and 127");return wm.toMIDIChannels(channel).forEach(function(ch){that.sendControlChange(6,data[0],channel,{time:time})}),data[1]=parseInt(data[1]),data[1]>=0&&data[1]<=127&&wm.toMIDIChannels(channel).forEach(function(ch){that.sendControlChange(38,data[1],channel,{time:time})}),this},Output.prototype._deselectRegisteredParameter=function(channel,time){var that=this;return wm.toMIDIChannels(channel).forEach(function(ch){that.sendControlChange(101,127,channel,{time:time}),that.sendControlChange(100,127,channel,{time:time})}),this},Output.prototype.setRegisteredParameter=function(parameter,data,channel,options){var that=this;if(options=options||{},!Array.isArray(parameter)){if(!wm.MIDI_REGISTERED_PARAMETER[parameter])throw new Error("The specified parameter is not available.");parameter=wm.MIDI_REGISTERED_PARAMETER[parameter]}return wm.toMIDIChannels(channel).forEach(function(ch){that._selectRegisteredParameter(parameter,channel,options.time),that._setCurrentRegisteredParameter(data,channel,options.time),that._deselectRegisteredParameter(channel,options.time)}),this},Output.prototype.setNonRegisteredParameter=function(parameter,data,channel,options){var that=this;if(options=options||{},!(parameter[0]>=0&&parameter[0]<=127&&parameter[1]>=0&&parameter[1]<=127))throw new Error("Position 0 and 1 of the 2-position parameter array must both be between 0 and 127.");return data=[].concat(data),wm.toMIDIChannels(channel).forEach(function(ch){that._selectNonRegisteredParameter(parameter,channel,options.time),that._setCurrentRegisteredParameter(data,channel,options.time),that._deselectRegisteredParameter(channel,options.time)}),this},Output.prototype.incrementRegisteredParameter=function(parameter,channel,options){var that=this;if(options=options||{},!Array.isArray(parameter)){if(!wm.MIDI_REGISTERED_PARAMETER[parameter])throw new Error("The specified parameter is not available.");parameter=wm.MIDI_REGISTERED_PARAMETER[parameter]}return wm.toMIDIChannels(channel).forEach(function(ch){that._selectRegisteredParameter(parameter,channel,options.time),that.sendControlChange(96,0,channel,{time:options.time}),that._deselectRegisteredParameter(channel,options.time)}),this},Output.prototype.decrementRegisteredParameter=function(parameter,channel,options){if(options=options||{},!Array.isArray(parameter)){if(!wm.MIDI_REGISTERED_PARAMETER[parameter])throw new TypeError("The specified parameter is not available.");parameter=wm.MIDI_REGISTERED_PARAMETER[parameter]}return wm.toMIDIChannels(channel).forEach(function(ch){this._selectRegisteredParameter(parameter,channel,options.time),this.sendControlChange(97,0,channel,{time:options.time}),this._deselectRegisteredParameter(channel,options.time)}.bind(this)),this},Output.prototype.setPitchBendRange=function(semitones,cents,channel,options){var that=this;if(options=options||{},semitones=parseInt(semitones)||0,!(semitones>=0&&127>=semitones))throw new RangeError("The semitones value must be between 0 and 127");if(cents=parseInt(cents)||0,!(cents>=0&&127>=cents))throw new RangeError("The cents value must be between 0 and 127");return wm.toMIDIChannels(channel).forEach(function(ch){that.setRegisteredParameter("pitchbendrange",[semitones,cents],channel,{time:options.time})}),this},Output.prototype.setModulationRange=function(semitones,cents,channel,options){var that=this;if(options=options||{},semitones=parseInt(semitones)||0,!(semitones>=0&&127>=semitones))throw new RangeError("The semitones value must be between 0 and 127");if(cents=parseInt(cents)||0,!(cents>=0&&127>=cents))throw new RangeError("The cents value must be between 0 and 127");return wm.toMIDIChannels(channel).forEach(function(ch){that.setRegisteredParameter("modulationrange",[semitones,cents],channel,{time:options.time})}),this},Output.prototype.setMasterTuning=function(value,channel,options){var that=this;if(options=options||{},value=parseFloat(value)||0,-65>=value||value>=64)throw new RangeError("The value must be a decimal number larger than -65 and smaller than 64.");var coarse=parseInt(value)+64,fine=value-parseInt(value);fine=Math.round((fine+1)/2*16383);var msb=fine>>7&127,lsb=127&fine;return wm.toMIDIChannels(channel).forEach(function(ch){that.setRegisteredParameter("channelcoarsetuning",coarse,channel,{time:options.time}),that.setRegisteredParameter("channelfinetuning",[msb,lsb],channel,{time:options.time})}),this},Output.prototype.setTuningProgram=function(value,channel,options){var that=this;if(options=options||{},value=parseInt(value),!(value>=0&&127>=value))throw new RangeError("The program value must be between 0 and 127");return wm.toMIDIChannels(channel).forEach(function(ch){that.setRegisteredParameter("tuningprogram",value,channel,{time:options.time})}),this},Output.prototype.setTuningBank=function(value,channel,options){var that=this;if(options=options||{},value=parseInt(value)||0,!(value>=0&&127>=value))throw new RangeError("The bank value must be between 0 and 127");return wm.toMIDIChannels(channel).forEach(function(ch){that.setRegisteredParameter("tuningbank",value,channel,{time:options.time})}),this},Output.prototype.sendChannelMode=function(command,value,channel,options){if(options=options||{},"string"==typeof command){if(command=wm.MIDI_CHANNEL_MODE_MESSAGES[command],!command)throw new TypeError("Invalid channel mode message name.")}else if(command=parseInt(command),!(command>=120&&127>=command))throw new RangeError("Channel mode numerical identifiers must be between 120 and 127.");if(value=parseInt(value)||0,0>value||value>127)throw new RangeError("Value must be an integer between 0 and 127.");return wm.toMIDIChannels(channel).forEach(function(ch){this.send((wm.MIDI_CHANNEL_MESSAGES.channelmode<<4)+(ch-1),[command,value],this._parseTimeParameter(options.time))}.bind(this)),this},Output.prototype.sendProgramChange=function(program,channel,options){var that=this;if(options=options||{},program=parseInt(program),
isNaN(program)||0>program||program>127)throw new RangeError("Program numbers must be between 0 and 127.");return wm.toMIDIChannels(channel).forEach(function(ch){that.send((wm.MIDI_CHANNEL_MESSAGES.programchange<<4)+(ch-1),[program],that._parseTimeParameter(options.time))}),this},Output.prototype.sendChannelAftertouch=function(pressure,channel,options){var that=this;options=options||{},pressure=parseFloat(pressure),(isNaN(pressure)||0>pressure||pressure>1)&&(pressure=.5);var nPressure=Math.round(127*pressure);return wm.toMIDIChannels(channel).forEach(function(ch){that.send((wm.MIDI_CHANNEL_MESSAGES.channelaftertouch<<4)+(ch-1),[nPressure],that._parseTimeParameter(options.time))}),this},Output.prototype.sendPitchBend=function(bend,channel,options){var that=this;if(options=options||{},bend=parseFloat(bend),isNaN(bend)||-1>bend||bend>1)throw new RangeError("Pitch bend value must be between -1 and 1.");var nLevel=Math.round((bend+1)/2*16383),msb=nLevel>>7&127,lsb=127&nLevel;return wm.toMIDIChannels(channel).forEach(function(ch){that.send((wm.MIDI_CHANNEL_MESSAGES.pitchbend<<4)+(ch-1),[lsb,msb],that._parseTimeParameter(options.time))}),this},Output.prototype._parseTimeParameter=function(time){var parsed,value;return"string"==typeof time&&"+"===time.substring(0,1)?(parsed=parseFloat(time),parsed&&parsed>0&&(value=wm.time+parsed)):(parsed=parseFloat(time),parsed>wm.time&&(value=parsed)),value},Output.prototype._convertNoteToArray=function(note){var notes=[];return Array.isArray(note)||(note=[note]),note.forEach(function(item){notes.push(wm.guessNoteNumber(item))}),notes},Output.prototype._onMidiMessage=function(e){},"function"==typeof define&&"object"==typeof define.amd?define([],function(){return wm}):"undefined"!=typeof module&&module.exports?module.exports=wm:scope.WebMidi||(scope.WebMidi=wm)}(this);
},{}]},{},[7])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3Vzci9saWIvbm9kZV9tb2R1bGVzL3dhdGNoaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCIuLi9hZHNyLWdhaW4tbm9kZS9pbmRleC5qcyIsIi4uL2pzLXN2Zy1waWFuby9pbmRleC5qcyIsIi4uL25vdGUtcGFyc2VyL2Rpc3Qvbm90ZS1wYXJzZXIuanMiLCJpbmRleC5qcyIsImtleWJvYXJkLXRvbmVzLmpzIiwic3ludGguanMiLCJ0ZXN0LmpzIiwiLi4vdG9uZS1mcmVxdWVuY3kvaW5kZXguanMiLCIuLi93ZWJtaWRpL3dlYm1pZGkubWluLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMxR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN0RUE7QUFDQTtBQUNBOztBQ0ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzVKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDN0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDOUZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM5REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3BCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCJmdW5jdGlvbiBBZHNyR2Fpbk5vZGUoY3R4KSB7XG5cbiAgICB0aGlzLmN0eCA9IGN0eDtcblxuICAgIHRoaXMub3B0aW9ucyA9IHtcbiAgICAgICAgYXR0YWNrQW1wOiAwLjEsIFxuICAgICAgICBkZWNheUFtcDogMC4zLFxuICAgICAgICBzdXN0YWluQW1wOiAwLjcsXG4gICAgICAgIHJlbGVhc2VBbXA6IDAuMDEsXG4gICAgICAgIGF0dGFja1RpbWU6IDAuMSxcbiAgICAgICAgZGVjYXlUaW1lOiAwLjIsXG4gICAgICAgIHN1c3RhaW5UaW1lOiAxLjAsIFxuICAgICAgICByZWxlYXNlVGltZTogMy40LFxuICAgICAgICBhdXRvUmVsZWFzZTogdHJ1ZVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBTZXQgb3B0aW9ucyBvciB1c2UgZGVmYXVsdHNcbiAgICAgKiBAcGFyYW0ge29iamVjdH0gb3B0aW9ucyBcbiAgICAgKi9cbiAgICB0aGlzLnNldE9wdGlvbnMgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHRoaXMub3B0aW9ucywgb3B0aW9ucyk7XG4gICAgfTtcblxuICAgIHRoaXMuZ2Fpbk5vZGVcbiAgICB0aGlzLmF1ZGlvVGltZVxuICAgIFxuICAgIC8qKlxuICAgICAqIEdldCBhIGdhaW4gbm9kZSBmcm9tIGRlZmluZWQgb3B0aW9uc1xuICAgICAqIEBwYXJhbSB7ZmxvYXR9IGF1ZGlvVGltZSBhbiBhdWRpbyBjb250ZXh0IHRpbWUgc3RhbXBcbiAgICAgKi9cbiAgICB0aGlzLmdldEdhaW5Ob2RlID0gIChhdWRpb1RpbWUpID0+IHtcblxuICAgICAgICB0aGlzLmdhaW5Ob2RlID0gdGhpcy5jdHguY3JlYXRlR2FpbigpO1xuICAgICAgICB0aGlzLmF1ZGlvVGltZSA9IGF1ZGlvVGltZVxuXG4gICAgICAgIHRoaXMuZ2Fpbk5vZGUuZ2Fpbi5zZXRWYWx1ZUF0VGltZSgwLCBhdWRpb1RpbWUpICAgICAgICBcbiAgICAgICAgXG4gICAgICAgIC8vIEF0dGFja1xuICAgICAgICB0aGlzLmdhaW5Ob2RlLmdhaW4uZXhwb25lbnRpYWxSYW1wVG9WYWx1ZUF0VGltZShcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5hdHRhY2tBbXAsIFxuICAgICAgICAgICAgYXVkaW9UaW1lICsgdGhpcy5vcHRpb25zLmF0dGFja1RpbWUpXG5cbiAgICAgICAgLy8gRGVjYXlcbiAgICAgICAgdGhpcy5nYWluTm9kZS5nYWluLmV4cG9uZW50aWFsUmFtcFRvVmFsdWVBdFRpbWUoXG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMuZGVjYXlBbXAsIFxuICAgICAgICAgICAgYXVkaW9UaW1lICsgdGhpcy5vcHRpb25zLmF0dGFja1RpbWUgKyB0aGlzLm9wdGlvbnMuZGVjYXlUaW1lKVxuXG4gICAgICAgIC8vIFN1c3RhaW5cbiAgICAgICAgdGhpcy5nYWluTm9kZS5nYWluLmV4cG9uZW50aWFsUmFtcFRvVmFsdWVBdFRpbWUoXG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMuc3VzdGFpbkFtcCwgXG4gICAgICAgICAgICBhdWRpb1RpbWUgKyB0aGlzLm9wdGlvbnMuYXR0YWNrVGltZSArIHRoaXMub3B0aW9ucy5zdXN0YWluVGltZSlcblxuICAgICAgICAvLyBDaGVjayBpZiBhdXRvLXJlbGVhc2VcbiAgICAgICAgLy8gVGhlbiBjYWxjdWxhdGUgd2hlbiBub3RlIHNob3VsZCBzdG9wXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuYXV0b1JlbGVhc2UpIHtcbiAgICAgICAgICAgIHRoaXMuZ2Fpbk5vZGUuZ2Fpbi5leHBvbmVudGlhbFJhbXBUb1ZhbHVlQXRUaW1lKFxuICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucy5yZWxlYXNlQW1wLFxuICAgICAgICAgICAgICAgIGF1ZGlvVGltZSArIHRoaXMucmVsZWFzZVRpbWUoKVxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBEaXNjb25uZWN0IHRoZSBnYWluIG5vZGUgXG4gICAgICAgICAgICB0aGlzLmRpc2Nvbm5lY3QoYXVkaW9UaW1lICsgdGhpcy5yZWxlYXNlVGltZSgpKVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLmdhaW5Ob2RlO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBSZWxlYXNlIHRoZSBub3RlIGR5bmFtaWNhbHlcbiAgICAgKiBFLmcuIGlmIHlvdXIgYXJlIG1ha2luZyBhIGtleWJvYXJkLCBhbmQgeW91IHdhbnQgdGhlIG5vdGVcbiAgICAgKiB0byBiZSByZWxlYXNlZCBhY2NvcmRpbmcgdG8gY3VycmVudCBhdWRpbyB0aW1lIGFkZGVkIHRoZSBBRFNSIHJlbGVhc2UgdGltZSBcbiAgICAgKi9cbiAgICB0aGlzLnJlbGVhc2VOb3cgPSAoKSA9PiB7XG4gICAgICAgIHRoaXMuZ2Fpbk5vZGUuZ2Fpbi5leHBvbmVudGlhbFJhbXBUb1ZhbHVlQXRUaW1lKFxuICAgICAgICAgICAgdGhpcy5vcHRpb25zLnJlbGVhc2VBbXAsXG4gICAgICAgICAgICB0aGlzLmN0eC5jdXJyZW50VGltZSArIHRoaXMub3B0aW9ucy5yZWxlYXNlVGltZSkgXG4gICAgICAgIHRoaXMuZGlzY29ubmVjdCh0aGlzLm9wdGlvbnMucmVsZWFzZVRpbWUpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IHJlbGVhc2UgdGltZSBhY2NvcmRpbmcgdG8gdGhlIGFkc3IgcmVsZWFzZSB0aW1lXG4gICAgICovXG4gICAgdGhpcy5yZWxlYXNlVGltZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLmF0dGFja1RpbWUgKyB0aGlzLm9wdGlvbnMuZGVjYXlUaW1lICsgdGhpcy5vcHRpb25zLnN1c3RhaW5UaW1lICsgdGhpcy5vcHRpb25zLnJlbGVhc2VUaW1lXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IHJlbGVhc2UgdGltZSBhY2NvcmRpbmcgdG8gJ25vdydcbiAgICAgKi9cbiAgICB0aGlzLnJlbGVhc2VUaW1lTm93ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jdHguY3VycmVudFRpbWUgKyB0aGlzLnJlbGVhc2VUaW1lKClcbiAgICB9XG4gICAgXG4gICAgLyoqXG4gICAgICogXG4gICAgICogQHBhcmFtIHtmbG9hdH0gZGlzY29ubmVjdFRpbWUgdGhlIHRpbWUgd2hlbiBnYWluTm9kZSBzaG91bGQgZGlzY29ubmVjdCBcbiAgICAgKi9cbiAgICB0aGlzLmRpc2Nvbm5lY3QgPSAoZGlzY29ubmVjdFRpbWUpID0+IHtcbiAgICAgICAgc2V0VGltZW91dCggKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5nYWluTm9kZS5kaXNjb25uZWN0KCk7XG4gICAgICAgIH0sXG4gICAgICAgIGRpc2Nvbm5lY3RUaW1lICogMTAwMCk7XG4gICAgfTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBBZHNyR2Fpbk5vZGU7XG4iLCJmdW5jdGlvbiBwaWFubyhlbGVtSUQsIG9wdHMpIHtcblxuICAgIHRoaXMuZWxlbUlEID0gZWxlbUlEXG4gICAgdGhpcy5lbGVtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZWxlbUlEKVxuICAgIFxuICAgIHRoaXMuZGVmYXVsdHMgPSB7XG4gICAgICAgIG9jdGF2ZXM6IDIsXG4gICAgICAgIG9jdGF2ZUJlZ2luOiAzXG4gICAgfVxuXG4gICAgdGhpcy5vcHRpb25zID0ge31cbiAgICBPYmplY3QuYXNzaWduKHRoaXMub3B0aW9ucywgdGhpcy5kZWZhdWx0cywgb3B0cylcbiAgICBcbiAgICB0aGlzLmNyZWF0ZVBpYW5vID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBsZXQgc3ZnID0gdGhpcy5nZXRQaWFub1NWRygpXG4gICAgICAgIHRoaXMuZWxlbS5pbm5lckhUTUwgPSBzdmdcbiAgICB9XG5cbiAgICB0aGlzLmdldFBpYW5vU1ZHID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBsZXQgYm94WCA9IHRoaXMub3B0aW9ucy5vY3RhdmVzICogMTQwXG4gICAgICAgIFxuICAgICAgICBsZXQgb2N0YXZlQmVnaW4gPSB0aGlzLm9wdGlvbnMub2N0YXZlQmVnaW5cbiAgICAgICAgbGV0IGh0bWwgPSBgXG4gICAgICAgIDxzdmcgXG4gICAgICAgICAgICB4bWxucz1cImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIgXG4gICAgICAgICAgICBwcmVzZXJ2ZUFzcGVjdFJhdGlvPVwibm9uZVwiIFxuICAgICAgICAgICAgdmlld0JveD1cIjAgMCAke2JveFh9IDgwXCIgXG4gICAgICAgICAgICBpZD1cInBpYW5vXCI+XG5cdFx0XHQ8Zz5gO1xuICAgICAgICBmb3IgKGkgPSAxOyBpIDw9IHRoaXMub3B0aW9ucy5vY3RhdmVzOyBpKyspIHsgIFxuICAgICAgICAgICAgaHRtbCArPSB0aGlzLmdldFRvbmVzKG9jdGF2ZUJlZ2luKVxuICAgICAgICAgICAgb2N0YXZlQmVnaW4rKyBcbiAgICAgICAgfVxuICAgICAgICBodG1sICs9IGBcbiAgICAgICAgICAgIDwvZz5cblx0XHQ8L3N2Zz5gXG4gICAgICAgIHJldHVybiBodG1sXG4gICAgfVxuXG4gICAgdGhpcy5nZXROb3RlQW5kT2N0YXZlID0gZnVuY3Rpb24gKG5vdGUsIG9jdGF2ZSkge1xuICAgICAgICByZXR1cm4gbm90ZSArIG9jdGF2ZVxuICAgIH1cblxuICAgIHRoaXMuY3VycmVudFggPSAwXG4gICAgdGhpcy5nZXRDdXJyZW50WCA9IGZ1bmN0aW9uICh4KSB7XG4gICAgICAgIHJldHVybiB4ICsgdGhpcy5jdXJyZW50WFxuICAgIH1cblxuICAgIHRoaXMuZ2V0VG9uZXMgPSBmdW5jdGlvbiAob2N0YXZlKSB7XG4gICAgICAgIGxldCBvY3RhdmVIVE1MID0gXG4gICAgICAgIGBcbiAgICAgICAgPHJlY3QgY2xhc3M9XCJ3aGl0ZSBjXCIgZGF0YS1ub3RlPVwiJHt0aGlzLmdldE5vdGVBbmRPY3RhdmUoJ2MnLCBvY3RhdmUpfVwiIHdpZHRoPVwiMjBcIiBoZWlnaHQ9XCI4MFwiIHg9XCIke3RoaXMuZ2V0Q3VycmVudFgoMCl9XCIgeT1cIjBcIiAvPlxuICAgICAgICA8cmVjdCBjbGFzcz1cIndoaXRlIGRcIiBkYXRhLW5vdGU9XCIke3RoaXMuZ2V0Tm90ZUFuZE9jdGF2ZSgnZCcsIG9jdGF2ZSl9XCIgd2lkdGg9XCIyMFwiIGhlaWdodD1cIjgwXCIgeD1cIiR7dGhpcy5nZXRDdXJyZW50WCgyMCl9XCIgeT1cIjBcIiAvPlxuICAgICAgICA8cmVjdCBjbGFzcz1cIndoaXRlIGVcIiBkYXRhLW5vdGU9XCIke3RoaXMuZ2V0Tm90ZUFuZE9jdGF2ZSgnZScsIG9jdGF2ZSl9XCIgd2lkdGg9XCIyMFwiIGhlaWdodD1cIjgwXCIgeD1cIiR7dGhpcy5nZXRDdXJyZW50WCg0MCl9XCIgeT1cIjBcIiAvPlxuICAgICAgICA8cmVjdCBjbGFzcz1cIndoaXRlIGZcIiBkYXRhLW5vdGU9XCIke3RoaXMuZ2V0Tm90ZUFuZE9jdGF2ZSgnZicsIG9jdGF2ZSl9XCIgd2lkdGg9XCIyMFwiIGhlaWdodD1cIjgwXCIgeD1cIiR7dGhpcy5nZXRDdXJyZW50WCg2MCl9XCIgeT1cIjBcIiAvPlxuICAgICAgICA8cmVjdCBjbGFzcz1cIndoaXRlIGdcIiBkYXRhLW5vdGU9XCIke3RoaXMuZ2V0Tm90ZUFuZE9jdGF2ZSgnZycsIG9jdGF2ZSl9XCIgd2lkdGg9XCIyMFwiIGhlaWdodD1cIjgwXCIgeD1cIiR7dGhpcy5nZXRDdXJyZW50WCg4MCl9XCIgeT1cIjBcIiAvPlxuICAgICAgICA8cmVjdCBjbGFzcz1cIndoaXRlIGFcIiBkYXRhLW5vdGU9XCIke3RoaXMuZ2V0Tm90ZUFuZE9jdGF2ZSgnYScsIG9jdGF2ZSl9XCIgd2lkdGg9XCIyMFwiIGhlaWdodD1cIjgwXCIgeD1cIiR7dGhpcy5nZXRDdXJyZW50WCgxMDApfVwiIHk9XCIwXCIgLz5cbiAgICAgICAgPHJlY3QgY2xhc3M9XCJ3aGl0ZSBiXCIgZGF0YS1ub3RlPVwiJHt0aGlzLmdldE5vdGVBbmRPY3RhdmUoJ2InLCBvY3RhdmUpfVwiIHdpZHRoPVwiMjBcIiBoZWlnaHQ9XCI4MFwiIHg9XCIke3RoaXMuZ2V0Q3VycmVudFgoMTIwKX1cIiB5PVwiMFwiIC8+XG4gICAgICAgIDxyZWN0IGNsYXNzPVwiYmxhY2sgY3NcIiBkYXRhLW5vdGU9XCIke3RoaXMuZ2V0Tm90ZUFuZE9jdGF2ZSgnY3MnLCBvY3RhdmUpfVwiIHdpZHRoPVwiMTZcIiBoZWlnaHQ9XCI1MFwiIHg9XCIke3RoaXMuZ2V0Q3VycmVudFgoMTIpfVwiIHk9XCIwXCIgLz5cbiAgICAgICAgPHJlY3QgY2xhc3M9XCJibGFjayBkc1wiIGRhdGEtbm90ZT1cIiR7dGhpcy5nZXROb3RlQW5kT2N0YXZlKCdkcycsIG9jdGF2ZSl9XCIgd2lkdGg9XCIxNlwiIGhlaWdodD1cIjUwXCIgeD1cIiR7dGhpcy5nZXRDdXJyZW50WCgzMil9XCIgeT1cIjBcIiAvPlxuICAgICAgICA8cmVjdCBjbGFzcz1cImJsYWNrIGZzXCIgZGF0YS1ub3RlPVwiJHt0aGlzLmdldE5vdGVBbmRPY3RhdmUoJ2ZzJywgb2N0YXZlKX1cIiB3aWR0aD1cIjE2XCIgaGVpZ2h0PVwiNTBcIiB4PVwiJHt0aGlzLmdldEN1cnJlbnRYKDcyKX1cIiB5PVwiMFwiIC8+XG4gICAgICAgIDxyZWN0IGNsYXNzPVwiYmxhY2sgZ3NcIiBkYXRhLW5vdGU9XCIke3RoaXMuZ2V0Tm90ZUFuZE9jdGF2ZSgnZ3MnLCBvY3RhdmUpfVwiIHdpZHRoPVwiMTZcIiBoZWlnaHQ9XCI1MFwiIHg9XCIke3RoaXMuZ2V0Q3VycmVudFgoOTIpfVwiIHk9XCIwXCIgLz5cbiAgICAgICAgPHJlY3QgY2xhc3M9XCJibGFjayBhc1wiIGRhdGEtbm90ZT1cIiR7dGhpcy5nZXROb3RlQW5kT2N0YXZlKCdhcycsIG9jdGF2ZSl9XCIgd2lkdGg9XCIxNlwiIGhlaWdodD1cIjUwXCIgeD1cIiR7dGhpcy5nZXRDdXJyZW50WCgxMTIpfVwiIHk9XCIwXCIgLz5gXG4gICAgXG4gICAgICAgIHRoaXMuY3VycmVudFgrPSAxNDBcbiAgICAgICAgcmV0dXJuIG9jdGF2ZUhUTUxcbiAgICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gcGlhbm87XG4iLCIhZnVuY3Rpb24odCxuKXtcIm9iamVjdFwiPT10eXBlb2YgZXhwb3J0cyYmXCJ1bmRlZmluZWRcIiE9dHlwZW9mIG1vZHVsZT9uKGV4cG9ydHMpOlwiZnVuY3Rpb25cIj09dHlwZW9mIGRlZmluZSYmZGVmaW5lLmFtZD9kZWZpbmUoW1wiZXhwb3J0c1wiXSxuKTpuKHQuTm90ZVBhcnNlcj10Lk5vdGVQYXJzZXJ8fHt9KX0odGhpcyxmdW5jdGlvbih0KXtcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBuKHQsbil7cmV0dXJuIEFycmF5KG4rMSkuam9pbih0KX1mdW5jdGlvbiByKHQpe3JldHVyblwibnVtYmVyXCI9PXR5cGVvZiB0fWZ1bmN0aW9uIGUodCl7cmV0dXJuXCJzdHJpbmdcIj09dHlwZW9mIHR9ZnVuY3Rpb24gdSh0KXtyZXR1cm4gdm9pZCAwIT09dH1mdW5jdGlvbiBjKHQsbil7cmV0dXJuIE1hdGgucG93KDIsKHQtNjkpLzEyKSoobnx8NDQwKX1mdW5jdGlvbiBvKCl7cmV0dXJuIGJ9ZnVuY3Rpb24gaSh0LG4scil7aWYoXCJzdHJpbmdcIiE9dHlwZW9mIHQpcmV0dXJuIG51bGw7dmFyIGU9Yi5leGVjKHQpO2lmKCFlfHwhbiYmZVs0XSlyZXR1cm4gbnVsbDt2YXIgdT17bGV0dGVyOmVbMV0udG9VcHBlckNhc2UoKSxhY2M6ZVsyXS5yZXBsYWNlKC94L2csXCIjI1wiKX07dS5wYz11LmxldHRlcit1LmFjYyx1LnN0ZXA9KHUubGV0dGVyLmNoYXJDb2RlQXQoMCkrMyklNyx1LmFsdD1cImJcIj09PXUuYWNjWzBdPy11LmFjYy5sZW5ndGg6dS5hY2MubGVuZ3RoO3ZhciBvPUFbdS5zdGVwXSt1LmFsdDtyZXR1cm4gdS5jaHJvbWE9bzwwPzEyK286byUxMixlWzNdJiYodS5vY3Q9K2VbM10sdS5taWRpPW8rMTIqKHUub2N0KzEpLHUuZnJlcT1jKHUubWlkaSxyKSksbiYmKHUudG9uaWNPZj1lWzRdKSx1fWZ1bmN0aW9uIGYodCl7cmV0dXJuIHIodCk/dDwwP24oXCJiXCIsLXQpOm4oXCIjXCIsdCk6XCJcIn1mdW5jdGlvbiBhKHQpe3JldHVybiByKHQpP1wiXCIrdDpcIlwifWZ1bmN0aW9uIGwodCxuLHIpe3JldHVybiBudWxsPT09dHx8dm9pZCAwPT09dD9udWxsOnQuc3RlcD9sKHQuc3RlcCx0LmFsdCx0Lm9jdCk6dDwwfHx0PjY/bnVsbDpDLmNoYXJBdCh0KStmKG4pK2Eocil9ZnVuY3Rpb24gcCh0KXtpZigocih0KXx8ZSh0KSkmJnQ+PTAmJnQ8MTI4KXJldHVybit0O3ZhciBuPWkodCk7cmV0dXJuIG4mJnUobi5taWRpKT9uLm1pZGk6bnVsbH1mdW5jdGlvbiBzKHQsbil7dmFyIHI9cCh0KTtyZXR1cm4gbnVsbD09PXI/bnVsbDpjKHIsbil9ZnVuY3Rpb24gZCh0KXtyZXR1cm4oaSh0KXx8e30pLmxldHRlcn1mdW5jdGlvbiBtKHQpe3JldHVybihpKHQpfHx7fSkuYWNjfWZ1bmN0aW9uIGgodCl7cmV0dXJuKGkodCl8fHt9KS5wY31mdW5jdGlvbiB2KHQpe3JldHVybihpKHQpfHx7fSkuc3RlcH1mdW5jdGlvbiBnKHQpe3JldHVybihpKHQpfHx7fSkuYWx0fWZ1bmN0aW9uIHgodCl7cmV0dXJuKGkodCl8fHt9KS5jaHJvbWF9ZnVuY3Rpb24geSh0KXtyZXR1cm4oaSh0KXx8e30pLm9jdH12YXIgYj0vXihbYS1nQS1HXSkoI3sxLH18YnsxLH18eHsxLH18KSgtP1xcZCopXFxzKiguKilcXHMqJC8sQT1bMCwyLDQsNSw3LDksMTFdLEM9XCJDREVGR0FCXCI7dC5yZWdleD1vLHQucGFyc2U9aSx0LmJ1aWxkPWwsdC5taWRpPXAsdC5mcmVxPXMsdC5sZXR0ZXI9ZCx0LmFjYz1tLHQucGM9aCx0LnN0ZXA9dix0LmFsdD1nLHQuY2hyb21hPXgsdC5vY3Q9eX0pO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9bm90ZS1wYXJzZXIuanMubWFwXG4iLCJjb25zdCBub3RlUGFyc2VyID0gcmVxdWlyZSgnbm90ZS1wYXJzZXInKVxuY29uc3Qga2V5Ym9hcmRUb25lcyA9IHJlcXVpcmUoJy4va2V5Ym9hcmQtdG9uZXMuanMnKTtcbmNvbnN0IGpzU3ZnUGlhbm8gPSByZXF1aXJlKCdqcy1zdmctcGlhbm8nKTtcbmNvbnN0IHdlYm1pZGkgPSByZXF1aXJlKCd3ZWJtaWRpJylcblxudmFyIGtleXMgPSB7fTtcblxuanNTdmdQaWFuby5wcm90b3R5cGUgPSB7XG5cbiAgICBnZXRGcmVxdWVuY3k6IGZ1bmN0aW9uIChub3RlKSB7XG4gICAgICAgIG5vdGUgPSBub3RlLnJlcGxhY2UoJ3MnLCAnIycpO1xuICAgICAgICBsZXQgcmVzID0gbm90ZVBhcnNlci5wYXJzZShub3RlKVxuICAgICAgICBsZXQgZnJlcSA9IHJlcy5mcmVxO1xuICAgICAgICByZXR1cm4gZnJlcTtcbiAgICB9LFxuXG4gICAgc3ludGg6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ3NldCBhIHN5bnRoJylcbiAgICB9LFxuXG4gICAgdG9nZ2xlS2V5OiBmdW5jdGlvbiAobm90ZSkge1xuICAgICAgICBub3RlID0gbm90ZS50b0xvd2VyQ2FzZShub3RlKVxuICAgICAgICBsZXQgc2VsZWN0b3IgPSAnIycgKyB0aGlzLmVsZW1JRCArIFwiIHJlY3RbZGF0YS1ub3RlPSdcIiArIG5vdGUgKyBcIiddXCJcbiAgICAgICAgbGV0IGVsZW0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKVxuICAgICAgICBpZiAoIWVsZW0pIHtcbiAgICAgICAgICAgIHJldHVyblxuICAgICAgICB9XG4gICAgICAgIGVsZW0uY2xhc3NMaXN0LnRvZ2dsZSgnYWN0aXZlJyk7XG4gICAgfSxcblxuICAgIHN5bnRoU3RhcnQ6IGZ1bmN0aW9uIChub3RlLCBvcHRpb25zKSB7XG5cbiAgICAgICAgdGhpcy50b2dnbGVLZXkobm90ZSlcbiAgICAgICAgbGV0IGZyZXEgPSB0aGlzLmdldEZyZXF1ZW5jeShub3RlKTtcbiAgICAgICAgbGV0IHN5bnRoID0gbmV3IHRoaXMuc3ludGgoKTtcblxuICAgICAgICBzeW50aC5zdGFydChmcmVxLCBvcHRpb25zKTtcbiAgICAgICAgY29uc29sZS5sb2cobm90ZSlcbiAgICAgICAga2V5c1tub3RlXSA9IHN5bnRoO1xuICAgIH0sXG5cbiAgICBzeW50aFN0b3A6IGZ1bmN0aW9uIChub3RlKSB7XG5cbiAgICAgICAgdGhpcy50b2dnbGVLZXkobm90ZSlcbiAgICAgICAgbGV0IHN5bnRoID0ga2V5c1tub3RlXVxuICAgICAgICBzeW50aC5zdG9wKClcbiAgICAgICAgZGVsZXRlIGtleXNbbm90ZV1cbiAgICB9LFxuXG4gICAgLy8gRW5hYmxlIHR3byBvY3RhdmVzIG9uIGtleWJvYXJkXG4gICAgZW5hYmxlS2V5Ym9hcmRFdmVudHM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgKGUpID0+IHtcblxuICAgICAgICAgICAgbGV0IGsgPSBlLmNvZGU7XG4gICAgICAgICAgICBsZXQga2V5QXJ5ID0ga2V5Ym9hcmRUb25lc1trXTtcbiAgICAgICAgICAgIGlmICgha2V5QXJ5KSByZXR1cm5cblxuICAgICAgICAgICAgbGV0IG5vdGUgPSBrZXlBcnlbMF0gKyAoa2V5QXJ5WzFdICsgdGhpcy5vcHRpb25zLm9jdGF2ZUJlZ2luKVxuXG4gICAgICAgICAgICBpZiAoayBpbiBrZXlib2FyZFRvbmVzICYmICEobm90ZSBpbiBrZXlzKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc3ludGhTdGFydChub3RlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleXVwXCIsIChlKSA9PiB7XG4gICAgICAgICAgICBsZXQgayA9IGUuY29kZTtcbiAgICAgICAgICAgIGxldCBrZXlBcnkgPSBrZXlib2FyZFRvbmVzW2tdO1xuICAgICAgICAgICAgaWYgKCFrZXlBcnkpIHJldHVyblxuICAgICAgICAgICAgXG4gICAgICAgICAgICBsZXQgbm90ZSA9IGtleUFyeVswXSArIChrZXlBcnlbMV0gKyB0aGlzLm9wdGlvbnMub2N0YXZlQmVnaW4pXG4gICAgICAgICAgICBpZiAoayBpbiBrZXlib2FyZFRvbmVzICYmIChub3RlIGluIGtleXMpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zeW50aFN0b3Aobm90ZSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSxcbiAgICBcbiAgICAvLyBFbmFibGUgbW91c2Vkb3duIGFuZCBtb3VzZXVwXG4gICAgZW5hYmxlTW91c2VFdmVudHM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgXG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgKGUpID0+IHtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgdmFyIG5vdGUgPSBlLnNyY0VsZW1lbnQuZGF0YXNldC5ub3RlO1xuICAgICAgICAgICAgaWYgKCFub3RlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLnN5bnRoU3RhcnQobm90ZSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZXVwXCIsIChlKSA9PiB7XG5cbiAgICAgICAgICAgIHZhciBub3RlID0gZS5zcmNFbGVtZW50LmRhdGFzZXQubm90ZTtcbiAgICAgICAgICAgIGlmIChub3RlIGluIGtleXMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnN5bnRoU3RvcChub3RlKVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2VvdXRcIiwgKGUpID0+IHtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgdmFyIG5vdGUgPSBlLnNyY0VsZW1lbnQuZGF0YXNldC5ub3RlO1xuICAgICAgICAgICAgaWYgKCFub3RlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAobm90ZSBpbiBrZXlzKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zeW50aFN0b3Aobm90ZSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSxcblxuXG4gICAgLy8gRW5hYmxlIG1pZGkga2V5Ym9hcmRcbiAgICBlbmFibGVNaWRpRXZlbnRzOiBmdW5jdGlvbiAocG9ydCkge1xuICAgICAgICBpZiAocG9ydCA9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHBvcnQgPSAxXG4gICAgICAgIH1cblxuICAgICAgICB3ZWJtaWRpLmVuYWJsZSggKGVycikgPT4ge1xuXG4gICAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJXZWJNaWRpIGNvdWxkIG5vdCBiZSBlbmFibGVkLlwiICsgZXJyKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICggIShwb3J0IGluIHdlYm1pZGkuaW5wdXRzKSkge1xuICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ01vZGkgcG9ydCBkb2VzIG5vdCBleGlzdHMgJyArIHBvcnQpXG4gICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFBvcnQgaXMgb2tcbiAgICAgICAgICAgIHZhciBtaWRpSW5wdXQgPSB3ZWJtaWRpLmlucHV0c1twb3J0XTtcbiAgICAgICAgICAgIG1pZGlJbnB1dC5hZGRMaXN0ZW5lcignbm90ZW9uJywgXCJhbGxcIiwgKGUpID0+IHtcblxuICAgICAgICAgICAgICAgIGxldCBvY3RhdmUgPSBwYXJzZUludChlLm5vdGUub2N0YXZlKVxuICAgICAgICAgICAgICAgIGxldCBub3RlID0gZS5ub3RlLm5hbWUgKyBvY3RhdmVcbiAgICAgICAgICAgICAgICBub3RlID0gbm90ZS5yZXBsYWNlKCcjJywgJ3MnKVxuXG4gICAgICAgICAgICAgICAgaWYgKCEobm90ZSBpbiBrZXlzKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnN5bnRoU3RhcnQobm90ZSwgZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIG1pZGlJbnB1dC5hZGRMaXN0ZW5lcignbm90ZW9mZicsIFwiYWxsXCIsIChlKSA9PiB7XG4gICAgICAgICAgICAgICAgbGV0IG9jdGF2ZSA9IHBhcnNlSW50KGUubm90ZS5vY3RhdmUpO1xuICAgICAgICAgICAgICAgIGxldCBub3RlID0gZS5ub3RlLm5hbWUgKyBvY3RhdmU7XG5cbiAgICAgICAgICAgICAgICBub3RlID0gbm90ZS5yZXBsYWNlKCcjJywgJ3MnKVxuXG4gICAgICAgICAgICAgICAgdGhpcy5zeW50aFN0b3Aobm90ZSlcblxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pXG4gICAgfSxcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBqc1N2Z1BpYW5vO1xuIiwidmFyIGtleWJvYXJkVG9uZXMgPSB7XG4gICAgS2V5UTogWydjJywgMF0sXG4gICAgRGlnaXQyOiBbJ2NzJywgMF0sXG4gICAgS2V5VzogWydkJywgMF0sXG4gICAgRGlnaXQzOiBbJ2RzJywgMF0sXG4gICAgS2V5RTogWydlJywgMF0sXG4gICAgS2V5UjogWydmJywwXSxcbiAgICBEaWdpdDU6IFsnZnMnLDBdLFxuICAgIEtleVQ6IFsnZycsMF0sXG4gICAgRGlnaXQ2OiBbJ2dzJywwXSxcbiAgICBLZXlZOiBbJ2EnLDBdLFxuICAgIERpZ2l0NzogWydhcycsMF0sXG4gICAgS2V5VTogWydiJywwXSxcblxuICAgIEtleVo6IFsnYycsMV0sXG4gICAgS2V5UzogWydjcycsMV0sXG4gICAgS2V5WDogWydkJywxXSxcbiAgICBLZXlEOiBbJ2RzJywxXSxcbiAgICBLZXlDOiBbJ2UnLDFdLFxuICAgIEtleVY6IFsnZicsMV0sXG4gICAgS2V5RzogWydmcycsMV0sXG4gICAgS2V5QjogWydnJywxXSxcbiAgICBLZXlIOiBbJ2dzJywxXSxcbiAgICBLZXlOOiBbJ2EnLDFdLFxuICAgIEtleUo6IFsnYXMnLDFdLFxuICAgIEtleU06IFsnYicsMV1cbn07XG5cbm1vZHVsZS5leHBvcnRzID0ga2V5Ym9hcmRUb25lcztcbiIsImNvbnN0IHRvbmVGcmVxdWVuY3kgPSByZXF1aXJlKCd0b25lLWZyZXF1ZW5jeScpO1xuY29uc3QgYWRzckdhaW5Ob2RlID0gcmVxdWlyZSgnYWRzci1nYWluLW5vZGUnKTtcblxubGV0IGF1ZGlvQ3R4ID0gbmV3IEF1ZGlvQ29udGV4dCgpOyBcbmxldCBtYXN0ZXJHYWluID0gYXVkaW9DdHguY3JlYXRlR2FpbigpO1xuXG5tYXN0ZXJHYWluLmdhaW4uc2V0VGFyZ2V0QXRUaW1lKDAuMywgYXVkaW9DdHguY3VycmVudFRpbWUsIDAuMClcbi8vIG1hc3RlckdhaW4uZ2Fpbi52YWx1ZSA9IDAuMztcbm1hc3RlckdhaW4uY29ubmVjdChhdWRpb0N0eC5kZXN0aW5hdGlvbik7XG5cbmZ1bmN0aW9uIGdldEJlYXRpbmdPc2MoYXVkaW9DdHgsIGZyZXEsIHZlbG9jaXR5KSB7XG5cbiAgICB0aGlzLm9zYzEgPSBhdWRpb0N0eC5jcmVhdGVPc2NpbGxhdG9yKCk7XG4gICAgdGhpcy5vc2MxLnR5cGUgPSAnc3F1YXJlJztcblxuICAgIHRoaXMub3NjMiA9IGF1ZGlvQ3R4LmNyZWF0ZU9zY2lsbGF0b3IoKTtcbiAgICB0aGlzLm9zYzIudHlwZSA9ICdzcXVhcmUnO1xuICAgIFxuICAgIHRoaXMub3NjMyA9IGF1ZGlvQ3R4LmNyZWF0ZU9zY2lsbGF0b3IoKTtcbiAgICB0aGlzLm9zYzMudHlwZSA9ICdzcXVhcmUnO1xuXG4gICAgbGV0IHN5bnRoR2FpbiA9IG5ldyBhZHNyR2Fpbk5vZGUoYXVkaW9DdHgpO1xuICAgIFxuICAgIGlmICh2ZWxvY2l0eSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHZlbG9jaXR5ID0gMC4zXG4gICAgfSBcbiAgICBcbiAgICBcbiAgICBzeW50aEdhaW4uc2V0T3B0aW9ucyh7XG4gICAgICAgIGluaXRHYWluOiAwLjEsIC8vIEluaXQgZ2FpbiBvbiBub3RlXG4gICAgICAgIG1heEdhaW46IHZlbG9jaXR5LCAvLyBNYXggZ2FpbiBvbiBub3RlXG4gICAgICAgIGF0dGFja1RpbWU6IDEuMCwgLy8gQXR0YWNrVGltZS4gZ2Fpbi5pbml0IHRvIGdhaW4ubWF4IGluIGF0dGFja1RpbWVcbiAgICAgICAgc3VzdGFpblRpbWU6IDAuMiwgLy8gU3VzdGFpbiBub3RlIGluIHRpbWVcbiAgICAgICAgcmVsZWFzZVRpbWU6IDAuNSAvLyBBcHByb3hpbWF0ZWQgZW5kIHRpbWUuIENhbGN1bGF0ZWQgd2l0aCBzZWNvbmRzVG9UaW1lQ29uc3RhbnQoKVxuICAgIFxuICAgIH0pO1xuICAgIFxuICAgIHRoaXMuZ2FpbiA9IHN5bnRoR2Fpbi5nZXRHYWluTm9kZShhdWRpb0N0eC5jdXJyZW50VGltZSk7XG5cbiAgICAvLyB0aGlzLm9zYzEuZnJlcXVlbmN5LnZhbHVlID0gZnJlcSAvLyBlLmcuIDQwMFxuICAgIHRoaXMub3NjMS5mcmVxdWVuY3kuc2V0VmFsdWVBdFRpbWUoZnJlcSwgYXVkaW9DdHguY3VycmVudFRpbWUpXG4gICAgLy8gdGhpcy5vc2MyLmZyZXF1ZW5jeS52YWx1ZSA9IGZyZXEgKyAoZnJlcSowLjAxKSAvLyBBZGQgYSBsaXR0bGVcbiAgICB0aGlzLm9zYzIuZnJlcXVlbmN5LnNldFZhbHVlQXRUaW1lKGZyZXEsIGF1ZGlvQ3R4LmN1cnJlbnRUaW1lKVxuXG4gICAgdGhpcy5vc2MxLmNvbm5lY3QodGhpcy5nYWluKTtcbiAgICB0aGlzLm9zYzIuY29ubmVjdCh0aGlzLmdhaW4pO1xuICAgIHRoaXMuZ2Fpbi5jb25uZWN0KG1hc3RlckdhaW4pO1xuXG4gICAgdGhpcy5zdGFydCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLm9zYzEuc3RhcnQoKTtcbiAgICAgICAgdGhpcy5vc2MyLnN0YXJ0KCk7XG4gICAgICAgIHRoaXMub3NjMy5zdGFydCgpO1xuICAgIH1cblxuICAgIHRoaXMuZGlzY29ubmVjdCA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICBsZXQgbGVuZ3RoID0gYXVkaW9DdHguY3VycmVudFRpbWUgKyBzeW50aEdhaW4uZ2V0VG90YWxMZW5ndGgoKTtcbiAgICAgICAgdGhpcy5vc2MxLnN0b3AobGVuZ3RoKTtcbiAgICAgICAgdGhpcy5vc2MyLnN0b3AobGVuZ3RoKTtcbiAgICAgICAgdGhpcy5vc2MzLnN0b3AobGVuZ3RoKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIGdldE11bHRpQmVhdGluZ09zYyAoKSB7XG5cbiAgICB0aGlzLnN0YXJ0ID0gZnVuY3Rpb24oZnJlcSwgb3B0aW9ucykge1xuXG4gICAgICAgIGxldCB2ZWxvY2l0eSA9IDAuM1xuICAgICAgICBpZiAob3B0aW9ucykge1xuICAgICAgICAgICAgdmVsb2NpdHkgPSBvcHRpb25zLnZlbG9jaXR5XG4gICAgICAgIH1cblxuICAgICAgICB0b25lRnJlcXVlbmN5LmJhc2UgPSBmcmVxO1xuICAgICAgICB0aGlzLnN5bnRoMSA9IG5ldyBnZXRCZWF0aW5nT3NjKGF1ZGlvQ3R4LCBmcmVxLCB2ZWxvY2l0eSlcbiAgICBcbiAgICAgICAgbGV0IGxvd0ZyZXEgPSB0b25lRnJlcXVlbmN5LmdldFRvbmVTdGVwKCs3KVxuICAgICAgICB0aGlzLnN5bnRoMiA9IG5ldyBnZXRCZWF0aW5nT3NjKGF1ZGlvQ3R4LCBsb3dGcmVxKjIsIHZlbG9jaXR5KVxuICAgIFxuICAgICAgICBsZXQgaGlnaEZyZXEgPSB0b25lRnJlcXVlbmN5LmdldFRvbmVTdGVwKCsxMilcbiAgICAgICAgdGhpcy5zeW50aDMgPSBuZXcgZ2V0QmVhdGluZ09zYyhhdWRpb0N0eCwgbG93RnJlcSozLCB2ZWxvY2l0eSlcblxuICAgICAgICB0aGlzLnN5bnRoMS5zdGFydCgpO1xuICAgICAgICB0aGlzLnN5bnRoMi5zdGFydCgpO1xuICAgICAgICB0aGlzLnN5bnRoMy5zdGFydCgpO1xuICAgIH1cblxuICAgIHRoaXMuc3RvcCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5zeW50aDEuZGlzY29ubmVjdCgpO1xuICAgICAgICB0aGlzLnN5bnRoMi5kaXNjb25uZWN0KCk7XG4gICAgICAgIC8vdGhpcy5zeW50aDMuZGlzY29ubmVjdCgpO1xuICAgIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBnZXRNdWx0aUJlYXRpbmdPc2NcbiIsIi8vIFVzZSBpdCBsaWtlIHRoaXM6ICBcbi8vIGNvbnN0IHN5bnRoID0gcmVxdWlyZSgncGx1Z2dhYmxlLXN5bnRoJylcbi8vIEJ1dCB0aGlzIGlzIHRoZSB0ZXN0IHNvIGluY2x1ZGUgaW5kZXhcbmNvbnN0IHBsdWdnYWJsZVN5bnRoID0gcmVxdWlyZSgnLi9pbmRleCcpXG5cbmNvbnN0IGF1ZGlvQ3R4ID0gbmV3IEF1ZGlvQ29udGV4dCgpOyBcbmNvbnN0IG1hc3RlckdhaW4gPSBhdWRpb0N0eC5jcmVhdGVHYWluKCk7XG5tYXN0ZXJHYWluLmdhaW4uc2V0VGFyZ2V0QXRUaW1lKDAuMSwgYXVkaW9DdHguY3VycmVudFRpbWUsIDAuNSlcbi8vIG1hc3RlckdhaW4uZ2Fpbi52YWx1ZSA9IDAuMTtcblxuLyoqXG4gKiBBIHZlcnkgc2ltcGxlIGV4YW1wbGUgc3ludGggb2JqZWN0XG4gKiBUaGUgc3ludGggd2hpY2ggaXMgZ29pbmcgdG8gYmUgY29ubmVjdGVkIHRvIHRoZSBwaWFuby5cbiAqIEltcGxlbWVudCBhIGBzdGFydGAgYW5kIGEgYHN0b3BgIG1ldGhvZCBcbiAqIFxuICogXG4gKi9cbmZ1bmN0aW9uIHRlc3RTeW50aCAoKSB7XG5cbiAgICB0aGlzLnN0YXJ0ID0gZnVuY3Rpb24gKGZyZXEsIG9wdGlvbnMpIHtcblxuICAgICAgICB0aGlzLm9zY2lsbGF0b3IgPSBhdWRpb0N0eC5jcmVhdGVPc2NpbGxhdG9yKCk7XG4gICAgICAgIHRoaXMub3NjaWxsYXRvci50eXBlID0gJ3NxdWFyZSc7XG4gICAgICAgIHRoaXMub3NjaWxsYXRvci5mcmVxdWVuY3kudmFsdWUgPSBmcmVxOyAvLyB2YWx1ZSBpbiBoZXJ0elxuICAgICAgICB0aGlzLm9zY2lsbGF0b3IuY29ubmVjdChtYXN0ZXJHYWluKTtcbiAgICAgICAgbWFzdGVyR2Fpbi5jb25uZWN0KGF1ZGlvQ3R4LmRlc3RpbmF0aW9uKTtcbiAgICAgICAgdGhpcy5vc2NpbGxhdG9yLnN0YXJ0KCk7XG4gICAgfVxuXG4gICAgdGhpcy5zdG9wID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLm9zY2lsbGF0b3Iuc3RvcCgpO1xuICAgIH1cbn1cblxuLy8gVXNlIGEgbW9yZSBpbnRlcmVzdGluZyBzeW50aFxudmFyIHRlc3RTeW50aDIgPSByZXF1aXJlKCcuL3N5bnRoJykgXG5cbiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uICgpIHtcblxuICAgIHZhciBlbGVtSUQgPSAncGlhbm8tY29udGFpbmVyJ1xuICAgIHZhciBwID0gbmV3IHBsdWdnYWJsZVN5bnRoKGVsZW1JRCwge1xuICAgICAgICBvY3RhdmVzOiAzLCBcbiAgICAgICAgb2N0YXZlQmVnaW46IDMgICAgXG4gICAgfSlcbiAgICBcbiAgICAvLyBEcmF3cyB0aGUgcGlhbm9cbiAgICBwLmNyZWF0ZVBpYW5vKClcblxuICAgIC8vIFNldCBzeW50aCB0byB0ZXN0IHN5bnRoIGFib3ZlXG4gICAgcC5zeW50aCA9IHRlc3RTeW50aDJcbiAgICBcbiAgICAvLyBlbmFibGUga2V5Ym9hcmQgZXZlbnRzXG4gICAgcC5lbmFibGVLZXlib2FyZEV2ZW50cygpXG4gICAgXG4gICAgLy8gRW5hYmxlIG1vdXNlIGV2ZW50c1xuICAgIHAuZW5hYmxlTW91c2VFdmVudHMoKVxuICAgIFxuICAgIC8vIEFsbCBtaWRpIHRvbmVzIHdpbGwgYmUgcGxheWVkLCBidXQgb25seSAzIG9jdGF2ZXMgaXMgdmlzaWJsZVxuICAgIC8vIFlvdSBjYW4gc3BlY2lmeSBpbnB1dCBwb3J0LCBidXQgZGVmYXVsdHMgdG8gMSBcbiAgICBwLmVuYWJsZU1pZGlFdmVudHMoMSlcblxufSlcbiIsIi8vIFNlZSBlLmcuIGh0dHA6Ly93d3cucGh5Lm10dS5lZHUvfnN1aXRzL05vdGVGcmVxQ2FsY3MuaHRtbFxuZnVuY3Rpb24gbm90ZUZyZXF1ZW5jeSgpIHtcbiAgICBcbiAgICB0aGlzLmJhc2UgPSA0NDA7IC8vIEFcbiAgICB0aGlzLm51bVN0ZXBzID0gMTI7IC8vIDEyXG4gICAgXG4gICAgdGhpcy5nZXRTdGVwU2l6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIE1hdGgucG93KDIsIDEvdGhpcy5udW1TdGVwcyk7XG4gICAgfTtcbiAgICBcbiAgICAvLyBSZXR1cm4gaHogb2YgdGhlIHN0ZXAsIGUuZy4gZm9yIHRoZSBkZWZhdWx0IHNldHRpbmdzIHRpaHMgeWllbGRzOlxuICAgIC8vIDAgPSA0NDAgKEEpXG4gICAgLy8gNSA9IDU4Ny4zMjkuLi4gKEQpXG4gICAgLy8gLTEyID0gMjIwIFxuICAgIHRoaXMuZ2V0VG9uZVN0ZXAgPWZ1bmN0aW9uKHN0ZXApIHtcbiAgICAgICAgcmV0dXJuIE1hdGgucG93KHRoaXMuZ2V0U3RlcFNpemUoKSwgc3RlcCkgKiB0aGlzLmJhc2U7XG4gICAgfTsgIFxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IG5ldyBub3RlRnJlcXVlbmN5KCk7XG4iLCIvKlxuXG5XZWJNaWRpIHYyLjAuNFxuXG5XZWJNaWRpLmpzIGhlbHBzIHlvdSB0YW1lIHRoZSBXZWIgTUlESSBBUEkuIFNlbmQgYW5kIHJlY2VpdmUgTUlESSBtZXNzYWdlcyB3aXRoIGVhc2UuIENvbnRyb2wgaW5zdHJ1bWVudHMgd2l0aCB1c2VyLWZyaWVuZGx5IGZ1bmN0aW9ucyAocGxheU5vdGUsIHNlbmRQaXRjaEJlbmQsIGV0Yy4pLiBSZWFjdCB0byBNSURJIGlucHV0IHdpdGggc2ltcGxlIGV2ZW50IGxpc3RlbmVycyAobm90ZW9uLCBwaXRjaGJlbmQsIGNvbnRyb2xjaGFuZ2UsIGV0Yy4pLlxuaHR0cHM6Ly9naXRodWIuY29tL2NvdGVqcC93ZWJtaWRpXG5cblxuVGhlIE1JVCBMaWNlbnNlIChNSVQpXG5cbkNvcHlyaWdodCAoYykgMjAxNS0yMDE4LCBKZWFuLVBoaWxpcHBlIEPDtHTDqVxuXG5QZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5IG9mIHRoaXMgc29mdHdhcmUgYW5kXG5hc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSBcIlNvZnR3YXJlXCIpLCB0byBkZWFsIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLFxuaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSxcbnN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpc1xuZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczpcblxuVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbFxucG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxuXG5USEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SIElNUExJRUQsIElOQ0xVRElORyBCVVRcbk5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EXG5OT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTXG5PUiBPVEhFUiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLCBPVVQgT0YgT1IgSU5cbkNPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTiBUSEUgU09GVFdBUkUuXG5cbiovXG5cbiFmdW5jdGlvbihzY29wZSl7XCJ1c2Ugc3RyaWN0XCI7ZnVuY3Rpb24gV2ViTWlkaSgpe2lmKFdlYk1pZGkucHJvdG90eXBlLl9zaW5nbGV0b24pdGhyb3cgbmV3IEVycm9yKFwiV2ViTWlkaSBpcyBhIHNpbmdsZXRvbiwgaXQgY2Fubm90IGJlIGluc3RhbnRpYXRlZCBkaXJlY3RseS5cIik7V2ViTWlkaS5wcm90b3R5cGUuX3NpbmdsZXRvbj10aGlzLHRoaXMuX2lucHV0cz1bXSx0aGlzLl9vdXRwdXRzPVtdLHRoaXMuX3VzZXJIYW5kbGVycz17fSx0aGlzLl9zdGF0ZUNoYW5nZVF1ZXVlPVtdLHRoaXMuX3Byb2Nlc3NpbmdTdGF0ZUNoYW5nZT0hMSx0aGlzLl9taWRpSW50ZXJmYWNlRXZlbnRzPVtcImNvbm5lY3RlZFwiLFwiZGlzY29ubmVjdGVkXCJdLHRoaXMuX25vdGVzPVtcIkNcIixcIkMjXCIsXCJEXCIsXCJEI1wiLFwiRVwiLFwiRlwiLFwiRiNcIixcIkdcIixcIkcjXCIsXCJBXCIsXCJBI1wiLFwiQlwiXSx0aGlzLl9zZW1pdG9uZXM9e0M6MCxEOjIsRTo0LEY6NSxHOjcsQTo5LEI6MTF9LE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRoaXMse01JRElfU1lTVEVNX01FU1NBR0VTOnt2YWx1ZTp7c3lzZXg6MjQwLHRpbWVjb2RlOjI0MSxzb25ncG9zaXRpb246MjQyLHNvbmdzZWxlY3Q6MjQzLHR1bmluZ3JlcXVlc3Q6MjQ2LHN5c2V4ZW5kOjI0NyxjbG9jazoyNDgsc3RhcnQ6MjUwLFwiY29udGludWVcIjoyNTEsc3RvcDoyNTIsYWN0aXZlc2Vuc2luZzoyNTQscmVzZXQ6MjU1LHVua25vd25zeXN0ZW1tZXNzYWdlOi0xfSx3cml0YWJsZTohMSxlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMX0sTUlESV9DSEFOTkVMX01FU1NBR0VTOnt2YWx1ZTp7bm90ZW9mZjo4LG5vdGVvbjo5LGtleWFmdGVydG91Y2g6MTAsY29udHJvbGNoYW5nZToxMSxjaGFubmVsbW9kZToxMSxwcm9ncmFtY2hhbmdlOjEyLGNoYW5uZWxhZnRlcnRvdWNoOjEzLHBpdGNoYmVuZDoxNH0sd3JpdGFibGU6ITEsZW51bWVyYWJsZTohMCxjb25maWd1cmFibGU6ITF9LE1JRElfUkVHSVNURVJFRF9QQVJBTUVURVI6e3ZhbHVlOntwaXRjaGJlbmRyYW5nZTpbMCwwXSxjaGFubmVsZmluZXR1bmluZzpbMCwxXSxjaGFubmVsY29hcnNldHVuaW5nOlswLDJdLHR1bmluZ3Byb2dyYW06WzAsM10sdHVuaW5nYmFuazpbMCw0XSxtb2R1bGF0aW9ucmFuZ2U6WzAsNV0sYXppbXV0aGFuZ2xlOls2MSwwXSxlbGV2YXRpb25hbmdsZTpbNjEsMV0sZ2FpbjpbNjEsMl0sZGlzdGFuY2VyYXRpbzpbNjEsM10sbWF4aW11bWRpc3RhbmNlOls2MSw0XSxtYXhpbXVtZGlzdGFuY2VnYWluOls2MSw1XSxyZWZlcmVuY2VkaXN0YW5jZXJhdGlvOls2MSw2XSxwYW5zcHJlYWRhbmdsZTpbNjEsN10scm9sbGFuZ2xlOls2MSw4XX0sd3JpdGFibGU6ITEsZW51bWVyYWJsZTohMCxjb25maWd1cmFibGU6ITF9LE1JRElfQ09OVFJPTF9DSEFOR0VfTUVTU0FHRVM6e3ZhbHVlOntiYW5rc2VsZWN0Y29hcnNlOjAsbW9kdWxhdGlvbndoZWVsY29hcnNlOjEsYnJlYXRoY29udHJvbGxlcmNvYXJzZToyLGZvb3Rjb250cm9sbGVyY29hcnNlOjQscG9ydGFtZW50b3RpbWVjb2Fyc2U6NSxkYXRhZW50cnljb2Fyc2U6Nix2b2x1bWVjb2Fyc2U6NyxiYWxhbmNlY29hcnNlOjgscGFuY29hcnNlOjEwLGV4cHJlc3Npb25jb2Fyc2U6MTEsZWZmZWN0Y29udHJvbDFjb2Fyc2U6MTIsZWZmZWN0Y29udHJvbDJjb2Fyc2U6MTMsZ2VuZXJhbHB1cnBvc2VzbGlkZXIxOjE2LGdlbmVyYWxwdXJwb3Nlc2xpZGVyMjoxNyxnZW5lcmFscHVycG9zZXNsaWRlcjM6MTgsZ2VuZXJhbHB1cnBvc2VzbGlkZXI0OjE5LGJhbmtzZWxlY3RmaW5lOjMyLG1vZHVsYXRpb253aGVlbGZpbmU6MzMsYnJlYXRoY29udHJvbGxlcmZpbmU6MzQsZm9vdGNvbnRyb2xsZXJmaW5lOjM2LHBvcnRhbWVudG90aW1lZmluZTozNyxkYXRhZW50cnlmaW5lOjM4LHZvbHVtZWZpbmU6MzksYmFsYW5jZWZpbmU6NDAscGFuZmluZTo0MixleHByZXNzaW9uZmluZTo0MyxlZmZlY3Rjb250cm9sMWZpbmU6NDQsZWZmZWN0Y29udHJvbDJmaW5lOjQ1LGhvbGRwZWRhbDo2NCxwb3J0YW1lbnRvOjY1LHN1c3RlbnV0b3BlZGFsOjY2LHNvZnRwZWRhbDo2NyxsZWdhdG9wZWRhbDo2OCxob2xkMnBlZGFsOjY5LHNvdW5kdmFyaWF0aW9uOjcwLHJlc29uYW5jZTo3MSxzb3VuZHJlbGVhc2V0aW1lOjcyLHNvdW5kYXR0YWNrdGltZTo3MyxicmlnaHRuZXNzOjc0LHNvdW5kY29udHJvbDY6NzUsc291bmRjb250cm9sNzo3Nixzb3VuZGNvbnRyb2w4Ojc3LHNvdW5kY29udHJvbDk6Nzgsc291bmRjb250cm9sMTA6NzksZ2VuZXJhbHB1cnBvc2VidXR0b24xOjgwLGdlbmVyYWxwdXJwb3NlYnV0dG9uMjo4MSxnZW5lcmFscHVycG9zZWJ1dHRvbjM6ODIsZ2VuZXJhbHB1cnBvc2VidXR0b240OjgzLHJldmVyYmxldmVsOjkxLHRyZW1vbG9sZXZlbDo5MixjaG9ydXNsZXZlbDo5MyxjZWxlc3RlbGV2ZWw6OTQscGhhc2VybGV2ZWw6OTUsZGF0YWJ1dHRvbmluY3JlbWVudDo5NixkYXRhYnV0dG9uZGVjcmVtZW50Ojk3LG5vbnJlZ2lzdGVyZWRwYXJhbWV0ZXJjb2Fyc2U6OTgsbm9ucmVnaXN0ZXJlZHBhcmFtZXRlcmZpbmU6OTkscmVnaXN0ZXJlZHBhcmFtZXRlcmNvYXJzZToxMDAscmVnaXN0ZXJlZHBhcmFtZXRlcmZpbmU6MTAxfSx3cml0YWJsZTohMSxlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMX0sTUlESV9DSEFOTkVMX01PREVfTUVTU0FHRVM6e3ZhbHVlOnthbGxzb3VuZG9mZjoxMjAscmVzZXRhbGxjb250cm9sbGVyczoxMjEsbG9jYWxjb250cm9sOjEyMixhbGxub3Rlc29mZjoxMjMsb21uaW1vZGVvZmY6MTI0LG9tbmltb2Rlb246MTI1LG1vbm9tb2Rlb246MTI2LHBvbHltb2Rlb246MTI3fSx3cml0YWJsZTohMSxlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMX19KSxPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0aGlzLHtzdXBwb3J0ZWQ6e2VudW1lcmFibGU6ITAsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuXCJyZXF1ZXN0TUlESUFjY2Vzc1wiaW4gbmF2aWdhdG9yfX0sZW5hYmxlZDp7ZW51bWVyYWJsZTohMCxnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdm9pZCAwIT09dGhpc1tcImludGVyZmFjZVwiXX0uYmluZCh0aGlzKX0saW5wdXRzOntlbnVtZXJhYmxlOiEwLGdldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9pbnB1dHN9LmJpbmQodGhpcyl9LG91dHB1dHM6e2VudW1lcmFibGU6ITAsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX291dHB1dHN9LmJpbmQodGhpcyl9LHN5c2V4RW5hYmxlZDp7ZW51bWVyYWJsZTohMCxnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4hKCF0aGlzW1wiaW50ZXJmYWNlXCJdfHwhdGhpc1tcImludGVyZmFjZVwiXS5zeXNleEVuYWJsZWQpfS5iaW5kKHRoaXMpfSx0aW1lOntlbnVtZXJhYmxlOiEwLGdldDpmdW5jdGlvbigpe3JldHVybiBwZXJmb3JtYW5jZS5ub3coKX19fSl9ZnVuY3Rpb24gSW5wdXQobWlkaUlucHV0KXt2YXIgdGhhdD10aGlzO3RoaXMuX3VzZXJIYW5kbGVycz17Y2hhbm5lbDp7fSxzeXN0ZW06e319LHRoaXMuX21pZGlJbnB1dD1taWRpSW5wdXQsT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGhpcyx7Y29ubmVjdGlvbjp7ZW51bWVyYWJsZTohMCxnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhhdC5fbWlkaUlucHV0LmNvbm5lY3Rpb259fSxpZDp7ZW51bWVyYWJsZTohMCxnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhhdC5fbWlkaUlucHV0LmlkfX0sbWFudWZhY3R1cmVyOntlbnVtZXJhYmxlOiEwLGdldDpmdW5jdGlvbigpe3JldHVybiB0aGF0Ll9taWRpSW5wdXQubWFudWZhY3R1cmVyfX0sbmFtZTp7ZW51bWVyYWJsZTohMCxnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhhdC5fbWlkaUlucHV0Lm5hbWV9fSxzdGF0ZTp7ZW51bWVyYWJsZTohMCxnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhhdC5fbWlkaUlucHV0LnN0YXRlfX0sdHlwZTp7ZW51bWVyYWJsZTohMCxnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhhdC5fbWlkaUlucHV0LnR5cGV9fX0pLHRoaXMuX2luaXRpYWxpemVVc2VySGFuZGxlcnMoKX1mdW5jdGlvbiBPdXRwdXQobWlkaU91dHB1dCl7dmFyIHRoYXQ9dGhpczt0aGlzLl9taWRpT3V0cHV0PW1pZGlPdXRwdXQsT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGhpcyx7Y29ubmVjdGlvbjp7ZW51bWVyYWJsZTohMCxnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhhdC5fbWlkaU91dHB1dC5jb25uZWN0aW9ufX0saWQ6e2VudW1lcmFibGU6ITAsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoYXQuX21pZGlPdXRwdXQuaWR9fSxtYW51ZmFjdHVyZXI6e2VudW1lcmFibGU6ITAsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoYXQuX21pZGlPdXRwdXQubWFudWZhY3R1cmVyfX0sbmFtZTp7ZW51bWVyYWJsZTohMCxnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhhdC5fbWlkaU91dHB1dC5uYW1lfX0sc3RhdGU6e2VudW1lcmFibGU6ITAsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoYXQuX21pZGlPdXRwdXQuc3RhdGV9fSx0eXBlOntlbnVtZXJhYmxlOiEwLGdldDpmdW5jdGlvbigpe3JldHVybiB0aGF0Ll9taWRpT3V0cHV0LnR5cGV9fX0pfXZhciB3bT1uZXcgV2ViTWlkaTtXZWJNaWRpLnByb3RvdHlwZS5lbmFibGU9ZnVuY3Rpb24oY2FsbGJhY2ssc3lzZXgpe3JldHVybiB0aGlzLmVuYWJsZWQ/dm9pZCAwOnRoaXMuc3VwcG9ydGVkP3ZvaWQgbmF2aWdhdG9yLnJlcXVlc3RNSURJQWNjZXNzKHtzeXNleDpzeXNleH0pLnRoZW4oZnVuY3Rpb24obWlkaUFjY2Vzcyl7ZnVuY3Rpb24gb25Qb3J0c09wZW4oKXt0aGlzLl91cGRhdGVJbnB1dHNBbmRPdXRwdXRzKCksdGhpc1tcImludGVyZmFjZVwiXS5vbnN0YXRlY2hhbmdlPXRoaXMuX29uSW50ZXJmYWNlU3RhdGVDaGFuZ2UuYmluZCh0aGlzKSxcImZ1bmN0aW9uXCI9PXR5cGVvZiBjYWxsYmFjayYmY2FsbGJhY2suY2FsbCh0aGlzKSxldmVudHMuZm9yRWFjaChmdW5jdGlvbihldmVudCl7dGhpcy5fb25JbnRlcmZhY2VTdGF0ZUNoYW5nZShldmVudCl9LmJpbmQodGhpcykpfXZhciBldmVudHM9W10scHJvbWlzZXM9W107dGhpc1tcImludGVyZmFjZVwiXT1taWRpQWNjZXNzLHRoaXMuX3Jlc2V0SW50ZXJmYWNlVXNlckhhbmRsZXJzKCksdGhpc1tcImludGVyZmFjZVwiXS5vbnN0YXRlY2hhbmdlPWZ1bmN0aW9uKGUpe2V2ZW50cy5wdXNoKGUpfTtmb3IodmFyIGlucHV0cz1taWRpQWNjZXNzLmlucHV0cy52YWx1ZXMoKSxpbnB1dD1pbnB1dHMubmV4dCgpO2lucHV0JiYhaW5wdXQuZG9uZTtpbnB1dD1pbnB1dHMubmV4dCgpKXByb21pc2VzLnB1c2goaW5wdXQudmFsdWUub3BlbigpKTtmb3IodmFyIG91dHB1dHM9bWlkaUFjY2Vzcy5vdXRwdXRzLnZhbHVlcygpLG91dHB1dD1vdXRwdXRzLm5leHQoKTtvdXRwdXQmJiFvdXRwdXQuZG9uZTtvdXRwdXQ9b3V0cHV0cy5uZXh0KCkpcHJvbWlzZXMucHVzaChvdXRwdXQudmFsdWUub3BlbigpKTtQcm9taXNlP1Byb21pc2UuYWxsKHByb21pc2VzKVtcImNhdGNoXCJdKGZ1bmN0aW9uKGVycil7fSkudGhlbihvblBvcnRzT3Blbi5iaW5kKHRoaXMpKTpzZXRUaW1lb3V0KG9uUG9ydHNPcGVuLmJpbmQodGhpcyksMjAwKX0uYmluZCh0aGlzKSxmdW5jdGlvbihlcnIpe1wiZnVuY3Rpb25cIj09dHlwZW9mIGNhbGxiYWNrJiZjYWxsYmFjay5jYWxsKHRoaXMsZXJyKX0uYmluZCh0aGlzKSk6dm9pZChcImZ1bmN0aW9uXCI9PXR5cGVvZiBjYWxsYmFjayYmY2FsbGJhY2sobmV3IEVycm9yKFwiVGhlIFdlYiBNSURJIEFQSSBpcyBub3Qgc3VwcG9ydGVkIGJ5IHlvdXIgYnJvd3Nlci5cIikpKX0sV2ViTWlkaS5wcm90b3R5cGUuZGlzYWJsZT1mdW5jdGlvbigpe2lmKCF0aGlzLnN1cHBvcnRlZCl0aHJvdyBuZXcgRXJyb3IoXCJUaGUgV2ViIE1JREkgQVBJIGlzIG5vdCBzdXBwb3J0ZWQgYnkgeW91ciBicm93c2VyLlwiKTt0aGlzW1wiaW50ZXJmYWNlXCJdJiYodGhpc1tcImludGVyZmFjZVwiXS5vbnN0YXRlY2hhbmdlPXZvaWQgMCksdGhpc1tcImludGVyZmFjZVwiXT12b2lkIDAsdGhpcy5faW5wdXRzPVtdLHRoaXMuX291dHB1dHM9W10sdGhpcy5fcmVzZXRJbnRlcmZhY2VVc2VySGFuZGxlcnMoKX0sV2ViTWlkaS5wcm90b3R5cGUuYWRkTGlzdGVuZXI9ZnVuY3Rpb24odHlwZSxsaXN0ZW5lcil7aWYoIXRoaXMuZW5hYmxlZCl0aHJvdyBuZXcgRXJyb3IoXCJXZWJNaWRpIG11c3QgYmUgZW5hYmxlZCBiZWZvcmUgYWRkaW5nIGV2ZW50IGxpc3RlbmVycy5cIik7aWYoXCJmdW5jdGlvblwiIT10eXBlb2YgbGlzdGVuZXIpdGhyb3cgbmV3IFR5cGVFcnJvcihcIlRoZSAnbGlzdGVuZXInIHBhcmFtZXRlciBtdXN0IGJlIGEgZnVuY3Rpb24uXCIpO2lmKCEodGhpcy5fbWlkaUludGVyZmFjZUV2ZW50cy5pbmRleE9mKHR5cGUpPj0wKSl0aHJvdyBuZXcgVHlwZUVycm9yKFwiVGhlIHNwZWNpZmllZCBldmVudCB0eXBlIGlzIG5vdCBzdXBwb3J0ZWQuXCIpO3JldHVybiB0aGlzLl91c2VySGFuZGxlcnNbdHlwZV0ucHVzaChsaXN0ZW5lciksdGhpc30sV2ViTWlkaS5wcm90b3R5cGUuaGFzTGlzdGVuZXI9ZnVuY3Rpb24odHlwZSxsaXN0ZW5lcil7aWYoIXRoaXMuZW5hYmxlZCl0aHJvdyBuZXcgRXJyb3IoXCJXZWJNaWRpIG11c3QgYmUgZW5hYmxlZCBiZWZvcmUgY2hlY2tpbmcgZXZlbnQgbGlzdGVuZXJzLlwiKTtpZihcImZ1bmN0aW9uXCIhPXR5cGVvZiBsaXN0ZW5lcil0aHJvdyBuZXcgVHlwZUVycm9yKFwiVGhlICdsaXN0ZW5lcicgcGFyYW1ldGVyIG11c3QgYmUgYSBmdW5jdGlvbi5cIik7aWYoISh0aGlzLl9taWRpSW50ZXJmYWNlRXZlbnRzLmluZGV4T2YodHlwZSk+PTApKXRocm93IG5ldyBUeXBlRXJyb3IoXCJUaGUgc3BlY2lmaWVkIGV2ZW50IHR5cGUgaXMgbm90IHN1cHBvcnRlZC5cIik7Zm9yKHZhciBvPTA7bzx0aGlzLl91c2VySGFuZGxlcnNbdHlwZV0ubGVuZ3RoO28rKylpZih0aGlzLl91c2VySGFuZGxlcnNbdHlwZV1bb109PT1saXN0ZW5lcilyZXR1cm4hMDtyZXR1cm4hMX0sV2ViTWlkaS5wcm90b3R5cGUucmVtb3ZlTGlzdGVuZXI9ZnVuY3Rpb24odHlwZSxsaXN0ZW5lcil7aWYoIXRoaXMuZW5hYmxlZCl0aHJvdyBuZXcgRXJyb3IoXCJXZWJNaWRpIG11c3QgYmUgZW5hYmxlZCBiZWZvcmUgcmVtb3ZpbmcgZXZlbnQgbGlzdGVuZXJzLlwiKTtpZih2b2lkIDAhPT1saXN0ZW5lciYmXCJmdW5jdGlvblwiIT10eXBlb2YgbGlzdGVuZXIpdGhyb3cgbmV3IFR5cGVFcnJvcihcIlRoZSAnbGlzdGVuZXInIHBhcmFtZXRlciBtdXN0IGJlIGEgZnVuY3Rpb24uXCIpO2lmKHRoaXMuX21pZGlJbnRlcmZhY2VFdmVudHMuaW5kZXhPZih0eXBlKT49MClpZihsaXN0ZW5lcilmb3IodmFyIG89MDtvPHRoaXMuX3VzZXJIYW5kbGVyc1t0eXBlXS5sZW5ndGg7bysrKXRoaXMuX3VzZXJIYW5kbGVyc1t0eXBlXVtvXT09PWxpc3RlbmVyJiZ0aGlzLl91c2VySGFuZGxlcnNbdHlwZV0uc3BsaWNlKG8sMSk7ZWxzZSB0aGlzLl91c2VySGFuZGxlcnNbdHlwZV09W107ZWxzZXtpZih2b2lkIDAhPT10eXBlKXRocm93IG5ldyBUeXBlRXJyb3IoXCJUaGUgc3BlY2lmaWVkIGV2ZW50IHR5cGUgaXMgbm90IHN1cHBvcnRlZC5cIik7dGhpcy5fcmVzZXRJbnRlcmZhY2VVc2VySGFuZGxlcnMoKX1yZXR1cm4gdGhpc30sV2ViTWlkaS5wcm90b3R5cGUudG9NSURJQ2hhbm5lbHM9ZnVuY3Rpb24oY2hhbm5lbCl7dmFyIGNoYW5uZWxzO3JldHVybiBjaGFubmVscz1cImFsbFwiPT09Y2hhbm5lbHx8dm9pZCAwPT09Y2hhbm5lbD9bXCJhbGxcIl06QXJyYXkuaXNBcnJheShjaGFubmVsKT9jaGFubmVsOltjaGFubmVsXSxjaGFubmVscy5pbmRleE9mKFwiYWxsXCIpPi0xJiYoY2hhbm5lbHM9WzEsMiwzLDQsNSw2LDcsOCw5LDEwLDExLDEyLDEzLDE0LDE1LDE2XSksY2hhbm5lbHMubWFwKGZ1bmN0aW9uKGNoKXtyZXR1cm4gcGFyc2VJbnQoY2gpfSkuZmlsdGVyKGZ1bmN0aW9uKGNoKXtyZXR1cm4gY2g+PTEmJjE2Pj1jaH0pfSxXZWJNaWRpLnByb3RvdHlwZS5nZXRJbnB1dEJ5SWQ9ZnVuY3Rpb24oaWQpe2lmKCF0aGlzLmVuYWJsZWQpdGhyb3cgbmV3IEVycm9yKFwiV2ViTWlkaSBpcyBub3QgZW5hYmxlZC5cIik7Zm9yKHZhciBpPTA7aTx0aGlzLmlucHV0cy5sZW5ndGg7aSsrKWlmKHRoaXMuaW5wdXRzW2ldLmlkPT09aWQpcmV0dXJuIHRoaXMuaW5wdXRzW2ldO3JldHVybiExfSxXZWJNaWRpLnByb3RvdHlwZS5nZXRPdXRwdXRCeUlkPWZ1bmN0aW9uKGlkKXtpZighdGhpcy5lbmFibGVkKXRocm93IG5ldyBFcnJvcihcIldlYk1pZGkgaXMgbm90IGVuYWJsZWQuXCIpO2Zvcih2YXIgaT0wO2k8dGhpcy5vdXRwdXRzLmxlbmd0aDtpKyspaWYodGhpcy5vdXRwdXRzW2ldLmlkPT09aWQpcmV0dXJuIHRoaXMub3V0cHV0c1tpXTtyZXR1cm4hMX0sV2ViTWlkaS5wcm90b3R5cGUuZ2V0SW5wdXRCeU5hbWU9ZnVuY3Rpb24obmFtZSl7aWYoIXRoaXMuZW5hYmxlZCl0aHJvdyBuZXcgRXJyb3IoXCJXZWJNaWRpIGlzIG5vdCBlbmFibGVkLlwiKTtmb3IodmFyIGk9MDtpPHRoaXMuaW5wdXRzLmxlbmd0aDtpKyspaWYofnRoaXMuaW5wdXRzW2ldLm5hbWUuaW5kZXhPZihuYW1lKSlyZXR1cm4gdGhpcy5pbnB1dHNbaV07cmV0dXJuITF9LFdlYk1pZGkucHJvdG90eXBlLmdldE9jdGF2ZT1mdW5jdGlvbihudW1iZXIpe3JldHVybiBudW1iZXImJm51bWJlcj49MCYmMTI3Pj1udW1iZXI/TWF0aC5mbG9vcihwYXJzZUludChudW1iZXIpLzEyLTEpLTE6dm9pZCAwfSxXZWJNaWRpLnByb3RvdHlwZS5nZXRPdXRwdXRCeU5hbWU9ZnVuY3Rpb24obmFtZSl7aWYoIXRoaXMuZW5hYmxlZCl0aHJvdyBuZXcgRXJyb3IoXCJXZWJNaWRpIGlzIG5vdCBlbmFibGVkLlwiKTtmb3IodmFyIGk9MDtpPHRoaXMub3V0cHV0cy5sZW5ndGg7aSsrKWlmKH50aGlzLm91dHB1dHNbaV0ubmFtZS5pbmRleE9mKG5hbWUpKXJldHVybiB0aGlzLm91dHB1dHNbaV07cmV0dXJuITF9LFdlYk1pZGkucHJvdG90eXBlLmd1ZXNzTm90ZU51bWJlcj1mdW5jdGlvbihpbnB1dCl7dmFyIG91dHB1dD0hMTtpZihpbnB1dCYmaW5wdXQudG9GaXhlZCYmaW5wdXQ+PTAmJjEyNz49aW5wdXQ/b3V0cHV0PU1hdGgucm91bmQoaW5wdXQpOnBhcnNlSW50KGlucHV0KT49MCYmcGFyc2VJbnQoaW5wdXQpPD0xMjc/b3V0cHV0PXBhcnNlSW50KGlucHV0KTooXCJzdHJpbmdcIj09dHlwZW9mIGlucHV0fHxpbnB1dCBpbnN0YW5jZW9mIFN0cmluZykmJihvdXRwdXQ9dGhpcy5ub3RlTmFtZVRvTnVtYmVyKGlucHV0KSksb3V0cHV0PT09ITEpdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBub3RlIG51bWJlciAoXCIraW5wdXQrXCIpLlwiKTtyZXR1cm4gb3V0cHV0fSxXZWJNaWRpLnByb3RvdHlwZS5ub3RlTmFtZVRvTnVtYmVyPWZ1bmN0aW9uKG5hbWUpe1wic3RyaW5nXCIhPXR5cGVvZiBuYW1lJiYobmFtZT1cIlwiKTt2YXIgbWF0Y2hlcz1uYW1lLm1hdGNoKC8oW0NERUZHQUJdKSgjezAsMn18YnswLDJ9KSgtP1xcZCspL2kpO2lmKCFtYXRjaGVzKXRocm93IG5ldyBSYW5nZUVycm9yKFwiSW52YWxpZCBub3RlIG5hbWUuXCIpO3ZhciBzZW1pdG9uZXM9d20uX3NlbWl0b25lc1ttYXRjaGVzWzFdLnRvVXBwZXJDYXNlKCldLG9jdGF2ZT1wYXJzZUludChtYXRjaGVzWzNdKSxyZXN1bHQ9MTIqKG9jdGF2ZSsyKStzZW1pdG9uZXM7aWYobWF0Y2hlc1syXS50b0xvd2VyQ2FzZSgpLmluZGV4T2YoXCJiXCIpPi0xP3Jlc3VsdC09bWF0Y2hlc1syXS5sZW5ndGg6bWF0Y2hlc1syXS50b0xvd2VyQ2FzZSgpLmluZGV4T2YoXCIjXCIpPi0xJiYocmVzdWx0Kz1tYXRjaGVzWzJdLmxlbmd0aCksMD5zZW1pdG9uZXN8fC0yPm9jdGF2ZXx8b2N0YXZlPjh8fDA+cmVzdWx0fHxyZXN1bHQ+MTI3KXRocm93IG5ldyBSYW5nZUVycm9yKFwiSW52YWxpZCBub3RlIG5hbWUgb3Igbm90ZSBvdXRzaWRlIHZhbGlkIHJhbmdlLlwiKTtyZXR1cm4gcmVzdWx0fSxXZWJNaWRpLnByb3RvdHlwZS5fdXBkYXRlSW5wdXRzQW5kT3V0cHV0cz1mdW5jdGlvbigpe3RoaXMuX3VwZGF0ZUlucHV0cygpLHRoaXMuX3VwZGF0ZU91dHB1dHMoKX0sV2ViTWlkaS5wcm90b3R5cGUuX3VwZGF0ZUlucHV0cz1mdW5jdGlvbigpe2Zvcih2YXIgaT0wO2k8dGhpcy5faW5wdXRzLmxlbmd0aDtpKyspe2Zvcih2YXIgcmVtb3ZlPSEwLHVwZGF0ZWQ9dGhpc1tcImludGVyZmFjZVwiXS5pbnB1dHMudmFsdWVzKCksaW5wdXQ9dXBkYXRlZC5uZXh0KCk7aW5wdXQmJiFpbnB1dC5kb25lO2lucHV0PXVwZGF0ZWQubmV4dCgpKWlmKHRoaXMuX2lucHV0c1tpXS5fbWlkaUlucHV0PT09aW5wdXQudmFsdWUpe3JlbW92ZT0hMTticmVha31yZW1vdmUmJnRoaXMuX2lucHV0cy5zcGxpY2UoaSwxKX10aGlzW1wiaW50ZXJmYWNlXCJdJiZ0aGlzW1wiaW50ZXJmYWNlXCJdLmlucHV0cy5mb3JFYWNoKGZ1bmN0aW9uKG5JbnB1dCl7Zm9yKHZhciBhZGQ9ITAsaj0wO2o8dGhpcy5faW5wdXRzLmxlbmd0aDtqKyspdGhpcy5faW5wdXRzW2pdLl9taWRpSW5wdXQ9PT1uSW5wdXQmJihhZGQ9ITEpO2FkZCYmdGhpcy5faW5wdXRzLnB1c2godGhpcy5fY3JlYXRlSW5wdXQobklucHV0KSl9LmJpbmQodGhpcykpfSxXZWJNaWRpLnByb3RvdHlwZS5fdXBkYXRlT3V0cHV0cz1mdW5jdGlvbigpe2Zvcih2YXIgaT0wO2k8dGhpcy5fb3V0cHV0cy5sZW5ndGg7aSsrKXtmb3IodmFyIHJlbW92ZT0hMCx1cGRhdGVkPXRoaXNbXCJpbnRlcmZhY2VcIl0ub3V0cHV0cy52YWx1ZXMoKSxvdXRwdXQ9dXBkYXRlZC5uZXh0KCk7b3V0cHV0JiYhb3V0cHV0LmRvbmU7b3V0cHV0PXVwZGF0ZWQubmV4dCgpKWlmKHRoaXMuX291dHB1dHNbaV0uX21pZGlPdXRwdXQ9PT1vdXRwdXQudmFsdWUpe3JlbW92ZT0hMTticmVha31yZW1vdmUmJnRoaXMuX291dHB1dHMuc3BsaWNlKGksMSl9dGhpc1tcImludGVyZmFjZVwiXSYmdGhpc1tcImludGVyZmFjZVwiXS5vdXRwdXRzLmZvckVhY2goZnVuY3Rpb24obk91dHB1dCl7Zm9yKHZhciBhZGQ9ITAsaj0wO2o8dGhpcy5fb3V0cHV0cy5sZW5ndGg7aisrKXRoaXMuX291dHB1dHNbal0uX21pZGlPdXRwdXQ9PT1uT3V0cHV0JiYoYWRkPSExKTthZGQmJnRoaXMuX291dHB1dHMucHVzaCh0aGlzLl9jcmVhdGVPdXRwdXQobk91dHB1dCkpfS5iaW5kKHRoaXMpKX0sV2ViTWlkaS5wcm90b3R5cGUuX2NyZWF0ZUlucHV0PWZ1bmN0aW9uKG1pZGlJbnB1dCl7dmFyIGlucHV0PW5ldyBJbnB1dChtaWRpSW5wdXQpO3JldHVybiBpbnB1dC5fbWlkaUlucHV0Lm9ubWlkaW1lc3NhZ2U9aW5wdXQuX29uTWlkaU1lc3NhZ2UuYmluZChpbnB1dCksaW5wdXR9LFdlYk1pZGkucHJvdG90eXBlLl9jcmVhdGVPdXRwdXQ9ZnVuY3Rpb24obWlkaU91dHB1dCl7dmFyIG91dHB1dD1uZXcgT3V0cHV0KG1pZGlPdXRwdXQpO3JldHVybiBvdXRwdXQuX21pZGlPdXRwdXQub25taWRpbWVzc2FnZT1vdXRwdXQuX29uTWlkaU1lc3NhZ2UuYmluZChvdXRwdXQpLG91dHB1dH0sV2ViTWlkaS5wcm90b3R5cGUuX29uSW50ZXJmYWNlU3RhdGVDaGFuZ2U9ZnVuY3Rpb24oZSl7dGhpcy5fdXBkYXRlSW5wdXRzQW5kT3V0cHV0cygpO3ZhciBldmVudD17dGltZXN0YW1wOmUudGltZVN0YW1wLHR5cGU6ZS5wb3J0LnN0YXRlfTt0aGlzW1wiaW50ZXJmYWNlXCJdJiZcImNvbm5lY3RlZFwiPT09ZS5wb3J0LnN0YXRlP1wib3V0cHV0XCI9PT1lLnBvcnQudHlwZT9ldmVudC5wb3J0PXRoaXMuZ2V0T3V0cHV0QnlJZChlLnBvcnQuaWQpOlwiaW5wdXRcIj09PWUucG9ydC50eXBlJiYoZXZlbnQucG9ydD10aGlzLmdldElucHV0QnlJZChlLnBvcnQuaWQpKTpldmVudC5wb3J0PXtjb25uZWN0aW9uOlwiY2xvc2VkXCIsaWQ6ZS5wb3J0LmlkLG1hbnVmYWN0dXJlcjplLnBvcnQubWFudWZhY3R1cmVyLG5hbWU6ZS5wb3J0Lm5hbWUsc3RhdGU6ZS5wb3J0LnN0YXRlLHR5cGU6ZS5wb3J0LnR5cGV9LHRoaXMuX3VzZXJIYW5kbGVyc1tlLnBvcnQuc3RhdGVdLmZvckVhY2goZnVuY3Rpb24oaGFuZGxlcil7aGFuZGxlcihldmVudCl9KX0sV2ViTWlkaS5wcm90b3R5cGUuX3Jlc2V0SW50ZXJmYWNlVXNlckhhbmRsZXJzPWZ1bmN0aW9uKCl7Zm9yKHZhciBpPTA7aTx0aGlzLl9taWRpSW50ZXJmYWNlRXZlbnRzLmxlbmd0aDtpKyspdGhpcy5fdXNlckhhbmRsZXJzW3RoaXMuX21pZGlJbnRlcmZhY2VFdmVudHNbaV1dPVtdfSxJbnB1dC5wcm90b3R5cGUuYWRkTGlzdGVuZXI9ZnVuY3Rpb24odHlwZSxjaGFubmVsLGxpc3RlbmVyKXt2YXIgdGhhdD10aGlzO2lmKHZvaWQgMD09PWNoYW5uZWwmJihjaGFubmVsPVwiYWxsXCIpLEFycmF5LmlzQXJyYXkoY2hhbm5lbCl8fChjaGFubmVsPVtjaGFubmVsXSksY2hhbm5lbC5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pe2lmKFwiYWxsXCIhPT1pdGVtJiYhKGl0ZW0+PTEmJjE2Pj1pdGVtKSl0aHJvdyBuZXcgUmFuZ2VFcnJvcihcIlRoZSAnY2hhbm5lbCcgcGFyYW1ldGVyIGlzIGludmFsaWQuXCIpfSksXCJmdW5jdGlvblwiIT10eXBlb2YgbGlzdGVuZXIpdGhyb3cgbmV3IFR5cGVFcnJvcihcIlRoZSAnbGlzdGVuZXInIHBhcmFtZXRlciBtdXN0IGJlIGEgZnVuY3Rpb24uXCIpO2lmKHdtLk1JRElfU1lTVEVNX01FU1NBR0VTW3R5cGVdKXRoaXMuX3VzZXJIYW5kbGVycy5zeXN0ZW1bdHlwZV18fCh0aGlzLl91c2VySGFuZGxlcnMuc3lzdGVtW3R5cGVdPVtdKSx0aGlzLl91c2VySGFuZGxlcnMuc3lzdGVtW3R5cGVdLnB1c2gobGlzdGVuZXIpO2Vsc2V7aWYoIXdtLk1JRElfQ0hBTk5FTF9NRVNTQUdFU1t0eXBlXSl0aHJvdyBuZXcgVHlwZUVycm9yKFwiVGhlIHNwZWNpZmllZCBldmVudCB0eXBlIGlzIG5vdCBzdXBwb3J0ZWQuXCIpO2lmKGNoYW5uZWwuaW5kZXhPZihcImFsbFwiKT4tMSl7Y2hhbm5lbD1bXTtmb3IodmFyIGo9MTsxNj49ajtqKyspY2hhbm5lbC5wdXNoKGopfXRoaXMuX3VzZXJIYW5kbGVycy5jaGFubmVsW3R5cGVdfHwodGhpcy5fdXNlckhhbmRsZXJzLmNoYW5uZWxbdHlwZV09W10pLGNoYW5uZWwuZm9yRWFjaChmdW5jdGlvbihjaCl7dGhhdC5fdXNlckhhbmRsZXJzLmNoYW5uZWxbdHlwZV1bY2hdfHwodGhhdC5fdXNlckhhbmRsZXJzLmNoYW5uZWxbdHlwZV1bY2hdPVtdKSx0aGF0Ll91c2VySGFuZGxlcnMuY2hhbm5lbFt0eXBlXVtjaF0ucHVzaChsaXN0ZW5lcil9KX1yZXR1cm4gdGhpc30sSW5wdXQucHJvdG90eXBlLm9uPUlucHV0LnByb3RvdHlwZS5hZGRMaXN0ZW5lcixJbnB1dC5wcm90b3R5cGUuaGFzTGlzdGVuZXI9ZnVuY3Rpb24odHlwZSxjaGFubmVsLGxpc3RlbmVyKXt2YXIgdGhhdD10aGlzO2lmKFwiZnVuY3Rpb25cIiE9dHlwZW9mIGxpc3RlbmVyKXRocm93IG5ldyBUeXBlRXJyb3IoXCJUaGUgJ2xpc3RlbmVyJyBwYXJhbWV0ZXIgbXVzdCBiZSBhIGZ1bmN0aW9uLlwiKTtpZih2b2lkIDA9PT1jaGFubmVsJiYoY2hhbm5lbD1cImFsbFwiKSxjaGFubmVsLmNvbnN0cnVjdG9yIT09QXJyYXkmJihjaGFubmVsPVtjaGFubmVsXSksd20uTUlESV9TWVNURU1fTUVTU0FHRVNbdHlwZV0pe2Zvcih2YXIgbz0wO288dGhpcy5fdXNlckhhbmRsZXJzLnN5c3RlbVt0eXBlXS5sZW5ndGg7bysrKWlmKHRoaXMuX3VzZXJIYW5kbGVycy5zeXN0ZW1bdHlwZV1bb109PT1saXN0ZW5lcilyZXR1cm4hMH1lbHNlIGlmKHdtLk1JRElfQ0hBTk5FTF9NRVNTQUdFU1t0eXBlXSl7aWYoY2hhbm5lbC5pbmRleE9mKFwiYWxsXCIpPi0xKXtjaGFubmVsPVtdO2Zvcih2YXIgaj0xOzE2Pj1qO2orKyljaGFubmVsLnB1c2goail9cmV0dXJuIHRoaXMuX3VzZXJIYW5kbGVycy5jaGFubmVsW3R5cGVdP2NoYW5uZWwuZXZlcnkoZnVuY3Rpb24oY2hOdW0pe3ZhciBsaXN0ZW5lcnM9dGhhdC5fdXNlckhhbmRsZXJzLmNoYW5uZWxbdHlwZV1bY2hOdW1dO3JldHVybiBsaXN0ZW5lcnMmJmxpc3RlbmVycy5pbmRleE9mKGxpc3RlbmVyKT4tMX0pOiExfXJldHVybiExfSxJbnB1dC5wcm90b3R5cGUucmVtb3ZlTGlzdGVuZXI9ZnVuY3Rpb24odHlwZSxjaGFubmVsLGxpc3RlbmVyKXt2YXIgdGhhdD10aGlzO2lmKHZvaWQgMCE9PWxpc3RlbmVyJiZcImZ1bmN0aW9uXCIhPXR5cGVvZiBsaXN0ZW5lcil0aHJvdyBuZXcgVHlwZUVycm9yKFwiVGhlICdsaXN0ZW5lcicgcGFyYW1ldGVyIG11c3QgYmUgYSBmdW5jdGlvbi5cIik7aWYodm9pZCAwPT09Y2hhbm5lbCYmKGNoYW5uZWw9XCJhbGxcIiksY2hhbm5lbC5jb25zdHJ1Y3RvciE9PUFycmF5JiYoY2hhbm5lbD1bY2hhbm5lbF0pLHdtLk1JRElfU1lTVEVNX01FU1NBR0VTW3R5cGVdKWlmKHZvaWQgMD09PWxpc3RlbmVyKXRoaXMuX3VzZXJIYW5kbGVycy5zeXN0ZW1bdHlwZV09W107ZWxzZSBmb3IodmFyIG89MDtvPHRoaXMuX3VzZXJIYW5kbGVycy5zeXN0ZW1bdHlwZV0ubGVuZ3RoO28rKyl0aGlzLl91c2VySGFuZGxlcnMuc3lzdGVtW3R5cGVdW29dPT09bGlzdGVuZXImJnRoaXMuX3VzZXJIYW5kbGVycy5zeXN0ZW1bdHlwZV0uc3BsaWNlKG8sMSk7ZWxzZSBpZih3bS5NSURJX0NIQU5ORUxfTUVTU0FHRVNbdHlwZV0pe2lmKGNoYW5uZWwuaW5kZXhPZihcImFsbFwiKT4tMSl7Y2hhbm5lbD1bXTtmb3IodmFyIGo9MTsxNj49ajtqKyspY2hhbm5lbC5wdXNoKGopfWlmKCF0aGlzLl91c2VySGFuZGxlcnMuY2hhbm5lbFt0eXBlXSlyZXR1cm4gdGhpcztjaGFubmVsLmZvckVhY2goZnVuY3Rpb24oY2hOdW0pe3ZhciBsaXN0ZW5lcnM9dGhhdC5fdXNlckhhbmRsZXJzLmNoYW5uZWxbdHlwZV1bY2hOdW1dO2lmKGxpc3RlbmVycylpZih2b2lkIDA9PT1saXN0ZW5lcil0aGF0Ll91c2VySGFuZGxlcnMuY2hhbm5lbFt0eXBlXVtjaE51bV09W107ZWxzZSBmb3IodmFyIGw9MDtsPGxpc3RlbmVycy5sZW5ndGg7bCsrKWxpc3RlbmVyc1tsXT09PWxpc3RlbmVyJiZsaXN0ZW5lcnMuc3BsaWNlKGwsMSl9KX1lbHNle2lmKHZvaWQgMCE9PXR5cGUpdGhyb3cgbmV3IFR5cGVFcnJvcihcIlRoZSBzcGVjaWZpZWQgZXZlbnQgdHlwZSBpcyBub3Qgc3VwcG9ydGVkLlwiKTt0aGlzLl9pbml0aWFsaXplVXNlckhhbmRsZXJzKCl9cmV0dXJuIHRoaXN9LElucHV0LnByb3RvdHlwZS5faW5pdGlhbGl6ZVVzZXJIYW5kbGVycz1mdW5jdGlvbigpe2Zvcih2YXIgcHJvcDEgaW4gd20uTUlESV9DSEFOTkVMX01FU1NBR0VTKXdtLk1JRElfQ0hBTk5FTF9NRVNTQUdFUy5oYXNPd25Qcm9wZXJ0eShwcm9wMSkmJih0aGlzLl91c2VySGFuZGxlcnMuY2hhbm5lbFtwcm9wMV09e30pO2Zvcih2YXIgcHJvcDIgaW4gd20uTUlESV9TWVNURU1fTUVTU0FHRVMpd20uTUlESV9TWVNURU1fTUVTU0FHRVMuaGFzT3duUHJvcGVydHkocHJvcDIpJiYodGhpcy5fdXNlckhhbmRsZXJzLnN5c3RlbVtwcm9wMl09W10pfSxJbnB1dC5wcm90b3R5cGUuX29uTWlkaU1lc3NhZ2U9ZnVuY3Rpb24oZSl7ZS5kYXRhWzBdPDI0MD90aGlzLl9wYXJzZUNoYW5uZWxFdmVudChlKTplLmRhdGFbMF08PTI1NSYmdGhpcy5fcGFyc2VTeXN0ZW1FdmVudChlKX0sSW5wdXQucHJvdG90eXBlLl9wYXJzZUNoYW5uZWxFdmVudD1mdW5jdGlvbihlKXt2YXIgZGF0YTEsZGF0YTIsY29tbWFuZD1lLmRhdGFbMF0+PjQsY2hhbm5lbD0oMTUmZS5kYXRhWzBdKSsxO2UuZGF0YS5sZW5ndGg+MSYmKGRhdGExPWUuZGF0YVsxXSxkYXRhMj1lLmRhdGEubGVuZ3RoPjI/ZS5kYXRhWzJdOnZvaWQgMCk7dmFyIGV2ZW50PXt0YXJnZXQ6dGhpcyxkYXRhOmUuZGF0YSx0aW1lc3RhbXA6ZS50aW1lU3RhbXAsY2hhbm5lbDpjaGFubmVsfTtjb21tYW5kPT09d20uTUlESV9DSEFOTkVMX01FU1NBR0VTLm5vdGVvZmZ8fGNvbW1hbmQ9PT13bS5NSURJX0NIQU5ORUxfTUVTU0FHRVMubm90ZW9uJiYwPT09ZGF0YTI/KGV2ZW50LnR5cGU9XCJub3Rlb2ZmXCIsZXZlbnQubm90ZT17bnVtYmVyOmRhdGExLG5hbWU6d20uX25vdGVzW2RhdGExJTEyXSxvY3RhdmU6d20uZ2V0T2N0YXZlKGRhdGExKX0sZXZlbnQudmVsb2NpdHk9ZGF0YTIvMTI3LGV2ZW50LnJhd1ZlbG9jaXR5PWRhdGEyKTpjb21tYW5kPT09d20uTUlESV9DSEFOTkVMX01FU1NBR0VTLm5vdGVvbj8oZXZlbnQudHlwZT1cIm5vdGVvblwiLGV2ZW50Lm5vdGU9e251bWJlcjpkYXRhMSxuYW1lOndtLl9ub3Rlc1tkYXRhMSUxMl0sb2N0YXZlOndtLmdldE9jdGF2ZShkYXRhMSl9LGV2ZW50LnZlbG9jaXR5PWRhdGEyLzEyNyxldmVudC5yYXdWZWxvY2l0eT1kYXRhMik6Y29tbWFuZD09PXdtLk1JRElfQ0hBTk5FTF9NRVNTQUdFUy5rZXlhZnRlcnRvdWNoPyhldmVudC50eXBlPVwia2V5YWZ0ZXJ0b3VjaFwiLGV2ZW50Lm5vdGU9e251bWJlcjpkYXRhMSxuYW1lOndtLl9ub3Rlc1tkYXRhMSUxMl0sb2N0YXZlOndtLmdldE9jdGF2ZShkYXRhMSl9LGV2ZW50LnZhbHVlPWRhdGEyLzEyNyk6Y29tbWFuZD09PXdtLk1JRElfQ0hBTk5FTF9NRVNTQUdFUy5jb250cm9sY2hhbmdlJiZkYXRhMT49MCYmMTE5Pj1kYXRhMT8oZXZlbnQudHlwZT1cImNvbnRyb2xjaGFuZ2VcIixldmVudC5jb250cm9sbGVyPXtudW1iZXI6ZGF0YTEsbmFtZTp0aGlzLmdldENjTmFtZUJ5TnVtYmVyKGRhdGExKX0sZXZlbnQudmFsdWU9ZGF0YTIpOmNvbW1hbmQ9PT13bS5NSURJX0NIQU5ORUxfTUVTU0FHRVMuY2hhbm5lbG1vZGUmJmRhdGExPj0xMjAmJjEyNz49ZGF0YTE/KGV2ZW50LnR5cGU9XCJjaGFubmVsbW9kZVwiLGV2ZW50LmNvbnRyb2xsZXI9e251bWJlcjpkYXRhMSxuYW1lOnRoaXMuZ2V0Q2hhbm5lbE1vZGVCeU51bWJlcihkYXRhMSl9LGV2ZW50LnZhbHVlPWRhdGEyKTpjb21tYW5kPT09d20uTUlESV9DSEFOTkVMX01FU1NBR0VTLnByb2dyYW1jaGFuZ2U/KGV2ZW50LnR5cGU9XCJwcm9ncmFtY2hhbmdlXCIsZXZlbnQudmFsdWU9ZGF0YTEpOmNvbW1hbmQ9PT13bS5NSURJX0NIQU5ORUxfTUVTU0FHRVMuY2hhbm5lbGFmdGVydG91Y2g/KGV2ZW50LnR5cGU9XCJjaGFubmVsYWZ0ZXJ0b3VjaFwiLGV2ZW50LnZhbHVlPWRhdGExLzEyNyk6Y29tbWFuZD09PXdtLk1JRElfQ0hBTk5FTF9NRVNTQUdFUy5waXRjaGJlbmQ/KGV2ZW50LnR5cGU9XCJwaXRjaGJlbmRcIixldmVudC52YWx1ZT0oKGRhdGEyPDw3KStkYXRhMS04MTkyKS84MTkyKTpldmVudC50eXBlPVwidW5rbm93bmNoYW5uZWxtZXNzYWdlXCIsdGhpcy5fdXNlckhhbmRsZXJzLmNoYW5uZWxbZXZlbnQudHlwZV0mJnRoaXMuX3VzZXJIYW5kbGVycy5jaGFubmVsW2V2ZW50LnR5cGVdW2NoYW5uZWxdJiZ0aGlzLl91c2VySGFuZGxlcnMuY2hhbm5lbFtldmVudC50eXBlXVtjaGFubmVsXS5mb3JFYWNoKGZ1bmN0aW9uKGNhbGxiYWNrKXtjYWxsYmFjayhldmVudCl9KX0sSW5wdXQucHJvdG90eXBlLmdldENjTmFtZUJ5TnVtYmVyPWZ1bmN0aW9uKG51bWJlcil7aWYobnVtYmVyPXBhcnNlSW50KG51bWJlciksIShudW1iZXI+PTAmJjExOT49bnVtYmVyKSl0aHJvdyBuZXcgUmFuZ2VFcnJvcihcIlRoZSBjb250cm9sIGNoYW5nZSBudW1iZXIgbXVzdCBiZSBiZXR3ZWVuIDAgYW5kIDExOS5cIik7Zm9yKHZhciBjYyBpbiB3bS5NSURJX0NPTlRST0xfQ0hBTkdFX01FU1NBR0VTKWlmKG51bWJlcj09PXdtLk1JRElfQ09OVFJPTF9DSEFOR0VfTUVTU0FHRVNbY2NdKXJldHVybiBjYztyZXR1cm4gdm9pZCAwfSxJbnB1dC5wcm90b3R5cGUuZ2V0Q2hhbm5lbE1vZGVCeU51bWJlcj1mdW5jdGlvbihudW1iZXIpe2lmKG51bWJlcj1wYXJzZUludChudW1iZXIpLCEobnVtYmVyPj0xMjAmJnN0YXR1czw9MTI3KSl0aHJvdyBuZXcgUmFuZ2VFcnJvcihcIlRoZSBjb250cm9sIGNoYW5nZSBudW1iZXIgbXVzdCBiZSBiZXR3ZWVuIDEyMCBhbmQgMTI3LlwiKTtmb3IodmFyIGNtIGluIHdtLk1JRElfQ0hBTk5FTF9NT0RFX01FU1NBR0VTKWlmKG51bWJlcj09PXdtLk1JRElfQ0hBTk5FTF9NT0RFX01FU1NBR0VTW2NtXSlyZXR1cm4gY219LElucHV0LnByb3RvdHlwZS5fcGFyc2VTeXN0ZW1FdmVudD1mdW5jdGlvbihlKXt2YXIgY29tbWFuZD1lLmRhdGFbMF0sZXZlbnQ9e3RhcmdldDp0aGlzLGRhdGE6ZS5kYXRhLHRpbWVzdGFtcDplLnRpbWVTdGFtcH07Y29tbWFuZD09PXdtLk1JRElfU1lTVEVNX01FU1NBR0VTLnN5c2V4P2V2ZW50LnR5cGU9XCJzeXNleFwiOmNvbW1hbmQ9PT13bS5NSURJX1NZU1RFTV9NRVNTQUdFUy50aW1lY29kZT9ldmVudC50eXBlPVwidGltZWNvZGVcIjpjb21tYW5kPT09d20uTUlESV9TWVNURU1fTUVTU0FHRVMuc29uZ3Bvc2l0aW9uP2V2ZW50LnR5cGU9XCJzb25ncG9zaXRpb25cIjpjb21tYW5kPT09d20uTUlESV9TWVNURU1fTUVTU0FHRVMuc29uZ3NlbGVjdD8oZXZlbnQudHlwZT1cInNvbmdzZWxlY3RcIixldmVudC5zb25nPWUuZGF0YVsxXSk6Y29tbWFuZD09PXdtLk1JRElfU1lTVEVNX01FU1NBR0VTLnR1bmluZ3JlcXVlc3Q/ZXZlbnQudHlwZT1cInR1bmluZ3JlcXVlc3RcIjpjb21tYW5kPT09d20uTUlESV9TWVNURU1fTUVTU0FHRVMuY2xvY2s/ZXZlbnQudHlwZT1cImNsb2NrXCI6Y29tbWFuZD09PXdtLk1JRElfU1lTVEVNX01FU1NBR0VTLnN0YXJ0P2V2ZW50LnR5cGU9XCJzdGFydFwiOmNvbW1hbmQ9PT13bS5NSURJX1NZU1RFTV9NRVNTQUdFU1tcImNvbnRpbnVlXCJdP2V2ZW50LnR5cGU9XCJjb250aW51ZVwiOmNvbW1hbmQ9PT13bS5NSURJX1NZU1RFTV9NRVNTQUdFUy5zdG9wP2V2ZW50LnR5cGU9XCJzdG9wXCI6Y29tbWFuZD09PXdtLk1JRElfU1lTVEVNX01FU1NBR0VTLmFjdGl2ZXNlbnNpbmc/ZXZlbnQudHlwZT1cImFjdGl2ZXNlbnNpbmdcIjpjb21tYW5kPT09d20uTUlESV9TWVNURU1fTUVTU0FHRVMucmVzZXQ/ZXZlbnQudHlwZT1cInJlc2V0XCI6ZXZlbnQudHlwZT1cInVua25vd25zeXN0ZW1tZXNzYWdlXCIsdGhpcy5fdXNlckhhbmRsZXJzLnN5c3RlbVtldmVudC50eXBlXSYmdGhpcy5fdXNlckhhbmRsZXJzLnN5c3RlbVtldmVudC50eXBlXS5mb3JFYWNoKGZ1bmN0aW9uKGNhbGxiYWNrKXtjYWxsYmFjayhldmVudCl9KX0sT3V0cHV0LnByb3RvdHlwZS5zZW5kPWZ1bmN0aW9uKHN0YXR1cyxkYXRhLHRpbWVzdGFtcCl7aWYoIShzdGF0dXM+PTEyOCYmMjU1Pj1zdGF0dXMpKXRocm93IG5ldyBSYW5nZUVycm9yKFwiVGhlIHN0YXR1cyBieXRlIG11c3QgYmUgYW4gaW50ZWdlciBiZXR3ZWVuIDEyOCAoMHg4MCkgYW5kIDI1NSAoMHhGRikuXCIpO3ZvaWQgMD09PWRhdGEmJihkYXRhPVtdKSxBcnJheS5pc0FycmF5KGRhdGEpfHwoZGF0YT1bZGF0YV0pO3ZhciBtZXNzYWdlPVtdO3JldHVybiBkYXRhLmZvckVhY2goZnVuY3Rpb24oaXRlbSxpbmRleCl7dmFyIHBhcnNlZD1wYXJzZUludChpdGVtKTtpZighKHBhcnNlZD49MCYmMjU1Pj1wYXJzZWQpKXRocm93IG5ldyBSYW5nZUVycm9yKFwiRGF0YSBieXRlcyBtdXN0IGJlIGludGVnZXJzIGJldHdlZW4gMCAoMHgwMCkgYW5kIDI1NSAoMHhGRikuXCIpO21lc3NhZ2UucHVzaChwYXJzZWQpfSksdGhpcy5fbWlkaU91dHB1dC5zZW5kKFtzdGF0dXNdLmNvbmNhdChtZXNzYWdlKSxwYXJzZUZsb2F0KHRpbWVzdGFtcCl8fDApLHRoaXN9LE91dHB1dC5wcm90b3R5cGUuc2VuZFN5c2V4PWZ1bmN0aW9uKG1hbnVmYWN0dXJlcixkYXRhLG9wdGlvbnMpe2lmKCF3bS5zeXNleEVuYWJsZWQpdGhyb3cgbmV3IEVycm9yKFwiU3lzZXggbWVzc2FnZSBzdXBwb3J0IG11c3QgZmlyc3QgYmUgYWN0aXZhdGVkLlwiKTtyZXR1cm4gb3B0aW9ucz1vcHRpb25zfHx7fSxtYW51ZmFjdHVyZXI9W10uY29uY2F0KG1hbnVmYWN0dXJlciksZGF0YS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pe2lmKDA+aXRlbXx8aXRlbT4xMjcpdGhyb3cgbmV3IFJhbmdlRXJyb3IoXCJUaGUgZGF0YSBieXRlcyBvZiBhIHN5c2V4IG1lc3NhZ2UgbXVzdCBiZSBpbnRlZ2VycyBiZXR3ZWVuIDAgKDB4MDApIGFuZCAxMjcgKDB4N0YpLlwiKX0pLGRhdGE9bWFudWZhY3R1cmVyLmNvbmNhdChkYXRhLHdtLk1JRElfU1lTVEVNX01FU1NBR0VTLnN5c2V4ZW5kKSx0aGlzLnNlbmQod20uTUlESV9TWVNURU1fTUVTU0FHRVMuc3lzZXgsZGF0YSx0aGlzLl9wYXJzZVRpbWVQYXJhbWV0ZXIob3B0aW9ucy50aW1lKSksdGhpc30sT3V0cHV0LnByb3RvdHlwZS5zZW5kVGltZWNvZGVRdWFydGVyRnJhbWU9ZnVuY3Rpb24odmFsdWUsb3B0aW9ucyl7cmV0dXJuIG9wdGlvbnM9b3B0aW9uc3x8e30sdGhpcy5zZW5kKHdtLk1JRElfU1lTVEVNX01FU1NBR0VTLnRpbWVjb2RlLHZhbHVlLHRoaXMuX3BhcnNlVGltZVBhcmFtZXRlcihvcHRpb25zLnRpbWUpKSx0aGlzfSxPdXRwdXQucHJvdG90eXBlLnNlbmRTb25nUG9zaXRpb249ZnVuY3Rpb24odmFsdWUsb3B0aW9ucyl7dmFsdWU9cGFyc2VJbnQodmFsdWUpfHwwLG9wdGlvbnM9b3B0aW9uc3x8e307dmFyIG1zYj12YWx1ZT4+NyYxMjcsbHNiPTEyNyZ2YWx1ZTtyZXR1cm4gdGhpcy5zZW5kKHdtLk1JRElfU1lTVEVNX01FU1NBR0VTLnNvbmdwb3NpdGlvbixbbXNiLGxzYl0sdGhpcy5fcGFyc2VUaW1lUGFyYW1ldGVyKG9wdGlvbnMudGltZSkpLHRoaXN9LE91dHB1dC5wcm90b3R5cGUuc2VuZFNvbmdTZWxlY3Q9ZnVuY3Rpb24odmFsdWUsb3B0aW9ucyl7aWYodmFsdWU9cGFyc2VJbnQodmFsdWUpLG9wdGlvbnM9b3B0aW9uc3x8e30sISh2YWx1ZT49MCYmMTI3Pj12YWx1ZSkpdGhyb3cgbmV3IFJhbmdlRXJyb3IoXCJUaGUgc29uZyBudW1iZXIgbXVzdCBiZSBiZXR3ZWVuIDAgYW5kIDEyNy5cIik7cmV0dXJuIHRoaXMuc2VuZCh3bS5NSURJX1NZU1RFTV9NRVNTQUdFUy5zb25nc2VsZWN0LFt2YWx1ZV0sdGhpcy5fcGFyc2VUaW1lUGFyYW1ldGVyKG9wdGlvbnMudGltZSkpLHRoaXN9LE91dHB1dC5wcm90b3R5cGUuc2VuZFR1bmluZ1JlcXVlc3Q9ZnVuY3Rpb24ob3B0aW9ucyl7cmV0dXJuIG9wdGlvbnM9b3B0aW9uc3x8e30sdGhpcy5zZW5kKHdtLk1JRElfU1lTVEVNX01FU1NBR0VTLnR1bmluZ3JlcXVlc3Qsdm9pZCAwLHRoaXMuX3BhcnNlVGltZVBhcmFtZXRlcihvcHRpb25zLnRpbWUpKSx0aGlzfSxPdXRwdXQucHJvdG90eXBlLnNlbmRDbG9jaz1mdW5jdGlvbihvcHRpb25zKXtyZXR1cm4gb3B0aW9ucz1vcHRpb25zfHx7fSx0aGlzLnNlbmQod20uTUlESV9TWVNURU1fTUVTU0FHRVMuY2xvY2ssdm9pZCAwLHRoaXMuX3BhcnNlVGltZVBhcmFtZXRlcihvcHRpb25zLnRpbWUpKSx0aGlzfSxPdXRwdXQucHJvdG90eXBlLnNlbmRTdGFydD1mdW5jdGlvbihvcHRpb25zKXtyZXR1cm4gb3B0aW9ucz1vcHRpb25zfHx7fSx0aGlzLnNlbmQod20uTUlESV9TWVNURU1fTUVTU0FHRVMuc3RhcnQsdm9pZCAwLHRoaXMuX3BhcnNlVGltZVBhcmFtZXRlcihvcHRpb25zLnRpbWUpKSx0aGlzfSxPdXRwdXQucHJvdG90eXBlLnNlbmRDb250aW51ZT1mdW5jdGlvbihvcHRpb25zKXtyZXR1cm4gb3B0aW9ucz1vcHRpb25zfHx7fSx0aGlzLnNlbmQod20uTUlESV9TWVNURU1fTUVTU0FHRVNbXCJjb250aW51ZVwiXSx2b2lkIDAsdGhpcy5fcGFyc2VUaW1lUGFyYW1ldGVyKG9wdGlvbnMudGltZSkpLHRoaXN9LE91dHB1dC5wcm90b3R5cGUuc2VuZFN0b3A9ZnVuY3Rpb24ob3B0aW9ucyl7cmV0dXJuIG9wdGlvbnM9b3B0aW9uc3x8e30sdGhpcy5zZW5kKHdtLk1JRElfU1lTVEVNX01FU1NBR0VTLnN0b3Asdm9pZCAwLHRoaXMuX3BhcnNlVGltZVBhcmFtZXRlcihvcHRpb25zLnRpbWUpKSx0aGlzfSxPdXRwdXQucHJvdG90eXBlLnNlbmRBY3RpdmVTZW5zaW5nPWZ1bmN0aW9uKG9wdGlvbnMpe3JldHVybiBvcHRpb25zPW9wdGlvbnN8fHt9LHRoaXMuc2VuZCh3bS5NSURJX1NZU1RFTV9NRVNTQUdFUy5hY3RpdmVzZW5zaW5nLFtdLHRoaXMuX3BhcnNlVGltZVBhcmFtZXRlcihvcHRpb25zLnRpbWUpKSx0aGlzfSxPdXRwdXQucHJvdG90eXBlLnNlbmRSZXNldD1mdW5jdGlvbihvcHRpb25zKXtyZXR1cm4gb3B0aW9ucz1vcHRpb25zfHx7fSx0aGlzLnNlbmQod20uTUlESV9TWVNURU1fTUVTU0FHRVMucmVzZXQsdm9pZCAwLHRoaXMuX3BhcnNlVGltZVBhcmFtZXRlcihvcHRpb25zLnRpbWUpKSx0aGlzfSxPdXRwdXQucHJvdG90eXBlLnN0b3BOb3RlPWZ1bmN0aW9uKG5vdGUsY2hhbm5lbCxvcHRpb25zKXtpZihcImFsbFwiPT09bm90ZSlyZXR1cm4gdGhpcy5zZW5kQ2hhbm5lbE1vZGUoXCJhbGxub3Rlc29mZlwiLDAsY2hhbm5lbCxvcHRpb25zKTt2YXIgblZlbG9jaXR5PTY0O3JldHVybiBvcHRpb25zPW9wdGlvbnN8fHt9LG9wdGlvbnMudmVsb2NpdHk9cGFyc2VGbG9hdChvcHRpb25zLnZlbG9jaXR5KSxvcHRpb25zLnJhd1ZlbG9jaXR5PyFpc05hTihvcHRpb25zLnZlbG9jaXR5KSYmb3B0aW9ucy52ZWxvY2l0eT49MCYmb3B0aW9ucy52ZWxvY2l0eTw9MTI3JiYoblZlbG9jaXR5PW9wdGlvbnMudmVsb2NpdHkpOiFpc05hTihvcHRpb25zLnZlbG9jaXR5KSYmb3B0aW9ucy52ZWxvY2l0eT49MCYmb3B0aW9ucy52ZWxvY2l0eTw9MSYmKG5WZWxvY2l0eT0xMjcqb3B0aW9ucy52ZWxvY2l0eSksdGhpcy5fY29udmVydE5vdGVUb0FycmF5KG5vdGUpLmZvckVhY2goZnVuY3Rpb24oaXRlbSl7d20udG9NSURJQ2hhbm5lbHMoY2hhbm5lbCkuZm9yRWFjaChmdW5jdGlvbihjaCl7dGhpcy5zZW5kKCh3bS5NSURJX0NIQU5ORUxfTUVTU0FHRVMubm90ZW9mZjw8NCkrKGNoLTEpLFtpdGVtLE1hdGgucm91bmQoblZlbG9jaXR5KV0sdGhpcy5fcGFyc2VUaW1lUGFyYW1ldGVyKG9wdGlvbnMudGltZSkpfS5iaW5kKHRoaXMpKX0uYmluZCh0aGlzKSksdGhpc30sT3V0cHV0LnByb3RvdHlwZS5wbGF5Tm90ZT1mdW5jdGlvbihub3RlLGNoYW5uZWwsb3B0aW9ucyl7dmFyIG5WZWxvY2l0eT02NDtpZihvcHRpb25zPW9wdGlvbnN8fHt9LG9wdGlvbnMudmVsb2NpdHk9cGFyc2VGbG9hdChvcHRpb25zLnZlbG9jaXR5KSxvcHRpb25zLnJhd1ZlbG9jaXR5PyFpc05hTihvcHRpb25zLnZlbG9jaXR5KSYmb3B0aW9ucy52ZWxvY2l0eT49MCYmb3B0aW9ucy52ZWxvY2l0eTw9MTI3JiYoblZlbG9jaXR5PW9wdGlvbnMudmVsb2NpdHkpOiFpc05hTihvcHRpb25zLnZlbG9jaXR5KSYmb3B0aW9ucy52ZWxvY2l0eT49MCYmb3B0aW9ucy52ZWxvY2l0eTw9MSYmKG5WZWxvY2l0eT0xMjcqb3B0aW9ucy52ZWxvY2l0eSksb3B0aW9ucy50aW1lPXRoaXMuX3BhcnNlVGltZVBhcmFtZXRlcihvcHRpb25zLnRpbWUpLHRoaXMuX2NvbnZlcnROb3RlVG9BcnJheShub3RlKS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pe3dtLnRvTUlESUNoYW5uZWxzKGNoYW5uZWwpLmZvckVhY2goZnVuY3Rpb24oY2gpe3RoaXMuc2VuZCgod20uTUlESV9DSEFOTkVMX01FU1NBR0VTLm5vdGVvbjw8NCkrKGNoLTEpLFtpdGVtLE1hdGgucm91bmQoblZlbG9jaXR5KV0sb3B0aW9ucy50aW1lKX0uYmluZCh0aGlzKSl9LmJpbmQodGhpcykpLG9wdGlvbnMuZHVyYXRpb249cGFyc2VGbG9hdChvcHRpb25zLmR1cmF0aW9uKSxvcHRpb25zLmR1cmF0aW9uKXtvcHRpb25zLmR1cmF0aW9uPD0wJiYob3B0aW9ucy5kdXJhdGlvbj0wKTt2YXIgblJlbGVhc2U9NjQ7b3B0aW9ucy5yZWxlYXNlPXBhcnNlRmxvYXQob3B0aW9ucy5yZWxlYXNlKSxvcHRpb25zLnJhd1ZlbG9jaXR5PyFpc05hTihvcHRpb25zLnJlbGVhc2UpJiZvcHRpb25zLnJlbGVhc2U+PTAmJm9wdGlvbnMucmVsZWFzZTw9MTI3JiYoblJlbGVhc2U9b3B0aW9ucy5yZWxlYXNlKTohaXNOYU4ob3B0aW9ucy5yZWxlYXNlKSYmb3B0aW9ucy5yZWxlYXNlPj0wJiZvcHRpb25zLnJlbGVhc2U8PTEmJihuUmVsZWFzZT0xMjcqb3B0aW9ucy5yZWxlYXNlKSx0aGlzLl9jb252ZXJ0Tm90ZVRvQXJyYXkobm90ZSkuZm9yRWFjaChmdW5jdGlvbihpdGVtKXt3bS50b01JRElDaGFubmVscyhjaGFubmVsKS5mb3JFYWNoKGZ1bmN0aW9uKGNoKXt0aGlzLnNlbmQoKHdtLk1JRElfQ0hBTk5FTF9NRVNTQUdFUy5ub3Rlb2ZmPDw0KSsoY2gtMSksW2l0ZW0sTWF0aC5yb3VuZChuUmVsZWFzZSldLChvcHRpb25zLnRpbWV8fHdtLnRpbWUpK29wdGlvbnMuZHVyYXRpb24pfS5iaW5kKHRoaXMpKX0uYmluZCh0aGlzKSl9cmV0dXJuIHRoaXN9LE91dHB1dC5wcm90b3R5cGUuc2VuZEtleUFmdGVydG91Y2g9ZnVuY3Rpb24obm90ZSxjaGFubmVsLHByZXNzdXJlLG9wdGlvbnMpe3ZhciB0aGF0PXRoaXM7aWYob3B0aW9ucz1vcHRpb25zfHx7fSwxPmNoYW5uZWx8fGNoYW5uZWw+MTYpdGhyb3cgbmV3IFJhbmdlRXJyb3IoXCJUaGUgY2hhbm5lbCBtdXN0IGJlIGJldHdlZW4gMSBhbmQgMTYuXCIpO3ByZXNzdXJlPXBhcnNlRmxvYXQocHJlc3N1cmUpLChpc05hTihwcmVzc3VyZSl8fDA+cHJlc3N1cmV8fHByZXNzdXJlPjEpJiYocHJlc3N1cmU9LjUpO3ZhciBuUHJlc3N1cmU9TWF0aC5yb3VuZCgxMjcqcHJlc3N1cmUpO3JldHVybiB0aGlzLl9jb252ZXJ0Tm90ZVRvQXJyYXkobm90ZSkuZm9yRWFjaChmdW5jdGlvbihpdGVtKXt3bS50b01JRElDaGFubmVscyhjaGFubmVsKS5mb3JFYWNoKGZ1bmN0aW9uKGNoKXt0aGF0LnNlbmQoKHdtLk1JRElfQ0hBTk5FTF9NRVNTQUdFUy5rZXlhZnRlcnRvdWNoPDw0KSsoY2gtMSksW2l0ZW0sblByZXNzdXJlXSx0aGF0Ll9wYXJzZVRpbWVQYXJhbWV0ZXIob3B0aW9ucy50aW1lKSl9KX0pLHRoaXN9LE91dHB1dC5wcm90b3R5cGUuc2VuZENvbnRyb2xDaGFuZ2U9ZnVuY3Rpb24oY29udHJvbGxlcix2YWx1ZSxjaGFubmVsLG9wdGlvbnMpe2lmKG9wdGlvbnM9b3B0aW9uc3x8e30sXCJzdHJpbmdcIj09dHlwZW9mIGNvbnRyb2xsZXIpe2lmKGNvbnRyb2xsZXI9d20uTUlESV9DT05UUk9MX0NIQU5HRV9NRVNTQUdFU1tjb250cm9sbGVyXSwhY29udHJvbGxlcil0aHJvdyBuZXcgVHlwZUVycm9yKFwiSW52YWxpZCBjb250cm9sbGVyIG5hbWUuXCIpfWVsc2UgaWYoY29udHJvbGxlcj1wYXJzZUludChjb250cm9sbGVyKSwhKGNvbnRyb2xsZXI+PTAmJjExOT49Y29udHJvbGxlcikpdGhyb3cgbmV3IFJhbmdlRXJyb3IoXCJDb250cm9sbGVyIG51bWJlcnMgbXVzdCBiZSBiZXR3ZWVuIDAgYW5kIDExOS5cIik7aWYodmFsdWU9cGFyc2VJbnQodmFsdWUpfHwwLCEodmFsdWU+PTAmJjEyNz49dmFsdWUpKXRocm93IG5ldyBSYW5nZUVycm9yKFwiQ29udHJvbGxlciB2YWx1ZSBtdXN0IGJlIGJldHdlZW4gMCBhbmQgMTI3LlwiKTtyZXR1cm4gd20udG9NSURJQ2hhbm5lbHMoY2hhbm5lbCkuZm9yRWFjaChmdW5jdGlvbihjaCl7dGhpcy5zZW5kKCh3bS5NSURJX0NIQU5ORUxfTUVTU0FHRVMuY29udHJvbGNoYW5nZTw8NCkrKGNoLTEpLFtjb250cm9sbGVyLHZhbHVlXSx0aGlzLl9wYXJzZVRpbWVQYXJhbWV0ZXIob3B0aW9ucy50aW1lKSl9LmJpbmQodGhpcykpLHRoaXN9LE91dHB1dC5wcm90b3R5cGUuX3NlbGVjdFJlZ2lzdGVyZWRQYXJhbWV0ZXI9ZnVuY3Rpb24ocGFyYW1ldGVyLGNoYW5uZWwsdGltZSl7dmFyIHRoYXQ9dGhpcztpZihwYXJhbWV0ZXJbMF09cGFyc2VJbnQocGFyYW1ldGVyWzBdKSwhKHBhcmFtZXRlclswXT49MCYmcGFyYW1ldGVyWzBdPD0xMjcpKXRocm93IG5ldyBSYW5nZUVycm9yKFwiVGhlIGNvbnRyb2w2NSB2YWx1ZSBtdXN0IGJlIGJldHdlZW4gMCBhbmQgMTI3XCIpO2lmKHBhcmFtZXRlclsxXT1wYXJzZUludChwYXJhbWV0ZXJbMV0pLCEocGFyYW1ldGVyWzFdPj0wJiZwYXJhbWV0ZXJbMV08PTEyNykpdGhyb3cgbmV3IFJhbmdlRXJyb3IoXCJUaGUgY29udHJvbDY0IHZhbHVlIG11c3QgYmUgYmV0d2VlbiAwIGFuZCAxMjdcIik7cmV0dXJuIHdtLnRvTUlESUNoYW5uZWxzKGNoYW5uZWwpLmZvckVhY2goZnVuY3Rpb24oY2gpe3RoYXQuc2VuZENvbnRyb2xDaGFuZ2UoMTAxLHBhcmFtZXRlclswXSxjaGFubmVsLHt0aW1lOnRpbWV9KSx0aGF0LnNlbmRDb250cm9sQ2hhbmdlKDEwMCxwYXJhbWV0ZXJbMV0sY2hhbm5lbCx7dGltZTp0aW1lfSl9KSx0aGlzfSxPdXRwdXQucHJvdG90eXBlLl9zZWxlY3ROb25SZWdpc3RlcmVkUGFyYW1ldGVyPWZ1bmN0aW9uKHBhcmFtZXRlcixjaGFubmVsLHRpbWUpe3ZhciB0aGF0PXRoaXM7aWYocGFyYW1ldGVyWzBdPXBhcnNlSW50KHBhcmFtZXRlclswXSksIShwYXJhbWV0ZXJbMF0+PTAmJnBhcmFtZXRlclswXTw9MTI3KSl0aHJvdyBuZXcgUmFuZ2VFcnJvcihcIlRoZSBjb250cm9sNjMgdmFsdWUgbXVzdCBiZSBiZXR3ZWVuIDAgYW5kIDEyN1wiKTtpZihwYXJhbWV0ZXJbMV09cGFyc2VJbnQocGFyYW1ldGVyWzFdKSwhKHBhcmFtZXRlclsxXT49MCYmcGFyYW1ldGVyWzFdPD0xMjcpKXRocm93IG5ldyBSYW5nZUVycm9yKFwiVGhlIGNvbnRyb2w2MiB2YWx1ZSBtdXN0IGJlIGJldHdlZW4gMCBhbmQgMTI3XCIpO3JldHVybiB3bS50b01JRElDaGFubmVscyhjaGFubmVsKS5mb3JFYWNoKGZ1bmN0aW9uKGNoKXt0aGF0LnNlbmRDb250cm9sQ2hhbmdlKDk5LHBhcmFtZXRlclswXSxjaGFubmVsLHt0aW1lOnRpbWV9KSx0aGF0LnNlbmRDb250cm9sQ2hhbmdlKDk4LHBhcmFtZXRlclsxXSxjaGFubmVsLHt0aW1lOnRpbWV9KX0pLHRoaXN9LE91dHB1dC5wcm90b3R5cGUuX3NldEN1cnJlbnRSZWdpc3RlcmVkUGFyYW1ldGVyPWZ1bmN0aW9uKGRhdGEsY2hhbm5lbCx0aW1lKXt2YXIgdGhhdD10aGlzO2lmKGRhdGE9W10uY29uY2F0KGRhdGEpLGRhdGFbMF09cGFyc2VJbnQoZGF0YVswXSksIShkYXRhWzBdPj0wJiZkYXRhWzBdPD0xMjcpKXRocm93IG5ldyBSYW5nZUVycm9yKFwiVGhlIG1zYiB2YWx1ZSBtdXN0IGJlIGJldHdlZW4gMCBhbmQgMTI3XCIpO3JldHVybiB3bS50b01JRElDaGFubmVscyhjaGFubmVsKS5mb3JFYWNoKGZ1bmN0aW9uKGNoKXt0aGF0LnNlbmRDb250cm9sQ2hhbmdlKDYsZGF0YVswXSxjaGFubmVsLHt0aW1lOnRpbWV9KX0pLGRhdGFbMV09cGFyc2VJbnQoZGF0YVsxXSksZGF0YVsxXT49MCYmZGF0YVsxXTw9MTI3JiZ3bS50b01JRElDaGFubmVscyhjaGFubmVsKS5mb3JFYWNoKGZ1bmN0aW9uKGNoKXt0aGF0LnNlbmRDb250cm9sQ2hhbmdlKDM4LGRhdGFbMV0sY2hhbm5lbCx7dGltZTp0aW1lfSl9KSx0aGlzfSxPdXRwdXQucHJvdG90eXBlLl9kZXNlbGVjdFJlZ2lzdGVyZWRQYXJhbWV0ZXI9ZnVuY3Rpb24oY2hhbm5lbCx0aW1lKXt2YXIgdGhhdD10aGlzO3JldHVybiB3bS50b01JRElDaGFubmVscyhjaGFubmVsKS5mb3JFYWNoKGZ1bmN0aW9uKGNoKXt0aGF0LnNlbmRDb250cm9sQ2hhbmdlKDEwMSwxMjcsY2hhbm5lbCx7dGltZTp0aW1lfSksdGhhdC5zZW5kQ29udHJvbENoYW5nZSgxMDAsMTI3LGNoYW5uZWwse3RpbWU6dGltZX0pfSksdGhpc30sT3V0cHV0LnByb3RvdHlwZS5zZXRSZWdpc3RlcmVkUGFyYW1ldGVyPWZ1bmN0aW9uKHBhcmFtZXRlcixkYXRhLGNoYW5uZWwsb3B0aW9ucyl7dmFyIHRoYXQ9dGhpcztpZihvcHRpb25zPW9wdGlvbnN8fHt9LCFBcnJheS5pc0FycmF5KHBhcmFtZXRlcikpe2lmKCF3bS5NSURJX1JFR0lTVEVSRURfUEFSQU1FVEVSW3BhcmFtZXRlcl0pdGhyb3cgbmV3IEVycm9yKFwiVGhlIHNwZWNpZmllZCBwYXJhbWV0ZXIgaXMgbm90IGF2YWlsYWJsZS5cIik7cGFyYW1ldGVyPXdtLk1JRElfUkVHSVNURVJFRF9QQVJBTUVURVJbcGFyYW1ldGVyXX1yZXR1cm4gd20udG9NSURJQ2hhbm5lbHMoY2hhbm5lbCkuZm9yRWFjaChmdW5jdGlvbihjaCl7dGhhdC5fc2VsZWN0UmVnaXN0ZXJlZFBhcmFtZXRlcihwYXJhbWV0ZXIsY2hhbm5lbCxvcHRpb25zLnRpbWUpLHRoYXQuX3NldEN1cnJlbnRSZWdpc3RlcmVkUGFyYW1ldGVyKGRhdGEsY2hhbm5lbCxvcHRpb25zLnRpbWUpLHRoYXQuX2Rlc2VsZWN0UmVnaXN0ZXJlZFBhcmFtZXRlcihjaGFubmVsLG9wdGlvbnMudGltZSl9KSx0aGlzfSxPdXRwdXQucHJvdG90eXBlLnNldE5vblJlZ2lzdGVyZWRQYXJhbWV0ZXI9ZnVuY3Rpb24ocGFyYW1ldGVyLGRhdGEsY2hhbm5lbCxvcHRpb25zKXt2YXIgdGhhdD10aGlzO2lmKG9wdGlvbnM9b3B0aW9uc3x8e30sIShwYXJhbWV0ZXJbMF0+PTAmJnBhcmFtZXRlclswXTw9MTI3JiZwYXJhbWV0ZXJbMV0+PTAmJnBhcmFtZXRlclsxXTw9MTI3KSl0aHJvdyBuZXcgRXJyb3IoXCJQb3NpdGlvbiAwIGFuZCAxIG9mIHRoZSAyLXBvc2l0aW9uIHBhcmFtZXRlciBhcnJheSBtdXN0IGJvdGggYmUgYmV0d2VlbiAwIGFuZCAxMjcuXCIpO3JldHVybiBkYXRhPVtdLmNvbmNhdChkYXRhKSx3bS50b01JRElDaGFubmVscyhjaGFubmVsKS5mb3JFYWNoKGZ1bmN0aW9uKGNoKXt0aGF0Ll9zZWxlY3ROb25SZWdpc3RlcmVkUGFyYW1ldGVyKHBhcmFtZXRlcixjaGFubmVsLG9wdGlvbnMudGltZSksdGhhdC5fc2V0Q3VycmVudFJlZ2lzdGVyZWRQYXJhbWV0ZXIoZGF0YSxjaGFubmVsLG9wdGlvbnMudGltZSksdGhhdC5fZGVzZWxlY3RSZWdpc3RlcmVkUGFyYW1ldGVyKGNoYW5uZWwsb3B0aW9ucy50aW1lKX0pLHRoaXN9LE91dHB1dC5wcm90b3R5cGUuaW5jcmVtZW50UmVnaXN0ZXJlZFBhcmFtZXRlcj1mdW5jdGlvbihwYXJhbWV0ZXIsY2hhbm5lbCxvcHRpb25zKXt2YXIgdGhhdD10aGlzO2lmKG9wdGlvbnM9b3B0aW9uc3x8e30sIUFycmF5LmlzQXJyYXkocGFyYW1ldGVyKSl7aWYoIXdtLk1JRElfUkVHSVNURVJFRF9QQVJBTUVURVJbcGFyYW1ldGVyXSl0aHJvdyBuZXcgRXJyb3IoXCJUaGUgc3BlY2lmaWVkIHBhcmFtZXRlciBpcyBub3QgYXZhaWxhYmxlLlwiKTtwYXJhbWV0ZXI9d20uTUlESV9SRUdJU1RFUkVEX1BBUkFNRVRFUltwYXJhbWV0ZXJdfXJldHVybiB3bS50b01JRElDaGFubmVscyhjaGFubmVsKS5mb3JFYWNoKGZ1bmN0aW9uKGNoKXt0aGF0Ll9zZWxlY3RSZWdpc3RlcmVkUGFyYW1ldGVyKHBhcmFtZXRlcixjaGFubmVsLG9wdGlvbnMudGltZSksdGhhdC5zZW5kQ29udHJvbENoYW5nZSg5NiwwLGNoYW5uZWwse3RpbWU6b3B0aW9ucy50aW1lfSksdGhhdC5fZGVzZWxlY3RSZWdpc3RlcmVkUGFyYW1ldGVyKGNoYW5uZWwsb3B0aW9ucy50aW1lKX0pLHRoaXN9LE91dHB1dC5wcm90b3R5cGUuZGVjcmVtZW50UmVnaXN0ZXJlZFBhcmFtZXRlcj1mdW5jdGlvbihwYXJhbWV0ZXIsY2hhbm5lbCxvcHRpb25zKXtpZihvcHRpb25zPW9wdGlvbnN8fHt9LCFBcnJheS5pc0FycmF5KHBhcmFtZXRlcikpe2lmKCF3bS5NSURJX1JFR0lTVEVSRURfUEFSQU1FVEVSW3BhcmFtZXRlcl0pdGhyb3cgbmV3IFR5cGVFcnJvcihcIlRoZSBzcGVjaWZpZWQgcGFyYW1ldGVyIGlzIG5vdCBhdmFpbGFibGUuXCIpO3BhcmFtZXRlcj13bS5NSURJX1JFR0lTVEVSRURfUEFSQU1FVEVSW3BhcmFtZXRlcl19cmV0dXJuIHdtLnRvTUlESUNoYW5uZWxzKGNoYW5uZWwpLmZvckVhY2goZnVuY3Rpb24oY2gpe3RoaXMuX3NlbGVjdFJlZ2lzdGVyZWRQYXJhbWV0ZXIocGFyYW1ldGVyLGNoYW5uZWwsb3B0aW9ucy50aW1lKSx0aGlzLnNlbmRDb250cm9sQ2hhbmdlKDk3LDAsY2hhbm5lbCx7dGltZTpvcHRpb25zLnRpbWV9KSx0aGlzLl9kZXNlbGVjdFJlZ2lzdGVyZWRQYXJhbWV0ZXIoY2hhbm5lbCxvcHRpb25zLnRpbWUpfS5iaW5kKHRoaXMpKSx0aGlzfSxPdXRwdXQucHJvdG90eXBlLnNldFBpdGNoQmVuZFJhbmdlPWZ1bmN0aW9uKHNlbWl0b25lcyxjZW50cyxjaGFubmVsLG9wdGlvbnMpe3ZhciB0aGF0PXRoaXM7aWYob3B0aW9ucz1vcHRpb25zfHx7fSxzZW1pdG9uZXM9cGFyc2VJbnQoc2VtaXRvbmVzKXx8MCwhKHNlbWl0b25lcz49MCYmMTI3Pj1zZW1pdG9uZXMpKXRocm93IG5ldyBSYW5nZUVycm9yKFwiVGhlIHNlbWl0b25lcyB2YWx1ZSBtdXN0IGJlIGJldHdlZW4gMCBhbmQgMTI3XCIpO2lmKGNlbnRzPXBhcnNlSW50KGNlbnRzKXx8MCwhKGNlbnRzPj0wJiYxMjc+PWNlbnRzKSl0aHJvdyBuZXcgUmFuZ2VFcnJvcihcIlRoZSBjZW50cyB2YWx1ZSBtdXN0IGJlIGJldHdlZW4gMCBhbmQgMTI3XCIpO3JldHVybiB3bS50b01JRElDaGFubmVscyhjaGFubmVsKS5mb3JFYWNoKGZ1bmN0aW9uKGNoKXt0aGF0LnNldFJlZ2lzdGVyZWRQYXJhbWV0ZXIoXCJwaXRjaGJlbmRyYW5nZVwiLFtzZW1pdG9uZXMsY2VudHNdLGNoYW5uZWwse3RpbWU6b3B0aW9ucy50aW1lfSl9KSx0aGlzfSxPdXRwdXQucHJvdG90eXBlLnNldE1vZHVsYXRpb25SYW5nZT1mdW5jdGlvbihzZW1pdG9uZXMsY2VudHMsY2hhbm5lbCxvcHRpb25zKXt2YXIgdGhhdD10aGlzO2lmKG9wdGlvbnM9b3B0aW9uc3x8e30sc2VtaXRvbmVzPXBhcnNlSW50KHNlbWl0b25lcyl8fDAsIShzZW1pdG9uZXM+PTAmJjEyNz49c2VtaXRvbmVzKSl0aHJvdyBuZXcgUmFuZ2VFcnJvcihcIlRoZSBzZW1pdG9uZXMgdmFsdWUgbXVzdCBiZSBiZXR3ZWVuIDAgYW5kIDEyN1wiKTtpZihjZW50cz1wYXJzZUludChjZW50cyl8fDAsIShjZW50cz49MCYmMTI3Pj1jZW50cykpdGhyb3cgbmV3IFJhbmdlRXJyb3IoXCJUaGUgY2VudHMgdmFsdWUgbXVzdCBiZSBiZXR3ZWVuIDAgYW5kIDEyN1wiKTtyZXR1cm4gd20udG9NSURJQ2hhbm5lbHMoY2hhbm5lbCkuZm9yRWFjaChmdW5jdGlvbihjaCl7dGhhdC5zZXRSZWdpc3RlcmVkUGFyYW1ldGVyKFwibW9kdWxhdGlvbnJhbmdlXCIsW3NlbWl0b25lcyxjZW50c10sY2hhbm5lbCx7dGltZTpvcHRpb25zLnRpbWV9KX0pLHRoaXN9LE91dHB1dC5wcm90b3R5cGUuc2V0TWFzdGVyVHVuaW5nPWZ1bmN0aW9uKHZhbHVlLGNoYW5uZWwsb3B0aW9ucyl7dmFyIHRoYXQ9dGhpcztpZihvcHRpb25zPW9wdGlvbnN8fHt9LHZhbHVlPXBhcnNlRmxvYXQodmFsdWUpfHwwLC02NT49dmFsdWV8fHZhbHVlPj02NCl0aHJvdyBuZXcgUmFuZ2VFcnJvcihcIlRoZSB2YWx1ZSBtdXN0IGJlIGEgZGVjaW1hbCBudW1iZXIgbGFyZ2VyIHRoYW4gLTY1IGFuZCBzbWFsbGVyIHRoYW4gNjQuXCIpO3ZhciBjb2Fyc2U9cGFyc2VJbnQodmFsdWUpKzY0LGZpbmU9dmFsdWUtcGFyc2VJbnQodmFsdWUpO2ZpbmU9TWF0aC5yb3VuZCgoZmluZSsxKS8yKjE2MzgzKTt2YXIgbXNiPWZpbmU+PjcmMTI3LGxzYj0xMjcmZmluZTtyZXR1cm4gd20udG9NSURJQ2hhbm5lbHMoY2hhbm5lbCkuZm9yRWFjaChmdW5jdGlvbihjaCl7dGhhdC5zZXRSZWdpc3RlcmVkUGFyYW1ldGVyKFwiY2hhbm5lbGNvYXJzZXR1bmluZ1wiLGNvYXJzZSxjaGFubmVsLHt0aW1lOm9wdGlvbnMudGltZX0pLHRoYXQuc2V0UmVnaXN0ZXJlZFBhcmFtZXRlcihcImNoYW5uZWxmaW5ldHVuaW5nXCIsW21zYixsc2JdLGNoYW5uZWwse3RpbWU6b3B0aW9ucy50aW1lfSl9KSx0aGlzfSxPdXRwdXQucHJvdG90eXBlLnNldFR1bmluZ1Byb2dyYW09ZnVuY3Rpb24odmFsdWUsY2hhbm5lbCxvcHRpb25zKXt2YXIgdGhhdD10aGlzO2lmKG9wdGlvbnM9b3B0aW9uc3x8e30sdmFsdWU9cGFyc2VJbnQodmFsdWUpLCEodmFsdWU+PTAmJjEyNz49dmFsdWUpKXRocm93IG5ldyBSYW5nZUVycm9yKFwiVGhlIHByb2dyYW0gdmFsdWUgbXVzdCBiZSBiZXR3ZWVuIDAgYW5kIDEyN1wiKTtyZXR1cm4gd20udG9NSURJQ2hhbm5lbHMoY2hhbm5lbCkuZm9yRWFjaChmdW5jdGlvbihjaCl7dGhhdC5zZXRSZWdpc3RlcmVkUGFyYW1ldGVyKFwidHVuaW5ncHJvZ3JhbVwiLHZhbHVlLGNoYW5uZWwse3RpbWU6b3B0aW9ucy50aW1lfSl9KSx0aGlzfSxPdXRwdXQucHJvdG90eXBlLnNldFR1bmluZ0Jhbms9ZnVuY3Rpb24odmFsdWUsY2hhbm5lbCxvcHRpb25zKXt2YXIgdGhhdD10aGlzO2lmKG9wdGlvbnM9b3B0aW9uc3x8e30sdmFsdWU9cGFyc2VJbnQodmFsdWUpfHwwLCEodmFsdWU+PTAmJjEyNz49dmFsdWUpKXRocm93IG5ldyBSYW5nZUVycm9yKFwiVGhlIGJhbmsgdmFsdWUgbXVzdCBiZSBiZXR3ZWVuIDAgYW5kIDEyN1wiKTtyZXR1cm4gd20udG9NSURJQ2hhbm5lbHMoY2hhbm5lbCkuZm9yRWFjaChmdW5jdGlvbihjaCl7dGhhdC5zZXRSZWdpc3RlcmVkUGFyYW1ldGVyKFwidHVuaW5nYmFua1wiLHZhbHVlLGNoYW5uZWwse3RpbWU6b3B0aW9ucy50aW1lfSl9KSx0aGlzfSxPdXRwdXQucHJvdG90eXBlLnNlbmRDaGFubmVsTW9kZT1mdW5jdGlvbihjb21tYW5kLHZhbHVlLGNoYW5uZWwsb3B0aW9ucyl7aWYob3B0aW9ucz1vcHRpb25zfHx7fSxcInN0cmluZ1wiPT10eXBlb2YgY29tbWFuZCl7aWYoY29tbWFuZD13bS5NSURJX0NIQU5ORUxfTU9ERV9NRVNTQUdFU1tjb21tYW5kXSwhY29tbWFuZCl0aHJvdyBuZXcgVHlwZUVycm9yKFwiSW52YWxpZCBjaGFubmVsIG1vZGUgbWVzc2FnZSBuYW1lLlwiKX1lbHNlIGlmKGNvbW1hbmQ9cGFyc2VJbnQoY29tbWFuZCksIShjb21tYW5kPj0xMjAmJjEyNz49Y29tbWFuZCkpdGhyb3cgbmV3IFJhbmdlRXJyb3IoXCJDaGFubmVsIG1vZGUgbnVtZXJpY2FsIGlkZW50aWZpZXJzIG11c3QgYmUgYmV0d2VlbiAxMjAgYW5kIDEyNy5cIik7aWYodmFsdWU9cGFyc2VJbnQodmFsdWUpfHwwLDA+dmFsdWV8fHZhbHVlPjEyNyl0aHJvdyBuZXcgUmFuZ2VFcnJvcihcIlZhbHVlIG11c3QgYmUgYW4gaW50ZWdlciBiZXR3ZWVuIDAgYW5kIDEyNy5cIik7cmV0dXJuIHdtLnRvTUlESUNoYW5uZWxzKGNoYW5uZWwpLmZvckVhY2goZnVuY3Rpb24oY2gpe3RoaXMuc2VuZCgod20uTUlESV9DSEFOTkVMX01FU1NBR0VTLmNoYW5uZWxtb2RlPDw0KSsoY2gtMSksW2NvbW1hbmQsdmFsdWVdLHRoaXMuX3BhcnNlVGltZVBhcmFtZXRlcihvcHRpb25zLnRpbWUpKX0uYmluZCh0aGlzKSksdGhpc30sT3V0cHV0LnByb3RvdHlwZS5zZW5kUHJvZ3JhbUNoYW5nZT1mdW5jdGlvbihwcm9ncmFtLGNoYW5uZWwsb3B0aW9ucyl7dmFyIHRoYXQ9dGhpcztpZihvcHRpb25zPW9wdGlvbnN8fHt9LHByb2dyYW09cGFyc2VJbnQocHJvZ3JhbSksXG5pc05hTihwcm9ncmFtKXx8MD5wcm9ncmFtfHxwcm9ncmFtPjEyNyl0aHJvdyBuZXcgUmFuZ2VFcnJvcihcIlByb2dyYW0gbnVtYmVycyBtdXN0IGJlIGJldHdlZW4gMCBhbmQgMTI3LlwiKTtyZXR1cm4gd20udG9NSURJQ2hhbm5lbHMoY2hhbm5lbCkuZm9yRWFjaChmdW5jdGlvbihjaCl7dGhhdC5zZW5kKCh3bS5NSURJX0NIQU5ORUxfTUVTU0FHRVMucHJvZ3JhbWNoYW5nZTw8NCkrKGNoLTEpLFtwcm9ncmFtXSx0aGF0Ll9wYXJzZVRpbWVQYXJhbWV0ZXIob3B0aW9ucy50aW1lKSl9KSx0aGlzfSxPdXRwdXQucHJvdG90eXBlLnNlbmRDaGFubmVsQWZ0ZXJ0b3VjaD1mdW5jdGlvbihwcmVzc3VyZSxjaGFubmVsLG9wdGlvbnMpe3ZhciB0aGF0PXRoaXM7b3B0aW9ucz1vcHRpb25zfHx7fSxwcmVzc3VyZT1wYXJzZUZsb2F0KHByZXNzdXJlKSwoaXNOYU4ocHJlc3N1cmUpfHwwPnByZXNzdXJlfHxwcmVzc3VyZT4xKSYmKHByZXNzdXJlPS41KTt2YXIgblByZXNzdXJlPU1hdGgucm91bmQoMTI3KnByZXNzdXJlKTtyZXR1cm4gd20udG9NSURJQ2hhbm5lbHMoY2hhbm5lbCkuZm9yRWFjaChmdW5jdGlvbihjaCl7dGhhdC5zZW5kKCh3bS5NSURJX0NIQU5ORUxfTUVTU0FHRVMuY2hhbm5lbGFmdGVydG91Y2g8PDQpKyhjaC0xKSxbblByZXNzdXJlXSx0aGF0Ll9wYXJzZVRpbWVQYXJhbWV0ZXIob3B0aW9ucy50aW1lKSl9KSx0aGlzfSxPdXRwdXQucHJvdG90eXBlLnNlbmRQaXRjaEJlbmQ9ZnVuY3Rpb24oYmVuZCxjaGFubmVsLG9wdGlvbnMpe3ZhciB0aGF0PXRoaXM7aWYob3B0aW9ucz1vcHRpb25zfHx7fSxiZW5kPXBhcnNlRmxvYXQoYmVuZCksaXNOYU4oYmVuZCl8fC0xPmJlbmR8fGJlbmQ+MSl0aHJvdyBuZXcgUmFuZ2VFcnJvcihcIlBpdGNoIGJlbmQgdmFsdWUgbXVzdCBiZSBiZXR3ZWVuIC0xIGFuZCAxLlwiKTt2YXIgbkxldmVsPU1hdGgucm91bmQoKGJlbmQrMSkvMioxNjM4MyksbXNiPW5MZXZlbD4+NyYxMjcsbHNiPTEyNyZuTGV2ZWw7cmV0dXJuIHdtLnRvTUlESUNoYW5uZWxzKGNoYW5uZWwpLmZvckVhY2goZnVuY3Rpb24oY2gpe3RoYXQuc2VuZCgod20uTUlESV9DSEFOTkVMX01FU1NBR0VTLnBpdGNoYmVuZDw8NCkrKGNoLTEpLFtsc2IsbXNiXSx0aGF0Ll9wYXJzZVRpbWVQYXJhbWV0ZXIob3B0aW9ucy50aW1lKSl9KSx0aGlzfSxPdXRwdXQucHJvdG90eXBlLl9wYXJzZVRpbWVQYXJhbWV0ZXI9ZnVuY3Rpb24odGltZSl7dmFyIHBhcnNlZCx2YWx1ZTtyZXR1cm5cInN0cmluZ1wiPT10eXBlb2YgdGltZSYmXCIrXCI9PT10aW1lLnN1YnN0cmluZygwLDEpPyhwYXJzZWQ9cGFyc2VGbG9hdCh0aW1lKSxwYXJzZWQmJnBhcnNlZD4wJiYodmFsdWU9d20udGltZStwYXJzZWQpKToocGFyc2VkPXBhcnNlRmxvYXQodGltZSkscGFyc2VkPndtLnRpbWUmJih2YWx1ZT1wYXJzZWQpKSx2YWx1ZX0sT3V0cHV0LnByb3RvdHlwZS5fY29udmVydE5vdGVUb0FycmF5PWZ1bmN0aW9uKG5vdGUpe3ZhciBub3Rlcz1bXTtyZXR1cm4gQXJyYXkuaXNBcnJheShub3RlKXx8KG5vdGU9W25vdGVdKSxub3RlLmZvckVhY2goZnVuY3Rpb24oaXRlbSl7bm90ZXMucHVzaCh3bS5ndWVzc05vdGVOdW1iZXIoaXRlbSkpfSksbm90ZXN9LE91dHB1dC5wcm90b3R5cGUuX29uTWlkaU1lc3NhZ2U9ZnVuY3Rpb24oZSl7fSxcImZ1bmN0aW9uXCI9PXR5cGVvZiBkZWZpbmUmJlwib2JqZWN0XCI9PXR5cGVvZiBkZWZpbmUuYW1kP2RlZmluZShbXSxmdW5jdGlvbigpe3JldHVybiB3bX0pOlwidW5kZWZpbmVkXCIhPXR5cGVvZiBtb2R1bGUmJm1vZHVsZS5leHBvcnRzP21vZHVsZS5leHBvcnRzPXdtOnNjb3BlLldlYk1pZGl8fChzY29wZS5XZWJNaWRpPXdtKX0odGhpcyk7Il19
