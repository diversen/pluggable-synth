(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
const noteParser = require('note-parser')
const octave1 = require('./keyboard-tones.js').octave1;
const jsCssPiano = require('js-css-piano');
const webmidi = require('webmidi')

var keys = {};

jsCssPiano.prototype = {

    getFrequency: function (note) {
        note = note.replace('s', '#');
        let res = noteParser.parse(note)
        let freq = res.freq;
        return freq;
    },

    synth: function () {
        console.log('set a synth')
    },

    toggleKey: function (note) {
        let selector = '#' + this.elemID + " > .piano li[data-note='" + note + "']"
        let elem = document.querySelector(selector)
        if (!elem) {
            return
        }
        elem.classList.toggle('active');
    },

    synthStart: function (note, options) {
        note = note.toLowerCase()
        this.toggleKey(note)
        let freq = this.getFrequency(note);
        let synth = new this.synth();

        synth.start(freq, options);
        keys[note] = synth;
    },

    synthStop: function (note) {
        note = note.toLowerCase()
        this.toggleKey(note)
        let synth = keys[note]
        synth.stop()
        delete keys[note]
    },

    // Enable one or two octaves on keyboard
    enableKeyboardEvents: function () {
        document.addEventListener("keydown", (e) => {

            var k = e.key;
            let note = octave1[k] + this.options.octaveBegin

            if (k in octave1 && !(note in keys)) {
                this.synthStart(note);
            }
        });

        document.addEventListener("keyup", (e) => {

            let octave = this.options.octaveBegin
            var k = e.key;
            let note = octave1[k] + octave;
            if (k in octave1 && (note in keys)) {
                this.synthStop(note)
            }
        });
    },

    // Enable midi keyboard
    enableMidiEvents: function (port) {
        if (port === 'undefined') {
            port = 1
        }

        webmidi.enable( (err) => {

            if (err) {
                console.log("WebMidi could not be enabled." + err);
                return false;
            }

            if ( !(port in webmidi.inputs)) {
               console.log('Modi port does not exists ' + port)
               return false;
            }

            // Port is ok
            var midiInput = webmidi.inputs[port];
            midiInput.addListener('noteon', "all", (e) => {

                let octave = parseInt(e.note.octave)
                let note = e.note.name + octave
                note = note.replace('#', 's')

                if (!(note in keys)) {
                    this.synthStart(note, e);
                }
            });

            midiInput.addListener('noteoff', "all", (e) => {
                let octave = parseInt(e.note.octave);
                let note = e.note.name + octave;

                note = note.replace('#', 's')

                this.synthStop(note)

            });
        })
    },
}

module.exports = jsCssPiano;

},{"./keyboard-tones.js":2,"js-css-piano":3,"note-parser":4,"webmidi":5}],2:[function(require,module,exports){
var keyboardTones = {}

keyboardTones.octave1 = {
    a: 'c',
    w: 'cs',
    s: 'd',
    e: 'ds',
    d: 'e',
    f: 'f',
    t: 'fs',
    g: 'g',
    y: 'gs',
    h: 'a',
    u: 'as',
    j: 'b'
};


keyboardTones.octave2 = {
    q: 'c',
    2: 'cs',
    w: 'd',
    3: 'ds',
    e: 'e',
    r: 'f',
    5: 'fs',
    t: 'g',
    6: 'gs',
    y: 'a',
    7: 'as',
    u: 'b'
};

module.exports = keyboardTones;
},{}],3:[function(require,module,exports){
function piano(elemID, opts) {

    this.elemID = elemID
    this.elem = document.getElementById(elemID)
    
    this.defaults = {
        octaves: 2,
        octaveBegin: 3
    }

    this.options = {}
    Object.assign(this.options, this.defaults, opts)
    
    this.createPiano = function () {
        let html = this.getPianoHTML()
        this.elem.innerHTML = html
    }

    this.getPianoHTML = function () {
        
        let octaveBegin = this.options.octaveBegin
        let html = `<ul class="piano">`
        for (i = 1; i <= this.options.octaves; i++) {  
            html += this.getTones(octaveBegin)
            octaveBegin++ 
        }
        html += `</ul>`
        return html
    }

    this.getNoteAndOctave = function (note, octave) {
        return note + octave
    }

    this.getTones = function (octave) {
        let octaveHTML = 
        `
            <li class="white c" data-note="${this.getNoteAndOctave('c', octave)}"></li>
            <li class="black cs" data-note="${this.getNoteAndOctave('cs', octave)}"></li>
            <li class="white d" data-note="${this.getNoteAndOctave('d', octave)}"></li>
            <li class="black ds" data-note="${this.getNoteAndOctave('ds', octave)}"></li>
            <li class="white e" data-note="${this.getNoteAndOctave('e', octave)}"></li>
            <li class="white f" data-note="${this.getNoteAndOctave('f', octave)}"></li>
            <li class="black fs" data-note="${this.getNoteAndOctave('fs', octave)}"></li>
            <li class="white g" data-note="${this.getNoteAndOctave('g', octave)}"></li>
            <li class="black gs" data-note="${this.getNoteAndOctave('gs', octave)}"></li>
            <li class="white a" data-note="${this.getNoteAndOctave('a', octave)}"></li>
            <li class="black as" data-note="${this.getNoteAndOctave('as', octave)}"></li>
            <li class="white b" data-note="${this.getNoteAndOctave('b', octave)}"></li>`
            
        return octaveHTML
    }
}

module.exports = piano;

},{}],4:[function(require,module,exports){
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n(t.NoteParser=t.NoteParser||{})}(this,function(t){"use strict";function n(t,n){return Array(n+1).join(t)}function r(t){return"number"==typeof t}function e(t){return"string"==typeof t}function u(t){return void 0!==t}function c(t,n){return Math.pow(2,(t-69)/12)*(n||440)}function o(){return b}function i(t,n,r){if("string"!=typeof t)return null;var e=b.exec(t);if(!e||!n&&e[4])return null;var u={letter:e[1].toUpperCase(),acc:e[2].replace(/x/g,"##")};u.pc=u.letter+u.acc,u.step=(u.letter.charCodeAt(0)+3)%7,u.alt="b"===u.acc[0]?-u.acc.length:u.acc.length;var o=A[u.step]+u.alt;return u.chroma=o<0?12+o:o%12,e[3]&&(u.oct=+e[3],u.midi=o+12*(u.oct+1),u.freq=c(u.midi,r)),n&&(u.tonicOf=e[4]),u}function f(t){return r(t)?t<0?n("b",-t):n("#",t):""}function a(t){return r(t)?""+t:""}function l(t,n,r){return null===t||void 0===t?null:t.step?l(t.step,t.alt,t.oct):t<0||t>6?null:C.charAt(t)+f(n)+a(r)}function p(t){if((r(t)||e(t))&&t>=0&&t<128)return+t;var n=i(t);return n&&u(n.midi)?n.midi:null}function s(t,n){var r=p(t);return null===r?null:c(r,n)}function d(t){return(i(t)||{}).letter}function m(t){return(i(t)||{}).acc}function h(t){return(i(t)||{}).pc}function v(t){return(i(t)||{}).step}function g(t){return(i(t)||{}).alt}function x(t){return(i(t)||{}).chroma}function y(t){return(i(t)||{}).oct}var b=/^([a-gA-G])(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)\s*$/,A=[0,2,4,5,7,9,11],C="CDEFGAB";t.regex=o,t.parse=i,t.build=l,t.midi=p,t.freq=s,t.letter=d,t.acc=m,t.pc=h,t.step=v,t.alt=g,t.chroma=x,t.oct=y});


},{}],5:[function(require,module,exports){
/*

WebMidi v2.0.0-rc.9

WebMidi.js helps you tame the Web MIDI API. Send and receive MIDI messages with ease. Control instruments with user-friendly functions (playNote, sendPitchBend, etc.). React to MIDI input with simple event listeners (noteon, pitchbend, controlchange, etc.).
https://github.com/cotejp/webmidi


The MIT License (MIT)

Copyright (c) 2015-2016, Jean-Philippe Côté

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and
associated documentation files (the "Software"), to deal in the Software without restriction,
including without limitation the rights to use, copy, modify, merge, publish, distribute,
sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial
portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT
NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES
OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

*/

!function(scope){"use strict";function WebMidi(){if(WebMidi.prototype._singleton)throw new Error("WebMidi is a singleton, it cannot be instantiated directly.");WebMidi.prototype._singleton=this,this._inputs=[],this._outputs=[],this._userHandlers={},this._stateChangeQueue=[],this._processingStateChange=!1,this._midiInterfaceEvents=["connected","disconnected"],this._notes=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],this._semitones={C:0,D:2,E:4,F:5,G:7,A:9,B:11},Object.defineProperties(this,{MIDI_SYSTEM_MESSAGES:{value:{sysex:240,timecode:241,songposition:242,songselect:243,tuningrequest:246,sysexend:247,clock:248,start:250,"continue":251,stop:252,activesensing:254,reset:255,unknownsystemmessage:-1},writable:!1,enumerable:!0,configurable:!1},MIDI_CHANNEL_MESSAGES:{value:{noteoff:8,noteon:9,keyaftertouch:10,controlchange:11,channelmode:11,programchange:12,channelaftertouch:13,pitchbend:14},writable:!1,enumerable:!0,configurable:!1},MIDI_REGISTERED_PARAMETER:{value:{pitchbendrange:[0,0],channelfinetuning:[0,1],channelcoarsetuning:[0,2],tuningprogram:[0,3],tuningbank:[0,4],modulationrange:[0,5],azimuthangle:[61,0],elevationangle:[61,1],gain:[61,2],distanceratio:[61,3],maximumdistance:[61,4],maximumdistancegain:[61,5],referencedistanceratio:[61,6],panspreadangle:[61,7],rollangle:[61,8]},writable:!1,enumerable:!0,configurable:!1},MIDI_CONTROL_CHANGE_MESSAGES:{value:{bankselectcoarse:0,modulationwheelcoarse:1,breathcontrollercoarse:2,footcontrollercoarse:4,portamentotimecoarse:5,dataentrycoarse:6,volumecoarse:7,balancecoarse:8,pancoarse:10,expressioncoarse:11,effectcontrol1coarse:12,effectcontrol2coarse:13,generalpurposeslider1:16,generalpurposeslider2:17,generalpurposeslider3:18,generalpurposeslider4:19,bankselectfine:32,modulationwheelfine:33,breathcontrollerfine:34,footcontrollerfine:36,portamentotimefine:37,dataentryfine:38,volumefine:39,balancefine:40,panfine:42,expressionfine:43,effectcontrol1fine:44,effectcontrol2fine:45,holdpedal:64,portamento:65,sustenutopedal:66,softpedal:67,legatopedal:68,hold2pedal:69,soundvariation:70,resonance:71,soundreleasetime:72,soundattacktime:73,brightness:74,soundcontrol6:75,soundcontrol7:76,soundcontrol8:77,soundcontrol9:78,soundcontrol10:79,generalpurposebutton1:80,generalpurposebutton2:81,generalpurposebutton3:82,generalpurposebutton4:83,reverblevel:91,tremololevel:92,choruslevel:93,celestelevel:94,phaserlevel:95,databuttonincrement:96,databuttondecrement:97,nonregisteredparametercoarse:98,nonregisteredparameterfine:99,registeredparametercoarse:100,registeredparameterfine:101},writable:!1,enumerable:!0,configurable:!1},MIDI_CHANNEL_MODE_MESSAGES:{value:{allsoundoff:120,resetallcontrollers:121,localcontrol:122,allnotesoff:123,omnimodeoff:124,omnimodeon:125,monomodeon:126,polymodeon:127},writable:!1,enumerable:!0,configurable:!1}}),Object.defineProperties(this,{supported:{enumerable:!0,get:function(){return"requestMIDIAccess"in navigator}},enabled:{enumerable:!0,get:function(){return void 0!==this["interface"]}.bind(this)},inputs:{enumerable:!0,get:function(){return this._inputs}.bind(this)},outputs:{enumerable:!0,get:function(){return this._outputs}.bind(this)},sysexEnabled:{enumerable:!0,get:function(){return!(!this["interface"]||!this["interface"].sysexEnabled)}.bind(this)},time:{enumerable:!0,get:function(){return performance.now()}}})}function Input(midiInput){var that=this;this._userHandlers={channel:{},system:{}},this._midiInput=midiInput,Object.defineProperties(this,{connection:{enumerable:!0,get:function(){return that._midiInput.connection}},id:{enumerable:!0,get:function(){return that._midiInput.id}},manufacturer:{enumerable:!0,get:function(){return that._midiInput.manufacturer}},name:{enumerable:!0,get:function(){return that._midiInput.name}},state:{enumerable:!0,get:function(){return that._midiInput.state}}}),this._initializeUserHandlers()}function Output(midiOutput){var that=this;this._midiOutput=midiOutput,Object.defineProperties(this,{connection:{enumerable:!0,get:function(){return that._midiOutput.connection}},id:{enumerable:!0,get:function(){return that._midiOutput.id}},manufacturer:{enumerable:!0,get:function(){return that._midiOutput.manufacturer}},name:{enumerable:!0,get:function(){return that._midiOutput.name}},state:{enumerable:!0,get:function(){return that._midiOutput.state}}})}var wm=new WebMidi;WebMidi.prototype.enable=function(callback,sysex){return this.enabled?void 0:this.supported?void navigator.requestMIDIAccess({sysex:sysex}).then(function(midiAccess){this["interface"]=midiAccess,this._resetInterfaceUserHandlers(),this["interface"].onstatechange=this._onInterfaceStateChange.bind(this),this._onInterfaceStateChange(null),"function"==typeof callback&&callback.call(this)}.bind(this),function(err){"function"==typeof callback&&callback.call(this,err)}.bind(this)):void("function"==typeof callback&&callback(new Error("The Web MIDI API is not supported by your browser.")))},WebMidi.prototype.disable=function(){if(!this.supported)throw new Error("The Web MIDI API is not supported by your browser.");this["interface"].onstatechange=void 0,this["interface"]=void 0,this._inputs=[],this._outputs=[],this._resetInterfaceUserHandlers()},WebMidi.prototype.addListener=function(type,listener){if(!this.enabled)throw new Error("WebMidi must be enabled before adding event listeners.");if("function"!=typeof listener)throw new TypeError("The 'listener' parameter must be a function.");if(!(this._midiInterfaceEvents.indexOf(type)>=0))throw new TypeError("The specified event type is not supported.");return this._userHandlers[type].push(listener),this},WebMidi.prototype.hasListener=function(type,listener){if(!this.enabled)throw new Error("WebMidi must be enabled before checking event listeners.");if("function"!=typeof listener)throw new TypeError("The 'listener' parameter must be a function.");if(!(this._midiInterfaceEvents.indexOf(type)>=0))throw new TypeError("The specified event type is not supported.");for(var o=0;o<this._userHandlers[type].length;o++)if(this._userHandlers[type][o]===listener)return!0;return!1},WebMidi.prototype.removeListener=function(type,listener){if(!this.enabled)throw new Error("WebMidi must be enabled before removing event listeners.");if(void 0!==listener&&"function"!=typeof listener)throw new TypeError("The 'listener' parameter must be a function.");if(this._midiInterfaceEvents.indexOf(type)>=0)if(listener)for(var o=0;o<this._userHandlers[type].length;o++)this._userHandlers[type][o]===listener&&this._userHandlers[type].splice(o,1);else this._userHandlers[type]=[];else{if(void 0!==type)throw new TypeError("The specified event type is not supported.");this._resetInterfaceUserHandlers()}return this},WebMidi.prototype.getInputById=function(id){if(!this.enabled)throw new Error("WebMidi is not enabled.");for(var i=0;i<this.inputs.length;i++)if(this.inputs[i].id===id)return this.inputs[i];return!1},WebMidi.prototype.getOutputById=function(id){if(!this.enabled)throw new Error("WebMidi is not enabled.");for(var i=0;i<this.outputs.length;i++)if(this.outputs[i].id===id)return this.outputs[i];return!1},WebMidi.prototype.getInputByName=function(name){if(!this.enabled)throw new Error("WebMidi is not enabled.");for(var i=0;i<this.inputs.length;i++)if(~this.inputs[i].name.indexOf(name))return this.inputs[i];return!1},WebMidi.prototype.getOctave=function(number){return number>=0&&127>=number?Math.floor(parseInt(number)/12-1)-1:void 0},WebMidi.prototype.getOutputByName=function(name){if(!this.enabled)throw new Error("WebMidi is not enabled.");for(var i=0;i<this.outputs.length;i++)if(~this.outputs[i].name.indexOf(name))return this.outputs[i];return!1},WebMidi.prototype.guessNoteNumber=function(input){var output=!1;if(input&&input.toFixed&&input>=0&&127>=input?output=Math.round(input):parseInt(input)>=0&&parseInt(input)<=127?output=parseInt(input):("string"==typeof input||input instanceof String)&&(output=this.noteNameToNumber(input)),output===!1)throw new Error("Invalid note number ("+input+").");return output},WebMidi.prototype.noteNameToNumber=function(name){"string"!=typeof name&&(name="");var matches=name.match(/([CDEFGAB])(#{0,2}|b{0,2})(-?\d+)/i);if(!matches)throw new RangeError("Invalid note name.");var semitones=wm._semitones[matches[1].toUpperCase()],octave=parseInt(matches[3]),result=12*(octave+2)+semitones;if(matches[2].toLowerCase().indexOf("b")>-1?result-=matches[2].length:matches[2].toLowerCase().indexOf("#")>-1&&(result+=matches[2].length),0>semitones||-2>octave||octave>8||0>result||result>127)throw new RangeError("Invalid note name or note outside valid range.");return result},WebMidi.prototype._updateInputsAndOutputs=function(){this._updateInputs(),this._updateOutputs()},WebMidi.prototype._updateInputs=function(){for(var i=0;i<this._inputs.length;i++){for(var remove=!0,updated=this["interface"].inputs.values(),input=updated.next();input&&!input.done;input=updated.next())if(this._inputs[i]._midiInput===input.value){remove=!1;break}remove&&this._inputs.splice(i,1)}this["interface"].inputs.forEach(function(nInput){for(var add=!0,j=0;j<this._inputs.length;j++)this._inputs[j]._midiInput===nInput&&(add=!1);add&&this._inputs.push(this._createInput(nInput))}.bind(this))},WebMidi.prototype._updateOutputs=function(){for(var i=0;i<this._outputs.length;i++){for(var remove=!0,updated=this["interface"].outputs.values(),output=updated.next();output&&!output.done;output=updated.next())if(this._outputs[i]._midiOutput===output.value){remove=!1;break}remove&&this._outputs.splice(i,1)}this["interface"].outputs.forEach(function(nOutput){for(var add=!0,j=0;j<this._outputs.length;j++)this._outputs[j]._midiOutput===nOutput&&(add=!1);add&&this._outputs.push(this._createOutput(nOutput))}.bind(this))},WebMidi.prototype._createInput=function(midiInput){var input=new Input(midiInput);return input._midiInput.onmidimessage=input._onMidiMessage.bind(input),input},WebMidi.prototype._createOutput=function(midiOutput){var output=new Output(midiOutput);return output._midiOutput.onmidimessage=output._onMidiMessage.bind(output),output},WebMidi.prototype._onInterfaceStateChange=function(e){if(this._stateChangeQueue.push(e),!this._processingStateChange){for(this._processingStateChange=!0;this._stateChangeQueue.length>0;)this._processStateChange(this._stateChangeQueue.shift());this._processingStateChange=!1}},WebMidi.prototype._processStateChange=function(e){if(this._updateInputsAndOutputs(),null!==e){var event={timestamp:e.timeStamp,type:e.port.state,id:e.port.id,manufacturer:e.port.manufacturer,name:e.port.name};"connected"===e.port.state&&("output"===e.port.type?event.output=this.getOutputById(e.port.id):"input"===e.port.type&&(event.input=this.getInputById(e.port.id))),this._userHandlers[e.port.state].forEach(function(handler){handler(event)})}},WebMidi.prototype._resetInterfaceUserHandlers=function(){for(var i=0;i<this._midiInterfaceEvents.length;i++)this._userHandlers[this._midiInterfaceEvents[i]]=[]},Input.prototype.addListener=function(type,channel,listener){var that=this;if(void 0===channel&&(channel="all"),Array.isArray(channel)||(channel=[channel]),channel.forEach(function(item){if("all"!==item&&!(item>=1&&16>=item))throw new RangeError("The 'channel' parameter is invalid.")}),"function"!=typeof listener)throw new TypeError("The 'listener' parameter must be a function.");if(wm.MIDI_SYSTEM_MESSAGES[type])this._userHandlers.system[type]||(this._userHandlers.system[type]=[]),this._userHandlers.system[type].push(listener);else{if(!wm.MIDI_CHANNEL_MESSAGES[type])throw new TypeError("The specified event type is not supported.");if(channel.indexOf("all")>-1){channel=[];for(var j=1;16>=j;j++)channel.push(j)}this._userHandlers.channel[type]||(this._userHandlers.channel[type]=[]),channel.forEach(function(ch){that._userHandlers.channel[type][ch]||(that._userHandlers.channel[type][ch]=[]),that._userHandlers.channel[type][ch].push(listener)})}return this},Input.prototype.on=Input.prototype.addListener,Input.prototype.hasListener=function(type,channel,listener){var that=this;if("function"!=typeof listener)throw new TypeError("The 'listener' parameter must be a function.");if(void 0===channel&&(channel="all"),channel.constructor!==Array&&(channel=[channel]),wm.MIDI_SYSTEM_MESSAGES[type]){for(var o=0;o<this._userHandlers.system[type].length;o++)if(this._userHandlers.system[type][o]===listener)return!0}else if(wm.MIDI_CHANNEL_MESSAGES[type]){if(channel.indexOf("all")>-1){channel=[];for(var j=1;16>=j;j++)channel.push(j)}return this._userHandlers.channel[type]?channel.every(function(chNum){var listeners=that._userHandlers.channel[type][chNum];return listeners&&listeners.indexOf(listener)>-1}):!1}return!1},Input.prototype.removeListener=function(type,channel,listener){var that=this;if(void 0!==listener&&"function"!=typeof listener)throw new TypeError("The 'listener' parameter must be a function.");if(void 0===channel&&(channel="all"),channel.constructor!==Array&&(channel=[channel]),wm.MIDI_SYSTEM_MESSAGES[type])if(void 0===listener)this._userHandlers.system[type]=[];else for(var o=0;o<this._userHandlers.system[type].length;o++)this._userHandlers.system[type][o]===listener&&this._userHandlers.system[type].splice(o,1);else if(wm.MIDI_CHANNEL_MESSAGES[type]){if(channel.indexOf("all")>-1){channel=[];for(var j=1;16>=j;j++)channel.push(j)}if(!this._userHandlers.channel[type])return this;channel.forEach(function(chNum){var listeners=that._userHandlers.channel[type][chNum];if(listeners)if(void 0===listener)that._userHandlers.channel[type][chNum]=[];else for(var l=0;l<listeners.length;l++)listeners[l]===listener&&listeners.splice(l,1)})}else{if(void 0!==type)throw new TypeError("The specified event type is not supported.");this._initializeUserHandlers()}return this},Input.prototype._initializeUserHandlers=function(){for(var prop1 in wm.MIDI_CHANNEL_MESSAGES)wm.MIDI_CHANNEL_MESSAGES.hasOwnProperty(prop1)&&(this._userHandlers.channel[prop1]={});for(var prop2 in wm.MIDI_SYSTEM_MESSAGES)wm.MIDI_SYSTEM_MESSAGES.hasOwnProperty(prop2)&&(this._userHandlers.system[prop2]=[])},Input.prototype._onMidiMessage=function(e){e.data[0]<240?this._parseChannelEvent(e):e.data[0]<=255&&this._parseSystemEvent(e)},Input.prototype._parseChannelEvent=function(e){var data1,data2,command=e.data[0]>>4,channel=(15&e.data[0])+1;e.data.length>1&&(data1=e.data[1],data2=e.data.length>2?e.data[2]:void 0);var event={target:this,data:e.data,timestamp:e.timeStamp,channel:channel};command===wm.MIDI_CHANNEL_MESSAGES.noteoff||command===wm.MIDI_CHANNEL_MESSAGES.noteon&&0===data2?(event.type="noteoff",event.note={number:data1,name:wm._notes[data1%12],octave:wm.getOctave(data1)},event.velocity=data2/127,event.rawVelocity=data2):command===wm.MIDI_CHANNEL_MESSAGES.noteon?(event.type="noteon",event.note={number:data1,name:wm._notes[data1%12],octave:wm.getOctave(data1)},event.velocity=data2/127,event.rawVelocity=data2):command===wm.MIDI_CHANNEL_MESSAGES.keyaftertouch?(event.type="keyaftertouch",event.note={number:data1,name:wm._notes[data1%12],octave:wm.getOctave(data1)},event.value=data2/127):command===wm.MIDI_CHANNEL_MESSAGES.controlchange&&data1>=0&&119>=data1?(event.type="controlchange",event.controller={number:data1,name:this.getCcNameByNumber(data1)},event.value=data2):command===wm.MIDI_CHANNEL_MESSAGES.channelmode&&data1>=120&&127>=data1?(event.type="channelmode",event.controller={number:data1,name:this.getChannelModeByNumber(data1)},event.value=data2):command===wm.MIDI_CHANNEL_MESSAGES.programchange?(event.type="programchange",event.value=data1):command===wm.MIDI_CHANNEL_MESSAGES.channelaftertouch?(event.type="channelaftertouch",event.value=data1/127):command===wm.MIDI_CHANNEL_MESSAGES.pitchbend?(event.type="pitchbend",event.value=((data2<<7)+data1-8192)/8192):event.type="unknownchannelmessage",this._userHandlers.channel[event.type]&&this._userHandlers.channel[event.type][channel]&&this._userHandlers.channel[event.type][channel].forEach(function(callback){callback(event)})},Input.prototype.getCcNameByNumber=function(number){if(number=parseInt(number),!(number>=0&&119>=number))throw new RangeError("The control change number must be between 0 and 119.");for(var cc in wm.MIDI_CONTROL_CHANGE_MESSAGES)if(number===wm.MIDI_CONTROL_CHANGE_MESSAGES[cc])return cc;return void 0},Input.prototype.getChannelModeByNumber=function(number){if(number=parseInt(number),!(number>=120&&status<=127))throw new RangeError("The control change number must be between 120 and 127.");for(var cm in wm.MIDI_CHANNEL_MODE_MESSAGES)if(number===wm.MIDI_CHANNEL_MODE_MESSAGES[cm])return cm},Input.prototype._parseSystemEvent=function(e){var command=e.data[0],event={target:this,data:e.data,timestamp:e.timeStamp};command===wm.MIDI_SYSTEM_MESSAGES.sysex?event.type="sysex":command===wm.MIDI_SYSTEM_MESSAGES.timecode?event.type="timecode":command===wm.MIDI_SYSTEM_MESSAGES.songposition?event.type="songposition":command===wm.MIDI_SYSTEM_MESSAGES.songselect?(event.type="songselect",event.song=e.data[1]):command===wm.MIDI_SYSTEM_MESSAGES.tuningrequest?event.type="tuningrequest":command===wm.MIDI_SYSTEM_MESSAGES.clock?event.type="clock":command===wm.MIDI_SYSTEM_MESSAGES.start?event.type="start":command===wm.MIDI_SYSTEM_MESSAGES["continue"]?event.type="continue":command===wm.MIDI_SYSTEM_MESSAGES.stop?event.type="stop":command===wm.MIDI_SYSTEM_MESSAGES.activesensing?event.type="activesensing":command===wm.MIDI_SYSTEM_MESSAGES.reset?event.type="reset":event.type="unknownsystemmessage",this._userHandlers.system[event.type]&&this._userHandlers.system[event.type].forEach(function(callback){callback(event)})},Output.prototype.send=function(status,data,timestamp){if(!(status>=128&&255>=status))throw new RangeError("The status byte must be an integer between 128 (0x80) and 255 (0xFF).");Array.isArray(data)||(data=parseInt(data)>=0&&parseInt(data)<=127?[parseInt(data)]:[]);var message=[status];return data.forEach(function(item){if(!(item>=0&&255>=item))throw new RangeError("The data bytes must be integers between 0 (0x00) and 255 (0xFF).");message.push(item)}),this._midiOutput.send(message,parseFloat(timestamp)||0),this},Output.prototype.sendSysex=function(manufacturer,data,options){if(!wm.sysexEnabled)throw new Error("SysEx message support must first be activated.");return options=options||{},manufacturer=[].concat(manufacturer),data.forEach(function(item){if(0>item||item>127)throw new RangeError("The data bytes of a SysEx message must be integers between 0 (0x00) and 127 (0x7F).")}),data=manufacturer.concat(data,wm.MIDI_SYSTEM_MESSAGES.sysexend),this.send(wm.MIDI_SYSTEM_MESSAGES.sysex,data,this._parseTimeParameter(options.time)),this},Output.prototype.sendTimecodeQuarterFrame=function(value,options){return options=options||{},this.send(wm.MIDI_SYSTEM_MESSAGES.timecode,value,this._parseTimeParameter(options.time)),this},Output.prototype.sendSongPosition=function(value,options){value=parseInt(value)||0,options=options||{};var msb=value>>7&127,lsb=127&value;return this.send(wm.MIDI_SYSTEM_MESSAGES.songposition,[msb,lsb],this._parseTimeParameter(options.time)),this},Output.prototype.sendSongSelect=function(value,options){if(value=parseInt(value),options=options||{},!(value>=0&&127>=value))throw new RangeError("The song number must be between 0 and 127.");return this.send(wm.MIDI_SYSTEM_MESSAGES.songselect,[value],this._parseTimeParameter(options.time)),this},Output.prototype.sendTuningRequest=function(options){return options=options||{},this.send(wm.MIDI_SYSTEM_MESSAGES.tuningrequest,void 0,this._parseTimeParameter(options.time)),this},Output.prototype.sendClock=function(options){return options=options||{},this.send(wm.MIDI_SYSTEM_MESSAGES.clock,void 0,this._parseTimeParameter(options.time)),this},Output.prototype.sendStart=function(options){return options=options||{},this.send(wm.MIDI_SYSTEM_MESSAGES.start,void 0,this._parseTimeParameter(options.time)),this},Output.prototype.sendContinue=function(options){return options=options||{},this.send(wm.MIDI_SYSTEM_MESSAGES["continue"],void 0,this._parseTimeParameter(options.time)),this},Output.prototype.sendStop=function(options){return options=options||{},this.send(wm.MIDI_SYSTEM_MESSAGES.stop,void 0,this._parseTimeParameter(options.time)),this},Output.prototype.sendActiveSensing=function(options){return options=options||{},this.send(wm.MIDI_SYSTEM_MESSAGES.activesensing,void 0,this._parseTimeParameter(options.time)),this},Output.prototype.sendReset=function(options){return options=options||{},this.send(wm.MIDI_SYSTEM_MESSAGES.reset,void 0,this._parseTimeParameter(options.time)),this},Output.prototype.stopNote=function(note,channel,options){if("all"===note)return this.sendChannelMode("allnotesoff",0,channel,options);var nVelocity=64;return options=options||{},options.velocity=parseFloat(options.velocity),options.rawVelocity?!isNaN(options.velocity)&&options.velocity>=0&&options.velocity<=127&&(nVelocity=options.velocity):!isNaN(options.velocity)&&options.velocity>=0&&options.velocity<=1&&(nVelocity=127*options.velocity),this._convertNoteToArray(note).forEach(function(item){this._convertChannelToArray(channel).forEach(function(ch){this.send((wm.MIDI_CHANNEL_MESSAGES.noteoff<<4)+(ch-1),[item,Math.round(nVelocity)],this._parseTimeParameter(options.time))}.bind(this))}.bind(this)),this},Output.prototype.playNote=function(note,channel,options){var nVelocity=64;if(options=options||{},options.velocity=parseFloat(options.velocity),options.rawVelocity?!isNaN(options.velocity)&&options.velocity>=0&&options.velocity<=127&&(nVelocity=options.velocity):!isNaN(options.velocity)&&options.velocity>=0&&options.velocity<=1&&(nVelocity=127*options.velocity),options.time=this._parseTimeParameter(options.time),this._convertNoteToArray(note).forEach(function(item){this._convertChannelToArray(channel).forEach(function(ch){this.send((wm.MIDI_CHANNEL_MESSAGES.noteon<<4)+(ch-1),[item,Math.round(nVelocity)],options.time)}.bind(this))}.bind(this)),options.duration=parseFloat(options.duration),options.duration){options.duration<=0&&(options.duration=0);var nRelease=64;options.release=parseFloat(options.release),options.rawVelocity?!isNaN(options.release)&&options.release>=0&&options.release<=127&&(nRelease=options.release):!isNaN(options.release)&&options.release>=0&&options.release<=1&&(nRelease=127*options.release),this._convertNoteToArray(note).forEach(function(item){this._convertChannelToArray(channel).forEach(function(ch){this.send((wm.MIDI_CHANNEL_MESSAGES.noteoff<<4)+(ch-1),[item,Math.round(nRelease)],(options.time||wm.time)+options.duration)}.bind(this))}.bind(this))}return this},Output.prototype.sendKeyAftertouch=function(note,channel,pressure,options){var that=this;if(options=options||{},1>channel||channel>16)throw new RangeError("The channel must be between 1 and 16.");pressure=parseFloat(pressure),(isNaN(pressure)||0>pressure||pressure>1)&&(pressure=.5);var nPressure=Math.round(127*pressure);return this._convertNoteToArray(note).forEach(function(item){that._convertChannelToArray(channel).forEach(function(ch){that.send((wm.MIDI_CHANNEL_MESSAGES.keyaftertouch<<4)+(ch-1),[item,nPressure],that._parseTimeParameter(options.time))})}),this},Output.prototype.sendControlChange=function(controller,value,channel,options){if(options=options||{},"string"==typeof controller){if(controller=wm.MIDI_CONTROL_CHANGE_MESSAGES[controller],!controller)throw new TypeError("Invalid controller name.")}else if(controller=parseInt(controller),!(controller>=0&&119>=controller))throw new RangeError("Controller numbers must be between 0 and 119.");if(value=parseInt(value)||0,!(value>=0&&127>=value))throw new RangeError("Controller value must be between 0 and 127.");return this._convertChannelToArray(channel).forEach(function(ch){this.send((wm.MIDI_CHANNEL_MESSAGES.controlchange<<4)+(ch-1),[controller,value],this._parseTimeParameter(options.time))}.bind(this)),this},Output.prototype._selectRegisteredParameter=function(parameter,channel,time){var that=this;if(parameter[0]=parseInt(parameter[0]),!(parameter[0]>=0&&parameter[0]<=127))throw new RangeError("The control65 value must be between 0 and 127");if(parameter[1]=parseInt(parameter[1]),!(parameter[1]>=0&&parameter[1]<=127))throw new RangeError("The control64 value must be between 0 and 127");return this._convertChannelToArray(channel).forEach(function(ch){that.sendControlChange(101,parameter[0],channel,{time:time}),that.sendControlChange(100,parameter[1],channel,{time:time})}),this},Output.prototype._selectNonRegisteredParameter=function(parameter,channel,time){var that=this;if(parameter[0]=parseInt(parameter[0]),!(parameter[0]>=0&&parameter[0]<=127))throw new RangeError("The control63 value must be between 0 and 127");if(parameter[1]=parseInt(parameter[1]),!(parameter[1]>=0&&parameter[1]<=127))throw new RangeError("The control62 value must be between 0 and 127");return this._convertChannelToArray(channel).forEach(function(ch){that.sendControlChange(99,parameter[0],channel,{time:time}),that.sendControlChange(98,parameter[1],channel,{time:time})}),this},Output.prototype._setCurrentRegisteredParameter=function(data,channel,time){var that=this;if(data=[].concat(data),data[0]=parseInt(data[0]),!(data[0]>=0&&data[0]<=127))throw new RangeError("The msb value must be between 0 and 127");return this._convertChannelToArray(channel).forEach(function(ch){that.sendControlChange(6,data[0],channel,{time:time})}),data[1]=parseInt(data[1]),data[1]>=0&&data[1]<=127&&this._convertChannelToArray(channel).forEach(function(ch){that.sendControlChange(38,data[1],channel,{time:time})}),this},Output.prototype._deselectRegisteredParameter=function(channel,time){var that=this;return this._convertChannelToArray(channel).forEach(function(ch){that.sendControlChange(101,127,channel,{time:time}),that.sendControlChange(100,127,channel,{time:time})}),this},Output.prototype.setRegisteredParameter=function(parameter,data,channel,options){var that=this;if(options=options||{},!Array.isArray(parameter)){if(!wm.MIDI_REGISTERED_PARAMETER[parameter])throw new Error("The specified parameter is not available.");parameter=wm.MIDI_REGISTERED_PARAMETER[parameter]}return this._convertChannelToArray(channel).forEach(function(ch){that._selectRegisteredParameter(parameter,channel,options.time),that._setCurrentRegisteredParameter(data,channel,options.time),that._deselectRegisteredParameter(channel,options.time)}),this},Output.prototype.setNonRegisteredParameter=function(parameter,data,channel,options){var that=this;if(options=options||{},!(parameter[0]>=0&&parameter[0]<=127&&parameter[1]>=0&&parameter[1]<=127))throw new Error("Position 0 and 1 of the 2-position parameter array must both be between 0 and 127.");return data=[].concat(data),this._convertChannelToArray(channel).forEach(function(ch){that._selectNonRegisteredParameter(parameter,channel,options.time),that._setCurrentRegisteredParameter(data,channel,options.time),that._deselectRegisteredParameter(channel,options.time)}),this},Output.prototype.incrementRegisteredParameter=function(parameter,channel,options){var that=this;if(options=options||{},!Array.isArray(parameter)){if(!wm.MIDI_REGISTERED_PARAMETER[parameter])throw new Error("The specified parameter is not available.");parameter=wm.MIDI_REGISTERED_PARAMETER[parameter]}return this._convertChannelToArray(channel).forEach(function(ch){that._selectRegisteredParameter(parameter,channel,options.time),that.sendControlChange(96,0,channel,{time:options.time}),that._deselectRegisteredParameter(channel,options.time)}),this},Output.prototype.decrementRegisteredParameter=function(parameter,channel,options){if(options=options||{},!Array.isArray(parameter)){if(!wm.MIDI_REGISTERED_PARAMETER[parameter])throw new TypeError("The specified parameter is not available.");parameter=wm.MIDI_REGISTERED_PARAMETER[parameter]}return this._convertChannelToArray(channel).forEach(function(ch){this._selectRegisteredParameter(parameter,channel,options.time),this.sendControlChange(97,0,channel,{time:options.time}),this._deselectRegisteredParameter(channel,options.time)}.bind(this)),this},Output.prototype.setPitchBendRange=function(semitones,cents,channel,options){var that=this;if(options=options||{},semitones=parseInt(semitones)||0,!(semitones>=0&&127>=semitones))throw new RangeError("The semitones value must be between 0 and 127");if(cents=parseInt(cents)||0,!(cents>=0&&127>=cents))throw new RangeError("The cents value must be between 0 and 127");return this._convertChannelToArray(channel).forEach(function(ch){that.setRegisteredParameter("pitchbendrange",[semitones,cents],channel,{time:options.time})}),this},Output.prototype.setModulationRange=function(semitones,cents,channel,options){var that=this;if(options=options||{},semitones=parseInt(semitones)||0,!(semitones>=0&&127>=semitones))throw new RangeError("The semitones value must be between 0 and 127");if(cents=parseInt(cents)||0,!(cents>=0&&127>=cents))throw new RangeError("The cents value must be between 0 and 127");return this._convertChannelToArray(channel).forEach(function(ch){that.setRegisteredParameter("modulationrange",[semitones,cents],channel,{time:options.time})}),this},Output.prototype.setMasterTuning=function(value,channel,options){var that=this;if(options=options||{},value=parseFloat(value)||0,-65>=value||value>=64)throw new RangeError("The value must be a decimal number larger than -65 and smaller than 64.");var coarse=parseInt(value)+64,fine=value-parseInt(value);fine=Math.round((fine+1)/2*16383);var msb=fine>>7&127,lsb=127&fine;return this._convertChannelToArray(channel).forEach(function(ch){that.setRegisteredParameter("channelcoarsetuning",coarse,channel,{time:options.time}),that.setRegisteredParameter("channelfinetuning",[msb,lsb],channel,{time:options.time})}),this},Output.prototype.setTuningProgram=function(value,channel,options){var that=this;if(options=options||{},value=parseInt(value)||0,!(value>=0&&127>=value))throw new RangeError("The program value must be between 0 and 127");return this._convertChannelToArray(channel).forEach(function(ch){that.setRegisteredParameter("tuningprogram",value,channel,{time:options.time})}),this},Output.prototype.setTuningBank=function(value,channel,options){var that=this;if(options=options||{},value=parseInt(value)||0,!(value>=0&&127>=value))throw new RangeError("The bank value must be between 0 and 127");return this._convertChannelToArray(channel).forEach(function(ch){that.setRegisteredParameter("tuningbank",value,channel,{time:options.time})}),this},Output.prototype.sendChannelMode=function(command,value,channel,options){if(options=options||{},"string"==typeof command){if(command=wm.MIDI_CHANNEL_MODE_MESSAGES[command],!command)throw new TypeError("Invalid channel mode message name.")}else if(command=parseInt(command),!(command>=120&&127>=command))throw new RangeError("Channel mode numerical identifiers must be between 120 and 127.");if(value=parseInt(value)||0,0>value||value>127)throw new RangeError("Value must be an integer between 0 and 127.");return this._convertChannelToArray(channel).forEach(function(ch){this.send((wm.MIDI_CHANNEL_MESSAGES.channelmode<<4)+(ch-1),[command,value],this._parseTimeParameter(options.time))}.bind(this)),this},Output.prototype.sendProgramChange=function(program,channel,options){var that=this;if(options=options||{},program=parseInt(program),isNaN(program)||0>program||program>127)throw new RangeError("Program numbers must be between 0 and 127.");return this._convertChannelToArray(channel).forEach(function(ch){that.send((wm.MIDI_CHANNEL_MESSAGES.programchange<<4)+(ch-1),[program],that._parseTimeParameter(options.time))}),this},Output.prototype.sendChannelAftertouch=function(pressure,channel,options){var that=this;options=options||{},pressure=parseFloat(pressure),(isNaN(pressure)||0>pressure||pressure>1)&&(pressure=.5);var nPressure=Math.round(127*pressure);return this._convertChannelToArray(channel).forEach(function(ch){that.send((wm.MIDI_CHANNEL_MESSAGES.channelaftertouch<<4)+(ch-1),[nPressure],that._parseTimeParameter(options.time))}),this},Output.prototype.sendPitchBend=function(bend,channel,options){
var that=this;if(options=options||{},bend=parseFloat(bend),isNaN(bend)||-1>bend||bend>1)throw new RangeError("Pitch bend value must be between -1 and 1.");var nLevel=Math.round((bend+1)/2*16383),msb=nLevel>>7&127,lsb=127&nLevel;return this._convertChannelToArray(channel).forEach(function(ch){that.send((wm.MIDI_CHANNEL_MESSAGES.pitchbend<<4)+(ch-1),[lsb,msb],that._parseTimeParameter(options.time))}),this},Output.prototype._parseTimeParameter=function(time){var parsed,value;return"string"==typeof time&&"+"===time.substring(0,1)?(parsed=parseFloat(time),parsed&&parsed>0&&(value=wm.time+parsed)):(parsed=parseFloat(time),parsed>wm.time&&(value=parsed)),value},Output.prototype._convertNoteToArray=function(note){var notes=[];return Array.isArray(note)||(note=[note]),note.forEach(function(item){notes.push(wm.guessNoteNumber(item))}),notes},Output.prototype._convertChannelToArray=function(channel){if(("all"===channel||void 0===channel)&&(channel=["all"]),Array.isArray(channel)||(channel=[channel]),channel.indexOf("all")>-1){channel=[];for(var i=1;16>=i;i++)channel.push(i)}return channel.forEach(function(ch){if(!(ch>=1&&16>=ch))throw new RangeError("MIDI channels must be between 1 and 16.")}),channel},Output.prototype._onMidiMessage=function(e){},"function"==typeof define&&"object"==typeof define.amd?define([],function(){return wm}):"undefined"!=typeof module&&module.exports?module.exports=wm:scope.WebMidi||(scope.WebMidi=wm)}(this);
},{}],6:[function(require,module,exports){
// Use it like this:  
// const synth = require('pluggable-synth')
// But this is the test
const pluggableSynth = require('./index')
const audioCtx = new AudioContext(); 
const masterGain = audioCtx.createGain();
masterGain.gain.value = 0.1;

/**
 * A simple test synth
 * The synth which is going to be connected to the piano
 * must have a `start` and a `stop` method 
 */
function testSynth () {

    this.start = function (freq, options) {
        this.oscillator = audioCtx.createOscillator();
        this.oscillator.type = 'square';
        this.oscillator.frequency.value = freq; // value in hertz
        this.oscillator.connect(masterGain);
        masterGain.connect(audioCtx.destination);
        this.oscillator.start();
    }

    this.stop = function () {
        this.oscillator.stop();
    }
}


$(document).ready(function () {

    var elemID = 'piano-container'
    var p = new pluggableSynth(elemID, {
        octaves: 2,
        octaveBegin: 3    
    })
    
    // Draws piano
    p.createPiano()

    // Set synth
    p.synth = testSynth
    
    // Enable one octave of keyboard
    p.enableKeyboardEvents()
    
    // All midi tones will be played, but only two octaves is visiable
    // Param is midi port. On linux this is the first connected midi device
    p.enableMidiEvents(1)

})
},{"./index":1}]},{},[6])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3Vzci9saWIvbm9kZV9tb2R1bGVzL3dhdGNoaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJpbmRleC5qcyIsImtleWJvYXJkLXRvbmVzLmpzIiwibm9kZV9tb2R1bGVzL2pzLWNzcy1waWFuby9pbmRleC5qcyIsIm5vZGVfbW9kdWxlcy9ub3RlLXBhcnNlci9kaXN0L25vdGUtcGFyc2VyLmpzIiwibm9kZV9tb2R1bGVzL3dlYm1pZGkvd2VibWlkaS5taW4uanMiLCJ0ZXN0LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNuSEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDakNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdkRBO0FBQ0E7QUFDQTs7QUNGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM5QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiY29uc3Qgbm90ZVBhcnNlciA9IHJlcXVpcmUoJ25vdGUtcGFyc2VyJylcbmNvbnN0IG9jdGF2ZTEgPSByZXF1aXJlKCcuL2tleWJvYXJkLXRvbmVzLmpzJykub2N0YXZlMTtcbmNvbnN0IGpzQ3NzUGlhbm8gPSByZXF1aXJlKCdqcy1jc3MtcGlhbm8nKTtcbmNvbnN0IHdlYm1pZGkgPSByZXF1aXJlKCd3ZWJtaWRpJylcblxudmFyIGtleXMgPSB7fTtcblxuanNDc3NQaWFuby5wcm90b3R5cGUgPSB7XG5cbiAgICBnZXRGcmVxdWVuY3k6IGZ1bmN0aW9uIChub3RlKSB7XG4gICAgICAgIG5vdGUgPSBub3RlLnJlcGxhY2UoJ3MnLCAnIycpO1xuICAgICAgICBsZXQgcmVzID0gbm90ZVBhcnNlci5wYXJzZShub3RlKVxuICAgICAgICBsZXQgZnJlcSA9IHJlcy5mcmVxO1xuICAgICAgICByZXR1cm4gZnJlcTtcbiAgICB9LFxuXG4gICAgc3ludGg6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ3NldCBhIHN5bnRoJylcbiAgICB9LFxuXG4gICAgdG9nZ2xlS2V5OiBmdW5jdGlvbiAobm90ZSkge1xuICAgICAgICBsZXQgc2VsZWN0b3IgPSAnIycgKyB0aGlzLmVsZW1JRCArIFwiID4gLnBpYW5vIGxpW2RhdGEtbm90ZT0nXCIgKyBub3RlICsgXCInXVwiXG4gICAgICAgIGxldCBlbGVtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihzZWxlY3RvcilcbiAgICAgICAgaWYgKCFlbGVtKSB7XG4gICAgICAgICAgICByZXR1cm5cbiAgICAgICAgfVxuICAgICAgICBlbGVtLmNsYXNzTGlzdC50b2dnbGUoJ2FjdGl2ZScpO1xuICAgIH0sXG5cbiAgICBzeW50aFN0YXJ0OiBmdW5jdGlvbiAobm90ZSwgb3B0aW9ucykge1xuICAgICAgICBub3RlID0gbm90ZS50b0xvd2VyQ2FzZSgpXG4gICAgICAgIHRoaXMudG9nZ2xlS2V5KG5vdGUpXG4gICAgICAgIGxldCBmcmVxID0gdGhpcy5nZXRGcmVxdWVuY3kobm90ZSk7XG4gICAgICAgIGxldCBzeW50aCA9IG5ldyB0aGlzLnN5bnRoKCk7XG5cbiAgICAgICAgc3ludGguc3RhcnQoZnJlcSwgb3B0aW9ucyk7XG4gICAgICAgIGtleXNbbm90ZV0gPSBzeW50aDtcbiAgICB9LFxuXG4gICAgc3ludGhTdG9wOiBmdW5jdGlvbiAobm90ZSkge1xuICAgICAgICBub3RlID0gbm90ZS50b0xvd2VyQ2FzZSgpXG4gICAgICAgIHRoaXMudG9nZ2xlS2V5KG5vdGUpXG4gICAgICAgIGxldCBzeW50aCA9IGtleXNbbm90ZV1cbiAgICAgICAgc3ludGguc3RvcCgpXG4gICAgICAgIGRlbGV0ZSBrZXlzW25vdGVdXG4gICAgfSxcblxuICAgIC8vIEVuYWJsZSBvbmUgb3IgdHdvIG9jdGF2ZXMgb24ga2V5Ym9hcmRcbiAgICBlbmFibGVLZXlib2FyZEV2ZW50czogZnVuY3Rpb24gKCkge1xuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCAoZSkgPT4ge1xuXG4gICAgICAgICAgICB2YXIgayA9IGUua2V5O1xuICAgICAgICAgICAgbGV0IG5vdGUgPSBvY3RhdmUxW2tdICsgdGhpcy5vcHRpb25zLm9jdGF2ZUJlZ2luXG5cbiAgICAgICAgICAgIGlmIChrIGluIG9jdGF2ZTEgJiYgIShub3RlIGluIGtleXMpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zeW50aFN0YXJ0KG5vdGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5dXBcIiwgKGUpID0+IHtcblxuICAgICAgICAgICAgbGV0IG9jdGF2ZSA9IHRoaXMub3B0aW9ucy5vY3RhdmVCZWdpblxuICAgICAgICAgICAgdmFyIGsgPSBlLmtleTtcbiAgICAgICAgICAgIGxldCBub3RlID0gb2N0YXZlMVtrXSArIG9jdGF2ZTtcbiAgICAgICAgICAgIGlmIChrIGluIG9jdGF2ZTEgJiYgKG5vdGUgaW4ga2V5cykpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnN5bnRoU3RvcChub3RlKVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLy8gRW5hYmxlIG1pZGkga2V5Ym9hcmRcbiAgICBlbmFibGVNaWRpRXZlbnRzOiBmdW5jdGlvbiAocG9ydCkge1xuICAgICAgICBpZiAocG9ydCA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHBvcnQgPSAxXG4gICAgICAgIH1cblxuICAgICAgICB3ZWJtaWRpLmVuYWJsZSggKGVycikgPT4ge1xuXG4gICAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJXZWJNaWRpIGNvdWxkIG5vdCBiZSBlbmFibGVkLlwiICsgZXJyKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICggIShwb3J0IGluIHdlYm1pZGkuaW5wdXRzKSkge1xuICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ01vZGkgcG9ydCBkb2VzIG5vdCBleGlzdHMgJyArIHBvcnQpXG4gICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFBvcnQgaXMgb2tcbiAgICAgICAgICAgIHZhciBtaWRpSW5wdXQgPSB3ZWJtaWRpLmlucHV0c1twb3J0XTtcbiAgICAgICAgICAgIG1pZGlJbnB1dC5hZGRMaXN0ZW5lcignbm90ZW9uJywgXCJhbGxcIiwgKGUpID0+IHtcblxuICAgICAgICAgICAgICAgIGxldCBvY3RhdmUgPSBwYXJzZUludChlLm5vdGUub2N0YXZlKVxuICAgICAgICAgICAgICAgIGxldCBub3RlID0gZS5ub3RlLm5hbWUgKyBvY3RhdmVcbiAgICAgICAgICAgICAgICBub3RlID0gbm90ZS5yZXBsYWNlKCcjJywgJ3MnKVxuXG4gICAgICAgICAgICAgICAgaWYgKCEobm90ZSBpbiBrZXlzKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnN5bnRoU3RhcnQobm90ZSwgZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIG1pZGlJbnB1dC5hZGRMaXN0ZW5lcignbm90ZW9mZicsIFwiYWxsXCIsIChlKSA9PiB7XG4gICAgICAgICAgICAgICAgbGV0IG9jdGF2ZSA9IHBhcnNlSW50KGUubm90ZS5vY3RhdmUpO1xuICAgICAgICAgICAgICAgIGxldCBub3RlID0gZS5ub3RlLm5hbWUgKyBvY3RhdmU7XG5cbiAgICAgICAgICAgICAgICBub3RlID0gbm90ZS5yZXBsYWNlKCcjJywgJ3MnKVxuXG4gICAgICAgICAgICAgICAgdGhpcy5zeW50aFN0b3Aobm90ZSlcblxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pXG4gICAgfSxcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBqc0Nzc1BpYW5vO1xuIiwidmFyIGtleWJvYXJkVG9uZXMgPSB7fVxuXG5rZXlib2FyZFRvbmVzLm9jdGF2ZTEgPSB7XG4gICAgYTogJ2MnLFxuICAgIHc6ICdjcycsXG4gICAgczogJ2QnLFxuICAgIGU6ICdkcycsXG4gICAgZDogJ2UnLFxuICAgIGY6ICdmJyxcbiAgICB0OiAnZnMnLFxuICAgIGc6ICdnJyxcbiAgICB5OiAnZ3MnLFxuICAgIGg6ICdhJyxcbiAgICB1OiAnYXMnLFxuICAgIGo6ICdiJ1xufTtcblxuXG5rZXlib2FyZFRvbmVzLm9jdGF2ZTIgPSB7XG4gICAgcTogJ2MnLFxuICAgIDI6ICdjcycsXG4gICAgdzogJ2QnLFxuICAgIDM6ICdkcycsXG4gICAgZTogJ2UnLFxuICAgIHI6ICdmJyxcbiAgICA1OiAnZnMnLFxuICAgIHQ6ICdnJyxcbiAgICA2OiAnZ3MnLFxuICAgIHk6ICdhJyxcbiAgICA3OiAnYXMnLFxuICAgIHU6ICdiJ1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBrZXlib2FyZFRvbmVzOyIsImZ1bmN0aW9uIHBpYW5vKGVsZW1JRCwgb3B0cykge1xuXG4gICAgdGhpcy5lbGVtSUQgPSBlbGVtSURcbiAgICB0aGlzLmVsZW0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChlbGVtSUQpXG4gICAgXG4gICAgdGhpcy5kZWZhdWx0cyA9IHtcbiAgICAgICAgb2N0YXZlczogMixcbiAgICAgICAgb2N0YXZlQmVnaW46IDNcbiAgICB9XG5cbiAgICB0aGlzLm9wdGlvbnMgPSB7fVxuICAgIE9iamVjdC5hc3NpZ24odGhpcy5vcHRpb25zLCB0aGlzLmRlZmF1bHRzLCBvcHRzKVxuICAgIFxuICAgIHRoaXMuY3JlYXRlUGlhbm8gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGxldCBodG1sID0gdGhpcy5nZXRQaWFub0hUTUwoKVxuICAgICAgICB0aGlzLmVsZW0uaW5uZXJIVE1MID0gaHRtbFxuICAgIH1cblxuICAgIHRoaXMuZ2V0UGlhbm9IVE1MID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBcbiAgICAgICAgbGV0IG9jdGF2ZUJlZ2luID0gdGhpcy5vcHRpb25zLm9jdGF2ZUJlZ2luXG4gICAgICAgIGxldCBodG1sID0gYDx1bCBjbGFzcz1cInBpYW5vXCI+YFxuICAgICAgICBmb3IgKGkgPSAxOyBpIDw9IHRoaXMub3B0aW9ucy5vY3RhdmVzOyBpKyspIHsgIFxuICAgICAgICAgICAgaHRtbCArPSB0aGlzLmdldFRvbmVzKG9jdGF2ZUJlZ2luKVxuICAgICAgICAgICAgb2N0YXZlQmVnaW4rKyBcbiAgICAgICAgfVxuICAgICAgICBodG1sICs9IGA8L3VsPmBcbiAgICAgICAgcmV0dXJuIGh0bWxcbiAgICB9XG5cbiAgICB0aGlzLmdldE5vdGVBbmRPY3RhdmUgPSBmdW5jdGlvbiAobm90ZSwgb2N0YXZlKSB7XG4gICAgICAgIHJldHVybiBub3RlICsgb2N0YXZlXG4gICAgfVxuXG4gICAgdGhpcy5nZXRUb25lcyA9IGZ1bmN0aW9uIChvY3RhdmUpIHtcbiAgICAgICAgbGV0IG9jdGF2ZUhUTUwgPSBcbiAgICAgICAgYFxuICAgICAgICAgICAgPGxpIGNsYXNzPVwid2hpdGUgY1wiIGRhdGEtbm90ZT1cIiR7dGhpcy5nZXROb3RlQW5kT2N0YXZlKCdjJywgb2N0YXZlKX1cIj48L2xpPlxuICAgICAgICAgICAgPGxpIGNsYXNzPVwiYmxhY2sgY3NcIiBkYXRhLW5vdGU9XCIke3RoaXMuZ2V0Tm90ZUFuZE9jdGF2ZSgnY3MnLCBvY3RhdmUpfVwiPjwvbGk+XG4gICAgICAgICAgICA8bGkgY2xhc3M9XCJ3aGl0ZSBkXCIgZGF0YS1ub3RlPVwiJHt0aGlzLmdldE5vdGVBbmRPY3RhdmUoJ2QnLCBvY3RhdmUpfVwiPjwvbGk+XG4gICAgICAgICAgICA8bGkgY2xhc3M9XCJibGFjayBkc1wiIGRhdGEtbm90ZT1cIiR7dGhpcy5nZXROb3RlQW5kT2N0YXZlKCdkcycsIG9jdGF2ZSl9XCI+PC9saT5cbiAgICAgICAgICAgIDxsaSBjbGFzcz1cIndoaXRlIGVcIiBkYXRhLW5vdGU9XCIke3RoaXMuZ2V0Tm90ZUFuZE9jdGF2ZSgnZScsIG9jdGF2ZSl9XCI+PC9saT5cbiAgICAgICAgICAgIDxsaSBjbGFzcz1cIndoaXRlIGZcIiBkYXRhLW5vdGU9XCIke3RoaXMuZ2V0Tm90ZUFuZE9jdGF2ZSgnZicsIG9jdGF2ZSl9XCI+PC9saT5cbiAgICAgICAgICAgIDxsaSBjbGFzcz1cImJsYWNrIGZzXCIgZGF0YS1ub3RlPVwiJHt0aGlzLmdldE5vdGVBbmRPY3RhdmUoJ2ZzJywgb2N0YXZlKX1cIj48L2xpPlxuICAgICAgICAgICAgPGxpIGNsYXNzPVwid2hpdGUgZ1wiIGRhdGEtbm90ZT1cIiR7dGhpcy5nZXROb3RlQW5kT2N0YXZlKCdnJywgb2N0YXZlKX1cIj48L2xpPlxuICAgICAgICAgICAgPGxpIGNsYXNzPVwiYmxhY2sgZ3NcIiBkYXRhLW5vdGU9XCIke3RoaXMuZ2V0Tm90ZUFuZE9jdGF2ZSgnZ3MnLCBvY3RhdmUpfVwiPjwvbGk+XG4gICAgICAgICAgICA8bGkgY2xhc3M9XCJ3aGl0ZSBhXCIgZGF0YS1ub3RlPVwiJHt0aGlzLmdldE5vdGVBbmRPY3RhdmUoJ2EnLCBvY3RhdmUpfVwiPjwvbGk+XG4gICAgICAgICAgICA8bGkgY2xhc3M9XCJibGFjayBhc1wiIGRhdGEtbm90ZT1cIiR7dGhpcy5nZXROb3RlQW5kT2N0YXZlKCdhcycsIG9jdGF2ZSl9XCI+PC9saT5cbiAgICAgICAgICAgIDxsaSBjbGFzcz1cIndoaXRlIGJcIiBkYXRhLW5vdGU9XCIke3RoaXMuZ2V0Tm90ZUFuZE9jdGF2ZSgnYicsIG9jdGF2ZSl9XCI+PC9saT5gXG4gICAgICAgICAgICBcbiAgICAgICAgcmV0dXJuIG9jdGF2ZUhUTUxcbiAgICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gcGlhbm87XG4iLCIhZnVuY3Rpb24odCxuKXtcIm9iamVjdFwiPT10eXBlb2YgZXhwb3J0cyYmXCJ1bmRlZmluZWRcIiE9dHlwZW9mIG1vZHVsZT9uKGV4cG9ydHMpOlwiZnVuY3Rpb25cIj09dHlwZW9mIGRlZmluZSYmZGVmaW5lLmFtZD9kZWZpbmUoW1wiZXhwb3J0c1wiXSxuKTpuKHQuTm90ZVBhcnNlcj10Lk5vdGVQYXJzZXJ8fHt9KX0odGhpcyxmdW5jdGlvbih0KXtcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBuKHQsbil7cmV0dXJuIEFycmF5KG4rMSkuam9pbih0KX1mdW5jdGlvbiByKHQpe3JldHVyblwibnVtYmVyXCI9PXR5cGVvZiB0fWZ1bmN0aW9uIGUodCl7cmV0dXJuXCJzdHJpbmdcIj09dHlwZW9mIHR9ZnVuY3Rpb24gdSh0KXtyZXR1cm4gdm9pZCAwIT09dH1mdW5jdGlvbiBjKHQsbil7cmV0dXJuIE1hdGgucG93KDIsKHQtNjkpLzEyKSoobnx8NDQwKX1mdW5jdGlvbiBvKCl7cmV0dXJuIGJ9ZnVuY3Rpb24gaSh0LG4scil7aWYoXCJzdHJpbmdcIiE9dHlwZW9mIHQpcmV0dXJuIG51bGw7dmFyIGU9Yi5leGVjKHQpO2lmKCFlfHwhbiYmZVs0XSlyZXR1cm4gbnVsbDt2YXIgdT17bGV0dGVyOmVbMV0udG9VcHBlckNhc2UoKSxhY2M6ZVsyXS5yZXBsYWNlKC94L2csXCIjI1wiKX07dS5wYz11LmxldHRlcit1LmFjYyx1LnN0ZXA9KHUubGV0dGVyLmNoYXJDb2RlQXQoMCkrMyklNyx1LmFsdD1cImJcIj09PXUuYWNjWzBdPy11LmFjYy5sZW5ndGg6dS5hY2MubGVuZ3RoO3ZhciBvPUFbdS5zdGVwXSt1LmFsdDtyZXR1cm4gdS5jaHJvbWE9bzwwPzEyK286byUxMixlWzNdJiYodS5vY3Q9K2VbM10sdS5taWRpPW8rMTIqKHUub2N0KzEpLHUuZnJlcT1jKHUubWlkaSxyKSksbiYmKHUudG9uaWNPZj1lWzRdKSx1fWZ1bmN0aW9uIGYodCl7cmV0dXJuIHIodCk/dDwwP24oXCJiXCIsLXQpOm4oXCIjXCIsdCk6XCJcIn1mdW5jdGlvbiBhKHQpe3JldHVybiByKHQpP1wiXCIrdDpcIlwifWZ1bmN0aW9uIGwodCxuLHIpe3JldHVybiBudWxsPT09dHx8dm9pZCAwPT09dD9udWxsOnQuc3RlcD9sKHQuc3RlcCx0LmFsdCx0Lm9jdCk6dDwwfHx0PjY/bnVsbDpDLmNoYXJBdCh0KStmKG4pK2Eocil9ZnVuY3Rpb24gcCh0KXtpZigocih0KXx8ZSh0KSkmJnQ+PTAmJnQ8MTI4KXJldHVybit0O3ZhciBuPWkodCk7cmV0dXJuIG4mJnUobi5taWRpKT9uLm1pZGk6bnVsbH1mdW5jdGlvbiBzKHQsbil7dmFyIHI9cCh0KTtyZXR1cm4gbnVsbD09PXI/bnVsbDpjKHIsbil9ZnVuY3Rpb24gZCh0KXtyZXR1cm4oaSh0KXx8e30pLmxldHRlcn1mdW5jdGlvbiBtKHQpe3JldHVybihpKHQpfHx7fSkuYWNjfWZ1bmN0aW9uIGgodCl7cmV0dXJuKGkodCl8fHt9KS5wY31mdW5jdGlvbiB2KHQpe3JldHVybihpKHQpfHx7fSkuc3RlcH1mdW5jdGlvbiBnKHQpe3JldHVybihpKHQpfHx7fSkuYWx0fWZ1bmN0aW9uIHgodCl7cmV0dXJuKGkodCl8fHt9KS5jaHJvbWF9ZnVuY3Rpb24geSh0KXtyZXR1cm4oaSh0KXx8e30pLm9jdH12YXIgYj0vXihbYS1nQS1HXSkoI3sxLH18YnsxLH18eHsxLH18KSgtP1xcZCopXFxzKiguKilcXHMqJC8sQT1bMCwyLDQsNSw3LDksMTFdLEM9XCJDREVGR0FCXCI7dC5yZWdleD1vLHQucGFyc2U9aSx0LmJ1aWxkPWwsdC5taWRpPXAsdC5mcmVxPXMsdC5sZXR0ZXI9ZCx0LmFjYz1tLHQucGM9aCx0LnN0ZXA9dix0LmFsdD1nLHQuY2hyb21hPXgsdC5vY3Q9eX0pO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9bm90ZS1wYXJzZXIuanMubWFwXG4iLCIvKlxuXG5XZWJNaWRpIHYyLjAuMC1yYy45XG5cbldlYk1pZGkuanMgaGVscHMgeW91IHRhbWUgdGhlIFdlYiBNSURJIEFQSS4gU2VuZCBhbmQgcmVjZWl2ZSBNSURJIG1lc3NhZ2VzIHdpdGggZWFzZS4gQ29udHJvbCBpbnN0cnVtZW50cyB3aXRoIHVzZXItZnJpZW5kbHkgZnVuY3Rpb25zIChwbGF5Tm90ZSwgc2VuZFBpdGNoQmVuZCwgZXRjLikuIFJlYWN0IHRvIE1JREkgaW5wdXQgd2l0aCBzaW1wbGUgZXZlbnQgbGlzdGVuZXJzIChub3Rlb24sIHBpdGNoYmVuZCwgY29udHJvbGNoYW5nZSwgZXRjLikuXG5odHRwczovL2dpdGh1Yi5jb20vY290ZWpwL3dlYm1pZGlcblxuXG5UaGUgTUlUIExpY2Vuc2UgKE1JVClcblxuQ29weXJpZ2h0IChjKSAyMDE1LTIwMTYsIEplYW4tUGhpbGlwcGUgQ8O0dMOpXG5cblBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkgb2YgdGhpcyBzb2Z0d2FyZSBhbmRcbmFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlIFwiU29mdHdhcmVcIiksIHRvIGRlYWwgaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sXG5pbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMgdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLFxuc3VibGljZW5zZSwgYW5kL29yIHNlbGwgY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzXG5mdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOlxuXG5UaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbiBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsXG5wb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuXG5cblRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1IgSU1QTElFRCwgSU5DTFVESU5HIEJVVFxuTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkRcbk5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVNcbk9SIE9USEVSIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sIE9VVCBPRiBPUiBJTlxuQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRSBTT0ZUV0FSRS5cblxuKi9cblxuIWZ1bmN0aW9uKHNjb3BlKXtcInVzZSBzdHJpY3RcIjtmdW5jdGlvbiBXZWJNaWRpKCl7aWYoV2ViTWlkaS5wcm90b3R5cGUuX3NpbmdsZXRvbil0aHJvdyBuZXcgRXJyb3IoXCJXZWJNaWRpIGlzIGEgc2luZ2xldG9uLCBpdCBjYW5ub3QgYmUgaW5zdGFudGlhdGVkIGRpcmVjdGx5LlwiKTtXZWJNaWRpLnByb3RvdHlwZS5fc2luZ2xldG9uPXRoaXMsdGhpcy5faW5wdXRzPVtdLHRoaXMuX291dHB1dHM9W10sdGhpcy5fdXNlckhhbmRsZXJzPXt9LHRoaXMuX3N0YXRlQ2hhbmdlUXVldWU9W10sdGhpcy5fcHJvY2Vzc2luZ1N0YXRlQ2hhbmdlPSExLHRoaXMuX21pZGlJbnRlcmZhY2VFdmVudHM9W1wiY29ubmVjdGVkXCIsXCJkaXNjb25uZWN0ZWRcIl0sdGhpcy5fbm90ZXM9W1wiQ1wiLFwiQyNcIixcIkRcIixcIkQjXCIsXCJFXCIsXCJGXCIsXCJGI1wiLFwiR1wiLFwiRyNcIixcIkFcIixcIkEjXCIsXCJCXCJdLHRoaXMuX3NlbWl0b25lcz17QzowLEQ6MixFOjQsRjo1LEc6NyxBOjksQjoxMX0sT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGhpcyx7TUlESV9TWVNURU1fTUVTU0FHRVM6e3ZhbHVlOntzeXNleDoyNDAsdGltZWNvZGU6MjQxLHNvbmdwb3NpdGlvbjoyNDIsc29uZ3NlbGVjdDoyNDMsdHVuaW5ncmVxdWVzdDoyNDYsc3lzZXhlbmQ6MjQ3LGNsb2NrOjI0OCxzdGFydDoyNTAsXCJjb250aW51ZVwiOjI1MSxzdG9wOjI1MixhY3RpdmVzZW5zaW5nOjI1NCxyZXNldDoyNTUsdW5rbm93bnN5c3RlbW1lc3NhZ2U6LTF9LHdyaXRhYmxlOiExLGVudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiExfSxNSURJX0NIQU5ORUxfTUVTU0FHRVM6e3ZhbHVlOntub3Rlb2ZmOjgsbm90ZW9uOjksa2V5YWZ0ZXJ0b3VjaDoxMCxjb250cm9sY2hhbmdlOjExLGNoYW5uZWxtb2RlOjExLHByb2dyYW1jaGFuZ2U6MTIsY2hhbm5lbGFmdGVydG91Y2g6MTMscGl0Y2hiZW5kOjE0fSx3cml0YWJsZTohMSxlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMX0sTUlESV9SRUdJU1RFUkVEX1BBUkFNRVRFUjp7dmFsdWU6e3BpdGNoYmVuZHJhbmdlOlswLDBdLGNoYW5uZWxmaW5ldHVuaW5nOlswLDFdLGNoYW5uZWxjb2Fyc2V0dW5pbmc6WzAsMl0sdHVuaW5ncHJvZ3JhbTpbMCwzXSx0dW5pbmdiYW5rOlswLDRdLG1vZHVsYXRpb25yYW5nZTpbMCw1XSxhemltdXRoYW5nbGU6WzYxLDBdLGVsZXZhdGlvbmFuZ2xlOls2MSwxXSxnYWluOls2MSwyXSxkaXN0YW5jZXJhdGlvOls2MSwzXSxtYXhpbXVtZGlzdGFuY2U6WzYxLDRdLG1heGltdW1kaXN0YW5jZWdhaW46WzYxLDVdLHJlZmVyZW5jZWRpc3RhbmNlcmF0aW86WzYxLDZdLHBhbnNwcmVhZGFuZ2xlOls2MSw3XSxyb2xsYW5nbGU6WzYxLDhdfSx3cml0YWJsZTohMSxlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMX0sTUlESV9DT05UUk9MX0NIQU5HRV9NRVNTQUdFUzp7dmFsdWU6e2JhbmtzZWxlY3Rjb2Fyc2U6MCxtb2R1bGF0aW9ud2hlZWxjb2Fyc2U6MSxicmVhdGhjb250cm9sbGVyY29hcnNlOjIsZm9vdGNvbnRyb2xsZXJjb2Fyc2U6NCxwb3J0YW1lbnRvdGltZWNvYXJzZTo1LGRhdGFlbnRyeWNvYXJzZTo2LHZvbHVtZWNvYXJzZTo3LGJhbGFuY2Vjb2Fyc2U6OCxwYW5jb2Fyc2U6MTAsZXhwcmVzc2lvbmNvYXJzZToxMSxlZmZlY3Rjb250cm9sMWNvYXJzZToxMixlZmZlY3Rjb250cm9sMmNvYXJzZToxMyxnZW5lcmFscHVycG9zZXNsaWRlcjE6MTYsZ2VuZXJhbHB1cnBvc2VzbGlkZXIyOjE3LGdlbmVyYWxwdXJwb3Nlc2xpZGVyMzoxOCxnZW5lcmFscHVycG9zZXNsaWRlcjQ6MTksYmFua3NlbGVjdGZpbmU6MzIsbW9kdWxhdGlvbndoZWVsZmluZTozMyxicmVhdGhjb250cm9sbGVyZmluZTozNCxmb290Y29udHJvbGxlcmZpbmU6MzYscG9ydGFtZW50b3RpbWVmaW5lOjM3LGRhdGFlbnRyeWZpbmU6Mzgsdm9sdW1lZmluZTozOSxiYWxhbmNlZmluZTo0MCxwYW5maW5lOjQyLGV4cHJlc3Npb25maW5lOjQzLGVmZmVjdGNvbnRyb2wxZmluZTo0NCxlZmZlY3Rjb250cm9sMmZpbmU6NDUsaG9sZHBlZGFsOjY0LHBvcnRhbWVudG86NjUsc3VzdGVudXRvcGVkYWw6NjYsc29mdHBlZGFsOjY3LGxlZ2F0b3BlZGFsOjY4LGhvbGQycGVkYWw6Njksc291bmR2YXJpYXRpb246NzAscmVzb25hbmNlOjcxLHNvdW5kcmVsZWFzZXRpbWU6NzIsc291bmRhdHRhY2t0aW1lOjczLGJyaWdodG5lc3M6NzQsc291bmRjb250cm9sNjo3NSxzb3VuZGNvbnRyb2w3Ojc2LHNvdW5kY29udHJvbDg6Nzcsc291bmRjb250cm9sOTo3OCxzb3VuZGNvbnRyb2wxMDo3OSxnZW5lcmFscHVycG9zZWJ1dHRvbjE6ODAsZ2VuZXJhbHB1cnBvc2VidXR0b24yOjgxLGdlbmVyYWxwdXJwb3NlYnV0dG9uMzo4MixnZW5lcmFscHVycG9zZWJ1dHRvbjQ6ODMscmV2ZXJibGV2ZWw6OTEsdHJlbW9sb2xldmVsOjkyLGNob3J1c2xldmVsOjkzLGNlbGVzdGVsZXZlbDo5NCxwaGFzZXJsZXZlbDo5NSxkYXRhYnV0dG9uaW5jcmVtZW50Ojk2LGRhdGFidXR0b25kZWNyZW1lbnQ6OTcsbm9ucmVnaXN0ZXJlZHBhcmFtZXRlcmNvYXJzZTo5OCxub25yZWdpc3RlcmVkcGFyYW1ldGVyZmluZTo5OSxyZWdpc3RlcmVkcGFyYW1ldGVyY29hcnNlOjEwMCxyZWdpc3RlcmVkcGFyYW1ldGVyZmluZToxMDF9LHdyaXRhYmxlOiExLGVudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiExfSxNSURJX0NIQU5ORUxfTU9ERV9NRVNTQUdFUzp7dmFsdWU6e2FsbHNvdW5kb2ZmOjEyMCxyZXNldGFsbGNvbnRyb2xsZXJzOjEyMSxsb2NhbGNvbnRyb2w6MTIyLGFsbG5vdGVzb2ZmOjEyMyxvbW5pbW9kZW9mZjoxMjQsb21uaW1vZGVvbjoxMjUsbW9ub21vZGVvbjoxMjYscG9seW1vZGVvbjoxMjd9LHdyaXRhYmxlOiExLGVudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiExfX0pLE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRoaXMse3N1cHBvcnRlZDp7ZW51bWVyYWJsZTohMCxnZXQ6ZnVuY3Rpb24oKXtyZXR1cm5cInJlcXVlc3RNSURJQWNjZXNzXCJpbiBuYXZpZ2F0b3J9fSxlbmFibGVkOntlbnVtZXJhYmxlOiEwLGdldDpmdW5jdGlvbigpe3JldHVybiB2b2lkIDAhPT10aGlzW1wiaW50ZXJmYWNlXCJdfS5iaW5kKHRoaXMpfSxpbnB1dHM6e2VudW1lcmFibGU6ITAsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX2lucHV0c30uYmluZCh0aGlzKX0sb3V0cHV0czp7ZW51bWVyYWJsZTohMCxnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fb3V0cHV0c30uYmluZCh0aGlzKX0sc3lzZXhFbmFibGVkOntlbnVtZXJhYmxlOiEwLGdldDpmdW5jdGlvbigpe3JldHVybiEoIXRoaXNbXCJpbnRlcmZhY2VcIl18fCF0aGlzW1wiaW50ZXJmYWNlXCJdLnN5c2V4RW5hYmxlZCl9LmJpbmQodGhpcyl9LHRpbWU6e2VudW1lcmFibGU6ITAsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHBlcmZvcm1hbmNlLm5vdygpfX19KX1mdW5jdGlvbiBJbnB1dChtaWRpSW5wdXQpe3ZhciB0aGF0PXRoaXM7dGhpcy5fdXNlckhhbmRsZXJzPXtjaGFubmVsOnt9LHN5c3RlbTp7fX0sdGhpcy5fbWlkaUlucHV0PW1pZGlJbnB1dCxPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0aGlzLHtjb25uZWN0aW9uOntlbnVtZXJhYmxlOiEwLGdldDpmdW5jdGlvbigpe3JldHVybiB0aGF0Ll9taWRpSW5wdXQuY29ubmVjdGlvbn19LGlkOntlbnVtZXJhYmxlOiEwLGdldDpmdW5jdGlvbigpe3JldHVybiB0aGF0Ll9taWRpSW5wdXQuaWR9fSxtYW51ZmFjdHVyZXI6e2VudW1lcmFibGU6ITAsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoYXQuX21pZGlJbnB1dC5tYW51ZmFjdHVyZXJ9fSxuYW1lOntlbnVtZXJhYmxlOiEwLGdldDpmdW5jdGlvbigpe3JldHVybiB0aGF0Ll9taWRpSW5wdXQubmFtZX19LHN0YXRlOntlbnVtZXJhYmxlOiEwLGdldDpmdW5jdGlvbigpe3JldHVybiB0aGF0Ll9taWRpSW5wdXQuc3RhdGV9fX0pLHRoaXMuX2luaXRpYWxpemVVc2VySGFuZGxlcnMoKX1mdW5jdGlvbiBPdXRwdXQobWlkaU91dHB1dCl7dmFyIHRoYXQ9dGhpczt0aGlzLl9taWRpT3V0cHV0PW1pZGlPdXRwdXQsT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGhpcyx7Y29ubmVjdGlvbjp7ZW51bWVyYWJsZTohMCxnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhhdC5fbWlkaU91dHB1dC5jb25uZWN0aW9ufX0saWQ6e2VudW1lcmFibGU6ITAsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoYXQuX21pZGlPdXRwdXQuaWR9fSxtYW51ZmFjdHVyZXI6e2VudW1lcmFibGU6ITAsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoYXQuX21pZGlPdXRwdXQubWFudWZhY3R1cmVyfX0sbmFtZTp7ZW51bWVyYWJsZTohMCxnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhhdC5fbWlkaU91dHB1dC5uYW1lfX0sc3RhdGU6e2VudW1lcmFibGU6ITAsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoYXQuX21pZGlPdXRwdXQuc3RhdGV9fX0pfXZhciB3bT1uZXcgV2ViTWlkaTtXZWJNaWRpLnByb3RvdHlwZS5lbmFibGU9ZnVuY3Rpb24oY2FsbGJhY2ssc3lzZXgpe3JldHVybiB0aGlzLmVuYWJsZWQ/dm9pZCAwOnRoaXMuc3VwcG9ydGVkP3ZvaWQgbmF2aWdhdG9yLnJlcXVlc3RNSURJQWNjZXNzKHtzeXNleDpzeXNleH0pLnRoZW4oZnVuY3Rpb24obWlkaUFjY2Vzcyl7dGhpc1tcImludGVyZmFjZVwiXT1taWRpQWNjZXNzLHRoaXMuX3Jlc2V0SW50ZXJmYWNlVXNlckhhbmRsZXJzKCksdGhpc1tcImludGVyZmFjZVwiXS5vbnN0YXRlY2hhbmdlPXRoaXMuX29uSW50ZXJmYWNlU3RhdGVDaGFuZ2UuYmluZCh0aGlzKSx0aGlzLl9vbkludGVyZmFjZVN0YXRlQ2hhbmdlKG51bGwpLFwiZnVuY3Rpb25cIj09dHlwZW9mIGNhbGxiYWNrJiZjYWxsYmFjay5jYWxsKHRoaXMpfS5iaW5kKHRoaXMpLGZ1bmN0aW9uKGVycil7XCJmdW5jdGlvblwiPT10eXBlb2YgY2FsbGJhY2smJmNhbGxiYWNrLmNhbGwodGhpcyxlcnIpfS5iaW5kKHRoaXMpKTp2b2lkKFwiZnVuY3Rpb25cIj09dHlwZW9mIGNhbGxiYWNrJiZjYWxsYmFjayhuZXcgRXJyb3IoXCJUaGUgV2ViIE1JREkgQVBJIGlzIG5vdCBzdXBwb3J0ZWQgYnkgeW91ciBicm93c2VyLlwiKSkpfSxXZWJNaWRpLnByb3RvdHlwZS5kaXNhYmxlPWZ1bmN0aW9uKCl7aWYoIXRoaXMuc3VwcG9ydGVkKXRocm93IG5ldyBFcnJvcihcIlRoZSBXZWIgTUlESSBBUEkgaXMgbm90IHN1cHBvcnRlZCBieSB5b3VyIGJyb3dzZXIuXCIpO3RoaXNbXCJpbnRlcmZhY2VcIl0ub25zdGF0ZWNoYW5nZT12b2lkIDAsdGhpc1tcImludGVyZmFjZVwiXT12b2lkIDAsdGhpcy5faW5wdXRzPVtdLHRoaXMuX291dHB1dHM9W10sdGhpcy5fcmVzZXRJbnRlcmZhY2VVc2VySGFuZGxlcnMoKX0sV2ViTWlkaS5wcm90b3R5cGUuYWRkTGlzdGVuZXI9ZnVuY3Rpb24odHlwZSxsaXN0ZW5lcil7aWYoIXRoaXMuZW5hYmxlZCl0aHJvdyBuZXcgRXJyb3IoXCJXZWJNaWRpIG11c3QgYmUgZW5hYmxlZCBiZWZvcmUgYWRkaW5nIGV2ZW50IGxpc3RlbmVycy5cIik7aWYoXCJmdW5jdGlvblwiIT10eXBlb2YgbGlzdGVuZXIpdGhyb3cgbmV3IFR5cGVFcnJvcihcIlRoZSAnbGlzdGVuZXInIHBhcmFtZXRlciBtdXN0IGJlIGEgZnVuY3Rpb24uXCIpO2lmKCEodGhpcy5fbWlkaUludGVyZmFjZUV2ZW50cy5pbmRleE9mKHR5cGUpPj0wKSl0aHJvdyBuZXcgVHlwZUVycm9yKFwiVGhlIHNwZWNpZmllZCBldmVudCB0eXBlIGlzIG5vdCBzdXBwb3J0ZWQuXCIpO3JldHVybiB0aGlzLl91c2VySGFuZGxlcnNbdHlwZV0ucHVzaChsaXN0ZW5lciksdGhpc30sV2ViTWlkaS5wcm90b3R5cGUuaGFzTGlzdGVuZXI9ZnVuY3Rpb24odHlwZSxsaXN0ZW5lcil7aWYoIXRoaXMuZW5hYmxlZCl0aHJvdyBuZXcgRXJyb3IoXCJXZWJNaWRpIG11c3QgYmUgZW5hYmxlZCBiZWZvcmUgY2hlY2tpbmcgZXZlbnQgbGlzdGVuZXJzLlwiKTtpZihcImZ1bmN0aW9uXCIhPXR5cGVvZiBsaXN0ZW5lcil0aHJvdyBuZXcgVHlwZUVycm9yKFwiVGhlICdsaXN0ZW5lcicgcGFyYW1ldGVyIG11c3QgYmUgYSBmdW5jdGlvbi5cIik7aWYoISh0aGlzLl9taWRpSW50ZXJmYWNlRXZlbnRzLmluZGV4T2YodHlwZSk+PTApKXRocm93IG5ldyBUeXBlRXJyb3IoXCJUaGUgc3BlY2lmaWVkIGV2ZW50IHR5cGUgaXMgbm90IHN1cHBvcnRlZC5cIik7Zm9yKHZhciBvPTA7bzx0aGlzLl91c2VySGFuZGxlcnNbdHlwZV0ubGVuZ3RoO28rKylpZih0aGlzLl91c2VySGFuZGxlcnNbdHlwZV1bb109PT1saXN0ZW5lcilyZXR1cm4hMDtyZXR1cm4hMX0sV2ViTWlkaS5wcm90b3R5cGUucmVtb3ZlTGlzdGVuZXI9ZnVuY3Rpb24odHlwZSxsaXN0ZW5lcil7aWYoIXRoaXMuZW5hYmxlZCl0aHJvdyBuZXcgRXJyb3IoXCJXZWJNaWRpIG11c3QgYmUgZW5hYmxlZCBiZWZvcmUgcmVtb3ZpbmcgZXZlbnQgbGlzdGVuZXJzLlwiKTtpZih2b2lkIDAhPT1saXN0ZW5lciYmXCJmdW5jdGlvblwiIT10eXBlb2YgbGlzdGVuZXIpdGhyb3cgbmV3IFR5cGVFcnJvcihcIlRoZSAnbGlzdGVuZXInIHBhcmFtZXRlciBtdXN0IGJlIGEgZnVuY3Rpb24uXCIpO2lmKHRoaXMuX21pZGlJbnRlcmZhY2VFdmVudHMuaW5kZXhPZih0eXBlKT49MClpZihsaXN0ZW5lcilmb3IodmFyIG89MDtvPHRoaXMuX3VzZXJIYW5kbGVyc1t0eXBlXS5sZW5ndGg7bysrKXRoaXMuX3VzZXJIYW5kbGVyc1t0eXBlXVtvXT09PWxpc3RlbmVyJiZ0aGlzLl91c2VySGFuZGxlcnNbdHlwZV0uc3BsaWNlKG8sMSk7ZWxzZSB0aGlzLl91c2VySGFuZGxlcnNbdHlwZV09W107ZWxzZXtpZih2b2lkIDAhPT10eXBlKXRocm93IG5ldyBUeXBlRXJyb3IoXCJUaGUgc3BlY2lmaWVkIGV2ZW50IHR5cGUgaXMgbm90IHN1cHBvcnRlZC5cIik7dGhpcy5fcmVzZXRJbnRlcmZhY2VVc2VySGFuZGxlcnMoKX1yZXR1cm4gdGhpc30sV2ViTWlkaS5wcm90b3R5cGUuZ2V0SW5wdXRCeUlkPWZ1bmN0aW9uKGlkKXtpZighdGhpcy5lbmFibGVkKXRocm93IG5ldyBFcnJvcihcIldlYk1pZGkgaXMgbm90IGVuYWJsZWQuXCIpO2Zvcih2YXIgaT0wO2k8dGhpcy5pbnB1dHMubGVuZ3RoO2krKylpZih0aGlzLmlucHV0c1tpXS5pZD09PWlkKXJldHVybiB0aGlzLmlucHV0c1tpXTtyZXR1cm4hMX0sV2ViTWlkaS5wcm90b3R5cGUuZ2V0T3V0cHV0QnlJZD1mdW5jdGlvbihpZCl7aWYoIXRoaXMuZW5hYmxlZCl0aHJvdyBuZXcgRXJyb3IoXCJXZWJNaWRpIGlzIG5vdCBlbmFibGVkLlwiKTtmb3IodmFyIGk9MDtpPHRoaXMub3V0cHV0cy5sZW5ndGg7aSsrKWlmKHRoaXMub3V0cHV0c1tpXS5pZD09PWlkKXJldHVybiB0aGlzLm91dHB1dHNbaV07cmV0dXJuITF9LFdlYk1pZGkucHJvdG90eXBlLmdldElucHV0QnlOYW1lPWZ1bmN0aW9uKG5hbWUpe2lmKCF0aGlzLmVuYWJsZWQpdGhyb3cgbmV3IEVycm9yKFwiV2ViTWlkaSBpcyBub3QgZW5hYmxlZC5cIik7Zm9yKHZhciBpPTA7aTx0aGlzLmlucHV0cy5sZW5ndGg7aSsrKWlmKH50aGlzLmlucHV0c1tpXS5uYW1lLmluZGV4T2YobmFtZSkpcmV0dXJuIHRoaXMuaW5wdXRzW2ldO3JldHVybiExfSxXZWJNaWRpLnByb3RvdHlwZS5nZXRPY3RhdmU9ZnVuY3Rpb24obnVtYmVyKXtyZXR1cm4gbnVtYmVyPj0wJiYxMjc+PW51bWJlcj9NYXRoLmZsb29yKHBhcnNlSW50KG51bWJlcikvMTItMSktMTp2b2lkIDB9LFdlYk1pZGkucHJvdG90eXBlLmdldE91dHB1dEJ5TmFtZT1mdW5jdGlvbihuYW1lKXtpZighdGhpcy5lbmFibGVkKXRocm93IG5ldyBFcnJvcihcIldlYk1pZGkgaXMgbm90IGVuYWJsZWQuXCIpO2Zvcih2YXIgaT0wO2k8dGhpcy5vdXRwdXRzLmxlbmd0aDtpKyspaWYofnRoaXMub3V0cHV0c1tpXS5uYW1lLmluZGV4T2YobmFtZSkpcmV0dXJuIHRoaXMub3V0cHV0c1tpXTtyZXR1cm4hMX0sV2ViTWlkaS5wcm90b3R5cGUuZ3Vlc3NOb3RlTnVtYmVyPWZ1bmN0aW9uKGlucHV0KXt2YXIgb3V0cHV0PSExO2lmKGlucHV0JiZpbnB1dC50b0ZpeGVkJiZpbnB1dD49MCYmMTI3Pj1pbnB1dD9vdXRwdXQ9TWF0aC5yb3VuZChpbnB1dCk6cGFyc2VJbnQoaW5wdXQpPj0wJiZwYXJzZUludChpbnB1dCk8PTEyNz9vdXRwdXQ9cGFyc2VJbnQoaW5wdXQpOihcInN0cmluZ1wiPT10eXBlb2YgaW5wdXR8fGlucHV0IGluc3RhbmNlb2YgU3RyaW5nKSYmKG91dHB1dD10aGlzLm5vdGVOYW1lVG9OdW1iZXIoaW5wdXQpKSxvdXRwdXQ9PT0hMSl0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIG5vdGUgbnVtYmVyIChcIitpbnB1dCtcIikuXCIpO3JldHVybiBvdXRwdXR9LFdlYk1pZGkucHJvdG90eXBlLm5vdGVOYW1lVG9OdW1iZXI9ZnVuY3Rpb24obmFtZSl7XCJzdHJpbmdcIiE9dHlwZW9mIG5hbWUmJihuYW1lPVwiXCIpO3ZhciBtYXRjaGVzPW5hbWUubWF0Y2goLyhbQ0RFRkdBQl0pKCN7MCwyfXxiezAsMn0pKC0/XFxkKykvaSk7aWYoIW1hdGNoZXMpdGhyb3cgbmV3IFJhbmdlRXJyb3IoXCJJbnZhbGlkIG5vdGUgbmFtZS5cIik7dmFyIHNlbWl0b25lcz13bS5fc2VtaXRvbmVzW21hdGNoZXNbMV0udG9VcHBlckNhc2UoKV0sb2N0YXZlPXBhcnNlSW50KG1hdGNoZXNbM10pLHJlc3VsdD0xMioob2N0YXZlKzIpK3NlbWl0b25lcztpZihtYXRjaGVzWzJdLnRvTG93ZXJDYXNlKCkuaW5kZXhPZihcImJcIik+LTE/cmVzdWx0LT1tYXRjaGVzWzJdLmxlbmd0aDptYXRjaGVzWzJdLnRvTG93ZXJDYXNlKCkuaW5kZXhPZihcIiNcIik+LTEmJihyZXN1bHQrPW1hdGNoZXNbMl0ubGVuZ3RoKSwwPnNlbWl0b25lc3x8LTI+b2N0YXZlfHxvY3RhdmU+OHx8MD5yZXN1bHR8fHJlc3VsdD4xMjcpdGhyb3cgbmV3IFJhbmdlRXJyb3IoXCJJbnZhbGlkIG5vdGUgbmFtZSBvciBub3RlIG91dHNpZGUgdmFsaWQgcmFuZ2UuXCIpO3JldHVybiByZXN1bHR9LFdlYk1pZGkucHJvdG90eXBlLl91cGRhdGVJbnB1dHNBbmRPdXRwdXRzPWZ1bmN0aW9uKCl7dGhpcy5fdXBkYXRlSW5wdXRzKCksdGhpcy5fdXBkYXRlT3V0cHV0cygpfSxXZWJNaWRpLnByb3RvdHlwZS5fdXBkYXRlSW5wdXRzPWZ1bmN0aW9uKCl7Zm9yKHZhciBpPTA7aTx0aGlzLl9pbnB1dHMubGVuZ3RoO2krKyl7Zm9yKHZhciByZW1vdmU9ITAsdXBkYXRlZD10aGlzW1wiaW50ZXJmYWNlXCJdLmlucHV0cy52YWx1ZXMoKSxpbnB1dD11cGRhdGVkLm5leHQoKTtpbnB1dCYmIWlucHV0LmRvbmU7aW5wdXQ9dXBkYXRlZC5uZXh0KCkpaWYodGhpcy5faW5wdXRzW2ldLl9taWRpSW5wdXQ9PT1pbnB1dC52YWx1ZSl7cmVtb3ZlPSExO2JyZWFrfXJlbW92ZSYmdGhpcy5faW5wdXRzLnNwbGljZShpLDEpfXRoaXNbXCJpbnRlcmZhY2VcIl0uaW5wdXRzLmZvckVhY2goZnVuY3Rpb24obklucHV0KXtmb3IodmFyIGFkZD0hMCxqPTA7ajx0aGlzLl9pbnB1dHMubGVuZ3RoO2orKyl0aGlzLl9pbnB1dHNbal0uX21pZGlJbnB1dD09PW5JbnB1dCYmKGFkZD0hMSk7YWRkJiZ0aGlzLl9pbnB1dHMucHVzaCh0aGlzLl9jcmVhdGVJbnB1dChuSW5wdXQpKX0uYmluZCh0aGlzKSl9LFdlYk1pZGkucHJvdG90eXBlLl91cGRhdGVPdXRwdXRzPWZ1bmN0aW9uKCl7Zm9yKHZhciBpPTA7aTx0aGlzLl9vdXRwdXRzLmxlbmd0aDtpKyspe2Zvcih2YXIgcmVtb3ZlPSEwLHVwZGF0ZWQ9dGhpc1tcImludGVyZmFjZVwiXS5vdXRwdXRzLnZhbHVlcygpLG91dHB1dD11cGRhdGVkLm5leHQoKTtvdXRwdXQmJiFvdXRwdXQuZG9uZTtvdXRwdXQ9dXBkYXRlZC5uZXh0KCkpaWYodGhpcy5fb3V0cHV0c1tpXS5fbWlkaU91dHB1dD09PW91dHB1dC52YWx1ZSl7cmVtb3ZlPSExO2JyZWFrfXJlbW92ZSYmdGhpcy5fb3V0cHV0cy5zcGxpY2UoaSwxKX10aGlzW1wiaW50ZXJmYWNlXCJdLm91dHB1dHMuZm9yRWFjaChmdW5jdGlvbihuT3V0cHV0KXtmb3IodmFyIGFkZD0hMCxqPTA7ajx0aGlzLl9vdXRwdXRzLmxlbmd0aDtqKyspdGhpcy5fb3V0cHV0c1tqXS5fbWlkaU91dHB1dD09PW5PdXRwdXQmJihhZGQ9ITEpO2FkZCYmdGhpcy5fb3V0cHV0cy5wdXNoKHRoaXMuX2NyZWF0ZU91dHB1dChuT3V0cHV0KSl9LmJpbmQodGhpcykpfSxXZWJNaWRpLnByb3RvdHlwZS5fY3JlYXRlSW5wdXQ9ZnVuY3Rpb24obWlkaUlucHV0KXt2YXIgaW5wdXQ9bmV3IElucHV0KG1pZGlJbnB1dCk7cmV0dXJuIGlucHV0Ll9taWRpSW5wdXQub25taWRpbWVzc2FnZT1pbnB1dC5fb25NaWRpTWVzc2FnZS5iaW5kKGlucHV0KSxpbnB1dH0sV2ViTWlkaS5wcm90b3R5cGUuX2NyZWF0ZU91dHB1dD1mdW5jdGlvbihtaWRpT3V0cHV0KXt2YXIgb3V0cHV0PW5ldyBPdXRwdXQobWlkaU91dHB1dCk7cmV0dXJuIG91dHB1dC5fbWlkaU91dHB1dC5vbm1pZGltZXNzYWdlPW91dHB1dC5fb25NaWRpTWVzc2FnZS5iaW5kKG91dHB1dCksb3V0cHV0fSxXZWJNaWRpLnByb3RvdHlwZS5fb25JbnRlcmZhY2VTdGF0ZUNoYW5nZT1mdW5jdGlvbihlKXtpZih0aGlzLl9zdGF0ZUNoYW5nZVF1ZXVlLnB1c2goZSksIXRoaXMuX3Byb2Nlc3NpbmdTdGF0ZUNoYW5nZSl7Zm9yKHRoaXMuX3Byb2Nlc3NpbmdTdGF0ZUNoYW5nZT0hMDt0aGlzLl9zdGF0ZUNoYW5nZVF1ZXVlLmxlbmd0aD4wOyl0aGlzLl9wcm9jZXNzU3RhdGVDaGFuZ2UodGhpcy5fc3RhdGVDaGFuZ2VRdWV1ZS5zaGlmdCgpKTt0aGlzLl9wcm9jZXNzaW5nU3RhdGVDaGFuZ2U9ITF9fSxXZWJNaWRpLnByb3RvdHlwZS5fcHJvY2Vzc1N0YXRlQ2hhbmdlPWZ1bmN0aW9uKGUpe2lmKHRoaXMuX3VwZGF0ZUlucHV0c0FuZE91dHB1dHMoKSxudWxsIT09ZSl7dmFyIGV2ZW50PXt0aW1lc3RhbXA6ZS50aW1lU3RhbXAsdHlwZTplLnBvcnQuc3RhdGUsaWQ6ZS5wb3J0LmlkLG1hbnVmYWN0dXJlcjplLnBvcnQubWFudWZhY3R1cmVyLG5hbWU6ZS5wb3J0Lm5hbWV9O1wiY29ubmVjdGVkXCI9PT1lLnBvcnQuc3RhdGUmJihcIm91dHB1dFwiPT09ZS5wb3J0LnR5cGU/ZXZlbnQub3V0cHV0PXRoaXMuZ2V0T3V0cHV0QnlJZChlLnBvcnQuaWQpOlwiaW5wdXRcIj09PWUucG9ydC50eXBlJiYoZXZlbnQuaW5wdXQ9dGhpcy5nZXRJbnB1dEJ5SWQoZS5wb3J0LmlkKSkpLHRoaXMuX3VzZXJIYW5kbGVyc1tlLnBvcnQuc3RhdGVdLmZvckVhY2goZnVuY3Rpb24oaGFuZGxlcil7aGFuZGxlcihldmVudCl9KX19LFdlYk1pZGkucHJvdG90eXBlLl9yZXNldEludGVyZmFjZVVzZXJIYW5kbGVycz1mdW5jdGlvbigpe2Zvcih2YXIgaT0wO2k8dGhpcy5fbWlkaUludGVyZmFjZUV2ZW50cy5sZW5ndGg7aSsrKXRoaXMuX3VzZXJIYW5kbGVyc1t0aGlzLl9taWRpSW50ZXJmYWNlRXZlbnRzW2ldXT1bXX0sSW5wdXQucHJvdG90eXBlLmFkZExpc3RlbmVyPWZ1bmN0aW9uKHR5cGUsY2hhbm5lbCxsaXN0ZW5lcil7dmFyIHRoYXQ9dGhpcztpZih2b2lkIDA9PT1jaGFubmVsJiYoY2hhbm5lbD1cImFsbFwiKSxBcnJheS5pc0FycmF5KGNoYW5uZWwpfHwoY2hhbm5lbD1bY2hhbm5lbF0pLGNoYW5uZWwuZm9yRWFjaChmdW5jdGlvbihpdGVtKXtpZihcImFsbFwiIT09aXRlbSYmIShpdGVtPj0xJiYxNj49aXRlbSkpdGhyb3cgbmV3IFJhbmdlRXJyb3IoXCJUaGUgJ2NoYW5uZWwnIHBhcmFtZXRlciBpcyBpbnZhbGlkLlwiKX0pLFwiZnVuY3Rpb25cIiE9dHlwZW9mIGxpc3RlbmVyKXRocm93IG5ldyBUeXBlRXJyb3IoXCJUaGUgJ2xpc3RlbmVyJyBwYXJhbWV0ZXIgbXVzdCBiZSBhIGZ1bmN0aW9uLlwiKTtpZih3bS5NSURJX1NZU1RFTV9NRVNTQUdFU1t0eXBlXSl0aGlzLl91c2VySGFuZGxlcnMuc3lzdGVtW3R5cGVdfHwodGhpcy5fdXNlckhhbmRsZXJzLnN5c3RlbVt0eXBlXT1bXSksdGhpcy5fdXNlckhhbmRsZXJzLnN5c3RlbVt0eXBlXS5wdXNoKGxpc3RlbmVyKTtlbHNle2lmKCF3bS5NSURJX0NIQU5ORUxfTUVTU0FHRVNbdHlwZV0pdGhyb3cgbmV3IFR5cGVFcnJvcihcIlRoZSBzcGVjaWZpZWQgZXZlbnQgdHlwZSBpcyBub3Qgc3VwcG9ydGVkLlwiKTtpZihjaGFubmVsLmluZGV4T2YoXCJhbGxcIik+LTEpe2NoYW5uZWw9W107Zm9yKHZhciBqPTE7MTY+PWo7aisrKWNoYW5uZWwucHVzaChqKX10aGlzLl91c2VySGFuZGxlcnMuY2hhbm5lbFt0eXBlXXx8KHRoaXMuX3VzZXJIYW5kbGVycy5jaGFubmVsW3R5cGVdPVtdKSxjaGFubmVsLmZvckVhY2goZnVuY3Rpb24oY2gpe3RoYXQuX3VzZXJIYW5kbGVycy5jaGFubmVsW3R5cGVdW2NoXXx8KHRoYXQuX3VzZXJIYW5kbGVycy5jaGFubmVsW3R5cGVdW2NoXT1bXSksdGhhdC5fdXNlckhhbmRsZXJzLmNoYW5uZWxbdHlwZV1bY2hdLnB1c2gobGlzdGVuZXIpfSl9cmV0dXJuIHRoaXN9LElucHV0LnByb3RvdHlwZS5vbj1JbnB1dC5wcm90b3R5cGUuYWRkTGlzdGVuZXIsSW5wdXQucHJvdG90eXBlLmhhc0xpc3RlbmVyPWZ1bmN0aW9uKHR5cGUsY2hhbm5lbCxsaXN0ZW5lcil7dmFyIHRoYXQ9dGhpcztpZihcImZ1bmN0aW9uXCIhPXR5cGVvZiBsaXN0ZW5lcil0aHJvdyBuZXcgVHlwZUVycm9yKFwiVGhlICdsaXN0ZW5lcicgcGFyYW1ldGVyIG11c3QgYmUgYSBmdW5jdGlvbi5cIik7aWYodm9pZCAwPT09Y2hhbm5lbCYmKGNoYW5uZWw9XCJhbGxcIiksY2hhbm5lbC5jb25zdHJ1Y3RvciE9PUFycmF5JiYoY2hhbm5lbD1bY2hhbm5lbF0pLHdtLk1JRElfU1lTVEVNX01FU1NBR0VTW3R5cGVdKXtmb3IodmFyIG89MDtvPHRoaXMuX3VzZXJIYW5kbGVycy5zeXN0ZW1bdHlwZV0ubGVuZ3RoO28rKylpZih0aGlzLl91c2VySGFuZGxlcnMuc3lzdGVtW3R5cGVdW29dPT09bGlzdGVuZXIpcmV0dXJuITB9ZWxzZSBpZih3bS5NSURJX0NIQU5ORUxfTUVTU0FHRVNbdHlwZV0pe2lmKGNoYW5uZWwuaW5kZXhPZihcImFsbFwiKT4tMSl7Y2hhbm5lbD1bXTtmb3IodmFyIGo9MTsxNj49ajtqKyspY2hhbm5lbC5wdXNoKGopfXJldHVybiB0aGlzLl91c2VySGFuZGxlcnMuY2hhbm5lbFt0eXBlXT9jaGFubmVsLmV2ZXJ5KGZ1bmN0aW9uKGNoTnVtKXt2YXIgbGlzdGVuZXJzPXRoYXQuX3VzZXJIYW5kbGVycy5jaGFubmVsW3R5cGVdW2NoTnVtXTtyZXR1cm4gbGlzdGVuZXJzJiZsaXN0ZW5lcnMuaW5kZXhPZihsaXN0ZW5lcik+LTF9KTohMX1yZXR1cm4hMX0sSW5wdXQucHJvdG90eXBlLnJlbW92ZUxpc3RlbmVyPWZ1bmN0aW9uKHR5cGUsY2hhbm5lbCxsaXN0ZW5lcil7dmFyIHRoYXQ9dGhpcztpZih2b2lkIDAhPT1saXN0ZW5lciYmXCJmdW5jdGlvblwiIT10eXBlb2YgbGlzdGVuZXIpdGhyb3cgbmV3IFR5cGVFcnJvcihcIlRoZSAnbGlzdGVuZXInIHBhcmFtZXRlciBtdXN0IGJlIGEgZnVuY3Rpb24uXCIpO2lmKHZvaWQgMD09PWNoYW5uZWwmJihjaGFubmVsPVwiYWxsXCIpLGNoYW5uZWwuY29uc3RydWN0b3IhPT1BcnJheSYmKGNoYW5uZWw9W2NoYW5uZWxdKSx3bS5NSURJX1NZU1RFTV9NRVNTQUdFU1t0eXBlXSlpZih2b2lkIDA9PT1saXN0ZW5lcil0aGlzLl91c2VySGFuZGxlcnMuc3lzdGVtW3R5cGVdPVtdO2Vsc2UgZm9yKHZhciBvPTA7bzx0aGlzLl91c2VySGFuZGxlcnMuc3lzdGVtW3R5cGVdLmxlbmd0aDtvKyspdGhpcy5fdXNlckhhbmRsZXJzLnN5c3RlbVt0eXBlXVtvXT09PWxpc3RlbmVyJiZ0aGlzLl91c2VySGFuZGxlcnMuc3lzdGVtW3R5cGVdLnNwbGljZShvLDEpO2Vsc2UgaWYod20uTUlESV9DSEFOTkVMX01FU1NBR0VTW3R5cGVdKXtpZihjaGFubmVsLmluZGV4T2YoXCJhbGxcIik+LTEpe2NoYW5uZWw9W107Zm9yKHZhciBqPTE7MTY+PWo7aisrKWNoYW5uZWwucHVzaChqKX1pZighdGhpcy5fdXNlckhhbmRsZXJzLmNoYW5uZWxbdHlwZV0pcmV0dXJuIHRoaXM7Y2hhbm5lbC5mb3JFYWNoKGZ1bmN0aW9uKGNoTnVtKXt2YXIgbGlzdGVuZXJzPXRoYXQuX3VzZXJIYW5kbGVycy5jaGFubmVsW3R5cGVdW2NoTnVtXTtpZihsaXN0ZW5lcnMpaWYodm9pZCAwPT09bGlzdGVuZXIpdGhhdC5fdXNlckhhbmRsZXJzLmNoYW5uZWxbdHlwZV1bY2hOdW1dPVtdO2Vsc2UgZm9yKHZhciBsPTA7bDxsaXN0ZW5lcnMubGVuZ3RoO2wrKylsaXN0ZW5lcnNbbF09PT1saXN0ZW5lciYmbGlzdGVuZXJzLnNwbGljZShsLDEpfSl9ZWxzZXtpZih2b2lkIDAhPT10eXBlKXRocm93IG5ldyBUeXBlRXJyb3IoXCJUaGUgc3BlY2lmaWVkIGV2ZW50IHR5cGUgaXMgbm90IHN1cHBvcnRlZC5cIik7dGhpcy5faW5pdGlhbGl6ZVVzZXJIYW5kbGVycygpfXJldHVybiB0aGlzfSxJbnB1dC5wcm90b3R5cGUuX2luaXRpYWxpemVVc2VySGFuZGxlcnM9ZnVuY3Rpb24oKXtmb3IodmFyIHByb3AxIGluIHdtLk1JRElfQ0hBTk5FTF9NRVNTQUdFUyl3bS5NSURJX0NIQU5ORUxfTUVTU0FHRVMuaGFzT3duUHJvcGVydHkocHJvcDEpJiYodGhpcy5fdXNlckhhbmRsZXJzLmNoYW5uZWxbcHJvcDFdPXt9KTtmb3IodmFyIHByb3AyIGluIHdtLk1JRElfU1lTVEVNX01FU1NBR0VTKXdtLk1JRElfU1lTVEVNX01FU1NBR0VTLmhhc093blByb3BlcnR5KHByb3AyKSYmKHRoaXMuX3VzZXJIYW5kbGVycy5zeXN0ZW1bcHJvcDJdPVtdKX0sSW5wdXQucHJvdG90eXBlLl9vbk1pZGlNZXNzYWdlPWZ1bmN0aW9uKGUpe2UuZGF0YVswXTwyNDA/dGhpcy5fcGFyc2VDaGFubmVsRXZlbnQoZSk6ZS5kYXRhWzBdPD0yNTUmJnRoaXMuX3BhcnNlU3lzdGVtRXZlbnQoZSl9LElucHV0LnByb3RvdHlwZS5fcGFyc2VDaGFubmVsRXZlbnQ9ZnVuY3Rpb24oZSl7dmFyIGRhdGExLGRhdGEyLGNvbW1hbmQ9ZS5kYXRhWzBdPj40LGNoYW5uZWw9KDE1JmUuZGF0YVswXSkrMTtlLmRhdGEubGVuZ3RoPjEmJihkYXRhMT1lLmRhdGFbMV0sZGF0YTI9ZS5kYXRhLmxlbmd0aD4yP2UuZGF0YVsyXTp2b2lkIDApO3ZhciBldmVudD17dGFyZ2V0OnRoaXMsZGF0YTplLmRhdGEsdGltZXN0YW1wOmUudGltZVN0YW1wLGNoYW5uZWw6Y2hhbm5lbH07Y29tbWFuZD09PXdtLk1JRElfQ0hBTk5FTF9NRVNTQUdFUy5ub3Rlb2ZmfHxjb21tYW5kPT09d20uTUlESV9DSEFOTkVMX01FU1NBR0VTLm5vdGVvbiYmMD09PWRhdGEyPyhldmVudC50eXBlPVwibm90ZW9mZlwiLGV2ZW50Lm5vdGU9e251bWJlcjpkYXRhMSxuYW1lOndtLl9ub3Rlc1tkYXRhMSUxMl0sb2N0YXZlOndtLmdldE9jdGF2ZShkYXRhMSl9LGV2ZW50LnZlbG9jaXR5PWRhdGEyLzEyNyxldmVudC5yYXdWZWxvY2l0eT1kYXRhMik6Y29tbWFuZD09PXdtLk1JRElfQ0hBTk5FTF9NRVNTQUdFUy5ub3Rlb24/KGV2ZW50LnR5cGU9XCJub3Rlb25cIixldmVudC5ub3RlPXtudW1iZXI6ZGF0YTEsbmFtZTp3bS5fbm90ZXNbZGF0YTElMTJdLG9jdGF2ZTp3bS5nZXRPY3RhdmUoZGF0YTEpfSxldmVudC52ZWxvY2l0eT1kYXRhMi8xMjcsZXZlbnQucmF3VmVsb2NpdHk9ZGF0YTIpOmNvbW1hbmQ9PT13bS5NSURJX0NIQU5ORUxfTUVTU0FHRVMua2V5YWZ0ZXJ0b3VjaD8oZXZlbnQudHlwZT1cImtleWFmdGVydG91Y2hcIixldmVudC5ub3RlPXtudW1iZXI6ZGF0YTEsbmFtZTp3bS5fbm90ZXNbZGF0YTElMTJdLG9jdGF2ZTp3bS5nZXRPY3RhdmUoZGF0YTEpfSxldmVudC52YWx1ZT1kYXRhMi8xMjcpOmNvbW1hbmQ9PT13bS5NSURJX0NIQU5ORUxfTUVTU0FHRVMuY29udHJvbGNoYW5nZSYmZGF0YTE+PTAmJjExOT49ZGF0YTE/KGV2ZW50LnR5cGU9XCJjb250cm9sY2hhbmdlXCIsZXZlbnQuY29udHJvbGxlcj17bnVtYmVyOmRhdGExLG5hbWU6dGhpcy5nZXRDY05hbWVCeU51bWJlcihkYXRhMSl9LGV2ZW50LnZhbHVlPWRhdGEyKTpjb21tYW5kPT09d20uTUlESV9DSEFOTkVMX01FU1NBR0VTLmNoYW5uZWxtb2RlJiZkYXRhMT49MTIwJiYxMjc+PWRhdGExPyhldmVudC50eXBlPVwiY2hhbm5lbG1vZGVcIixldmVudC5jb250cm9sbGVyPXtudW1iZXI6ZGF0YTEsbmFtZTp0aGlzLmdldENoYW5uZWxNb2RlQnlOdW1iZXIoZGF0YTEpfSxldmVudC52YWx1ZT1kYXRhMik6Y29tbWFuZD09PXdtLk1JRElfQ0hBTk5FTF9NRVNTQUdFUy5wcm9ncmFtY2hhbmdlPyhldmVudC50eXBlPVwicHJvZ3JhbWNoYW5nZVwiLGV2ZW50LnZhbHVlPWRhdGExKTpjb21tYW5kPT09d20uTUlESV9DSEFOTkVMX01FU1NBR0VTLmNoYW5uZWxhZnRlcnRvdWNoPyhldmVudC50eXBlPVwiY2hhbm5lbGFmdGVydG91Y2hcIixldmVudC52YWx1ZT1kYXRhMS8xMjcpOmNvbW1hbmQ9PT13bS5NSURJX0NIQU5ORUxfTUVTU0FHRVMucGl0Y2hiZW5kPyhldmVudC50eXBlPVwicGl0Y2hiZW5kXCIsZXZlbnQudmFsdWU9KChkYXRhMjw8NykrZGF0YTEtODE5MikvODE5Mik6ZXZlbnQudHlwZT1cInVua25vd25jaGFubmVsbWVzc2FnZVwiLHRoaXMuX3VzZXJIYW5kbGVycy5jaGFubmVsW2V2ZW50LnR5cGVdJiZ0aGlzLl91c2VySGFuZGxlcnMuY2hhbm5lbFtldmVudC50eXBlXVtjaGFubmVsXSYmdGhpcy5fdXNlckhhbmRsZXJzLmNoYW5uZWxbZXZlbnQudHlwZV1bY2hhbm5lbF0uZm9yRWFjaChmdW5jdGlvbihjYWxsYmFjayl7Y2FsbGJhY2soZXZlbnQpfSl9LElucHV0LnByb3RvdHlwZS5nZXRDY05hbWVCeU51bWJlcj1mdW5jdGlvbihudW1iZXIpe2lmKG51bWJlcj1wYXJzZUludChudW1iZXIpLCEobnVtYmVyPj0wJiYxMTk+PW51bWJlcikpdGhyb3cgbmV3IFJhbmdlRXJyb3IoXCJUaGUgY29udHJvbCBjaGFuZ2UgbnVtYmVyIG11c3QgYmUgYmV0d2VlbiAwIGFuZCAxMTkuXCIpO2Zvcih2YXIgY2MgaW4gd20uTUlESV9DT05UUk9MX0NIQU5HRV9NRVNTQUdFUylpZihudW1iZXI9PT13bS5NSURJX0NPTlRST0xfQ0hBTkdFX01FU1NBR0VTW2NjXSlyZXR1cm4gY2M7cmV0dXJuIHZvaWQgMH0sSW5wdXQucHJvdG90eXBlLmdldENoYW5uZWxNb2RlQnlOdW1iZXI9ZnVuY3Rpb24obnVtYmVyKXtpZihudW1iZXI9cGFyc2VJbnQobnVtYmVyKSwhKG51bWJlcj49MTIwJiZzdGF0dXM8PTEyNykpdGhyb3cgbmV3IFJhbmdlRXJyb3IoXCJUaGUgY29udHJvbCBjaGFuZ2UgbnVtYmVyIG11c3QgYmUgYmV0d2VlbiAxMjAgYW5kIDEyNy5cIik7Zm9yKHZhciBjbSBpbiB3bS5NSURJX0NIQU5ORUxfTU9ERV9NRVNTQUdFUylpZihudW1iZXI9PT13bS5NSURJX0NIQU5ORUxfTU9ERV9NRVNTQUdFU1tjbV0pcmV0dXJuIGNtfSxJbnB1dC5wcm90b3R5cGUuX3BhcnNlU3lzdGVtRXZlbnQ9ZnVuY3Rpb24oZSl7dmFyIGNvbW1hbmQ9ZS5kYXRhWzBdLGV2ZW50PXt0YXJnZXQ6dGhpcyxkYXRhOmUuZGF0YSx0aW1lc3RhbXA6ZS50aW1lU3RhbXB9O2NvbW1hbmQ9PT13bS5NSURJX1NZU1RFTV9NRVNTQUdFUy5zeXNleD9ldmVudC50eXBlPVwic3lzZXhcIjpjb21tYW5kPT09d20uTUlESV9TWVNURU1fTUVTU0FHRVMudGltZWNvZGU/ZXZlbnQudHlwZT1cInRpbWVjb2RlXCI6Y29tbWFuZD09PXdtLk1JRElfU1lTVEVNX01FU1NBR0VTLnNvbmdwb3NpdGlvbj9ldmVudC50eXBlPVwic29uZ3Bvc2l0aW9uXCI6Y29tbWFuZD09PXdtLk1JRElfU1lTVEVNX01FU1NBR0VTLnNvbmdzZWxlY3Q/KGV2ZW50LnR5cGU9XCJzb25nc2VsZWN0XCIsZXZlbnQuc29uZz1lLmRhdGFbMV0pOmNvbW1hbmQ9PT13bS5NSURJX1NZU1RFTV9NRVNTQUdFUy50dW5pbmdyZXF1ZXN0P2V2ZW50LnR5cGU9XCJ0dW5pbmdyZXF1ZXN0XCI6Y29tbWFuZD09PXdtLk1JRElfU1lTVEVNX01FU1NBR0VTLmNsb2NrP2V2ZW50LnR5cGU9XCJjbG9ja1wiOmNvbW1hbmQ9PT13bS5NSURJX1NZU1RFTV9NRVNTQUdFUy5zdGFydD9ldmVudC50eXBlPVwic3RhcnRcIjpjb21tYW5kPT09d20uTUlESV9TWVNURU1fTUVTU0FHRVNbXCJjb250aW51ZVwiXT9ldmVudC50eXBlPVwiY29udGludWVcIjpjb21tYW5kPT09d20uTUlESV9TWVNURU1fTUVTU0FHRVMuc3RvcD9ldmVudC50eXBlPVwic3RvcFwiOmNvbW1hbmQ9PT13bS5NSURJX1NZU1RFTV9NRVNTQUdFUy5hY3RpdmVzZW5zaW5nP2V2ZW50LnR5cGU9XCJhY3RpdmVzZW5zaW5nXCI6Y29tbWFuZD09PXdtLk1JRElfU1lTVEVNX01FU1NBR0VTLnJlc2V0P2V2ZW50LnR5cGU9XCJyZXNldFwiOmV2ZW50LnR5cGU9XCJ1bmtub3duc3lzdGVtbWVzc2FnZVwiLHRoaXMuX3VzZXJIYW5kbGVycy5zeXN0ZW1bZXZlbnQudHlwZV0mJnRoaXMuX3VzZXJIYW5kbGVycy5zeXN0ZW1bZXZlbnQudHlwZV0uZm9yRWFjaChmdW5jdGlvbihjYWxsYmFjayl7Y2FsbGJhY2soZXZlbnQpfSl9LE91dHB1dC5wcm90b3R5cGUuc2VuZD1mdW5jdGlvbihzdGF0dXMsZGF0YSx0aW1lc3RhbXApe2lmKCEoc3RhdHVzPj0xMjgmJjI1NT49c3RhdHVzKSl0aHJvdyBuZXcgUmFuZ2VFcnJvcihcIlRoZSBzdGF0dXMgYnl0ZSBtdXN0IGJlIGFuIGludGVnZXIgYmV0d2VlbiAxMjggKDB4ODApIGFuZCAyNTUgKDB4RkYpLlwiKTtBcnJheS5pc0FycmF5KGRhdGEpfHwoZGF0YT1wYXJzZUludChkYXRhKT49MCYmcGFyc2VJbnQoZGF0YSk8PTEyNz9bcGFyc2VJbnQoZGF0YSldOltdKTt2YXIgbWVzc2FnZT1bc3RhdHVzXTtyZXR1cm4gZGF0YS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pe2lmKCEoaXRlbT49MCYmMjU1Pj1pdGVtKSl0aHJvdyBuZXcgUmFuZ2VFcnJvcihcIlRoZSBkYXRhIGJ5dGVzIG11c3QgYmUgaW50ZWdlcnMgYmV0d2VlbiAwICgweDAwKSBhbmQgMjU1ICgweEZGKS5cIik7bWVzc2FnZS5wdXNoKGl0ZW0pfSksdGhpcy5fbWlkaU91dHB1dC5zZW5kKG1lc3NhZ2UscGFyc2VGbG9hdCh0aW1lc3RhbXApfHwwKSx0aGlzfSxPdXRwdXQucHJvdG90eXBlLnNlbmRTeXNleD1mdW5jdGlvbihtYW51ZmFjdHVyZXIsZGF0YSxvcHRpb25zKXtpZighd20uc3lzZXhFbmFibGVkKXRocm93IG5ldyBFcnJvcihcIlN5c0V4IG1lc3NhZ2Ugc3VwcG9ydCBtdXN0IGZpcnN0IGJlIGFjdGl2YXRlZC5cIik7cmV0dXJuIG9wdGlvbnM9b3B0aW9uc3x8e30sbWFudWZhY3R1cmVyPVtdLmNvbmNhdChtYW51ZmFjdHVyZXIpLGRhdGEuZm9yRWFjaChmdW5jdGlvbihpdGVtKXtpZigwPml0ZW18fGl0ZW0+MTI3KXRocm93IG5ldyBSYW5nZUVycm9yKFwiVGhlIGRhdGEgYnl0ZXMgb2YgYSBTeXNFeCBtZXNzYWdlIG11c3QgYmUgaW50ZWdlcnMgYmV0d2VlbiAwICgweDAwKSBhbmQgMTI3ICgweDdGKS5cIil9KSxkYXRhPW1hbnVmYWN0dXJlci5jb25jYXQoZGF0YSx3bS5NSURJX1NZU1RFTV9NRVNTQUdFUy5zeXNleGVuZCksdGhpcy5zZW5kKHdtLk1JRElfU1lTVEVNX01FU1NBR0VTLnN5c2V4LGRhdGEsdGhpcy5fcGFyc2VUaW1lUGFyYW1ldGVyKG9wdGlvbnMudGltZSkpLHRoaXN9LE91dHB1dC5wcm90b3R5cGUuc2VuZFRpbWVjb2RlUXVhcnRlckZyYW1lPWZ1bmN0aW9uKHZhbHVlLG9wdGlvbnMpe3JldHVybiBvcHRpb25zPW9wdGlvbnN8fHt9LHRoaXMuc2VuZCh3bS5NSURJX1NZU1RFTV9NRVNTQUdFUy50aW1lY29kZSx2YWx1ZSx0aGlzLl9wYXJzZVRpbWVQYXJhbWV0ZXIob3B0aW9ucy50aW1lKSksdGhpc30sT3V0cHV0LnByb3RvdHlwZS5zZW5kU29uZ1Bvc2l0aW9uPWZ1bmN0aW9uKHZhbHVlLG9wdGlvbnMpe3ZhbHVlPXBhcnNlSW50KHZhbHVlKXx8MCxvcHRpb25zPW9wdGlvbnN8fHt9O3ZhciBtc2I9dmFsdWU+PjcmMTI3LGxzYj0xMjcmdmFsdWU7cmV0dXJuIHRoaXMuc2VuZCh3bS5NSURJX1NZU1RFTV9NRVNTQUdFUy5zb25ncG9zaXRpb24sW21zYixsc2JdLHRoaXMuX3BhcnNlVGltZVBhcmFtZXRlcihvcHRpb25zLnRpbWUpKSx0aGlzfSxPdXRwdXQucHJvdG90eXBlLnNlbmRTb25nU2VsZWN0PWZ1bmN0aW9uKHZhbHVlLG9wdGlvbnMpe2lmKHZhbHVlPXBhcnNlSW50KHZhbHVlKSxvcHRpb25zPW9wdGlvbnN8fHt9LCEodmFsdWU+PTAmJjEyNz49dmFsdWUpKXRocm93IG5ldyBSYW5nZUVycm9yKFwiVGhlIHNvbmcgbnVtYmVyIG11c3QgYmUgYmV0d2VlbiAwIGFuZCAxMjcuXCIpO3JldHVybiB0aGlzLnNlbmQod20uTUlESV9TWVNURU1fTUVTU0FHRVMuc29uZ3NlbGVjdCxbdmFsdWVdLHRoaXMuX3BhcnNlVGltZVBhcmFtZXRlcihvcHRpb25zLnRpbWUpKSx0aGlzfSxPdXRwdXQucHJvdG90eXBlLnNlbmRUdW5pbmdSZXF1ZXN0PWZ1bmN0aW9uKG9wdGlvbnMpe3JldHVybiBvcHRpb25zPW9wdGlvbnN8fHt9LHRoaXMuc2VuZCh3bS5NSURJX1NZU1RFTV9NRVNTQUdFUy50dW5pbmdyZXF1ZXN0LHZvaWQgMCx0aGlzLl9wYXJzZVRpbWVQYXJhbWV0ZXIob3B0aW9ucy50aW1lKSksdGhpc30sT3V0cHV0LnByb3RvdHlwZS5zZW5kQ2xvY2s9ZnVuY3Rpb24ob3B0aW9ucyl7cmV0dXJuIG9wdGlvbnM9b3B0aW9uc3x8e30sdGhpcy5zZW5kKHdtLk1JRElfU1lTVEVNX01FU1NBR0VTLmNsb2NrLHZvaWQgMCx0aGlzLl9wYXJzZVRpbWVQYXJhbWV0ZXIob3B0aW9ucy50aW1lKSksdGhpc30sT3V0cHV0LnByb3RvdHlwZS5zZW5kU3RhcnQ9ZnVuY3Rpb24ob3B0aW9ucyl7cmV0dXJuIG9wdGlvbnM9b3B0aW9uc3x8e30sdGhpcy5zZW5kKHdtLk1JRElfU1lTVEVNX01FU1NBR0VTLnN0YXJ0LHZvaWQgMCx0aGlzLl9wYXJzZVRpbWVQYXJhbWV0ZXIob3B0aW9ucy50aW1lKSksdGhpc30sT3V0cHV0LnByb3RvdHlwZS5zZW5kQ29udGludWU9ZnVuY3Rpb24ob3B0aW9ucyl7cmV0dXJuIG9wdGlvbnM9b3B0aW9uc3x8e30sdGhpcy5zZW5kKHdtLk1JRElfU1lTVEVNX01FU1NBR0VTW1wiY29udGludWVcIl0sdm9pZCAwLHRoaXMuX3BhcnNlVGltZVBhcmFtZXRlcihvcHRpb25zLnRpbWUpKSx0aGlzfSxPdXRwdXQucHJvdG90eXBlLnNlbmRTdG9wPWZ1bmN0aW9uKG9wdGlvbnMpe3JldHVybiBvcHRpb25zPW9wdGlvbnN8fHt9LHRoaXMuc2VuZCh3bS5NSURJX1NZU1RFTV9NRVNTQUdFUy5zdG9wLHZvaWQgMCx0aGlzLl9wYXJzZVRpbWVQYXJhbWV0ZXIob3B0aW9ucy50aW1lKSksdGhpc30sT3V0cHV0LnByb3RvdHlwZS5zZW5kQWN0aXZlU2Vuc2luZz1mdW5jdGlvbihvcHRpb25zKXtyZXR1cm4gb3B0aW9ucz1vcHRpb25zfHx7fSx0aGlzLnNlbmQod20uTUlESV9TWVNURU1fTUVTU0FHRVMuYWN0aXZlc2Vuc2luZyx2b2lkIDAsdGhpcy5fcGFyc2VUaW1lUGFyYW1ldGVyKG9wdGlvbnMudGltZSkpLHRoaXN9LE91dHB1dC5wcm90b3R5cGUuc2VuZFJlc2V0PWZ1bmN0aW9uKG9wdGlvbnMpe3JldHVybiBvcHRpb25zPW9wdGlvbnN8fHt9LHRoaXMuc2VuZCh3bS5NSURJX1NZU1RFTV9NRVNTQUdFUy5yZXNldCx2b2lkIDAsdGhpcy5fcGFyc2VUaW1lUGFyYW1ldGVyKG9wdGlvbnMudGltZSkpLHRoaXN9LE91dHB1dC5wcm90b3R5cGUuc3RvcE5vdGU9ZnVuY3Rpb24obm90ZSxjaGFubmVsLG9wdGlvbnMpe2lmKFwiYWxsXCI9PT1ub3RlKXJldHVybiB0aGlzLnNlbmRDaGFubmVsTW9kZShcImFsbG5vdGVzb2ZmXCIsMCxjaGFubmVsLG9wdGlvbnMpO3ZhciBuVmVsb2NpdHk9NjQ7cmV0dXJuIG9wdGlvbnM9b3B0aW9uc3x8e30sb3B0aW9ucy52ZWxvY2l0eT1wYXJzZUZsb2F0KG9wdGlvbnMudmVsb2NpdHkpLG9wdGlvbnMucmF3VmVsb2NpdHk/IWlzTmFOKG9wdGlvbnMudmVsb2NpdHkpJiZvcHRpb25zLnZlbG9jaXR5Pj0wJiZvcHRpb25zLnZlbG9jaXR5PD0xMjcmJihuVmVsb2NpdHk9b3B0aW9ucy52ZWxvY2l0eSk6IWlzTmFOKG9wdGlvbnMudmVsb2NpdHkpJiZvcHRpb25zLnZlbG9jaXR5Pj0wJiZvcHRpb25zLnZlbG9jaXR5PD0xJiYoblZlbG9jaXR5PTEyNypvcHRpb25zLnZlbG9jaXR5KSx0aGlzLl9jb252ZXJ0Tm90ZVRvQXJyYXkobm90ZSkuZm9yRWFjaChmdW5jdGlvbihpdGVtKXt0aGlzLl9jb252ZXJ0Q2hhbm5lbFRvQXJyYXkoY2hhbm5lbCkuZm9yRWFjaChmdW5jdGlvbihjaCl7dGhpcy5zZW5kKCh3bS5NSURJX0NIQU5ORUxfTUVTU0FHRVMubm90ZW9mZjw8NCkrKGNoLTEpLFtpdGVtLE1hdGgucm91bmQoblZlbG9jaXR5KV0sdGhpcy5fcGFyc2VUaW1lUGFyYW1ldGVyKG9wdGlvbnMudGltZSkpfS5iaW5kKHRoaXMpKX0uYmluZCh0aGlzKSksdGhpc30sT3V0cHV0LnByb3RvdHlwZS5wbGF5Tm90ZT1mdW5jdGlvbihub3RlLGNoYW5uZWwsb3B0aW9ucyl7dmFyIG5WZWxvY2l0eT02NDtpZihvcHRpb25zPW9wdGlvbnN8fHt9LG9wdGlvbnMudmVsb2NpdHk9cGFyc2VGbG9hdChvcHRpb25zLnZlbG9jaXR5KSxvcHRpb25zLnJhd1ZlbG9jaXR5PyFpc05hTihvcHRpb25zLnZlbG9jaXR5KSYmb3B0aW9ucy52ZWxvY2l0eT49MCYmb3B0aW9ucy52ZWxvY2l0eTw9MTI3JiYoblZlbG9jaXR5PW9wdGlvbnMudmVsb2NpdHkpOiFpc05hTihvcHRpb25zLnZlbG9jaXR5KSYmb3B0aW9ucy52ZWxvY2l0eT49MCYmb3B0aW9ucy52ZWxvY2l0eTw9MSYmKG5WZWxvY2l0eT0xMjcqb3B0aW9ucy52ZWxvY2l0eSksb3B0aW9ucy50aW1lPXRoaXMuX3BhcnNlVGltZVBhcmFtZXRlcihvcHRpb25zLnRpbWUpLHRoaXMuX2NvbnZlcnROb3RlVG9BcnJheShub3RlKS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pe3RoaXMuX2NvbnZlcnRDaGFubmVsVG9BcnJheShjaGFubmVsKS5mb3JFYWNoKGZ1bmN0aW9uKGNoKXt0aGlzLnNlbmQoKHdtLk1JRElfQ0hBTk5FTF9NRVNTQUdFUy5ub3Rlb248PDQpKyhjaC0xKSxbaXRlbSxNYXRoLnJvdW5kKG5WZWxvY2l0eSldLG9wdGlvbnMudGltZSl9LmJpbmQodGhpcykpfS5iaW5kKHRoaXMpKSxvcHRpb25zLmR1cmF0aW9uPXBhcnNlRmxvYXQob3B0aW9ucy5kdXJhdGlvbiksb3B0aW9ucy5kdXJhdGlvbil7b3B0aW9ucy5kdXJhdGlvbjw9MCYmKG9wdGlvbnMuZHVyYXRpb249MCk7dmFyIG5SZWxlYXNlPTY0O29wdGlvbnMucmVsZWFzZT1wYXJzZUZsb2F0KG9wdGlvbnMucmVsZWFzZSksb3B0aW9ucy5yYXdWZWxvY2l0eT8haXNOYU4ob3B0aW9ucy5yZWxlYXNlKSYmb3B0aW9ucy5yZWxlYXNlPj0wJiZvcHRpb25zLnJlbGVhc2U8PTEyNyYmKG5SZWxlYXNlPW9wdGlvbnMucmVsZWFzZSk6IWlzTmFOKG9wdGlvbnMucmVsZWFzZSkmJm9wdGlvbnMucmVsZWFzZT49MCYmb3B0aW9ucy5yZWxlYXNlPD0xJiYoblJlbGVhc2U9MTI3Km9wdGlvbnMucmVsZWFzZSksdGhpcy5fY29udmVydE5vdGVUb0FycmF5KG5vdGUpLmZvckVhY2goZnVuY3Rpb24oaXRlbSl7dGhpcy5fY29udmVydENoYW5uZWxUb0FycmF5KGNoYW5uZWwpLmZvckVhY2goZnVuY3Rpb24oY2gpe3RoaXMuc2VuZCgod20uTUlESV9DSEFOTkVMX01FU1NBR0VTLm5vdGVvZmY8PDQpKyhjaC0xKSxbaXRlbSxNYXRoLnJvdW5kKG5SZWxlYXNlKV0sKG9wdGlvbnMudGltZXx8d20udGltZSkrb3B0aW9ucy5kdXJhdGlvbil9LmJpbmQodGhpcykpfS5iaW5kKHRoaXMpKX1yZXR1cm4gdGhpc30sT3V0cHV0LnByb3RvdHlwZS5zZW5kS2V5QWZ0ZXJ0b3VjaD1mdW5jdGlvbihub3RlLGNoYW5uZWwscHJlc3N1cmUsb3B0aW9ucyl7dmFyIHRoYXQ9dGhpcztpZihvcHRpb25zPW9wdGlvbnN8fHt9LDE+Y2hhbm5lbHx8Y2hhbm5lbD4xNil0aHJvdyBuZXcgUmFuZ2VFcnJvcihcIlRoZSBjaGFubmVsIG11c3QgYmUgYmV0d2VlbiAxIGFuZCAxNi5cIik7cHJlc3N1cmU9cGFyc2VGbG9hdChwcmVzc3VyZSksKGlzTmFOKHByZXNzdXJlKXx8MD5wcmVzc3VyZXx8cHJlc3N1cmU+MSkmJihwcmVzc3VyZT0uNSk7dmFyIG5QcmVzc3VyZT1NYXRoLnJvdW5kKDEyNypwcmVzc3VyZSk7cmV0dXJuIHRoaXMuX2NvbnZlcnROb3RlVG9BcnJheShub3RlKS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pe3RoYXQuX2NvbnZlcnRDaGFubmVsVG9BcnJheShjaGFubmVsKS5mb3JFYWNoKGZ1bmN0aW9uKGNoKXt0aGF0LnNlbmQoKHdtLk1JRElfQ0hBTk5FTF9NRVNTQUdFUy5rZXlhZnRlcnRvdWNoPDw0KSsoY2gtMSksW2l0ZW0sblByZXNzdXJlXSx0aGF0Ll9wYXJzZVRpbWVQYXJhbWV0ZXIob3B0aW9ucy50aW1lKSl9KX0pLHRoaXN9LE91dHB1dC5wcm90b3R5cGUuc2VuZENvbnRyb2xDaGFuZ2U9ZnVuY3Rpb24oY29udHJvbGxlcix2YWx1ZSxjaGFubmVsLG9wdGlvbnMpe2lmKG9wdGlvbnM9b3B0aW9uc3x8e30sXCJzdHJpbmdcIj09dHlwZW9mIGNvbnRyb2xsZXIpe2lmKGNvbnRyb2xsZXI9d20uTUlESV9DT05UUk9MX0NIQU5HRV9NRVNTQUdFU1tjb250cm9sbGVyXSwhY29udHJvbGxlcil0aHJvdyBuZXcgVHlwZUVycm9yKFwiSW52YWxpZCBjb250cm9sbGVyIG5hbWUuXCIpfWVsc2UgaWYoY29udHJvbGxlcj1wYXJzZUludChjb250cm9sbGVyKSwhKGNvbnRyb2xsZXI+PTAmJjExOT49Y29udHJvbGxlcikpdGhyb3cgbmV3IFJhbmdlRXJyb3IoXCJDb250cm9sbGVyIG51bWJlcnMgbXVzdCBiZSBiZXR3ZWVuIDAgYW5kIDExOS5cIik7aWYodmFsdWU9cGFyc2VJbnQodmFsdWUpfHwwLCEodmFsdWU+PTAmJjEyNz49dmFsdWUpKXRocm93IG5ldyBSYW5nZUVycm9yKFwiQ29udHJvbGxlciB2YWx1ZSBtdXN0IGJlIGJldHdlZW4gMCBhbmQgMTI3LlwiKTtyZXR1cm4gdGhpcy5fY29udmVydENoYW5uZWxUb0FycmF5KGNoYW5uZWwpLmZvckVhY2goZnVuY3Rpb24oY2gpe3RoaXMuc2VuZCgod20uTUlESV9DSEFOTkVMX01FU1NBR0VTLmNvbnRyb2xjaGFuZ2U8PDQpKyhjaC0xKSxbY29udHJvbGxlcix2YWx1ZV0sdGhpcy5fcGFyc2VUaW1lUGFyYW1ldGVyKG9wdGlvbnMudGltZSkpfS5iaW5kKHRoaXMpKSx0aGlzfSxPdXRwdXQucHJvdG90eXBlLl9zZWxlY3RSZWdpc3RlcmVkUGFyYW1ldGVyPWZ1bmN0aW9uKHBhcmFtZXRlcixjaGFubmVsLHRpbWUpe3ZhciB0aGF0PXRoaXM7aWYocGFyYW1ldGVyWzBdPXBhcnNlSW50KHBhcmFtZXRlclswXSksIShwYXJhbWV0ZXJbMF0+PTAmJnBhcmFtZXRlclswXTw9MTI3KSl0aHJvdyBuZXcgUmFuZ2VFcnJvcihcIlRoZSBjb250cm9sNjUgdmFsdWUgbXVzdCBiZSBiZXR3ZWVuIDAgYW5kIDEyN1wiKTtpZihwYXJhbWV0ZXJbMV09cGFyc2VJbnQocGFyYW1ldGVyWzFdKSwhKHBhcmFtZXRlclsxXT49MCYmcGFyYW1ldGVyWzFdPD0xMjcpKXRocm93IG5ldyBSYW5nZUVycm9yKFwiVGhlIGNvbnRyb2w2NCB2YWx1ZSBtdXN0IGJlIGJldHdlZW4gMCBhbmQgMTI3XCIpO3JldHVybiB0aGlzLl9jb252ZXJ0Q2hhbm5lbFRvQXJyYXkoY2hhbm5lbCkuZm9yRWFjaChmdW5jdGlvbihjaCl7dGhhdC5zZW5kQ29udHJvbENoYW5nZSgxMDEscGFyYW1ldGVyWzBdLGNoYW5uZWwse3RpbWU6dGltZX0pLHRoYXQuc2VuZENvbnRyb2xDaGFuZ2UoMTAwLHBhcmFtZXRlclsxXSxjaGFubmVsLHt0aW1lOnRpbWV9KX0pLHRoaXN9LE91dHB1dC5wcm90b3R5cGUuX3NlbGVjdE5vblJlZ2lzdGVyZWRQYXJhbWV0ZXI9ZnVuY3Rpb24ocGFyYW1ldGVyLGNoYW5uZWwsdGltZSl7dmFyIHRoYXQ9dGhpcztpZihwYXJhbWV0ZXJbMF09cGFyc2VJbnQocGFyYW1ldGVyWzBdKSwhKHBhcmFtZXRlclswXT49MCYmcGFyYW1ldGVyWzBdPD0xMjcpKXRocm93IG5ldyBSYW5nZUVycm9yKFwiVGhlIGNvbnRyb2w2MyB2YWx1ZSBtdXN0IGJlIGJldHdlZW4gMCBhbmQgMTI3XCIpO2lmKHBhcmFtZXRlclsxXT1wYXJzZUludChwYXJhbWV0ZXJbMV0pLCEocGFyYW1ldGVyWzFdPj0wJiZwYXJhbWV0ZXJbMV08PTEyNykpdGhyb3cgbmV3IFJhbmdlRXJyb3IoXCJUaGUgY29udHJvbDYyIHZhbHVlIG11c3QgYmUgYmV0d2VlbiAwIGFuZCAxMjdcIik7cmV0dXJuIHRoaXMuX2NvbnZlcnRDaGFubmVsVG9BcnJheShjaGFubmVsKS5mb3JFYWNoKGZ1bmN0aW9uKGNoKXt0aGF0LnNlbmRDb250cm9sQ2hhbmdlKDk5LHBhcmFtZXRlclswXSxjaGFubmVsLHt0aW1lOnRpbWV9KSx0aGF0LnNlbmRDb250cm9sQ2hhbmdlKDk4LHBhcmFtZXRlclsxXSxjaGFubmVsLHt0aW1lOnRpbWV9KX0pLHRoaXN9LE91dHB1dC5wcm90b3R5cGUuX3NldEN1cnJlbnRSZWdpc3RlcmVkUGFyYW1ldGVyPWZ1bmN0aW9uKGRhdGEsY2hhbm5lbCx0aW1lKXt2YXIgdGhhdD10aGlzO2lmKGRhdGE9W10uY29uY2F0KGRhdGEpLGRhdGFbMF09cGFyc2VJbnQoZGF0YVswXSksIShkYXRhWzBdPj0wJiZkYXRhWzBdPD0xMjcpKXRocm93IG5ldyBSYW5nZUVycm9yKFwiVGhlIG1zYiB2YWx1ZSBtdXN0IGJlIGJldHdlZW4gMCBhbmQgMTI3XCIpO3JldHVybiB0aGlzLl9jb252ZXJ0Q2hhbm5lbFRvQXJyYXkoY2hhbm5lbCkuZm9yRWFjaChmdW5jdGlvbihjaCl7dGhhdC5zZW5kQ29udHJvbENoYW5nZSg2LGRhdGFbMF0sY2hhbm5lbCx7dGltZTp0aW1lfSl9KSxkYXRhWzFdPXBhcnNlSW50KGRhdGFbMV0pLGRhdGFbMV0+PTAmJmRhdGFbMV08PTEyNyYmdGhpcy5fY29udmVydENoYW5uZWxUb0FycmF5KGNoYW5uZWwpLmZvckVhY2goZnVuY3Rpb24oY2gpe3RoYXQuc2VuZENvbnRyb2xDaGFuZ2UoMzgsZGF0YVsxXSxjaGFubmVsLHt0aW1lOnRpbWV9KX0pLHRoaXN9LE91dHB1dC5wcm90b3R5cGUuX2Rlc2VsZWN0UmVnaXN0ZXJlZFBhcmFtZXRlcj1mdW5jdGlvbihjaGFubmVsLHRpbWUpe3ZhciB0aGF0PXRoaXM7cmV0dXJuIHRoaXMuX2NvbnZlcnRDaGFubmVsVG9BcnJheShjaGFubmVsKS5mb3JFYWNoKGZ1bmN0aW9uKGNoKXt0aGF0LnNlbmRDb250cm9sQ2hhbmdlKDEwMSwxMjcsY2hhbm5lbCx7dGltZTp0aW1lfSksdGhhdC5zZW5kQ29udHJvbENoYW5nZSgxMDAsMTI3LGNoYW5uZWwse3RpbWU6dGltZX0pfSksdGhpc30sT3V0cHV0LnByb3RvdHlwZS5zZXRSZWdpc3RlcmVkUGFyYW1ldGVyPWZ1bmN0aW9uKHBhcmFtZXRlcixkYXRhLGNoYW5uZWwsb3B0aW9ucyl7dmFyIHRoYXQ9dGhpcztpZihvcHRpb25zPW9wdGlvbnN8fHt9LCFBcnJheS5pc0FycmF5KHBhcmFtZXRlcikpe2lmKCF3bS5NSURJX1JFR0lTVEVSRURfUEFSQU1FVEVSW3BhcmFtZXRlcl0pdGhyb3cgbmV3IEVycm9yKFwiVGhlIHNwZWNpZmllZCBwYXJhbWV0ZXIgaXMgbm90IGF2YWlsYWJsZS5cIik7cGFyYW1ldGVyPXdtLk1JRElfUkVHSVNURVJFRF9QQVJBTUVURVJbcGFyYW1ldGVyXX1yZXR1cm4gdGhpcy5fY29udmVydENoYW5uZWxUb0FycmF5KGNoYW5uZWwpLmZvckVhY2goZnVuY3Rpb24oY2gpe3RoYXQuX3NlbGVjdFJlZ2lzdGVyZWRQYXJhbWV0ZXIocGFyYW1ldGVyLGNoYW5uZWwsb3B0aW9ucy50aW1lKSx0aGF0Ll9zZXRDdXJyZW50UmVnaXN0ZXJlZFBhcmFtZXRlcihkYXRhLGNoYW5uZWwsb3B0aW9ucy50aW1lKSx0aGF0Ll9kZXNlbGVjdFJlZ2lzdGVyZWRQYXJhbWV0ZXIoY2hhbm5lbCxvcHRpb25zLnRpbWUpfSksdGhpc30sT3V0cHV0LnByb3RvdHlwZS5zZXROb25SZWdpc3RlcmVkUGFyYW1ldGVyPWZ1bmN0aW9uKHBhcmFtZXRlcixkYXRhLGNoYW5uZWwsb3B0aW9ucyl7dmFyIHRoYXQ9dGhpcztpZihvcHRpb25zPW9wdGlvbnN8fHt9LCEocGFyYW1ldGVyWzBdPj0wJiZwYXJhbWV0ZXJbMF08PTEyNyYmcGFyYW1ldGVyWzFdPj0wJiZwYXJhbWV0ZXJbMV08PTEyNykpdGhyb3cgbmV3IEVycm9yKFwiUG9zaXRpb24gMCBhbmQgMSBvZiB0aGUgMi1wb3NpdGlvbiBwYXJhbWV0ZXIgYXJyYXkgbXVzdCBib3RoIGJlIGJldHdlZW4gMCBhbmQgMTI3LlwiKTtyZXR1cm4gZGF0YT1bXS5jb25jYXQoZGF0YSksdGhpcy5fY29udmVydENoYW5uZWxUb0FycmF5KGNoYW5uZWwpLmZvckVhY2goZnVuY3Rpb24oY2gpe3RoYXQuX3NlbGVjdE5vblJlZ2lzdGVyZWRQYXJhbWV0ZXIocGFyYW1ldGVyLGNoYW5uZWwsb3B0aW9ucy50aW1lKSx0aGF0Ll9zZXRDdXJyZW50UmVnaXN0ZXJlZFBhcmFtZXRlcihkYXRhLGNoYW5uZWwsb3B0aW9ucy50aW1lKSx0aGF0Ll9kZXNlbGVjdFJlZ2lzdGVyZWRQYXJhbWV0ZXIoY2hhbm5lbCxvcHRpb25zLnRpbWUpfSksdGhpc30sT3V0cHV0LnByb3RvdHlwZS5pbmNyZW1lbnRSZWdpc3RlcmVkUGFyYW1ldGVyPWZ1bmN0aW9uKHBhcmFtZXRlcixjaGFubmVsLG9wdGlvbnMpe3ZhciB0aGF0PXRoaXM7aWYob3B0aW9ucz1vcHRpb25zfHx7fSwhQXJyYXkuaXNBcnJheShwYXJhbWV0ZXIpKXtpZighd20uTUlESV9SRUdJU1RFUkVEX1BBUkFNRVRFUltwYXJhbWV0ZXJdKXRocm93IG5ldyBFcnJvcihcIlRoZSBzcGVjaWZpZWQgcGFyYW1ldGVyIGlzIG5vdCBhdmFpbGFibGUuXCIpO3BhcmFtZXRlcj13bS5NSURJX1JFR0lTVEVSRURfUEFSQU1FVEVSW3BhcmFtZXRlcl19cmV0dXJuIHRoaXMuX2NvbnZlcnRDaGFubmVsVG9BcnJheShjaGFubmVsKS5mb3JFYWNoKGZ1bmN0aW9uKGNoKXt0aGF0Ll9zZWxlY3RSZWdpc3RlcmVkUGFyYW1ldGVyKHBhcmFtZXRlcixjaGFubmVsLG9wdGlvbnMudGltZSksdGhhdC5zZW5kQ29udHJvbENoYW5nZSg5NiwwLGNoYW5uZWwse3RpbWU6b3B0aW9ucy50aW1lfSksdGhhdC5fZGVzZWxlY3RSZWdpc3RlcmVkUGFyYW1ldGVyKGNoYW5uZWwsb3B0aW9ucy50aW1lKX0pLHRoaXN9LE91dHB1dC5wcm90b3R5cGUuZGVjcmVtZW50UmVnaXN0ZXJlZFBhcmFtZXRlcj1mdW5jdGlvbihwYXJhbWV0ZXIsY2hhbm5lbCxvcHRpb25zKXtpZihvcHRpb25zPW9wdGlvbnN8fHt9LCFBcnJheS5pc0FycmF5KHBhcmFtZXRlcikpe2lmKCF3bS5NSURJX1JFR0lTVEVSRURfUEFSQU1FVEVSW3BhcmFtZXRlcl0pdGhyb3cgbmV3IFR5cGVFcnJvcihcIlRoZSBzcGVjaWZpZWQgcGFyYW1ldGVyIGlzIG5vdCBhdmFpbGFibGUuXCIpO3BhcmFtZXRlcj13bS5NSURJX1JFR0lTVEVSRURfUEFSQU1FVEVSW3BhcmFtZXRlcl19cmV0dXJuIHRoaXMuX2NvbnZlcnRDaGFubmVsVG9BcnJheShjaGFubmVsKS5mb3JFYWNoKGZ1bmN0aW9uKGNoKXt0aGlzLl9zZWxlY3RSZWdpc3RlcmVkUGFyYW1ldGVyKHBhcmFtZXRlcixjaGFubmVsLG9wdGlvbnMudGltZSksdGhpcy5zZW5kQ29udHJvbENoYW5nZSg5NywwLGNoYW5uZWwse3RpbWU6b3B0aW9ucy50aW1lfSksdGhpcy5fZGVzZWxlY3RSZWdpc3RlcmVkUGFyYW1ldGVyKGNoYW5uZWwsb3B0aW9ucy50aW1lKX0uYmluZCh0aGlzKSksdGhpc30sT3V0cHV0LnByb3RvdHlwZS5zZXRQaXRjaEJlbmRSYW5nZT1mdW5jdGlvbihzZW1pdG9uZXMsY2VudHMsY2hhbm5lbCxvcHRpb25zKXt2YXIgdGhhdD10aGlzO2lmKG9wdGlvbnM9b3B0aW9uc3x8e30sc2VtaXRvbmVzPXBhcnNlSW50KHNlbWl0b25lcyl8fDAsIShzZW1pdG9uZXM+PTAmJjEyNz49c2VtaXRvbmVzKSl0aHJvdyBuZXcgUmFuZ2VFcnJvcihcIlRoZSBzZW1pdG9uZXMgdmFsdWUgbXVzdCBiZSBiZXR3ZWVuIDAgYW5kIDEyN1wiKTtpZihjZW50cz1wYXJzZUludChjZW50cyl8fDAsIShjZW50cz49MCYmMTI3Pj1jZW50cykpdGhyb3cgbmV3IFJhbmdlRXJyb3IoXCJUaGUgY2VudHMgdmFsdWUgbXVzdCBiZSBiZXR3ZWVuIDAgYW5kIDEyN1wiKTtyZXR1cm4gdGhpcy5fY29udmVydENoYW5uZWxUb0FycmF5KGNoYW5uZWwpLmZvckVhY2goZnVuY3Rpb24oY2gpe3RoYXQuc2V0UmVnaXN0ZXJlZFBhcmFtZXRlcihcInBpdGNoYmVuZHJhbmdlXCIsW3NlbWl0b25lcyxjZW50c10sY2hhbm5lbCx7dGltZTpvcHRpb25zLnRpbWV9KX0pLHRoaXN9LE91dHB1dC5wcm90b3R5cGUuc2V0TW9kdWxhdGlvblJhbmdlPWZ1bmN0aW9uKHNlbWl0b25lcyxjZW50cyxjaGFubmVsLG9wdGlvbnMpe3ZhciB0aGF0PXRoaXM7aWYob3B0aW9ucz1vcHRpb25zfHx7fSxzZW1pdG9uZXM9cGFyc2VJbnQoc2VtaXRvbmVzKXx8MCwhKHNlbWl0b25lcz49MCYmMTI3Pj1zZW1pdG9uZXMpKXRocm93IG5ldyBSYW5nZUVycm9yKFwiVGhlIHNlbWl0b25lcyB2YWx1ZSBtdXN0IGJlIGJldHdlZW4gMCBhbmQgMTI3XCIpO2lmKGNlbnRzPXBhcnNlSW50KGNlbnRzKXx8MCwhKGNlbnRzPj0wJiYxMjc+PWNlbnRzKSl0aHJvdyBuZXcgUmFuZ2VFcnJvcihcIlRoZSBjZW50cyB2YWx1ZSBtdXN0IGJlIGJldHdlZW4gMCBhbmQgMTI3XCIpO3JldHVybiB0aGlzLl9jb252ZXJ0Q2hhbm5lbFRvQXJyYXkoY2hhbm5lbCkuZm9yRWFjaChmdW5jdGlvbihjaCl7dGhhdC5zZXRSZWdpc3RlcmVkUGFyYW1ldGVyKFwibW9kdWxhdGlvbnJhbmdlXCIsW3NlbWl0b25lcyxjZW50c10sY2hhbm5lbCx7dGltZTpvcHRpb25zLnRpbWV9KX0pLHRoaXN9LE91dHB1dC5wcm90b3R5cGUuc2V0TWFzdGVyVHVuaW5nPWZ1bmN0aW9uKHZhbHVlLGNoYW5uZWwsb3B0aW9ucyl7dmFyIHRoYXQ9dGhpcztpZihvcHRpb25zPW9wdGlvbnN8fHt9LHZhbHVlPXBhcnNlRmxvYXQodmFsdWUpfHwwLC02NT49dmFsdWV8fHZhbHVlPj02NCl0aHJvdyBuZXcgUmFuZ2VFcnJvcihcIlRoZSB2YWx1ZSBtdXN0IGJlIGEgZGVjaW1hbCBudW1iZXIgbGFyZ2VyIHRoYW4gLTY1IGFuZCBzbWFsbGVyIHRoYW4gNjQuXCIpO3ZhciBjb2Fyc2U9cGFyc2VJbnQodmFsdWUpKzY0LGZpbmU9dmFsdWUtcGFyc2VJbnQodmFsdWUpO2ZpbmU9TWF0aC5yb3VuZCgoZmluZSsxKS8yKjE2MzgzKTt2YXIgbXNiPWZpbmU+PjcmMTI3LGxzYj0xMjcmZmluZTtyZXR1cm4gdGhpcy5fY29udmVydENoYW5uZWxUb0FycmF5KGNoYW5uZWwpLmZvckVhY2goZnVuY3Rpb24oY2gpe3RoYXQuc2V0UmVnaXN0ZXJlZFBhcmFtZXRlcihcImNoYW5uZWxjb2Fyc2V0dW5pbmdcIixjb2Fyc2UsY2hhbm5lbCx7dGltZTpvcHRpb25zLnRpbWV9KSx0aGF0LnNldFJlZ2lzdGVyZWRQYXJhbWV0ZXIoXCJjaGFubmVsZmluZXR1bmluZ1wiLFttc2IsbHNiXSxjaGFubmVsLHt0aW1lOm9wdGlvbnMudGltZX0pfSksdGhpc30sT3V0cHV0LnByb3RvdHlwZS5zZXRUdW5pbmdQcm9ncmFtPWZ1bmN0aW9uKHZhbHVlLGNoYW5uZWwsb3B0aW9ucyl7dmFyIHRoYXQ9dGhpcztpZihvcHRpb25zPW9wdGlvbnN8fHt9LHZhbHVlPXBhcnNlSW50KHZhbHVlKXx8MCwhKHZhbHVlPj0wJiYxMjc+PXZhbHVlKSl0aHJvdyBuZXcgUmFuZ2VFcnJvcihcIlRoZSBwcm9ncmFtIHZhbHVlIG11c3QgYmUgYmV0d2VlbiAwIGFuZCAxMjdcIik7cmV0dXJuIHRoaXMuX2NvbnZlcnRDaGFubmVsVG9BcnJheShjaGFubmVsKS5mb3JFYWNoKGZ1bmN0aW9uKGNoKXt0aGF0LnNldFJlZ2lzdGVyZWRQYXJhbWV0ZXIoXCJ0dW5pbmdwcm9ncmFtXCIsdmFsdWUsY2hhbm5lbCx7dGltZTpvcHRpb25zLnRpbWV9KX0pLHRoaXN9LE91dHB1dC5wcm90b3R5cGUuc2V0VHVuaW5nQmFuaz1mdW5jdGlvbih2YWx1ZSxjaGFubmVsLG9wdGlvbnMpe3ZhciB0aGF0PXRoaXM7aWYob3B0aW9ucz1vcHRpb25zfHx7fSx2YWx1ZT1wYXJzZUludCh2YWx1ZSl8fDAsISh2YWx1ZT49MCYmMTI3Pj12YWx1ZSkpdGhyb3cgbmV3IFJhbmdlRXJyb3IoXCJUaGUgYmFuayB2YWx1ZSBtdXN0IGJlIGJldHdlZW4gMCBhbmQgMTI3XCIpO3JldHVybiB0aGlzLl9jb252ZXJ0Q2hhbm5lbFRvQXJyYXkoY2hhbm5lbCkuZm9yRWFjaChmdW5jdGlvbihjaCl7dGhhdC5zZXRSZWdpc3RlcmVkUGFyYW1ldGVyKFwidHVuaW5nYmFua1wiLHZhbHVlLGNoYW5uZWwse3RpbWU6b3B0aW9ucy50aW1lfSl9KSx0aGlzfSxPdXRwdXQucHJvdG90eXBlLnNlbmRDaGFubmVsTW9kZT1mdW5jdGlvbihjb21tYW5kLHZhbHVlLGNoYW5uZWwsb3B0aW9ucyl7aWYob3B0aW9ucz1vcHRpb25zfHx7fSxcInN0cmluZ1wiPT10eXBlb2YgY29tbWFuZCl7aWYoY29tbWFuZD13bS5NSURJX0NIQU5ORUxfTU9ERV9NRVNTQUdFU1tjb21tYW5kXSwhY29tbWFuZCl0aHJvdyBuZXcgVHlwZUVycm9yKFwiSW52YWxpZCBjaGFubmVsIG1vZGUgbWVzc2FnZSBuYW1lLlwiKX1lbHNlIGlmKGNvbW1hbmQ9cGFyc2VJbnQoY29tbWFuZCksIShjb21tYW5kPj0xMjAmJjEyNz49Y29tbWFuZCkpdGhyb3cgbmV3IFJhbmdlRXJyb3IoXCJDaGFubmVsIG1vZGUgbnVtZXJpY2FsIGlkZW50aWZpZXJzIG11c3QgYmUgYmV0d2VlbiAxMjAgYW5kIDEyNy5cIik7aWYodmFsdWU9cGFyc2VJbnQodmFsdWUpfHwwLDA+dmFsdWV8fHZhbHVlPjEyNyl0aHJvdyBuZXcgUmFuZ2VFcnJvcihcIlZhbHVlIG11c3QgYmUgYW4gaW50ZWdlciBiZXR3ZWVuIDAgYW5kIDEyNy5cIik7cmV0dXJuIHRoaXMuX2NvbnZlcnRDaGFubmVsVG9BcnJheShjaGFubmVsKS5mb3JFYWNoKGZ1bmN0aW9uKGNoKXt0aGlzLnNlbmQoKHdtLk1JRElfQ0hBTk5FTF9NRVNTQUdFUy5jaGFubmVsbW9kZTw8NCkrKGNoLTEpLFtjb21tYW5kLHZhbHVlXSx0aGlzLl9wYXJzZVRpbWVQYXJhbWV0ZXIob3B0aW9ucy50aW1lKSl9LmJpbmQodGhpcykpLHRoaXN9LE91dHB1dC5wcm90b3R5cGUuc2VuZFByb2dyYW1DaGFuZ2U9ZnVuY3Rpb24ocHJvZ3JhbSxjaGFubmVsLG9wdGlvbnMpe3ZhciB0aGF0PXRoaXM7aWYob3B0aW9ucz1vcHRpb25zfHx7fSxwcm9ncmFtPXBhcnNlSW50KHByb2dyYW0pLGlzTmFOKHByb2dyYW0pfHwwPnByb2dyYW18fHByb2dyYW0+MTI3KXRocm93IG5ldyBSYW5nZUVycm9yKFwiUHJvZ3JhbSBudW1iZXJzIG11c3QgYmUgYmV0d2VlbiAwIGFuZCAxMjcuXCIpO3JldHVybiB0aGlzLl9jb252ZXJ0Q2hhbm5lbFRvQXJyYXkoY2hhbm5lbCkuZm9yRWFjaChmdW5jdGlvbihjaCl7dGhhdC5zZW5kKCh3bS5NSURJX0NIQU5ORUxfTUVTU0FHRVMucHJvZ3JhbWNoYW5nZTw8NCkrKGNoLTEpLFtwcm9ncmFtXSx0aGF0Ll9wYXJzZVRpbWVQYXJhbWV0ZXIob3B0aW9ucy50aW1lKSl9KSx0aGlzfSxPdXRwdXQucHJvdG90eXBlLnNlbmRDaGFubmVsQWZ0ZXJ0b3VjaD1mdW5jdGlvbihwcmVzc3VyZSxjaGFubmVsLG9wdGlvbnMpe3ZhciB0aGF0PXRoaXM7b3B0aW9ucz1vcHRpb25zfHx7fSxwcmVzc3VyZT1wYXJzZUZsb2F0KHByZXNzdXJlKSwoaXNOYU4ocHJlc3N1cmUpfHwwPnByZXNzdXJlfHxwcmVzc3VyZT4xKSYmKHByZXNzdXJlPS41KTt2YXIgblByZXNzdXJlPU1hdGgucm91bmQoMTI3KnByZXNzdXJlKTtyZXR1cm4gdGhpcy5fY29udmVydENoYW5uZWxUb0FycmF5KGNoYW5uZWwpLmZvckVhY2goZnVuY3Rpb24oY2gpe3RoYXQuc2VuZCgod20uTUlESV9DSEFOTkVMX01FU1NBR0VTLmNoYW5uZWxhZnRlcnRvdWNoPDw0KSsoY2gtMSksW25QcmVzc3VyZV0sdGhhdC5fcGFyc2VUaW1lUGFyYW1ldGVyKG9wdGlvbnMudGltZSkpfSksdGhpc30sT3V0cHV0LnByb3RvdHlwZS5zZW5kUGl0Y2hCZW5kPWZ1bmN0aW9uKGJlbmQsY2hhbm5lbCxvcHRpb25zKXtcbnZhciB0aGF0PXRoaXM7aWYob3B0aW9ucz1vcHRpb25zfHx7fSxiZW5kPXBhcnNlRmxvYXQoYmVuZCksaXNOYU4oYmVuZCl8fC0xPmJlbmR8fGJlbmQ+MSl0aHJvdyBuZXcgUmFuZ2VFcnJvcihcIlBpdGNoIGJlbmQgdmFsdWUgbXVzdCBiZSBiZXR3ZWVuIC0xIGFuZCAxLlwiKTt2YXIgbkxldmVsPU1hdGgucm91bmQoKGJlbmQrMSkvMioxNjM4MyksbXNiPW5MZXZlbD4+NyYxMjcsbHNiPTEyNyZuTGV2ZWw7cmV0dXJuIHRoaXMuX2NvbnZlcnRDaGFubmVsVG9BcnJheShjaGFubmVsKS5mb3JFYWNoKGZ1bmN0aW9uKGNoKXt0aGF0LnNlbmQoKHdtLk1JRElfQ0hBTk5FTF9NRVNTQUdFUy5waXRjaGJlbmQ8PDQpKyhjaC0xKSxbbHNiLG1zYl0sdGhhdC5fcGFyc2VUaW1lUGFyYW1ldGVyKG9wdGlvbnMudGltZSkpfSksdGhpc30sT3V0cHV0LnByb3RvdHlwZS5fcGFyc2VUaW1lUGFyYW1ldGVyPWZ1bmN0aW9uKHRpbWUpe3ZhciBwYXJzZWQsdmFsdWU7cmV0dXJuXCJzdHJpbmdcIj09dHlwZW9mIHRpbWUmJlwiK1wiPT09dGltZS5zdWJzdHJpbmcoMCwxKT8ocGFyc2VkPXBhcnNlRmxvYXQodGltZSkscGFyc2VkJiZwYXJzZWQ+MCYmKHZhbHVlPXdtLnRpbWUrcGFyc2VkKSk6KHBhcnNlZD1wYXJzZUZsb2F0KHRpbWUpLHBhcnNlZD53bS50aW1lJiYodmFsdWU9cGFyc2VkKSksdmFsdWV9LE91dHB1dC5wcm90b3R5cGUuX2NvbnZlcnROb3RlVG9BcnJheT1mdW5jdGlvbihub3RlKXt2YXIgbm90ZXM9W107cmV0dXJuIEFycmF5LmlzQXJyYXkobm90ZSl8fChub3RlPVtub3RlXSksbm90ZS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pe25vdGVzLnB1c2god20uZ3Vlc3NOb3RlTnVtYmVyKGl0ZW0pKX0pLG5vdGVzfSxPdXRwdXQucHJvdG90eXBlLl9jb252ZXJ0Q2hhbm5lbFRvQXJyYXk9ZnVuY3Rpb24oY2hhbm5lbCl7aWYoKFwiYWxsXCI9PT1jaGFubmVsfHx2b2lkIDA9PT1jaGFubmVsKSYmKGNoYW5uZWw9W1wiYWxsXCJdKSxBcnJheS5pc0FycmF5KGNoYW5uZWwpfHwoY2hhbm5lbD1bY2hhbm5lbF0pLGNoYW5uZWwuaW5kZXhPZihcImFsbFwiKT4tMSl7Y2hhbm5lbD1bXTtmb3IodmFyIGk9MTsxNj49aTtpKyspY2hhbm5lbC5wdXNoKGkpfXJldHVybiBjaGFubmVsLmZvckVhY2goZnVuY3Rpb24oY2gpe2lmKCEoY2g+PTEmJjE2Pj1jaCkpdGhyb3cgbmV3IFJhbmdlRXJyb3IoXCJNSURJIGNoYW5uZWxzIG11c3QgYmUgYmV0d2VlbiAxIGFuZCAxNi5cIil9KSxjaGFubmVsfSxPdXRwdXQucHJvdG90eXBlLl9vbk1pZGlNZXNzYWdlPWZ1bmN0aW9uKGUpe30sXCJmdW5jdGlvblwiPT10eXBlb2YgZGVmaW5lJiZcIm9iamVjdFwiPT10eXBlb2YgZGVmaW5lLmFtZD9kZWZpbmUoW10sZnVuY3Rpb24oKXtyZXR1cm4gd219KTpcInVuZGVmaW5lZFwiIT10eXBlb2YgbW9kdWxlJiZtb2R1bGUuZXhwb3J0cz9tb2R1bGUuZXhwb3J0cz13bTpzY29wZS5XZWJNaWRpfHwoc2NvcGUuV2ViTWlkaT13bSl9KHRoaXMpOyIsIi8vIFVzZSBpdCBsaWtlIHRoaXM6ICBcbi8vIGNvbnN0IHN5bnRoID0gcmVxdWlyZSgncGx1Z2dhYmxlLXN5bnRoJylcbi8vIEJ1dCB0aGlzIGlzIHRoZSB0ZXN0XG5jb25zdCBwbHVnZ2FibGVTeW50aCA9IHJlcXVpcmUoJy4vaW5kZXgnKVxuY29uc3QgYXVkaW9DdHggPSBuZXcgQXVkaW9Db250ZXh0KCk7IFxuY29uc3QgbWFzdGVyR2FpbiA9IGF1ZGlvQ3R4LmNyZWF0ZUdhaW4oKTtcbm1hc3RlckdhaW4uZ2Fpbi52YWx1ZSA9IDAuMTtcblxuLyoqXG4gKiBBIHNpbXBsZSB0ZXN0IHN5bnRoXG4gKiBUaGUgc3ludGggd2hpY2ggaXMgZ29pbmcgdG8gYmUgY29ubmVjdGVkIHRvIHRoZSBwaWFub1xuICogbXVzdCBoYXZlIGEgYHN0YXJ0YCBhbmQgYSBgc3RvcGAgbWV0aG9kIFxuICovXG5mdW5jdGlvbiB0ZXN0U3ludGggKCkge1xuXG4gICAgdGhpcy5zdGFydCA9IGZ1bmN0aW9uIChmcmVxLCBvcHRpb25zKSB7XG4gICAgICAgIHRoaXMub3NjaWxsYXRvciA9IGF1ZGlvQ3R4LmNyZWF0ZU9zY2lsbGF0b3IoKTtcbiAgICAgICAgdGhpcy5vc2NpbGxhdG9yLnR5cGUgPSAnc3F1YXJlJztcbiAgICAgICAgdGhpcy5vc2NpbGxhdG9yLmZyZXF1ZW5jeS52YWx1ZSA9IGZyZXE7IC8vIHZhbHVlIGluIGhlcnR6XG4gICAgICAgIHRoaXMub3NjaWxsYXRvci5jb25uZWN0KG1hc3RlckdhaW4pO1xuICAgICAgICBtYXN0ZXJHYWluLmNvbm5lY3QoYXVkaW9DdHguZGVzdGluYXRpb24pO1xuICAgICAgICB0aGlzLm9zY2lsbGF0b3Iuc3RhcnQoKTtcbiAgICB9XG5cbiAgICB0aGlzLnN0b3AgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMub3NjaWxsYXRvci5zdG9wKCk7XG4gICAgfVxufVxuXG5cbiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uICgpIHtcblxuICAgIHZhciBlbGVtSUQgPSAncGlhbm8tY29udGFpbmVyJ1xuICAgIHZhciBwID0gbmV3IHBsdWdnYWJsZVN5bnRoKGVsZW1JRCwge1xuICAgICAgICBvY3RhdmVzOiAyLFxuICAgICAgICBvY3RhdmVCZWdpbjogMyAgICBcbiAgICB9KVxuICAgIFxuICAgIC8vIERyYXdzIHBpYW5vXG4gICAgcC5jcmVhdGVQaWFubygpXG5cbiAgICAvLyBTZXQgc3ludGhcbiAgICBwLnN5bnRoID0gdGVzdFN5bnRoXG4gICAgXG4gICAgLy8gRW5hYmxlIG9uZSBvY3RhdmUgb2Yga2V5Ym9hcmRcbiAgICBwLmVuYWJsZUtleWJvYXJkRXZlbnRzKClcbiAgICBcbiAgICAvLyBBbGwgbWlkaSB0b25lcyB3aWxsIGJlIHBsYXllZCwgYnV0IG9ubHkgdHdvIG9jdGF2ZXMgaXMgdmlzaWFibGVcbiAgICAvLyBQYXJhbSBpcyBtaWRpIHBvcnQuIE9uIGxpbnV4IHRoaXMgaXMgdGhlIGZpcnN0IGNvbm5lY3RlZCBtaWRpIGRldmljZVxuICAgIHAuZW5hYmxlTWlkaUV2ZW50cygxKVxuXG59KSJdfQ==
